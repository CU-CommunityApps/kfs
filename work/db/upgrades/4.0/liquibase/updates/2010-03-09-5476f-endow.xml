<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns='http://www.liquibase.org/xml/ns/dbchangelog/1.9' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd'>
  <changeSet author='Bonnie' id='5476f-1' dbms ="oracle" failOnError='true'>
    <comment>run all xx_V.sql to create view tables </comment>
    <createView viewName='END_KEMID_HIST_BAL_DET_V'>select B.kemid,B.hldg_ip_ind,(A.HIST_INC_CSH + B.VAL_AT_MARKET) as VAL_AT_MARKET,SEC_RPT_GRP,ANN_INC_EST,FY_REM_EST_INC,NEXT_FY_EST_INC,A.ME_DT_IDfrom END_HIST_CSH_T Ainner join(   select   B.kemid,   B.hldg_ip_ind,   sum(B.HLDG_MVAL) as VAL_AT_MARKET,   R.SEC_RPT_GRP as SEC_RPT_GRP,   sum(HLDG_ANNL_INC_EST) as ANN_INC_EST,   sum(HLDG_FY_REM_EST_INC) as FY_REM_EST_INC,   sum(HLDG_NEXT_FY_EST_INC) as NEXT_FY_EST_INC,   B.ME_DT_ID   from END_HLDG_HIST_T B, END_SEC_T S, END_CLS_CD_T CL, END_SEC_RPT_GRP_T R   where S.SEC_ID = B.SEC_ID   and S.SEC_CLS_CD = CL.SEC_CLS_CD   and CL.SEC_RPT_GRP = R.SEC_RPT_GRP   and B.hldg_ip_ind = 'I'   group by B.kemid, R.SEC_RPT_GRP, B.hldg_ip_ind, B.ME_DT_ID   order by kemid)B on B.kemid = A.kemid and B.ME_DT_ID = A.ME_DT_IDunionselectB.kemid,B.hldg_ip_ind,(A.HIST_PRIN_CSH + B.VAL_AT_MARKET) as VAL_AT_MARKET,SEC_RPT_GRP,ANN_INC_EST,FY_REM_EST_INC,NEXT_FY_EST_INC,A.ME_DT_IDfrom END_HIST_CSH_T Ainner join(   select   B.kemid,   B.hldg_ip_ind,   sum(B.HLDG_MVAL) as VAL_AT_MARKET,   R.SEC_RPT_GRP as SEC_RPT_GRP,   sum(HLDG_ANNL_INC_EST) as ANN_INC_EST,   sum(HLDG_FY_REM_EST_INC) as FY_REM_EST_INC,   sum(HLDG_NEXT_FY_EST_INC) as NEXT_FY_EST_INC,   B.ME_DT_ID   from END_HLDG_HIST_T B, END_SEC_T S, END_CLS_CD_T CL, END_SEC_RPT_GRP_T R   where S.SEC_ID = B.SEC_ID   and S.SEC_CLS_CD = CL.SEC_CLS_CD   and CL.SEC_RPT_GRP = R.SEC_RPT_GRP   and B.hldg_ip_ind = 'P'   group by B.kemid, R.SEC_RPT_GRP, B.hldg_ip_ind, B.ME_DT_ID   order by kemid)B on B.kemid = A.kemid and B.ME_DT_ID = A.ME_DT_ID</createView>
  </changeSet>
   <changeSet author='Bonnie' id='5476f-1a' dbms ="mysql" failOnError='true'>
    <comment>run all xx_V.sql to create view tables </comment>
    <createView viewName='END_KEMID_HIST_BAL_DET_V'><![CDATA[  
select
B.kemid,
B.hldg_ip_ind,
(A.HIST_INC_CSH + B.VAL_AT_MARKET) as VAL_AT_MARKET,
SEC_RPT_GRP,
ANN_INC_EST,
FY_REM_EST_INC,
NEXT_FY_EST_INC,
A.ME_DT_ID
from END_HIST_CSH_T A
inner join
(
   select
   B.kemid,
   B.hldg_ip_ind,
   sum(B.HLDG_MVAL) as VAL_AT_MARKET,
   R.SEC_RPT_GRP as SEC_RPT_GRP,
   sum(HLDG_ANNL_INC_EST) as ANN_INC_EST,
   sum(HLDG_FY_REM_EST_INC) as FY_REM_EST_INC,
   sum(HLDG_NEXT_FY_EST_INC) as NEXT_FY_EST_INC,
   B.ME_DT_ID
   from END_HLDG_HIST_T B, END_SEC_T S, END_CLS_CD_T CL, END_SEC_RPT_GRP_T R
   where S.SEC_ID = B.SEC_ID
   and S.SEC_CLS_CD = CL.SEC_CLS_CD
   and CL.SEC_RPT_GRP = R.SEC_RPT_GRP
   and B.hldg_ip_ind = 'I'
   group by B.kemid, R.SEC_RPT_GRP, B.hldg_ip_ind, B.ME_DT_ID
   order by kemid
)
B on B.kemid = A.kemid and B.ME_DT_ID = A.ME_DT_ID
union
select
B.kemid,
B.hldg_ip_ind,
(A.HIST_PRIN_CSH + B.VAL_AT_MARKET) as VAL_AT_MARKET,
SEC_RPT_GRP,
ANN_INC_EST,
FY_REM_EST_INC,
NEXT_FY_EST_INC,
A.ME_DT_ID
from END_HIST_CSH_T A
inner join
(
   select
   B.kemid,
   B.hldg_ip_ind,
   sum(B.HLDG_MVAL) as VAL_AT_MARKET,
   R.SEC_RPT_GRP as SEC_RPT_GRP,
   sum(HLDG_ANNL_INC_EST) as ANN_INC_EST,
   sum(HLDG_FY_REM_EST_INC) as FY_REM_EST_INC,
   sum(HLDG_NEXT_FY_EST_INC) as NEXT_FY_EST_INC,
   B.ME_DT_ID
   from END_HLDG_HIST_T B, END_SEC_T S, END_CLS_CD_T CL, END_SEC_RPT_GRP_T R
   where S.SEC_ID = B.SEC_ID
   and S.SEC_CLS_CD = CL.SEC_CLS_CD
   and CL.SEC_RPT_GRP = R.SEC_RPT_GRP
   and B.hldg_ip_ind = 'P'
   group by B.kemid, R.SEC_RPT_GRP, B.hldg_ip_ind, B.ME_DT_ID
   order by kemid
)
B on B.kemid = A.kemid and B.ME_DT_ID = A.ME_DT_ID
 	]]></createView> 
      </changeSet>
  
</databaseChangeLog>
