Index: build/external/work/staging/vnd/exclusion/placeholder.txt
===================================================================
Index: build/external/work/staging/sys/batchContainer/placeholder.txt
===================================================================
--- build/external/work/staging/sys/batchContainer/placeholder.txt	(revision 0)
+++ build/external/work/staging/sys/batchContainer/placeholder.txt	(revision 37225)
@@ -0,0 +1,105 @@
+  1.
+
+  My heart aches, and a drowsy numbness pains
+    My sense, as though of hemlock I had drunk,
+  Or emptied some dull opiate to the drains
+    One minute past, and Lethe-wards had sunk:
+  'Tis not through envy of thy happy lot,
+    But being too happy in thine happiness,--
+      That thou, light-winged Dryad of the trees,
+          In some melodious plot
+    Of beechen green, and shadows numberless,
+      Singest of summer in full-throated ease.                 10
+
+  2.
+
+  O, for a draught of vintage! that hath been
+    Cool'd a long age in the deep-delved earth,
+  Tasting of Flora and the country green,
+    Dance, and Provençal song, and sunburnt mirth!
+  O for a beaker full of the warm South,
+    Full of the true, the blushful Hippocrene,
+      With beaded bubbles winking at the brim,
+          And purple-stained mouth;
+    That I might drink, and leave the world unseen,
+      And with thee fade away into the forest dim:             20
+
+  3.
+
+  Fade far away, dissolve, and quite forget
+    What thou among the leaves hast never known,
+  The weariness, the fever, and the fret
+    Here, where men sit and hear each other groan;
+  Where palsy shakes a few, sad, last gray hairs,
+    Where youth grows pale, and spectre-thin, and dies;
+      Where but to think is to be full of sorrow
+          And leaden-eyed despairs,
+    Where Beauty cannot keep her lustrous eyes,
+      Or new Love pine at them beyond to-morrow.               30
+
+  4.
+
+  Away! away! for I will fly to thee,
+    Not charioted by Bacchus and his pards,
+  But on the viewless wings of Poesy,
+    Though the dull brain perplexes and retards:
+  Already with thee! tender is the night,
+    And haply the Queen-Moon is on her throne,
+      Cluster'd around by all her starry Fays;
+          But here there is no light,
+    Save what from heaven is with the breezes blown
+      Through verdurous glooms and winding mossy ways.         40
+
+  5.
+
+  I cannot see what flowers are at my feet,
+    Nor what soft incense hangs upon the boughs,
+  But, in embalmed darkness, guess each sweet
+    Wherewith the seasonable month endows
+  The grass, the thicket, and the fruit-tree wild;
+    White hawthorn, and the pastoral eglantine;
+      Fast fading violets cover'd up in leaves;
+          And mid-May's eldest child,
+    The coming musk-rose, full of dewy wine,
+      The murmurous haunt of flies on summer eves.             50
+
+  6.
+
+  Darkling I listen; and, for many a time
+    I have been half in love with easeful Death,
+  Call'd him soft names in many a mused rhyme,
+    To take into the air my quiet breath;
+  Now more than ever seems it rich to die,
+    To cease upon the midnight with no pain,
+      While thou art pouring forth thy soul abroad
+          In such an ecstasy!
+    Still wouldst thou sing, and I have ears in vain--
+      To thy high requiem become a sod.                        60
+
+  7.
+
+  Thou wast not born for death, immortal Bird!
+    No hungry generations tread thee down;
+  The voice I hear this passing night was heard
+    In ancient days by emperor and clown:
+  Perhaps the self-same song that found a path
+    Through the sad heart of Ruth, when, sick for home,
+      She stood in tears amid the alien corn;
+          The same that oft-times hath
+    Charm'd magic casements, opening on the foam
+      Of perilous seas, in faery lands forlorn.                70
+
+  8.
+
+  Forlorn! the very word is like a bell
+    To toll me back from thee to my sole self!
+  Adieu! the fancy cannot cheat so well
+    As she is fam'd to do, deceiving elf.
+  Adieu! adieu! thy plaintive anthem fades
+    Past the near meadows, over the still stream,
+      Up the hill-side; and now 'tis buried deep
+          In the next valley-glades:
+    Was it a vision, or a waking dream?
+      Fled is that music:--Do I wake or sleep?                 80
+
+-- John Keats
\ No newline at end of file
Index: build/external/log4j.properties
===================================================================
--- build/external/log4j.properties	(revision 30259)
+++ build/external/log4j.properties	(revision 37225)
@@ -96,4 +96,4 @@
 #log4j.logger.org.kuali.rice.kns.service.impl.PostProcessorServiceImpl=DEBUG
 #log4j.logger.org.kuali.rice.kns.util.WebUtils=DEBUG
 #log4j.logger.org.kuali.rice.kns.web.struts.pojo.PojoFormBase=DEBUG
-#log4j.logger.org.springframework.beans.factory.support.AbstractBeanDefinitionReader=DEBUG
+#log4j.logger.org.springframework.beans.factory.support.AbstractBeanDefinitionReader=DEBUG
\ No newline at end of file
Index: build/external/user/kfs-build.properties
===================================================================
--- build/external/user/kfs-build.properties	(revision 30259)
+++ build/external/user/kfs-build.properties	(revision 37225)
@@ -53,7 +53,7 @@
 rice.server.datasource.username=${datasource.username}
 rice.server.datasource.password=${datasource.password}
 
-tomcat.version=5
+tomcat.version=6
 
 #rice.ksb.batch.mode=true
 
Index: build/ContainerRunner.launch
===================================================================
--- build/ContainerRunner.launch	(revision 0)
+++ build/ContainerRunner.launch	(revision 37225)
@@ -0,0 +1,15 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<launchConfiguration type="org.eclipse.jdt.launching.localJavaApplication">
+<stringAttribute key="bad_container_name" value="BatchStepRunnerEclipseLauncher"/>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_PATHS">
+<listEntry value="/kfs/work/src/org/kuali/kfs/sys/context/BatchStepRunner.java"/>
+</listAttribute>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_TYPES">
+<listEntry value="1"/>
+</listAttribute>
+<booleanAttribute key="org.eclipse.debug.core.appendEnvironmentVariables" value="true"/>
+<stringAttribute key="org.eclipse.jdt.launching.MAIN_TYPE" value="org.kuali.kfs.sys.context.BatchStepRunner"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROGRAM_ARGUMENTS" value="batchContainerStep StepRunner.launch"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="kfs"/>
+<stringAttribute key="org.eclipse.jdt.launching.VM_ARGUMENTS" value="-Dcatalina.base=&quot;/java/servers/apache-tomcat-5.5.16&quot; -Dcatalina.home=&quot;/java/servers/apache-tomcat-5.5.16&quot; -Dwtp.deploy=&quot;/java/projects&quot; -Djava.endorsed.dirs=&quot;/java/servers/apache-tomcat-5.5.16/common/endorsed&quot; -Xmx2g -Xms768m -XX:MaxPermSize=384m -XX:PermSize=256m -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false"/>
+</launchConfiguration>
Index: build/properties/directory.properties
===================================================================
--- build/properties/directory.properties	(revision 30259)
+++ build/properties/directory.properties	(revision 37225)
@@ -19,10 +19,10 @@
 ##     structures under the base directories.
 #############################
 
-# Application server directories - these assume the Tomcat 5.5 structure
-tomcat.version=5
-#appserver.lib.dir=${appserver.home}/common/lib
-#appserver.classes.dir=${appserver.home}/common/classes
+# Application server directories - these assume the Tomcat 6.0 structure
+tomcat.version=6
+#appserver.lib.dir=${appserver.home}/lib
+#appserver.classes.dir=${appserver.home}/lib
 appserver.deploy.dir=${appserver.home}/webapps
 appserver.config.dir=${appserver.home}/conf
 appserver.localhost.dir=${appserver.config.dir}/Catalina/localhost
Index: build/properties/build.properties
===================================================================
--- build/properties/build.properties	(revision 30259)
+++ build/properties/build.properties	(revision 37225)
@@ -114,3 +114,6 @@
 xpp3*.jar,hibernate*.jar,asm*.jar,avalon*.jar,batik*.jar,cas*.jar,opensaml*.jar,saaj-impl*.jar,\
 struts-el*.jar,taglibs*.jar,wstx*.jar,xalan-serializer*.jar,xmlsec*.jar,connector-api*.jar,\
 abdera*.jar,backport*.jar,bcprov*.jar,wss4j*.jar,aopalliance*.jar
+
+# batch container
+step.status.check.interval=10
Index: build/TriggerRunner.launch
===================================================================
--- build/TriggerRunner.launch	(revision 0)
+++ build/TriggerRunner.launch	(revision 37225)
@@ -0,0 +1,15 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<launchConfiguration type="org.eclipse.jdt.launching.localJavaApplication">
+<stringAttribute key="bad_container_name" value="BatchStepRunnerEclipseLauncher"/>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_PATHS">
+<listEntry value="/iu/src/edu/iu/ebs/kfs/sys/context/BatchStepTrigger.java"/>
+</listAttribute>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_TYPES">
+<listEntry value="1"/>
+</listAttribute>
+<booleanAttribute key="org.eclipse.debug.core.appendEnvironmentVariables" value="true"/>
+<stringAttribute key="org.eclipse.jdt.launching.MAIN_TYPE" value="org.kuali.kfs.sys.context.BatchStepTrigger"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROGRAM_ARGUMENTS" value="nightlyOutStep nightlyOutJob 1 /java/work/kfs/snd/staging/sys/batchContainer 5"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="kfs"/>
+<stringAttribute key="org.eclipse.jdt.launching.VM_ARGUMENTS" value="-Dcatalina.base=&quot;/java/servers/apache-tomcat-5.5.16&quot; -Dcatalina.home=&quot;/java/servers/apache-tomcat-5.5.16&quot; -Dwtp.deploy=&quot;/java/projects&quot; -Djava.endorsed.dirs=&quot;/java/servers/apache-tomcat-5.5.16/common/endorsed&quot; -Xmx2g -Xms768m -XX:MaxPermSize=384m -XX:PermSize=256m -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false"/>
+</launchConfiguration>
Index: build/ContainerStopper.launch
===================================================================
--- build/ContainerStopper.launch	(revision 0)
+++ build/ContainerStopper.launch	(revision 37225)
@@ -0,0 +1,15 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<launchConfiguration type="org.eclipse.jdt.launching.localJavaApplication">
+<stringAttribute key="bad_container_name" value="BatchStepRunnerEclipseLauncher"/>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_PATHS">
+<listEntry value="/iu/src/edu/iu/ebs/kfs/sys/context/BatchStepTrigger.java"/>
+</listAttribute>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_TYPES">
+<listEntry value="1"/>
+</listAttribute>
+<booleanAttribute key="org.eclipse.debug.core.appendEnvironmentVariables" value="true"/>
+<stringAttribute key="org.eclipse.jdt.launching.MAIN_TYPE" value="org.kuali.kfs.sys.context.BatchStepTrigger"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROGRAM_ARGUMENTS" value="stopBatchContainerStep stopBatchContainerJob 1 /java/work/kfs/snd/staging/sys/batchContainer 5"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="kfs"/>
+<stringAttribute key="org.eclipse.jdt.launching.VM_ARGUMENTS" value="-Dcatalina.base=&quot;/java/servers/apache-tomcat-5.5.16&quot; -Dcatalina.home=&quot;/java/servers/apache-tomcat-5.5.16&quot; -Dwtp.deploy=&quot;/java/projects&quot; -Djava.endorsed.dirs=&quot;/java/servers/apache-tomcat-5.5.16/common/endorsed&quot; -Xmx2g -Xms768m -XX:MaxPermSize=384m -XX:PermSize=256m -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false"/>
+</launchConfiguration>
Index: test/unit/src/org/kuali/kfs/coa/service/CfdaServiceTest.java
===================================================================
--- test/unit/src/org/kuali/kfs/coa/service/CfdaServiceTest.java	(revision 0)
+++ test/unit/src/org/kuali/kfs/coa/service/CfdaServiceTest.java	(revision 37225)
@@ -0,0 +1,47 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.coa.service;
+
+import java.io.IOException;
+
+import org.kuali.kfs.coa.businessobject.CfdaUpdateResults;
+import org.kuali.kfs.coa.service.impl.CfdaServiceImpl;
+import org.kuali.kfs.sys.ConfigureContext;
+import org.kuali.kfs.sys.context.KualiTestBase;
+import org.kuali.kfs.sys.context.SpringContext;
+
+@ConfigureContext
+public class CfdaServiceTest extends KualiTestBase {
+
+//    public void testPatternExtraction() {
+//
+//        String[] table = { "<TD ALIGN=\"Center\" NOWRAP valign=\"TOP\"  WIDTH=\"0\"><A HREF=\"CATALOG.PROGRAM_TEXT_RPT.SHOW?p_arg_names=prog_nbr&p_arg_values=10.001\"><FONT STYLE = \"font-family:Arial; color:#00008B; font-size:10pt; \"><B><U>10.001</U></B></FONT></A></TD>\n", "<TD ALIGN=\"Left\" NOWRAP valign=\"TOP\"  WIDTH=\"0\"><FONT STYLE = \"font-family:Arial; font-size:10pt; \">USDA</FONT></TD>\n", "<TD ALIGN=\"Left\" NOWRAP valign=\"TOP\"  WIDTH=\"666\"><FONT STYLE = \"font-family:Arial; font-size:10pt; \">Agricultural Research_Basic and Applied Research</FONT></TD>" };
+//
+//        String n = ((CfdaServiceImpl)SpringContext.getBean(CfdaService.class)).extractCfdaNumberFrom(table[0]);
+//        String a = ((CfdaServiceImpl)SpringContext.getBean(CfdaService.class)).extractCfdaAgencyFrom(table[1]);
+//        String t = ((CfdaServiceImpl)SpringContext.getBean(CfdaService.class)).extractCfdaTitleFrom(table[2]);
+//
+//        assertEquals("Number extraction failed", "10.001", n);
+//        assertEquals("Agency extraction failed", "USDA", a);
+//        assertEquals("Title extraction failed", "Agricultural Research_Basic and Applied Research", t);
+//    }
+
+    public void testUpdate() throws IOException {
+        // Commented out since causing unit tests to pause for 15 minutes (and doesn't really test anything anyway)
+        //CfdaUpdateResults results = SpringContext.getBean(CfdaService.class).update();
+    }
+
+}
Index: test/unit/src/org/kuali/kfs/fp/service/CheckServiceTest.java
===================================================================
--- test/unit/src/org/kuali/kfs/fp/service/CheckServiceTest.java	(revision 30259)
+++ test/unit/src/org/kuali/kfs/fp/service/CheckServiceTest.java	(revision 37225)
@@ -57,7 +57,7 @@
         check.setFinancialDocumentDepositLineNumber(new Integer(2001));
         check.setSequenceId(new Integer(2001));
         check.setFinancialDocumentTypeCode("CR");
-        check.setCashieringRecordSource("R");
+        check.setCashieringStatus("C");//change
 
         // clean up remnants of earlier tests
         clearTestData();
Index: test/unit/src/org/kuali/kfs/fp/businessobject/CheckBaseTest.java
===================================================================
--- test/unit/src/org/kuali/kfs/fp/businessobject/CheckBaseTest.java	(revision 30259)
+++ test/unit/src/org/kuali/kfs/fp/businessobject/CheckBaseTest.java	(revision 37225)
@@ -40,7 +40,7 @@
     private static final Integer SEQ_ID = new Integer(1);
     private static final Integer DEPOSIT_LINE_NUMBER = new Integer(1);
     private static final String GENERAL_LEDGER_INPUT_TYPE = "CR";
-    private static final String CASHIERING_SOURCE = "R";
+    private static final String CASHIERING_STATUS = "C";
 
     @Override
     protected void setUp() throws Exception {
@@ -56,7 +56,7 @@
         crchk.setObjectId(GUID);
         crchk.setSequenceId(SEQ_ID);
         crchk.setVersionNumber(VER_NBR);
-        crchk.setCashieringRecordSource(CASHIERING_SOURCE);
+        crchk.setCashieringStatus(CASHIERING_STATUS);
         crchk.setFinancialDocumentTypeCode(GENERAL_LEDGER_INPUT_TYPE);
     }
 
@@ -71,6 +71,6 @@
         assertEquals(SEQ_ID, crchk.getSequenceId());
         assertEquals(VER_NBR, crchk.getVersionNumber());
         assertEquals(GENERAL_LEDGER_INPUT_TYPE, crchk.getFinancialDocumentTypeCode());
-        assertEquals(CASHIERING_SOURCE, crchk.getCashieringRecordSource());
+        assertEquals(CASHIERING_STATUS, crchk.getCashieringStatus());
     }
 }
Index: test/unit/src/org/kuali/kfs/fp/document/service/CashManagementServiceTest.java
===================================================================
--- test/unit/src/org/kuali/kfs/fp/document/service/CashManagementServiceTest.java	(revision 30259)
+++ test/unit/src/org/kuali/kfs/fp/document/service/CashManagementServiceTest.java	(revision 37225)
@@ -708,8 +708,8 @@
         crDoc.getDocumentHeader().setFinancialDocumentStatusCode(status);
 
         crDoc.setCheckEntryMode(CashReceiptDocument.CHECK_ENTRY_TOTAL);
-        crDoc.setTotalCashAmount(KualiDecimal.ZERO); // cash amounts are now calculated differently
-        crDoc.setTotalCheckAmount(checkAmount);
+        crDoc.setTotalConfirmedCashAmount(KualiDecimal.ZERO); // cash amounts are now calculated differently
+        crDoc.setTotalConfirmedCheckAmount(checkAmount);
 
         crDoc.setCampusLocationCode(campusCode);
 
Index: test/integration/src/org/kuali/kfs/sys/batch/service/impl/BatchFileAdminAuthorizationServiceTest.java
===================================================================
--- test/integration/src/org/kuali/kfs/sys/batch/service/impl/BatchFileAdminAuthorizationServiceTest.java	(revision 0)
+++ test/integration/src/org/kuali/kfs/sys/batch/service/impl/BatchFileAdminAuthorizationServiceTest.java	(revision 37225)
@@ -0,0 +1,70 @@
+package org.kuali.kfs.sys.batch.service.impl;
+
+
+
+import java.io.File;
+
+import org.kuali.kfs.sys.ConfigureContext;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.batch.BatchFile;
+import org.kuali.kfs.sys.batch.BatchFileUtils;
+import org.kuali.kfs.sys.batch.service.BatchFileAdminAuthorizationService;
+import org.kuali.kfs.sys.context.KualiTestBase;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.sys.fixture.UserNameFixture;
+import org.kuali.rice.kim.bo.Person;
+import org.kuali.rice.kim.bo.types.dto.AttributeSet;
+import org.kuali.rice.kns.service.KualiConfigurationService;
+import org.kuali.rice.kns.util.GlobalVariables;
+import org.kuali.rice.kns.util.KNSConstants;
+
+import org.kuali.kfs.sys.identity.KfsKimAttributes;
+
+/**
+ * Class to test implementation of the BatchFileAdminAuthorizationService
+ * 
+ */
+@ConfigureContext(session=UserNameFixture.khuntley)
+public class BatchFileAdminAuthorizationServiceTest extends KualiTestBase {
+    private BatchFileAdminAuthorizationServiceImpl batchFileAdminAuthorizationService;
+    private KualiConfigurationService kualiConfigurationService;
+    
+    @Override
+    protected void setUp() throws Exception {
+        super.setUp();
+        
+        batchFileAdminAuthorizationService = new BatchFileAdminAuthorizationServiceImpl();
+        kualiConfigurationService = SpringContext.getBean(KualiConfigurationService.class);
+    }
+
+    /**
+     * The super method sets an OS specific absolute path of the file into the 'filePath' attribute. 
+     * The IU class overrides this behavior by setting only the relative path and using '/' as the file separator
+     */
+    public void testGeneratePermissionDetails() {        
+        BatchFile batchFile = getBatchFile();
+        Person user = GlobalVariables.getUserSession().getPerson();
+        
+        //the method we're testing
+        AttributeSet permissionDetails = batchFileAdminAuthorizationService.generatePermissionDetails(batchFile, user);        
+        System.out.println(permissionDetails);
+
+        String permissionFilePath = permissionDetails.get(KfsKimAttributes.FILE_PATH);
+        String expectedFilePath = "staging/sys/batchContainer/placeholder.txt";
+        
+        assertEquals( "Wrong filePath was returned", expectedFilePath, permissionFilePath);
+    }
+    
+    private BatchFile getBatchFile() {
+        //Any batch file should do
+        String batchContainerDir = kualiConfigurationService.getPropertyString("staging.directory.sys.batchContainer");
+
+        String batchFileName = batchContainerDir + File.separator + "placeholder.txt";        
+        File file = new File(batchFileName).getAbsoluteFile();
+        
+        BatchFile batchFile = new BatchFile();
+        batchFile.setFile(file);        
+        
+        return batchFile;
+    }
+}
Index: test/integration/src/org/kuali/kfs/sys/identity/NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceFilePathTest.java
===================================================================
--- test/integration/src/org/kuali/kfs/sys/identity/NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceFilePathTest.java	(revision 0)
+++ test/integration/src/org/kuali/kfs/sys/identity/NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceFilePathTest.java	(revision 37225)
@@ -0,0 +1,199 @@
+package org.kuali.kfs.sys.identity;
+
+
+import java.util.ArrayList;
+import java.util.List;
+
+import org.kuali.kfs.sys.ConfigureContext;
+import org.kuali.kfs.sys.context.KualiTestBase;
+import org.kuali.rice.kim.bo.role.dto.KimPermissionInfo;
+import org.kuali.rice.kim.bo.types.dto.AttributeSet;
+
+/**
+ * Class to test implementation of the NamespacePermissionTypeService (allowing wildcards in the namespace and adding an additional attribute with wildcards).
+ * 
+ */
+@ConfigureContext 
+public class NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceFilePathTest 
+    extends KualiTestBase {
+    
+    private static final String PERMISSION_NAMESPACE_EXACT = "KFS-GL";
+    private static final String PERMISSION_NAMESPACE_PARTIAL = "KFS*";
+    private static final String PERMISSION_NAMESPACE_BLANK = null;
+    
+    private static final String PERMISSION_FILE_PATH_EXACT = "staging/gl/collectorXml/gl_collector1.xml";
+    private static final String PERMISSION_FILE_PATH_PARTIAL1 = "staging/gl/collectorXml/*";
+    private static final String PERMISSION_FILE_PATH_PARTIAL2 = "staging/*";
+    private static final String PERMISSION_FILE_PATH_WILDCARD = "*";
+    private static final String PERMISSION_FILE_PATH_BLANK = null;
+    
+    List<KimPermissionInfo> permissions = 
+        buildPermissionList( new String[][] 
+        { 
+            {"1", PERMISSION_NAMESPACE_EXACT,   PERMISSION_FILE_PATH_EXACT},     //KFS-GL:   staging/gl/collectorXml/gl_collector1.xml   -staging/gl/collectorXml/gl_collector1.xml
+            {"2", PERMISSION_NAMESPACE_EXACT,   PERMISSION_FILE_PATH_PARTIAL1},  //KFS-GL:   staging/gl/collectorXml/*                   -staging/gl/collectorXml/*  EXCEPT gl_collector1.xml   
+            {"3", PERMISSION_NAMESPACE_EXACT,   PERMISSION_FILE_PATH_BLANK},     //KFS-GL:   null                                        -reports/gl/*, staging/gl/* EXCEPT staging/gl/collectorXml/*
+            {"4", PERMISSION_NAMESPACE_PARTIAL, PERMISSION_FILE_PATH_EXACT},     //KFS*  :   staging/gl/collectorXml/gl_collector1.xml   -none
+            {"5", PERMISSION_NAMESPACE_PARTIAL, PERMISSION_FILE_PATH_PARTIAL2},  //KFS*  :   staging/*                                   -staging/* EXCEPT staging/gl/* and staging/workflow/*
+            {"6", PERMISSION_NAMESPACE_PARTIAL, PERMISSION_FILE_PATH_BLANK},     //KFS*  :   null                                        -reports/* EXCEPT reports/gl/*
+            {"7", PERMISSION_NAMESPACE_BLANK,   PERMISSION_FILE_PATH_EXACT},     //null  :   staging/gl/collectorXml/gl_collector1.xml   -none
+            {"8", PERMISSION_NAMESPACE_BLANK,   PERMISSION_FILE_PATH_WILDCARD},  //null  :   *                                           -staging/workflow/*
+                
+        } );
+
+    private static final String REQUESTED_NAMESPACE_EXACT_MATCH = "KFS-GL";
+    private static final String REQUESTED_NAMESPACE_PARTIAL_MATCH = "KFS-CAM";
+    private static final String REQUESTED_NAMESPACE_BLANK_MATCH = null;
+    
+    private NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceImpl permissionTypeService;
+    
+    @Override
+    public void setUp() throws Exception {
+        super.setUp();
+
+        permissionTypeService = new NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceImpl();
+        
+        permissionTypeService.setWildcardMatchStringAttributeName(KfsKimAttributes.FILE_PATH);
+        permissionTypeService.setNamespaceRequiredOnStoredAttributeSet(false);
+        permissionTypeService.setCheckRequiredAttributes(false);
+    }
+	
+    /**
+     * This test runs through all priority cases beginning with the least priority and adding a higher priority on each iteration. 
+     * The newest priority added should be returned in each case.
+     * 
+     */
+    public void testPerformMatches_moreExactMatch() {
+        //Iterate over the list of permissions beginning with the broadest match down to the most specific match
+        //With each iteration the results should return only one match and it should be the most specific match that was just added to the perms list
+        String requestedFilePathExactMatch = "staging/gl/collectorXml/gl_collector1.xml";
+        
+        AttributeSet requestedDetails = new AttributeSet();
+        requestedDetails.put(KfsKimAttributes.NAMESPACE_CODE, REQUESTED_NAMESPACE_EXACT_MATCH);
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathExactMatch);
+        
+        List<KimPermissionInfo> perms = new ArrayList<KimPermissionInfo>();
+        
+        for( int i = permissions.size(); i > 0; i--) {
+            perms.add(permissions.get(i-1));
+            
+            List<KimPermissionInfo> results = permissionTypeService.getMatchingPermissions(requestedDetails, perms);
+            
+            assertResults( perms, results, perms.size()-1 );
+        }
+    }
+    
+	public void testPerformMatches_namespace_exact_filepath_exact() {//PERMISSION 1
+	    //Only the first permission should be returned even though the requested details match all the permissions
+	    String requestedFilePathExactMatch = "staging/gl/collectorXml/gl_collector1.xml";
+	    
+        AttributeSet requestedDetails = new AttributeSet();
+        requestedDetails.put(KfsKimAttributes.NAMESPACE_CODE, REQUESTED_NAMESPACE_EXACT_MATCH);
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathExactMatch);
+	    
+        List<KimPermissionInfo> results = permissionTypeService.getMatchingPermissions(requestedDetails, permissions);
+        
+        assertResults( permissions, results, 0);
+	}
+	
+	public void testPerformMatches_namespace_exact_filepath_partial() {//PERMISSION 2
+	    //Partial match: Only the second permission should be returned even though the requested details match the 2nd, 3rd, 5th, 6th, and 8th permissions
+        String requestedFilePathPartialMatch = "staging/gl/collectorXml/gl_collector2.xml";
+        
+        AttributeSet requestedDetails = new AttributeSet();
+        requestedDetails.put(KfsKimAttributes.NAMESPACE_CODE, REQUESTED_NAMESPACE_EXACT_MATCH);
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathPartialMatch);
+        
+        List<KimPermissionInfo> results = permissionTypeService.getMatchingPermissions(requestedDetails, permissions);
+        
+        assertResults( permissions, results, 1);
+	}
+    
+    public void testPerformMatches_namespace_exact_filepath_blank() {//PERMISSION 3
+        //Blank match: Only the third permission should be returned even though the requested details match the 3rd, 5th, 6th, and 8th permissions
+        String requestedFilePathBlankMatchStaging = "staging/gl/enterpriseFeed/entp_test_file_001.data";
+        
+        AttributeSet requestedDetails = new AttributeSet();
+        requestedDetails.put(KfsKimAttributes.NAMESPACE_CODE, REQUESTED_NAMESPACE_EXACT_MATCH);
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathBlankMatchStaging);
+        
+        List<KimPermissionInfo> results = permissionTypeService.getMatchingPermissions(requestedDetails, permissions);
+        
+        assertResults( permissions, results, 2);
+        
+        //Blank match: Only the third permission should be returned even though the requested details match the 3rd, 6th, and 8th permissions
+        String requestedFilePathBlankMatchReports = "reports/gl/placeholder.txt";
+
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathBlankMatchReports);
+        
+        results = permissionTypeService.getMatchingPermissions(requestedDetails, permissions);
+        
+        assertResults( permissions, results, 2);
+    }
+    
+    public void testPerformMatches_namespace_partial_filepath_partial() {//PERMISSION 5
+        //Partial match: Only the fifth permission should be returned even though the requested details match the 5th, 6th, and 8th permissions
+        String requestedFilePathPartialMatch = "staging/cm/barcode/placeholder.txt";
+        
+        AttributeSet requestedDetails = new AttributeSet();
+        requestedDetails.put(KfsKimAttributes.NAMESPACE_CODE, REQUESTED_NAMESPACE_PARTIAL_MATCH);
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathPartialMatch);
+        
+        List<KimPermissionInfo> results = permissionTypeService.getMatchingPermissions(requestedDetails, permissions);
+        
+        assertResults( permissions, results, 4);
+    }
+    
+    public void testPerformMatches_namespace_partial_filepath_blank() {//PERMISSION 6
+        //Blank match: Only the sixth permission should be returned even though the requested details match the 6th and 8th permissions
+        String requestedFilePathBlankMatch = "reports/cm/placeholder.txt";
+        
+        AttributeSet requestedDetails = new AttributeSet();
+        requestedDetails.put(KfsKimAttributes.NAMESPACE_CODE, REQUESTED_NAMESPACE_PARTIAL_MATCH);
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathBlankMatch);
+        
+        List<KimPermissionInfo> results = permissionTypeService.getMatchingPermissions(requestedDetails, permissions);
+        
+        assertResults( permissions, results, 5);
+    }
+    
+    public void testPerformMatches_namespace_blank_filepath_blank() {//PERMISSION 8
+        //A null namespace in the request details should only match null namespaces in the permissions. They do not match all permissions.
+        //A null namespace in the permissions, however, behaves like a wildcard and matches any namespace, including null.
+        
+        //Therefore these request details should only match the eighth permission and not the 3rd, 5th, or 6th permissions
+        String requestedFilePathBlankMatch = "staging/workflow/loaded/placeholder.txt";
+        
+        AttributeSet requestedDetails = new AttributeSet();
+        requestedDetails.put(KfsKimAttributes.NAMESPACE_CODE, REQUESTED_NAMESPACE_BLANK_MATCH);
+        requestedDetails.put(KfsKimAttributes.FILE_PATH, requestedFilePathBlankMatch);
+        
+        List<KimPermissionInfo> results = permissionTypeService.getMatchingPermissions(requestedDetails, permissions);
+        
+        assertResults( permissions, results, 7);
+    }
+    
+    private void assertResults(List<KimPermissionInfo> permissionsList, List<KimPermissionInfo> resultsList, int permissionIndexExpected) {
+        String resultStrPrefix = "returned PERMISSION ";        
+        String resultStr = (resultsList.size() == 1 ? resultStrPrefix + resultsList.get(0).getPermissionId() +": " : "");
+        
+        System.out.println ( resultStr + resultsList );
+        
+        assertEquals( "Wrong nunmber of matches", 1, resultsList.size());
+        assertEquals( "Wrong permission was returned", permissionsList.get(permissionIndexExpected), resultsList.get(0));
+    }
+	
+	private List<KimPermissionInfo> buildPermissionList( String[][] permissionData ) {
+	    List<KimPermissionInfo> permissions = new ArrayList<KimPermissionInfo>();
+	    
+	    for ( String[] perm : permissionData ) {
+	        KimPermissionInfo kpi = new KimPermissionInfo();
+	        kpi.setDetails( new AttributeSet() );
+	        kpi.setPermissionId(perm[0]);
+	        kpi.getDetails().put(KfsKimAttributes.NAMESPACE_CODE, perm[1] );
+	        kpi.getDetails().put(KfsKimAttributes.FILE_PATH, perm[2] );
+	        permissions.add(kpi);
+	    }
+	    return permissions;        
+    }	
+}
Index: work/db/upgrades/iu_branch/document_types.xml
===================================================================
--- work/db/upgrades/iu_branch/document_types.xml	(revision 0)
+++ work/db/upgrades/iu_branch/document_types.xml	(revision 37225)
@@ -0,0 +1,190 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<data xmlns="ns:workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ns:workflow resource:WorkflowData">
+  <documentTypes xmlns="ns:workflow/DocumentType" xsi:schemaLocation="ns:workflow/DocumentType resource:DocumentType">
+  	<!-- KFSMI-5343 -->
+    <documentType>
+      <name>CRM</name>
+      <parent>AR</parent>
+      <label>Customer Credit Memo</label>
+      <docHandler>${application.url}/arCustomerCreditMemoDocument.do?methodToCall=docHandler</docHandler>
+      <active>true</active>
+      <routingVersion>2</routingVersion>
+      <routePaths>
+        <routePath>
+          <start name="AdHoc" nextNode="Account" />
+          <role name="Account" nextNode="AccountingOrganizationHierarchy"/>
+		  <role name="AccountingOrganizationHierarchy"/>
+        </routePath>
+      </routePaths>
+      <routeNodes>
+        <start name="AdHoc" />
+        <role name="Account">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+		<role name="AccountingOrganizationHierarchy">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+      </routeNodes>
+    </documentType>
+    <documentType>
+      <name>PCDM</name>
+      <parent>FPSM</parent>
+      <label>Procurement Card Default</label>
+      <active>true</active>
+      <routingVersion>2</routingVersion>
+    </documentType>
+    <!-- KFSMI-4606 -->
+     <documentType>
+      <name>ECD</name>
+      <parent>EC</parent>
+      <docHandler>${application.url}/effortEffortCertification.do?methodToCall=docHandler</docHandler>
+      <routePaths>
+        <routePath>
+          <start name="AdHoc" nextNode="ProjectManagement"/>
+          <requests name="ProjectManagement" nextNode="Account"/>
+          <requests name="Account" nextNode="AccountingOrganizationHierarchy"/>
+          <requests name="AccountingOrganizationHierarchy" nextNode="DoAwardSplit"/>
+          
+          <!-- FSKD-632 iu-custom: added routeNode -->
+          <split name="DoAwardSplit" nextNode="RequiresWorkstudyReview">
+            <branch name="True">
+              <role name="Award" nextNode="AwardJoin" />
+            </branch>
+            <branch name="False">
+              <simple name="AwardDoNothing" nextNode="AwardJoin" />
+            </branch>
+            <join name="AwardJoin" />
+          </split>
+		  <split name="RequiresWorkstudyReview" nextNode="DoRecreateSplit"> 
+  			<branch name="True"> 
+    			<requests name="Workstudy" nextNode="JoinRequiresWorkstudyReview" /> 
+  			</branch> 
+  			<branch name="False"> 
+    			<simple name="RequiresWorkstudyNoOp" nextNode="JoinRequiresWorkstudyReview" /> 
+  			</branch> 
+  			<join name="JoinRequiresWorkstudyReview" /> 
+		  </split>
+          
+          <split name="DoRecreateSplit">
+            <branch name="True">
+              <requests name="Management" nextNode="RecreateJoin"/>
+            </branch>
+            <branch name="False">
+              <simple name="RecreateDoNothing" nextNode="RecreateJoin"/>
+            </branch>
+            <join name="RecreateJoin"/>
+          </split>
+        </routePath>
+      </routePaths>
+      <routeNodes>
+        <start name="AdHoc"/>
+        <role name="ProjectManagement">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+        <role name="Account">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+        <role name="AccountingOrganizationHierarchy">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+        <role name="Award">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+        <role name="Management">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+        <split name="DoAwardSplit">
+          <type>org.kuali.kfs.sys.document.workflow.SimpleBooleanSplitNode</type>
+        </split>
+        <split name="DoRecreateSplit">
+          <type>org.kuali.kfs.sys.document.workflow.SimpleBooleanSplitNode</type>
+        </split>
+        <simple name="AwardDoNothing">
+          <type>org.kuali.rice.kew.engine.node.NoOpNode</type>
+        </simple>
+        <simple name="RecreateDoNothing">
+          <type>org.kuali.rice.kew.engine.node.NoOpNode</type>
+        </simple>
+        
+        <!-- FSKD-632 iu-custom: added routeNode -->
+        <split name="RequiresWorkstudyReview">
+          <type>org.kuali.kfs.sys.document.workflow.SimpleBooleanSplitNode</type>
+        </split>
+        <simple name="RequiresWorkstudyNoOp">
+          <type>org.kuali.rice.kew.engine.node.NoOpNode</type>
+        </simple>
+        <join name="JoinRequiresWorkstudyReview"/>
+        <role name="Workstudy">
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+          <activationType>P</activationType>
+        </role>
+        
+        <join name="AwardJoin"/>
+        <join name="RecreateJoin"/>
+      </routeNodes>
+    </documentType>
+    <documentType>
+      <name>PCDM</name>
+      <parent>FPSM</parent>
+      <label>Procurement Card Default</label>
+      <helpDefinitionURL>default.htm?turl=WordDocuments%2Fcreditcardtype.htm</helpDefinitionURL>
+      <active>true</active>
+      <routingVersion>2</routingVersion>
+    </documentType>
+    </documentTypes>
+<!-- KFSMI-6901 -->
+  <documentTypes xmlns="ns:workflow/DocumentType" xsi:schemaLocation="ns:workflow/DocumentType resource:DocumentType">
+    <documentType>
+      <name>POA</name>
+      <parent>PO</parent>
+      <label>Purchase Order Amendment</label>
+      <docHandler>${application.url}/purapPurchaseOrder.do?methodToCall=docHandler</docHandler>
+      <helpDefinitionURL>default.htm?turl=WordDocuments%2Fpurchaseorderamend.htm</helpDefinitionURL>
+      <active>true</active>
+      <routingVersion>2</routingVersion>
+      <routePaths>
+        <routePath>
+          <start name="AdHoc" nextNode="HasNewUnorderedItems" />
+          <split name="HasNewUnorderedItems" nextNode="Join">
+            <branch name="True">
+              <role name="NewUnorderedItems" nextNode="Join" />
+            </branch>
+            <branch name="False">
+              <simple name="NoOp" nextNode="Join" />
+            </branch>
+            <join name="Join" />
+          </split>
+        </routePath>
+      </routePaths>
+      <routeNodes>
+        <start name="AdHoc" />
+        <split name="HasNewUnorderedItems">
+          <type>org.kuali.kfs.sys.document.workflow.SimpleBooleanSplitNode</type>
+        </split>
+        <role name="NewUnorderedItems">
+          <!--<ruleTemplate>KualiNewUnorderedItemsTemplate</ruleTemplate>-->
+          <qualifierResolverClass>org.kuali.rice.kns.workflow.attribute.DataDictionaryQualifierResolver</qualifierResolverClass>
+        </role>
+        <join name="Join" />
+        <simple name="NoOp">
+          <type>org.kuali.rice.kew.engine.node.NoOpNode</type>
+        </simple>
+      </routeNodes>
+    </documentType>
+    <!-- KFSMI-7058 -->
+    <documentType>
+      <name>APDT</name>
+      <parent>CMSM</parent>
+      <label>Asset Payment Document Type</label>
+      <active>true</active>
+      <routingVersion>1</routingVersion>
+    </documentType>
+  </documentTypes>
+</data>
\ No newline at end of file
Index: work/db/upgrades/iu_branch/structure_changes.xml
===================================================================
--- work/db/upgrades/iu_branch/structure_changes.xml	(revision 0)
+++ work/db/upgrades/iu_branch/structure_changes.xml	(revision 37225)
@@ -0,0 +1,565 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
+                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
+
+    <changeSet author="jksmith" id="KFSMI6285_STRUCTURE_CHANGES">
+		<createTable tableName="FP_PRCRMNT_CARD_DFLT_T">
+            <column name="CC_NBR" type="VARCHAR2(16)">
+                <constraints nullable="false" primaryKey="true" primaryKeyName="FP_PRCRMNT_CARD_DFLT_TP1"/>
+            </column>
+            <column defaultValueNumeric="1" name="VER_NBR" type="NUMBER(8,0)">
+                <constraints nullable="false"/>
+            </column>
+            <column name="OBJ_ID" type="VARCHAR2(36)">
+                <constraints nullable="false" unique="true" uniqueConstraintName="FP_PRCRMNT_CARD_DFLT_TC0" />
+            </column>
+            <column name="CARD_HLDR_NM" type="VARCHAR2(123)" />
+            <column name="CARD_HLDR_ALTRNT_NM" type="VARCHAR2(123)" />
+            <column name="CARD_HLDR_LN1_ADDR" type="VARCHAR2(45)" />
+            <column name="CARD_HLDR_LN2_ADDR" type="VARCHAR2(45)" />
+            <column name="CARD_HLDR_CTY_NM" type="VARCHAR2(45)" />
+            <column name="CARD_HLDR_ST_CD" type="VARCHAR2(2)" />
+            <column name="CARD_HLDR_ZIP_CD" type="VARCHAR2(20)" />
+            <column name="CARD_HLDR_WRK_PHN_NBR" type="VARCHAR2(10)" />
+            <column name="CARD_LMT" type="NUMBER(19,2)" />
+            <column name="CARD_CYCLE_AMT_LMT" type="NUMBER(19,2)" />
+            <column name="CARD_CYCLE_VOL_LMT" type="NUMBER(19,2)" />
+            <column name="CARD_STAT_CD" type="VARCHAR2(2)" />
+            <column name="CARD_NTE_TXT" type="VARCHAR2(50)" />
+            <column name="FIN_COA_CD" type="VARCHAR2(2)" />
+            <column name="ACCOUNT_NBR" type="VARCHAR2(7)" />
+            <column name="SUB_ACCT_NBR" type="VARCHAR2(5)" />
+            <column name="FIN_OBJECT_CD" type="VARCHAR2(4)" />
+            <column name="FIN_SUB_OBJ_CD" type="VARCHAR2(3)" />
+            <column name="PROJECT_CD" type="VARCHAR2(10)" />
+            <column name="ROW_ACTV_IND" type="VARCHAR2(1)" />
+        </createTable>
+        <addForeignKeyConstraint constraintName="FP_PRCRMNT_CARD_DFLT_TR1"
+    		baseTableName="FP_PRCRMNT_CARD_DFLT_T" baseColumnNames="FIN_COA_CD"
+    		referencedTableName="CA_CHART_T" referencedColumnNames="FIN_COA_CD"
+		/>
+		<addForeignKeyConstraint constraintName="FP_PRCRMNT_CARD_DFLT_TR2"
+    		baseTableName="FP_PRCRMNT_CARD_DFLT_T" baseColumnNames="FIN_COA_CD, ACCOUNT_NBR"
+    		referencedTableName="CA_ACCOUNT_T" referencedColumnNames="FIN_COA_CD, ACCOUNT_NBR"
+		/>
+		<addForeignKeyConstraint constraintName="FP_PRCRMNT_CARD_DFLT_TR3"
+    		baseTableName="FP_PRCRMNT_CARD_DFLT_T" baseColumnNames="FIN_COA_CD, ACCOUNT_NBR, SUB_ACCT_NBR"
+    		referencedTableName="CA_SUB_ACCT_T" referencedColumnNames="FIN_COA_CD, ACCOUNT_NBR, SUB_ACCT_NBR"
+		/>
+		<addForeignKeyConstraint constraintName="FP_PRCRMNT_CARD_DFLT_TR4"
+    		baseTableName="FP_PRCRMNT_CARD_DFLT_T" baseColumnNames="PROJECT_CD"
+    		referencedTableName="CA_PROJECT_T" referencedColumnNames="PROJECT_CD"
+		/>
+	</changeSet>
+
+	<changeSet author="jksmith" id="KFSMI6617_STRUCTURE_CHANGES">
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_100_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_50_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_20_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_10_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_5_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_2_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_1_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_OTHR_DLR_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_100_CENT_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_50_CENT_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_25_CENT_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_10_CENT_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_5_CENT_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_1_CENT_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_DEPOSIT_HDR_T">
+			<column name="FDOC_MSTR_OTHR_CENT_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_COIN_DTL_T">
+			<column name="CSHR_STAT_CD" type="VARCHAR2(1)"/>
+		</addColumn>
+		<addColumn tableName="FP_CHECK_DTL_T">
+			<column name="CSHR_STAT_CD" type="VARCHAR2(1)"/>
+		</addColumn>
+		<addColumn tableName="FP_CURRENCY_DTL_T">
+			<column name="CSHR_STAT_CD" type="VARCHAR2(1)"/>
+		</addColumn>
+		<addColumn tableName="FP_CASH_RCPT_DOC_T">
+			<column name="FDOC_CNFRMD_CASH_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_CASH_RCPT_DOC_T">
+			<column name="FDOC_CNFRMD_CHCK_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<addColumn tableName="FP_CASH_RCPT_DOC_T">
+			<column name="FDOC_CNFRMD_COIN_AMT" type="NUMBER(19,2)"/>
+		</addColumn>
+		<dropColumn tableName="FP_DEPOSIT_HDR_T" columnName="FDOC_REF_NBR"/>
+		<dropPrimaryKey tableName="FP_CURRENCY_DTL_T" constraintName="FP_CURRENCY_DTL_TP1"/>
+		<dropPrimaryKey tableName="FP_CHECK_DTL_T" constraintName="FP_CHECK_DTL_TP1"/>
+		<dropPrimaryKey tableName="FP_COIN_DTL_T" constraintName="FP_COIN_DTL_TP1"/>		
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="CSHR_STAT_CD" value="C"/>
+			<where>FDOC_TYP_CD = 'CR' and FDOC_COLUMN_TYP_CD = 'C'</where>
+		</update>
+		<update tableName="FP_CHECK_DTL_T">
+			<column name="CSHR_STAT_CD" value="C"/>
+			<where>FDOC_TYP_CD = 'CR' and FDOC_COLUMN_TYP_CD = 'R'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="CSHR_STAT_CD" value="C"/>
+			<where>FDOC_TYP_CD = 'CR' and FDOC_COLUMN_TYP_CD = 'C'</where>
+		</update>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="CSHR_STAT_CD" value="R"/>
+			<where>FDOC_TYP_CD = 'CR' and FDOC_COLUMN_TYP_CD = 'R'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="CSHR_STAT_CD" value="R"/>
+			<where>FDOC_TYP_CD = 'CR' and FDOC_COLUMN_TYP_CD = 'R'</where>
+		</update>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="FDOC_TYP_CD" value="CMD"/>
+			<where>FDOC_TYP_CD = 'CM'</where>
+		</update>
+		<update tableName="FP_CHECK_DTL_T">
+			<column name="FDOC_TYP_CD" value="CMD"/>
+			<where>FDOC_TYP_CD = 'CM'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="FDOC_TYP_CD" value="CMD"/>
+			<where>FDOC_TYP_CD = 'CM'</where>
+		</update>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="CSHR_STAT_CD" value="R"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'R'</where>
+		</update>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="CSHR_STAT_CD" value="D"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'D'</where>
+		</update>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="CSHR_STAT_CD" value="O"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'O'</where>
+		</update>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="CSHR_STAT_CD" value="C"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'C'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="CSHR_STAT_CD" value="R"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'R'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="CSHR_STAT_CD" value="D"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'D'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="CSHR_STAT_CD" value="O"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'O'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="CSHR_STAT_CD" value="C"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'C'</where>
+		</update>
+		<update tableName="FP_CHECK_DTL_T">
+			<column name="CSHR_STAT_CD" value="R"/>
+			<where>FDOC_TYP_CD = 'CMD' and FDOC_COLUMN_TYP_CD = 'I'</where>
+		</update>
+		<delete tableName="FP_CURRENCY_DTL_T">
+			<where>FDOC_TYP_CD = 'BCS'</where>
+		</delete>
+		<delete tableName="FP_COIN_DTL_T">
+			<where>FDOC_TYP_CD = 'BCS'</where>
+		</delete>
+		<sql>
+			declare
+				v_fdoc_nbr FP_DEPOSIT_HDR_T.fdoc_nbr%TYPE;
+				v_fdoc_100_dlr_amt FP_CURRENCY_DTL_T.fdoc_100_dlr_amt%TYPE;
+				v_fdoc_50_dlr_amt FP_CURRENCY_DTL_T.fdoc_50_dlr_amt%TYPE;
+				v_fdoc_20_dlr_amt FP_CURRENCY_DTL_T.fdoc_20_dlr_amt%TYPE;
+				v_fdoc_10_dlr_amt FP_CURRENCY_DTL_T.fdoc_10_dlr_amt%TYPE;
+				v_fdoc_5_dlr_amt FP_CURRENCY_DTL_T.fdoc_5_dlr_amt%TYPE;
+				v_fdoc_2_dlr_amt FP_CURRENCY_DTL_T.fdoc_2_dlr_amt%TYPE;
+				v_fdoc_1_dlr_amt FP_CURRENCY_DTL_T.fdoc_1_dlr_amt%TYPE;
+				v_fdoc_othr_dlr_amt FP_CURRENCY_DTL_T.fdoc_othr_dlr_amt%TYPE;
+				v_fdoc_100_cent_amt FP_COIN_DTL_T.fdoc_100_cent_amt%TYPE;
+				v_fdoc_50_cent_amt FP_COIN_DTL_T.fdoc_50_cent_amt%TYPE;
+				v_fdoc_25_cent_amt FP_COIN_DTL_T.fdoc_25_cent_amt%TYPE;
+				v_fdoc_10_cent_amt FP_COIN_DTL_T.fdoc_10_cent_amt%TYPE;
+				v_fdoc_5_cent_amt FP_COIN_DTL_T.fdoc_5_cent_amt%TYPE;
+				v_fdoc_1_cent_amt FP_COIN_DTL_T.fdoc_1_cent_amt%TYPE;
+				v_fdoc_othr_cent_amt FP_COIN_DTL_T.fdoc_othr_cent_amt%TYPE;
+				
+				cursor currency_dtl_cursor is
+					select fdoc_nbr, fdoc_100_dlr_amt, fdoc_50_dlr_amt, fdoc_20_dlr_amt, fdoc_10_dlr_amt, fdoc_5_dlr_amt, fdoc_2_dlr_amt, fdoc_1_dlr_amt, fdoc_othr_dlr_amt
+					from fp_currency_dtl_t
+					where fdoc_typ_cd = 'CMD' and fdoc_column_typ_cd = 'M';
+				cursor coin_dtl_cursor is
+					select fdoc_nbr, fdoc_100_cent_amt, fdoc_50_cent_amt, fdoc_25_cent_amt, fdoc_10_cent_amt, fdoc_5_cent_amt, fdoc_1_cent_amt, fdoc_othr_cent_amt
+					from fp_coin_dtl_t
+					where fdoc_typ_cd = 'CMD' and fdoc_column_typ_cd = 'M';	
+			begin
+				if not currency_dtl_cursor%ISOPEN then
+					open currency_dtl_cursor;
+				end if;
+				loop
+					fetch currency_dtl_cursor into v_fdoc_nbr, v_fdoc_100_dlr_amt, v_fdoc_50_dlr_amt, v_fdoc_20_dlr_amt, v_fdoc_10_dlr_amt, v_fdoc_5_dlr_amt, v_fdoc_2_dlr_amt, v_fdoc_1_dlr_amt, v_fdoc_othr_dlr_amt;
+					exit when currency_dtl_cursor%NOTFOUND;
+					update fp_deposit_hdr_t set fdoc_mstr_100_dlr_amt = v_fdoc_100_dlr_amt, fdoc_mstr_50_dlr_amt = v_fdoc_50_dlr_amt, fdoc_mstr_20_dlr_amt = v_fdoc_20_dlr_amt, fdoc_mstr_10_dlr_amt = v_fdoc_10_dlr_amt, fdoc_mstr_5_dlr_amt = v_fdoc_5_dlr_amt, fdoc_mstr_2_dlr_amt = v_fdoc_2_dlr_amt, fdoc_mstr_1_dlr_amt = v_fdoc_1_dlr_amt, fdoc_mstr_othr_dlr_amt = v_fdoc_othr_dlr_amt where fdoc_nbr = v_fdoc_nbr;
+				end loop;
+				if not coin_dtl_cursor%ISOPEN then
+					open coin_dtl_cursor;
+				end if;
+				loop
+					fetch coin_dtl_cursor into v_fdoc_nbr, v_fdoc_100_cent_amt, v_fdoc_50_cent_amt, v_fdoc_25_cent_amt, v_fdoc_10_cent_amt, v_fdoc_5_cent_amt, v_fdoc_1_cent_amt, v_fdoc_othr_cent_amt;
+					exit when coin_dtl_cursor%NOTFOUND;
+					update fp_deposit_hdr_t set fdoc_mstr_100_cent_amt = v_fdoc_100_cent_amt, fdoc_mstr_50_cent_amt = v_fdoc_50_cent_amt, fdoc_mstr_25_cent_amt = v_fdoc_25_cent_amt, fdoc_mstr_10_cent_amt = v_fdoc_10_cent_amt, fdoc_mstr_5_cent_amt = v_fdoc_5_cent_amt, fdoc_mstr_1_cent_amt = v_fdoc_1_cent_amt, fdoc_mstr_othr_cent_amt = v_fdoc_othr_cent_amt where fdoc_nbr = v_fdoc_nbr;
+				end loop;
+			end;
+		</sql>
+		<delete tableName="FP_CURRENCY_DTL_T">
+			<where>fdoc_typ_cd = 'CMD' and fdoc_column_typ_cd = 'M'</where>
+		</delete>
+		<delete tableName="FP_COIN_DTL_T">
+			<where>fdoc_typ_cd = 'CMD' and fdoc_column_typ_cd = 'M'</where>
+		</delete>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="FDOC_TYP_CD" value="CR"/>
+			<column name="CSHR_STAT_CD" value="Q"/>
+			<where>FDOC_TYP_CD = 'CH' and fdoc_column_typ_cd = 'R'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="FDOC_TYP_CD" value="CR"/>
+			<column name="CSHR_STAT_CD" value="Q"/>
+			<where>FDOC_TYP_CD = 'CH' and fdoc_column_typ_cd = 'R'</where>
+		</update>
+		<update tableName="FP_CURRENCY_DTL_T">
+			<column name="FDOC_TYP_CD" value="CR"/>
+			<column name="CSHR_STAT_CD" value="G"/>
+			<where>FDOC_TYP_CD = 'CH' and fdoc_column_typ_cd = 'V'</where>
+		</update>
+		<update tableName="FP_COIN_DTL_T">
+			<column name="FDOC_TYP_CD" value="CR"/>
+			<column name="CSHR_STAT_CD" value="G"/>
+			<where>FDOC_TYP_CD = 'CH' and fdoc_column_typ_cd = 'V'</where>
+		</update>
+		<!-- implementers: think twice before running the lines below, they're to make sure test data works -->
+		<delete tableName="FP_CURRENCY_DTL_T">
+			<where>cshr_stat_cd is null</where>
+		</delete>
+		<delete tableName="FP_COIN_DTL_T">
+			<where>cshr_stat_cd is null</where>
+		</delete>
+		<addPrimaryKey tableName="FP_CURRENCY_DTL_T" columnNames="FDOC_NBR,  FDOC_TYP_CD, CSHR_STAT_CD" constraintName="FP_CURRENCY_DTL_TP1"/>
+		<addPrimaryKey tableName="FP_CHECK_DTL_T" columnNames="FDOC_NBR, FDOC_TYP_CD, CSHR_STAT_CD, FDOC_LINE_NBR" constraintName="FP_CHECK_DTL_TP1"/>
+		<addPrimaryKey tableName="FP_COIN_DTL_T" columnNames="FDOC_NBR,  FDOC_TYP_CD, CSHR_STAT_CD" constraintName="FP_COIN_DTL_TP1"/>
+		<dropColumn tableName="FP_CURRENCY_DTL_T" columnName="FDOC_COLUMN_TYP_CD"/>
+		<dropColumn tableName="FP_COIN_DTL_T" columnName="FDOC_COLUMN_TYP_CD"/>
+		<dropColumn tableName="FP_CHECK_DTL_T" columnName="FDOC_COLUMN_TYP_CD"/>
+		<modifySql dbms="mysql">
+			<replace replace="VARCHAR2" with="VARCHAR" />
+		</modifySql>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI307_STRUCTURE_CHANGES">
+		<addColumn tableName="FP_DV_DOC_T">
+			<column name="IMD_PMT_IND" type="VARCHAR2(1)"/>
+		</addColumn>
+	</changeSet>
+	
+	<changeSet author="kekanaya" id="KFSMI4123_STRUCTURE_CHANGES">
+		<addColumn tableName="FP_CASH_RCPT_DOC_T">
+			<column name="FDOC_BNK_CD" type="VARCHAR2(4)"/>
+		</addColumn>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6858_REMOVE_USELESS_CR_ARTIFACTS">
+		<comment>Removes unused and non-informative FP_REVOLVFND_DTL_T table and FDOC_COLUMN_TYP_CD columns from FP_ADV_DPST_DTL_T and FP_CR_CARD_DTL_T.</comment>
+		<dropTable tableName="FP_REVOLVFND_DTL_T"/>
+		<dropPrimaryKey tableName="FP_ADV_DPST_DTL_T" constraintName="FP_ADV_DPST_DTL_TP1"/>
+		<dropColumn tableName="FP_ADV_DPST_DTL_T" columnName="FDOC_COLUMN_TYP_CD"/>
+		<addPrimaryKey tableName="FP_ADV_DPST_DTL_T" constraintName="FP_ADV_DPST_DTL_TP1" columnNames="FDOC_NBR,  FDOC_TYP_CD, FDOC_LINE_NBR"/>
+		<dropPrimaryKey tableName="FP_CR_CARD_DTL_T" constraintName="FP_CR_CARD_DTL_TP1"/>
+		<dropColumn tableName="FP_CR_CARD_DTL_T" columnName="FDOC_COLUMN_TYP_CD"/>
+		<addPrimaryKey tableName="FP_CR_CARD_DTL_T" constraintName="FP_CR_CARD_DTL_TP1" columnNames="FDOC_NBR,  FDOC_TYP_CD, FDOC_LINE_NBR"/>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6905_ADD_ACH_ELIGIBLE_TO_PAYEE_TYPE">
+		<comment>Add column to PDP's payee type table to say whether the payee type is ACH eligible or not.  Original SQL version by Ying Feng.</comment>
+		<addColumn tableName="PDP_PAYEE_TYP_T">
+			<column name="ACH_ELGBL_IND" type="VARCHAR2(1)"/>
+		</addColumn>
+		<update tableName="PDP_PAYEE_TYP_T">
+			<column name="ACH_ELGBL_IND" value="N"/>
+		</update>
+		<update tableName="PDP_PAYEE_TYP_T">
+			<column name="ACH_ELGBL_IND" value="Y"/>
+			<where>PAYEE_TYP_CD in ('E','V', 'T')</where>
+		</update>
+	</changeSet>
+	
+	<changeSet author="schoo" id="KFSMI-6709_STRUCTURE_CHANGES">
+		<renameTable oldTableName="GL_EXPEND_TRN_T" newTableName="GL_EXPEND_TRN_MT"/>
+	</changeSet>
+	
+	<changeSet author="schoo" id="KFSMI-KFSMI-6629_STRUCTURE_CHANGES">
+		<modifyColumn tableName='CM_CPTLAST_DTL_T'>
+      		<column name='AST_OFFCMP_ADDR' type='VARCHAR2(45)' />
+    	</modifyColumn>
+    	<modifyColumn tableName='CM_AST_TRNFR_DOC_T'>
+      		<column name='AST_OFFCMP_ADDR' type='VARCHAR2(45)' />
+    	</modifyColumn>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI7058_ASSET_PMT_DOC_TABLE_AND_SAMPLE_DATA">
+		<createSequence sequenceName="CM_AST_PMT_DOC_TYP_SEQ" startValue="20" incrementBy="1" />
+		<createTable tableName="CM_AST_PMT_DOC_TYP_T">
+            <column name="DOC_TYP_ID" type="NUMBER(7,0)">
+                <constraints nullable="false" primaryKey="true" primaryKeyName="CM_AST_PMT_DOC_TYP_T_TP1"/>
+            </column>
+            <column defaultValueNumeric="1" name="VER_NBR" type="NUMBER(8,0)">
+                <constraints nullable="false"/>
+            </column>
+            <column name="OBJ_ID" type="VARCHAR2(36)">
+                <constraints nullable="false" unique="true" uniqueConstraintName="CM_AST_PMT_DOC_TYP_T_TC0" />
+            </column>
+            <column name="DOC_TYP_NM" type="VARCHAR2(4)" />
+            <column name="ACTV_IND" type="VARCHAR2(1)" />
+        </createTable>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="1" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="AA" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="2" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="MPAY" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="3" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="AD" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="4" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="CR" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="5" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="CCR" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="6" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="DI" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="7" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="DV" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="8" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="GEC" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="9" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="IB" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="10" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="JV" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="11" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="SB" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="12" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="YEDI" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="13" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="YEGE" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="14" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="PCDO" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="15" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="PREQ" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="16" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="CM" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+        <insert tableName="CM_AST_PMT_DOC_TYP_T">
+        	<column name="DOC_TYP_ID" value="17" />
+        	<column name="OBJ_ID" value="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+        	<column name="DOC_TYP_NM" value="ND" />
+        	<column name="ACTV_IND" value="Y"/>
+        </insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6999_RENAME_CFDA_REF_T">
+		<renameTable oldTableName="CG_CFDA_REF_T" newTableName="CA_CFDA_REF_T"/>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6965_PCDO_ACCT_LINES_DESC">
+		<comment>Adds column to hold description to PCDO accounting lines</comment>
+		<addColumn tableName="FP_PRCRMNT_ACCT_LINES_T">
+			<column name="FDOC_LINE_DESC" type="VARCHAR2(40)" />
+		</addColumn>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSCNTRB641_ADD_ACTIVE_INDICATORS_TO_CAMS_TABLES">
+		<comment>Adds active indicators to three CAMS tables.</comment>
+		<addColumn tableName="CM_AST_COMPONENT_T">
+			<column name="ACTV_IND" type="VARCHAR2(1)"/>
+		</addColumn>
+		<update tableName="CM_AST_COMPONENT_T">
+			<column name="ACTV_IND" value="Y"/>
+		</update>
+		<addColumn tableName="CM_AST_WRNTY_T">
+			<column name="ACTV_IND" type="VARCHAR2(1)"/>
+		</addColumn>
+		<update tableName="CM_AST_WRNTY_T">
+			<column name="ACTV_IND" value="Y"/>
+		</update>
+		<addColumn tableName="CM_AST_RPR_HIST_T">
+			<column name="ACTV_IND" type="VARCHAR2(1)"/>
+		</addColumn>
+		<update tableName="CM_AST_RPR_HIST_T">
+			<column name="ACTV_IND" value="Y"/>
+		</update>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSCNTRB162_DEBARRED_VENDOR_TABLES">
+		<comment>Alters and creates tables as necessary for the debarred vendor tracking process.</comment>
+		<addColumn tableName="PUR_REQS_T">
+			<column name="VNDR_DEBRD_REAS_TXT" type="VARCHAR2(255)"/>
+		</addColumn>
+		<addColumn tableName="PUR_PO_T">
+			<column name="VNDR_DEBRD_REAS_TXT" type="VARCHAR2(255)"/>
+		</addColumn>
+		<createSequence sequenceName="PUR_VNDR_EXCL_MTCH_T_SEQ" startValue="1" incrementBy="1" minValue="1"/>
+		<createTable tableName="PUR_VNDR_EXCL_MT">
+			<column name="VNDR_EXCL_ID" type="NUMBER(10,0)">
+				<constraints primaryKey="true" nullable="false"/>
+			</column>
+			<column name="VNDR_EXCL_LOAD_DT" type="DATE"/>
+			<column name="VNDR_EXCL_NM" type="VARCHAR2(200)"/>
+			<column name="VNDR_EXCL_LN1_ADDR" type="VARCHAR2(150)"/>
+			<column name="VNDR_EXCL_LN2_ADDR" type="VARCHAR2(50)"/>
+			<column name="VNDR_EXCL_CTY_NM" type="VARCHAR2(50)"/>
+			<column name="VNDR_EXCL_ST_CD" type="VARCHAR2(2)"/>
+			<column name="VNDR_EXCL_PRVN_NM" type="VARCHAR2(20)"/>
+			<column name="VNDR_EXCL_ZIP_CD" type="VARCHAR2(20)"/>
+			<column name="VNDR_EXCL_OTHR_NM" type="VARCHAR2(1000)"/>
+			<column name="VNDR_EXCL_DESC_TXT" type="VARCHAR2(1000)"/>
+		</createTable>
+		<createTable tableName="PUR_VNDR_EXCL_MTCH_T">
+			<column name="VNDR_EXCL_ID" type="NUMBER(10,0)">
+				<constraints primaryKey="true" nullable="false"/>
+			</column>
+			<column name="OBJ_ID" type="VARCHAR2(36)">
+				<constraints nullable="false" unique="true"/>
+			</column>
+			<column name="VER_NBR" type="NUMBER(8,0)">
+				<constraints nullable="false"/>
+			</column>
+			<column name="VNDR_HDR_GNRTD_ID" type="NUMBER(10,0)">
+				<constraints nullable="false"/>
+			</column>
+			<column name="VNDR_DTL_ASND_ID" type="NUMBER(10,0)">
+				<constraints nullable="false"/>
+			</column>
+			<column name="VNDR_ADDR_GNRTD_ID" type="NUMBER(10,0)"/>
+			<column name="VNDR_EXCL_CFRM_STAT_CD" type="VARCHAR2(10)"/>
+			<column name="VNDR_EXCL_LOAD_DT" type="DATE"/>
+			<column name="VNDR_EXCL_NM" type="VARCHAR2(200)"/>
+			<column name="VNDR_EXCL_LN1_ADDR" type="VARCHAR2(150)"/>
+			<column name="VNDR_EXCL_LN2_ADDR" type="VARCHAR2(50)"/>
+			<column name="VNDR_EXCL_CTY_NM" type="VARCHAR2(50)"/>
+			<column name="VNDR_EXCL_ST_CD" type="VARCHAR2(2)"/>
+			<column name="VNDR_EXCL_PRVN_NM" type="VARCHAR2(20)"/>
+			<column name="VNDR_EXCL_ZIP_CD" type="VARCHAR2(20)"/>
+			<column name="VNDR_EXCL_OTHR_NM" type="VARCHAR2(1000)"/>
+			<column name="VNDR_EXCL_DESC_TXT" type="VARCHAR2(1000)"/>
+			<column name="LST_UPDT_TS" type="DATE"/>
+			<column name="LST_UPDT_PRNCPL_NM" type="VARCHAR2(100)"/>
+		</createTable>
+		<addForeignKeyConstraint constraintName="PUR_VNDR_EXCL_MTCH_TP1" baseTableName="PUR_VNDR_EXCL_MTCH_T" baseColumnNames="VNDR_HDR_GNRTD_ID" referencedTableName="PUR_VNDR_HDR_T" referencedColumnNames="VNDR_HDR_GNRTD_ID"/>
+		<addForeignKeyConstraint constraintName="PUR_VNDR_EXCL_MTCH_TP2" baseTableName="PUR_VNDR_EXCL_MTCH_T" baseColumnNames="VNDR_HDR_GNRTD_ID,VNDR_DTL_ASND_ID" referencedTableName="PUR_VNDR_DTL_T" referencedColumnNames="VNDR_HDR_GNRTD_ID,VNDR_DTL_ASND_ID"/>
+	</changeSet>
+</databaseChangeLog>
\ No newline at end of file
Index: work/db/upgrades/iu_branch/rice_data.xml
===================================================================
--- work/db/upgrades/iu_branch/rice_data.xml	(revision 0)
+++ work/db/upgrades/iu_branch/rice_data.xml	(revision 37225)
@@ -0,0 +1,921 @@
+<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
+	
+	<changeSet author="jksmith" id="KFSMI6342_UNORDERED_LINE_ITEM_MESSAGE_PARAMETER">
+		<comment>Adds parameter for warning message for when user clicks "add unordered item" button</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PURAP" />
+			<column name="PARM_DTL_TYP_CD" value="LineItemReceiving" />
+			<column name="PARM_NM" value="UNORDERED_ITEM_WARNING_IND" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="Y" />
+			<column name="PARM_DESC_TXT" value="Indicates whether a warning message shall be given when a user clicks &quot;add unordered item&quot; button. When set to Y the user will receive a warning." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6315_SEMAPHORE_PROCESSING_INTERVAL_INSERTION">
+		<comment>Adds parameter for semaphore processing interval</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-SYS" />
+			<column name="PARM_DTL_TYP_CD" value="BatchContainerStep" />
+			<column name="PARM_NM" value="SEMAPHORE_PROCESSING_INTERVAL" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="3000" />
+			<column name="PARM_DESC_TXT" value="Controls the frequency (in milliseconds) with which the batch container (BatchContainerStep) will check for semaphore step files to process. The semaphore files are created by the brte scripts via BatchStepTrigger." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI5346_ACH_CC_PARAMETER">
+		<comment>Adds parameter for KFSMI-5346 cc address for ACH notifications</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="PARM_DTL_TYP_CD" value="SendAchAdviceNotificationsStep" />
+			<column name="PARM_NM" value="ACH_SUMMARY_CC_EMAIL_ADDRESSES" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="knoreceipt-l@indiana.edu" />
+			<column name="PARM_DESC_TXT" value="The pdpSendAchAdviceNotificationsJob generates ACH payment summary email notifications for payees and copies of these emails are sent to the email address(es) specified in this parameter." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6527_CHANGE_REQUEST_ENABLE_PARAMETER">
+		<comment>Adds parameter for KFSMI-6527 which enables or disables change request on the CR</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-FP" />
+			<column name="PARM_DTL_TYP_CD" value="CashReceipt" />
+			<column name="PARM_NM" value="CHANGE_REQUEST_ENABLED_IND" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="Y" />
+			<column name="PARM_DESC_TXT" value="Indicator to turn Cash receipt change request ability on and off." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6653_UPDATE_BANK_CODE_DOCUMENT_TYPES_PARAMETER">
+		<comment>Updates the parameter KFS-SYS / Bank / BANK_CODE_DOCUMENT_TYPES to take out document types which permanently have bank codes.</comment>
+		<update tableName="KRNS_PARM_T">
+			<column name="TXT" value="DV;PREQ;CM;CTRL"/>
+			<where>NMSPC_CD = 'KFS-SYS' and PARM_DTL_TYP_CD = 'Bank' and APPL_NMSPC_CD = 'KFS' and PARM_NM = 'BANK_CODE_DOCUMENT_TYPES'</where>
+		</update>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI307_IMMEDIATE_DV_DISBURSEMENT_PERMISSION">
+		<comment>Creates a permission to allow KFS-SYS Operations and KFS-FP Disbursement Manager to set a DV for immediate disbursement.</comment>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSSYS6007"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_TMPL_ID" valueNumeric="(select perm_tmpl_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Transactional Document')"/>
+			<column name="NMSPC_CD" value="KFS-FP"/>
+			<column name="NM" value="Use Transactional Document"/>
+			<column name="DESC_TXT" value="Allow Disbursement Voucher to be marked for immediate disbursement by the Pre-Disbursement Processor."/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSSYS6007-1"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_ID" value="KFSSYS6007"/>
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Transactional Document')"/>
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nm = 'documentTypeName')"/>
+			<column name="ATTR_VAL" value="DV"/>
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSSYS6007-2"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_ID" value="KFSSYS6007"/>
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Transactional Document')"/>
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nm = 'editMode')"/>
+			<column name="ATTR_VAL" value="immediateDisbursementEntryMode"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSSYS6007-1"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-FP' and role_nm = 'Disbursement Manager')"/>
+			<column name="PERM_ID" value="KFSSYS6007"/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSSYS6007-2"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-SYS' and role_nm = 'Operations')"/>
+			<column name="PERM_ID" value="KFSSYS6007"/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI307_DV_IMMEDIATE_EXTRACT_MAIL_PARAMS">
+		<comment>Adds parameters for the from addresses and the to addresses for Disbursement Vouchers which were immediately extracted.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-FP" />
+			<column name="PARM_DTL_TYP_CD" value="DisbursementVoucher" />
+			<column name="PARM_NM" value="IMMEDIATE_EXTRACT_NOTIFICATION_FROM_EMAIL_ADDRESS" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="knoreceipt-l@indiana.edu" />
+			<column name="PARM_DESC_TXT" value="Email address which sends out the notification that a disbursement voucher was prepared for immediate extraction." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-FP" />
+			<column name="PARM_DTL_TYP_CD" value="DisbursementVoucher" />
+			<column name="PARM_NM" value="IMMEDIATE_EXTRACT_NOTIFICATION_TO_EMAIL_ADDRESSES" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="knoreceipt-l@indiana.edu" />
+			<column name="PARM_DESC_TXT" value="Email addresses which receive notification that a disbursement voucher was prepared for immediate extraction." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI5918_COLLECTOR_FAILURE_SUBJECT_PARAM">
+		<comment>Adds parameter for KFSMI-5918 subject for Collector notification e-mail when failures occur</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-GL" />
+			<column name="PARM_DTL_TYP_CD" value="CollectorStep" />
+			<column name="PARM_NM" value="VALIDATION_ERROR_EMAIL_SUBJECT_LINE" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="File Uploaded Not Processed" />
+			<column name="PARM_DESC_TXT" value="This is the subject line used when the collector sends out email relating to a file that failed validation." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6285_PROCUREMENT_CARD_DEFAULT_PARAMETERS">
+		<comment>Create parameters which turn on various fields in the ProcurementCardDefault business object</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-FP" />
+			<column name="PARM_DTL_TYP_CD" value="ProcurementCardCreateDocumentsStep" />
+			<column name="PARM_NM" value="PROCUREMENT_CARD_ACCOUNTING_DEFAULT_IND" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="N" />
+			<column name="PARM_DESC_TXT" value="If yes, accounting information is displayed / required on the Procurement Card Document Default maintenance document and accounting line information on the Procurement Card document is populated from Procurement Card Document Default table, if present.  If accounting information does not exist in the reference table for a given credit card, the ERROR_TRANSACTION* parameter values will be used.  If No, the accounting line information on the Procurement Card document is generated from the bank file." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-FP" />
+			<column name="PARM_DTL_TYP_CD" value="ProcurementCardCreateDocumentsStep" />
+			<column name="PARM_NM" value="PROCUREMENT_CARD_HOLDER_DEFAULT_IND" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="N" />
+			<column name="PARM_DESC_TXT" value="If yes, cardholder information is displayed / required on the Procurement Card Document Default maintenance document and cardholder information on the Procurement Card document is populated from Procurement Card Document Default table, if present.  If No, the cardholder information on the Procurement Card document is generated from the bank file." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6809_DEPRECIATION_BLANK_OUT_PARAMS">
+		<comment>Adds parameters to control the more finely tuned running of the Asset Depreciation job during the "blank out period," traditionally in the months around year end.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-CAM" />
+			<column name="PARM_DTL_TYP_CD" value="AssetDepreciationStep" />
+			<column name="PARM_NM" value="RUN_DATE" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="The run date to run the asset depreciation batch job during the blank out period." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">so 
+			<column name="NMSPC_CD" value="KFS-CAM" />
+			<column name="PARM_DTL_TYP_CD" value="AssetDepreciationStep" />
+			<column name="PARM_NM" value="BLANK_OUT_BEGIN_MMDD" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="The depreciation blank out period begin month and day (in format MM/DD) when the job should not run automatically." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-CAM" />
+			<column name="PARM_DTL_TYP_CD" value="AssetDepreciationStep" />
+			<column name="PARM_NM" value="BLANK_OUT_END_MMDD" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="The depreciation blank out period end month and day (in format MM/DD) when the job should not run automatically." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-CAM" />
+			<column name="PARM_DTL_TYP_CD" value="AssetDepreciationStep" />
+			<column name="PARM_NM" value="BLANK_OUT_PERIOD_RUN_DATE" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="The run date (in format mm/dd/yyyy) to run the asset depreciation batch job during the blank out period." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6809_RUN_DATE_NOTIFICATION_PARAM">
+		<comment>Adds parameter for KFSMI-6809 which holds the e-mail address for notifications about the Asset Depreciation run date.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-CAM" />
+			<column name="PARM_DTL_TYP_CD" value="AssetDepreciationStep" />
+			<column name="PARM_NM" value="RUN_DATE_NOTIFICATION_EMAIL_ADDRESSES" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="This email list to send a notification when blank out period run date is not set or not in blank out period range." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI4553_NEW_ROLE_FOR_VENDOR_REVIEWER">
+		<comment>New KIM role type, role, and responsibility action for KFS-VND Exclude Single Actor Reviewer.  This one is ugly, sorry about that...</comment>
+		<insert tableName="KRIM_TYP_T">
+			<column name="KIM_TYP_ID" value="KFSMI4553-1"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="NMSPC_CD" value="KFS-SYS"/>
+			<column name="NM" value="Exclude Single Actor Separation Of Duties"/>
+			<column name="SRVC_NM" value="excludeSingleActorSeparationOfDutiesRoleTypeService"/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_T">
+			<column name="ROLE_ID" value="KFSMI4553-2"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="NMSPC_CD" value="KFS-VND"/>
+			<column name="ROLE_NM" value="Exclude Single Actor Reviewer"/>
+			<column name="KIM_TYP_ID" value="KFSMI4553-1"/>
+			<column name="ACTV_IND" value="Y"/>
+			<column name="LAST_UPDT_DT" value="SYSDATE"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_MBR_T">
+			<column name="KRIM_ROLE_MBR_ID" value="KFSMI4553-3"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ROLE_ID" value="KFSMI4553-2"/>
+			<column name="MBR_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-VND' and role_nm = 'Reviewer')"/>
+			<column name="MBR_TYP_CD" value="R"/>
+			<column name="LAST_UPDT_DT" value="SYSDATE"/>
+		</insert>
+		<delete tableName="KRIM_ROLE_RSP_ACTN_T">
+			<where>role_rsp_id in (select role_rsp_id from krim_role_rsp_t where role_id = (select role_id from krim_role_t where nmspc_cd = 'KFS-VND' and role_nm = 'Reviewer') and rsp_id = (select krim_rsp_t.rsp_id from krim_rsp_t join ((select rsp_id from krim_rsp_attr_data_t where kim_attr_defn_id = (select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'documentTypeName') and attr_val = 'PVEN') r_a_d1 join (select rsp_id from krim_rsp_attr_data_t where kim_attr_defn_id = (select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'routeNodeName') and attr_val = 'Management') r_a_d2 on r_a_d1.rsp_id = r_a_d2.rsp_id) on krim_rsp_t.rsp_id = r_a_d1.rsp_id where krim_rsp_t.nmspc_cd = 'KFS-VND'))</where>
+		</delete>
+		<delete tableName="KRIM_ROLE_RSP_T">
+			<where>role_id = (select role_id from krim_role_t where nmspc_cd = 'KFS-VND' and role_nm = 'Reviewer') and rsp_id = (select krim_rsp_t.rsp_id from krim_rsp_t join ((select rsp_id from krim_rsp_attr_data_t where kim_attr_defn_id = (select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'documentTypeName') and attr_val = 'PVEN') r_a_d1 join (select rsp_id from krim_rsp_attr_data_t where kim_attr_defn_id = (select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'routeNodeName') and attr_val = 'Management') r_a_d2 on r_a_d1.rsp_id = r_a_d2.rsp_id) on krim_rsp_t.rsp_id = r_a_d1.rsp_id where krim_rsp_t.nmspc_cd = 'KFS-VND')</where>
+		</delete>
+		<insert tableName="KRIM_ROLE_RSP_T">
+			<column name="ROLE_RSP_ID" value="KFSMI4553-4"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ROLE_ID" value="KFSMI4553-2"/>
+			<column name="RSP_ID" valueNumeric="(select krim_rsp_t.rsp_id from krim_rsp_t join ((select rsp_id from krim_rsp_attr_data_t where kim_attr_defn_id = (select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'documentTypeName') and attr_val = 'PVEN') r_a_d1 join (select rsp_id from krim_rsp_attr_data_t where kim_attr_defn_id = (select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'routeNodeName') and attr_val = 'Management') r_a_d2 on r_a_d1.rsp_id = r_a_d2.rsp_id) on krim_rsp_t.rsp_id = r_a_d1.rsp_id where krim_rsp_t.nmspc_cd = 'KFS-VND')"/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_RSP_ACTN_T">
+			<column name="ROLE_RSP_ACTN_ID" value="KFSMI4553-5"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ACTN_TYP_CD" value="A"/>
+			<column name="ACTN_PLCY_CD" value="F"/>
+			<column name="ROLE_MBR_ID" value="*"/>
+			<column name="ROLE_RSP_ID" value="KFSMI4553-4"/>
+			<column name="FRC_ACTN" value="Y"/>
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6732_PREROUTE_EDIT_DOCUMENT_PERMISSION_FOR_PAYMENT_APPLICATION">
+		<comment>Creates a permission to allow KR-WKFLW Initiator and KFS-SYS Accounts Receivable Lockbox Manager to edit a Payment Application document pre-route.</comment>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSAR6732"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_TMPL_ID" valueNumeric="(select perm_tmpl_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Edit Document')"/>
+			<column name="NMSPC_CD" value="KFS-AR"/>
+			<column name="NM" value="Edit Document"/>
+			<column name="DESC_TXT" value="Edit permission for the Payment Application document prior to the document being submitted."/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSAR6732-1"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_ID" value="KFSAR6732"/>
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Edit Document')"/>
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'documentTypeName')"/>
+			<column name="ATTR_VAL" value="APP"/>
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSAR6732-2"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_ID" value="KFSAR6732"/>
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Edit Document')"/>
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'routeNodeName')"/>
+			<column name="ATTR_VAL" value="PreRoute"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSAR6732-1"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-SYS' and role_nm = 'Accounts Receivable Lockbox Manager')"/>
+			<column name="PERM_ID" value="KFSAR6732"/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSAR6732-2"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KR-WKFLW' and role_nm = 'Initiator')"/>
+			<column name="PERM_ID" value="KFSAR6732"/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI5340_ROLE_FOR_INVOICE_PROCESSING_EDITORS">
+		<comment>A new role and a permission associated which will allow a select group of users to edit the processing organization fields on a Customer Invoice document.  Based on SQL by Kalani Ekanayake.</comment>
+		<insert tableName="KRIM_ROLE_T">
+			<column name="ROLE_ID" value="KFSAR5340R"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="NMSPC_CD" value="KFS-AR"/>
+			<column name="ROLE_NM" value="Multi Organization Invoicer"/>
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_typ_t where nm = 'Default' and nmspc_cd = 'KUALI' and actv_ind = 'Y')"/>
+			<column name="ACTV_IND" value="Y"/>
+			<column name="LAST_UPDT_DT" value="SYSDATE"/>
+		</insert>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSAR5340P"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_TMPL_ID" valueNumeric="(select perm_tmpl_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Transactional Document')"/>
+			<column name="NMSPC_CD" value="KFS-AR"/>
+			<column name="NM" value="Use Transactional Document"/>
+			<column name="DESC_TXT" value="KFS-AR', 'Use Transactional Document', 'Users who can edit the Processing Chart Code and the processing organization fields on the Customer Invoice Document."/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSAR5340P-1"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_ID" value="KFSAR5340P"/>
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Transactional Document')"/>
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'documentTypeName')"/>
+			<column name="ATTR_VAL" value="INV"/>
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSAR5340P-2"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="PERM_ID" value="KFSAR5340P"/>
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Transactional Document')"/>
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-NS' and nm = 'editMode')"/>
+			<column name="ATTR_VAL" value="processingOrganizationMode"/>
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSAR5340RP"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1"/>
+			<column name="ROLE_ID" value="KFSAR5340R"/>
+			<column name="PERM_ID" value="KFSAR5340P"/>
+			<column name="ACTV_IND" value="Y"/>
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6890_PARAMETER_UPDATE_FOR_ACH_BANKS">
+		<comment>New parameter on url to find Federal ACH Bank file from, plus update corresponding parameter with bad parameter detail type</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="PARM_DTL_TYP_CD" value="Batch" />
+			<column name="PARM_NM" value="FEDERAL_ACH_BANK_FILE_URL" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="https://www.fededirectory.frb.org/FedACHdir.txt" />
+			<column name="PARM_DESC_TXT" value="The URL of the file to download from the Federal ACH Bank Directory website. This file is then loaded into the ACH bank table." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<update tableName="KRNS_PARM_T">
+			<column name="PARM_DTL_TYP_CD" value="Batch"/>
+			<where>nmspc_cd = 'KFS-PDP' and parm_dtl_typ_cd = 'All' and parm_nm = 'ACH_BANK_INPUT_FILE' and appl_nmspc_cd = 'KFS'</where>
+		</update>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6886_PAYEE_ACH_ADMIN_ROLE">
+		<comment>New role for administration of Payee ACH Accounts, with attendant new KIM role type and permissions.  SQL contributed by Ying.</comment>
+		<insert tableName="KRIM_TYP_T">
+			<column name="KIM_TYP_ID" value="KFSMI6886-TYP"/>
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="NM" value="Payee ACH Account" />
+			<column name="SRVC_NM" value="payeeACHAccountRoleTypeService" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_ATTR_DEFN_T">
+			<column name="KIM_ATTR_DEFN_ID" value="KFSMI6886-ATTRDEF" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="NM" value="achTransactionTypeCode" />
+			<column name="CMPNT_NM" value="org.kuali.kfs.sys.identity.KfsKimAttributes" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_TYP_ATTR_T">
+			<column name="KIM_TYP_ATTR_ID" value="KFSMI6886-TYPEATTR" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="SORT_CD" value="a" />
+			<column name="KIM_TYP_ID" value="KFSMI6886-TYP" />
+			<column name="KIM_ATTR_DEFN_ID" value="KFSMI6886-ATTRDEF" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_ROLE_T">
+			<column name="ROLE_ID" value="KFSMI6886-ROLE" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="ROLE_NM" value="Payee ACH Accounts Administrator" />
+			<column name="DESC_TXT" value="Administration staff who can view and update Payee ACH Account records and the legacy history of a certain ACH Transaction Type." />
+			<column name="KIM_TYP_ID" value="KFSMI6886-TYP" />
+			<column name="ACTV_IND" value="Y" />
+			<column name="LAST_UPDT_DT" value="SYSDATE" />
+		</insert>
+		<insert tableName="KRIM_ROLE_MBR_T">
+			<column name="ROLE_MBR_ID" value="KFSMI6886-ROLE-P1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="MBR_ID" valueNumeric="(select prncpl_id from krim_prncpl_t where prncpl_nm = 'ahrens')" />
+			<column name="MBR_TYP_CD" value="P" />
+			<column name="ROLE_ID" value="KFSMI6886-ROLE" />
+			<column name="LAST_UPDT_DT" value="SYSDATE" />
+		</insert>
+		<insert tableName="KRIM_ROLE_MBR_T">
+			<column name="KRIM_ROLE_MBR_ID" value="KFSMI6886-ROLE-P2" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_ID" value="KFSMI6886-ROLE" />
+			<column name="MBR_ID" valueNumeric="(select prncpl_id from krim_prncpl_t where prncpl_nm = 'dcote')" />
+			<column name="MBR_TYP_CD" value="P" />
+			<column name="LAST_UPDT_DT" value="SYSDATE" />
+		</insert>
+		<insert tableName="KRIM_ROLE_MBR_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSMI6886-AD1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_MBR_ID" value="KFSMI6886-ROLE-P2" />
+			<column name="KIM_TYP_ID" value="KFSMI6886-TYP" />
+			<column name="KIM_ATTR_DEFN_ID" value="KFSMI6886-ATTRDEF" />
+			<column name="ATTR_VAL" value="E" />
+		</insert>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSMI6886-PRM1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_TMPL_ID" valueNumeric="(select perm_tmpl_id from krim_perm_tmpl_t where nm = 'Create / Maintain Record(s)' and nmspc_cd = 'KR-NS')" />
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="NM" value="Create / Maintain Record(s)" />
+			<column name="DESC_TXT" value="Allows to view and update Payee ACH Accounts of a certain transaction type." />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSMI6886-AT2" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_ID" value="KFSMI6886-PRM1" />
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nm = 'Create / Maintain Record(s)' and nmspc_cd = 'KR-NS')" />
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'documentTypeName')" />
+			<column name="ATTR_VAL" value="PAAT" />
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSMI6886-AT2" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_ID" value="KFSMI6886-PRM1" />
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nm = 'Create / Maintain Record(s)' and nmspc_cd = 'KR-NS')" />
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-NS' and nm = 'existingRecordsOnly')" />
+			<column name="ATTR_VAL" value="false" />
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSMI6886-RLPRM1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_ID" value="KFSMI6886-ROLE" />
+			<column name="PERM_ID" value="KFSMI6886-PRM1" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSMI6886-PRM2" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_TMPL_ID" valueNumeric="(select perm_tmpl_id from krim_perm_tmpl_t where nm = 'Look Up Records' and nmspc_cd = 'KR-NS')" />
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="NM" value="Look Up Records" />
+			<column name="DESC_TXT" value="Allows the lookup of Payee ACH Account records of certain transaction type(s)." />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSMI6886-AT3" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_ID" value="KFSMI6886-PRM2" />
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nm = 'Look Up Records' and nmspc_cd = 'KR-NS')" />
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-NS' and nm = 'componentName')" />
+			<column name="ATTR_VAL" value="PayeeACHAccount" />
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSMI6886-AT4" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_ID" value="KFSMI6886-PRM2" />
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nm = 'Look Up Records' and nmspc_cd = 'KR-NS')" />
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-NS' and nm = 'namespaceCode')" />
+			<column name="ATTR_VAL" value="KFS-PDP" />
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSMI6886-RLPRM2" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_ID" value="KFSMI6886-ROLE" />
+			<column name="PERM_ID" value="KFSMI6886-PRM2" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSMI6886-PRM3" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_TMPL_ID" valueNumeric="(select perm_tmpl_id from krim_perm_tmpl_t where nm = 'Initiate Document' and nmspc_cd = 'KR-SYS')" />
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="NM" value="Initiate Document" />
+			<column name="DESC_TXT" value="Allows initiation the PDP Payee ACH Account maintenance document." />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSMI6886-AT5" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_ID" value="KFSMI6886-PRM3" />
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nm = 'Initiate Document' and nmspc_cd = 'KR-SYS')" />
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-WKFLW' and nm = 'documentTypeName')" />
+			<column name="ATTR_VAL" value="PAAT" /> <!-- It's PAAT! -->
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSMI6886-RLPRM3" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-PDP' and role_nm = 'Payee ACH Accounts Administrator')" />
+			<column name="PERM_ID" value="KFSMI6886-PRM3" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSMI6886-RLPRM4" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-SYS' and role_nm = 'Operations')" />
+			<column name="PERM_ID" value="KFSMI6886-PRM3" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI4452_BATCH_LOCKOUT_MESSAGE">
+		<comment>Adds parameter for KFSMI-4452 to hold message when documents are locked out by other processes (such as pdp purap immediate extracts job)</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-SYS" />
+			<column name="PARM_DTL_TYP_CD" value="All" />
+			<column name="PARM_NM" value="DOCUMENT_LOCKOUT_DEFAULT_MESSAGE" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="This document is currently locked out for running batch job." />
+			<column name="PARM_DESC_TXT" value="This parameter is to set the default message for the various documents during the lockout time." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6820_FROM_ADDRESSES_FOR_BATCH_JOBS">
+		<comment>Adds parameters for several modules which have batch jobs that need to have specified from e-mail addresses for sent e-mails.  Kalani did the sql on this one.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-GL" />
+			<column name="PARM_DTL_TYP_CD" value="Batch" />
+			<column name="PARM_NM" value="FROM_EMAIL_ADDRESS" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="From email address used for messages sent by the system." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-LD" />
+			<column name="PARM_DTL_TYP_CD" value="Batch" />
+			<column name="PARM_NM" value="FROM_EMAIL_ADDRESS" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="From email address used for messages sent by the system." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PDP" />
+			<column name="PARM_DTL_TYP_CD" value="Batch" />
+			<column name="PARM_NM" value="FROM_EMAIL_ADDRESS" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="From email address used for messages sent by the system." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PURAP" />
+			<column name="PARM_DTL_TYP_CD" value="Batch" />
+			<column name="PARM_NM" value="FROM_EMAIL_ADDRESS" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="From email address used for messages sent by the system." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6944_SCHEDULE_PRIOR_YEAR_JOB">
+		<comment>Adds parameter for KFSMI-6944 to specify run date for prior year job, so that job can be scheduled. Megha did the sql here.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-COA" />
+			<column name="PARM_DTL_TYP_CD" value="UpdatePriorYearDataStep" />
+			<column name="PARM_NM" value="RUN_DATE" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="06/30/2011" />
+			<column name="PARM_DESC_TXT" value="The run date (in format MM/DD/YYYY ) to run the update prior year data job." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI7014_PARAM_TO_INACTIVE_AMOUNT_TOTAL_DURING_POST_PROCESS">
+		<comment>Adds parameter for KFSMI-7014 to activate or inactivate whether amount totaling occurs during post-processing.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-SYS" />
+			<column name="PARM_DTL_TYP_CD" value="Document" />
+			<column name="PARM_NM" value="UPDATE_TOTAL_AMOUNT_IN_POST_PROCESSING_IND" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="N" />
+			<column name="PARM_DESC_TXT" value="Determines whether functionality to update a financial document's total amount during routing post-processing should be carried out." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI7041_PERM_TO_USE_FRINGE_BENEFIT_INQUIRY_ACTION">
+		<comment>Create a KR-NS Use Screen template permission for the org.kuali.kfs.module.ld.document.web.struts.FringeBenefitInquiryAction.</comment>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSMI7041-PRM" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_TMPL_ID" valueNumeric="(select perm_tmpl_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Screen')" />
+			<column name="NMSPC_CD" value="KFS-LD" />
+			<column name="NM" value="Use Screen" />
+			<column name="DESC_TXT" value="Permits access to screens controlled by org.kuali.kfs.module.ld.document.web.struts.FringeBenefitInquiryAction" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSMI7041-AT1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_ID" value="KFSMI7041-PRM" />
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Use Screen')" />
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nmspc_cd = 'KR-SYS' and nm = 'actionClass')" />
+			<column name="ATTR_VAL" value="org.kuali.kfs.module.ld.document.web.struts.FringeBenefitInquiryAction" />
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSMI7041-RLPRM1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-SYS' and role_nm = 'User')" />
+			<column name="PERM_ID" value="KFSMI7041-PRM" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6319_EINVOICE_OVERRIDE_CAMPUS">
+		<comment>Adds parameter for KFSMI-6319 to potentially override the campus used by the e-invoicing process. Megha did the original sql here.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PURAP" />
+			<column name="PARM_DTL_TYP_CD" value="ElectronicInvoiceStep" />
+			<column name="PARM_NM" value="OVERRIDE_PROCESSING_CAMPUS" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="" />
+			<column name="PARM_DESC_TXT" value="This parameter is to determine the campus for electronic invoice payments. If parameter value is populated, set the processing campus on the eInvoice generated PREQ to the parameter value. If parameter value is empty, use the Requisition initiator''s campus code." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI7019_CHANGE_MPAY_LBL">
+		<comment>Changes the label for the document type MPAY to the more accurate Asset Manual Payment</comment>
+		<update tableName="KREW_DOC_TYP_T">
+			<column name="LBL" value="Asset Manual Payment"/>
+			<where>DOC_TYP_NM = 'MPAY' and CUR_IND = 1 and ACTV_IND = 1</where>
+		</update>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6929_LABOR_LEDGER_ORIGIN_CODES_PARAMETER">
+		<comment>Adds parameter for KFSMI-6929 which lists labor ledger origin codes</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-LD" />
+			<column name="PARM_DTL_TYP_CD" value="LedgerEntry" />
+			<column name="PARM_NM" value="LINK_DOCUMENT_NUMBER_TO_LABOR_ORIGIN_CODES" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="LD;PL" />
+			<column name="PARM_DESC_TXT" value="The list of origin codes which will cause a general ledger Entryâs document number on a lookup to form a link to the list of labor ledger entries which created that general ledger entry." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI6964_UPDATE_DOC_TYPE_HELP_URL">
+		<comment>Updates the help urls for the MPAY (asset manual payment) and ALOC (asset location) document types.</comment>
+		<update tableName="KREW_DOC_TYP_T">
+			<column name="HELP_DEF_URL" value="default.htm?turl=WordDocuments%2Fassetmanualpayment.htm" />
+			<where>DOC_TYP_NM = 'MPAY' and CUR_IND = 1 AND ACTV_IND = 1</where>
+		</update>
+		<update tableName="KREW_DOC_TYP_T">
+			<column name="HELP_DEF_URL" value="default.htm?turl=WordDocuments%2Fassetlocationglobal.htm" />
+			<where>DOC_TYP_NM = 'ALOC' and CUR_IND = 1 AND ACTV_IND = 1</where>
+		</update>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSMI7006_CUTOFF_TIME_PARAMETER">
+		<comment>Adds parameter to perform cutoff of batch cycle.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-SYS" />
+			<column name="PARM_DTL_TYP_CD" value="Batch" />
+			<column name="PARM_NM" value="RUN_DATE_CUTOFF_TIME" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="2:00:00" />
+			<column name="PARM_DESC_TXT" value="Time, in 24 hour time format (hh:mm:ss), after which it is considered to be the ânext dayâ for the purposes of evaluating RUN_DATE parameters. For example: Today is 9/27/2011, RUN_DATE=9/27/2011, RUN_DATE_CUTOFF_TIME=2:00:00. Due to a slow running schedule a job triggered by RUN_DATE does not have its turn until 1:00 9/28/2011. The job will still run because the cutoff time is 2 hours after midnight. In this case, anything running after 2:00 is considered the next day." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSCNTRB162_DEBARRED_VENDOR_TRACKING_PERMS_AND_PARMS">
+		<comment>New parameters for debarred vendor tracking process as well as the permission to upload the vendor exclusion file.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-VND" />
+			<column name="PARM_DTL_TYP_CD" value="Lookup" />
+			<column name="PARM_NM" value="EXCLUSION_AND_DEBARRED_VENDOR_TYPES" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="PO;DV" />
+			<column name="PARM_DESC_TXT" value="This parameter identifies the vendor types available as search criteria on the âVendor Exclusionâ and âDebarred Unmatched Vendorâ lookups." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PURAP" />
+			<column name="PARM_DTL_TYP_CD" value="Requisition" />
+			<column name="PARM_NM" value="SHOW_DEBARRED_VENDOR_WARNING_IND" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="Y" />
+			<column name="PARM_DESC_TXT" value="This indicates whether a warning or an error should be displayed when a debarred vendor is selected in a requisition. If Y then a warning is displayed. If N an error is displayed." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-PURAP" />
+			<column name="PARM_DTL_TYP_CD" value="PurchaseOrder" />
+			<column name="PARM_NM" value="SHOW_DEBARRED_VENDOR_WARNING_IND" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="Y" />
+			<column name="PARM_DESC_TXT" value="This indicates whether a warning or an error should be displayed when a debarred vendor is selected in a purchase order. If Y then a warning is displayed. If N an error is displayed." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+		<insert tableName="KRIM_PERM_T">
+			<column name="PERM_ID" value="KFSCNTRB162-PRM" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_TMPL_ID" value="select perm_tmpl_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Upload Batch Input File(s)'" />
+			<column name="NMSPC_CD" value="KFS-VND" />
+			<column name="NM" value="Use Screen" />
+			<column name="DESC_TXT" value="Authorizes users to access the Vendor Exclude File Upload page." />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+		<insert tableName="KRIM_PERM_ATTR_DATA_T">
+			<column name="ATTR_DATA_ID" value="KFSCNTRB162-AT1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="PERM_ID" value="KFSCNTRB162-PRM" />
+			<column name="KIM_TYP_ID" valueNumeric="(select kim_typ_id from krim_perm_tmpl_t where nmspc_cd = 'KR-NS' and nm = 'Upload Batch Input File(s)')" />
+			<column name="KIM_ATTR_DEFN_ID" valueNumeric="(select kim_attr_defn_id from krim_attr_defn_t where nm = 'beanName')" />
+			<column name="ATTR_VAL" value="vendorExcludeInputFileType" />
+		</insert>
+		<insert tableName="KRIM_ROLE_PERM_T">
+			<column name="ROLE_PERM_ID" value="KFSCNTRB162-RLPRM1" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()"/>
+			<column name="VER_NBR" value="1" />
+			<column name="ROLE_ID" valueNumeric="(select role_id from krim_role_t where nmspc_cd = 'KFS-VND' and role_nm = 'Reviewer')" />
+			<column name="PERM_ID" value="KFSCNTRB162-PRM" />
+			<column name="ACTV_IND" value="Y" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSCNTRB672_BATCH_MAX_FILE_SIZE_PARAMETER">
+		<comment>Adds parameter which determines the max size of files which can be uploaded via batch upload.</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-SYS" />
+			<column name="PARM_DTL_TYP_CD" value="Batch" />
+			<column name="PARM_NM" value="MAX_FILE_SIZE_UPLOAD" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="30M" />
+			<column name="PARM_DESC_TXT" value="The size limitation for batch file uploads in megabytes." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSCNTRB56_UPDATE_CFDM_PARENT_DOC_TYPE">
+		<comment>Changes the parent document type of the CFDA maintenance document, CFDM, so that it's parent is COSM, the Chart of Accounts simple maintenance document type.</comment>
+		<update tableName="KREW_DOC_TYP_T">
+			<column name="PARNT_ID" valueNumeric="(select doc_typ_id from krew_doc_typ_t where doc_typ_nm = 'COSM' and cur_ind = 1 and actv_ind = 1)" type="BIGINT"/>
+			<where>doc_typ_nm = 'CFDM' and cur_ind = 1 and actv_ind = 1</where>
+		</update>
+	</changeSet>
+	
+	<changeSet author="jksmith" id="KFSCNTRB155_DEFAULT_ASSET_MANUFACTURER_PARAMETER">
+		<comment>Adds parameter to specify the default asset manufacturer</comment>
+		<insert tableName="KRNS_PARM_T">
+			<column name="NMSPC_CD" value="KFS-CAM" />
+			<column name="PARM_DTL_TYP_CD" value="Asset" />
+			<column name="PARM_NM" value="DEFAULT_FABRICATION_ASSET_MANUFACTURER" />
+			<column name="APPL_NMSPC_CD" value="KFS" />
+			<column name="OBJ_ID" valueNumeric="sys_guid()" />
+			<column name="VER_NBR" value="1" />
+			<column name="PARM_TYP_CD" value="CONFG" />
+			<column name="TXT" value="UNIVERSITY CONSTRUCTED" />
+			<column name="PARM_DESC_TXT" value="Default manufacturer name to be used during Asset Fabrication." />
+			<column name="CONS_CD" value="A" />
+		</insert>
+	</changeSet>
+	
+</databaseChangeLog>
\ No newline at end of file
Index: work/src/org/kuali/kfs/coa/service/CfdaService.java
===================================================================
--- work/src/org/kuali/kfs/coa/service/CfdaService.java	(revision 0)
+++ work/src/org/kuali/kfs/coa/service/CfdaService.java	(revision 37225)
@@ -0,0 +1,31 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.coa.service;
+
+import java.io.IOException;
+
+import org.kuali.kfs.coa.businessobject.CFDA;
+import org.kuali.kfs.coa.businessobject.CfdaUpdateResults;
+
+/**
+ * 
+ */
+public interface CfdaService {
+    CfdaUpdateResults update() throws IOException;
+
+    public CFDA getByPrimaryId(String cfdaNumber);
+
+}
Index: work/src/org/kuali/kfs/coa/service/impl/CfdaServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/coa/service/impl/CfdaServiceImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/coa/service/impl/CfdaServiceImpl.java	(revision 37225)
@@ -0,0 +1,249 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.coa.service.impl;
+
+import java.io.BufferedReader;
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.util.Calendar;
+import java.util.Collection;
+import java.util.Comparator;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.SortedMap;
+import java.util.TreeMap;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.commons.net.ftp.FTPClient;
+import org.apache.commons.net.ftp.FTPReply;
+import org.kuali.kfs.coa.batch.CfdaBatchStep;
+import org.kuali.kfs.coa.businessobject.CFDA;
+import org.kuali.kfs.coa.businessobject.CfdaUpdateResults;
+import org.kuali.kfs.coa.service.CfdaService;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.KFSPropertyConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kns.service.BusinessObjectService;
+import org.kuali.rice.kns.service.DateTimeService;
+import org.kuali.rice.kns.service.ParameterService;
+
+import au.com.bytecode.opencsv.CSVReader;
+
+public class CfdaServiceImpl implements CfdaService {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(CfdaServiceImpl.class);
+
+    private BusinessObjectService businessObjectService;
+    protected static Comparator cfdaComparator;
+
+    static {
+        cfdaComparator = new Comparator() {
+            public int compare(Object o1, Object o2) {
+                String lhs = (String) o1;
+                String rhs = (String) o2;
+                return lhs.compareTo(rhs);
+            }
+        };
+    }
+
+    /**
+     * @return
+     * @throws IOException
+     */
+    public SortedMap<String, CFDA> getGovCodes() throws IOException {
+        Calendar calendar = SpringContext.getBean(DateTimeService.class).getCurrentCalendar();
+        SortedMap<String, CFDA> govMap = new TreeMap<String, CFDA>();
+
+        // ftp://ftp.cfda.gov/programs09187.csv
+        String govURL = SpringContext.getBean(ParameterService.class).getParameterValue(CfdaBatchStep.class, KFSConstants.SOURCE_URL_PARAMETER);
+        String fileName = StringUtils.substringAfterLast(govURL, "/");
+        govURL = StringUtils.substringBeforeLast(govURL, "/");
+        if (StringUtils.contains(govURL, "ftp://")) {
+            govURL = StringUtils.remove(govURL, "ftp://");
+        }
+
+        // need to pull off the '20' in 2009
+        String year = "" + calendar.get(Calendar.YEAR);
+        year = year.substring(2, 4);
+        fileName = fileName + year;
+
+        // the last 3 numbers in the file name are the day of the year, but the files are from "yesterday"
+        fileName = fileName + String.format("%03d", calendar.get(Calendar.DAY_OF_YEAR) - 1);
+        fileName = fileName + ".csv";
+
+        LOG.info("Getting government file: " + fileName + " for update");
+
+        InputStream inputStream = null;
+        FTPClient ftp = new FTPClient();
+        try {
+            ftp.connect(govURL);
+            int reply = ftp.getReplyCode();
+
+            if (!FTPReply.isPositiveCompletion(reply)) {
+                LOG.error("FTP connection to server not established.");
+                throw new IOException("FTP connection to server not established.");
+            }
+
+            boolean loggedIn = ftp.login("anonymous", "");
+            if (!loggedIn) {
+                LOG.error("Could not login as anonymous.");
+                throw new IOException("Could not login as anonymous.");
+            }
+
+            LOG.info("Successfully connected and logged in");
+
+            inputStream = ftp.retrieveFileStream(fileName);
+            if (inputStream != null) {
+                LOG.info("reading input stream");
+                InputStreamReader screenReader = new InputStreamReader(inputStream);
+                BufferedReader screen = new BufferedReader(screenReader);
+
+                CSVReader csvReader = new CSVReader(screenReader, ',', '"', 1);
+                List<String[]> lines = csvReader.readAll();
+                for (String[] line : lines) {
+                    String title = line[0];
+                    String number = line[1];
+
+                    CFDA cfda = new CFDA();
+                    cfda.setCfdaNumber(number);
+                    cfda.setCfdaProgramTitleName(title);
+
+                    govMap.put(number, cfda);
+                }
+            }
+
+            ftp.logout();
+            ftp.disconnect();
+        }
+        finally {
+            if (ftp.isConnected()) {
+                ftp.disconnect();
+            }
+        }
+
+        return govMap;
+    }
+
+    /**
+     * @return
+     * @throws IOException
+     */
+    public SortedMap<String, CFDA> getKfsCodes() throws IOException {
+        Collection allCodes = businessObjectService.findAll(CFDA.class);
+
+        SortedMap<String, CFDA> kfsMapAll = new TreeMap<String, CFDA>(cfdaComparator);
+        for (Object o : allCodes) {
+            CFDA c = (CFDA) o;
+            kfsMapAll.put(c.getCfdaNumber(), c);
+        }
+        return kfsMapAll;
+    }
+
+    /**
+     *
+     */
+    public CfdaUpdateResults update() throws IOException {
+
+        CfdaUpdateResults results = new CfdaUpdateResults();
+        Map<String, CFDA> govMap = null;
+
+        try {
+            govMap = getGovCodes();
+        }
+        catch (IOException ioe) {
+            LOG.error("Error connecting to URL resource: " + ioe.getMessage(), ioe);
+            StringBuilder builder = new StringBuilder();
+            builder.append("No updates took place.\n");
+            builder.append(ioe.getMessage());
+            results.setMessage(builder.toString());
+            return results;
+        }
+        Map<String, CFDA> kfsMap = getKfsCodes();
+
+        results.setNumberOfRecordsInKfsDatabase(kfsMap.keySet().size());
+        results.setNumberOfRecordsRetrievedFromWebSite(govMap.keySet().size());
+
+        for (Object key : kfsMap.keySet()) {
+
+            CFDA cfdaKfs = kfsMap.get(key);
+            CFDA cfdaGov = govMap.get(key);
+
+            if (cfdaKfs.getCfdaMaintenanceTypeId().startsWith("M")) {
+                // Leave it alone. It's maintained manually.
+                results.setNumberOfRecordsNotUpdatedBecauseManual(1 + results.getNumberOfRecordsNotUpdatedBecauseManual());
+            }
+            else if (cfdaKfs.getCfdaMaintenanceTypeId().startsWith("A")) {
+
+                if (cfdaGov == null) {
+                    if (cfdaKfs.isActive()) {
+                        cfdaKfs.setActive(false);
+                        businessObjectService.save(cfdaKfs);
+                        results.setNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite(results.getNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite() + 1);
+                    }
+                    else {
+                        // Leave it alone for historical purposes
+                        results.setNumberOfRecrodsNotUpdatedForHistoricalPurposes(results.getNumberOfRecrodsNotUpdatedForHistoricalPurposes() + 1);
+                    }
+                }
+                else {
+                    if (cfdaKfs.isActive()) {
+                        results.setNumberOfRecordsUpdatedBecauseAutomatic(results.getNumberOfRecordsUpdatedBecauseAutomatic() + 1);
+                    }
+                    else {
+                        cfdaKfs.setActive(true);
+                        results.setNumberOfRecordsReActivated(results.getNumberOfRecordsReActivated() + 1);
+                    }
+
+                    cfdaKfs.setCfdaProgramTitleName(cfdaGov.getCfdaProgramTitleName());
+                    businessObjectService.save(cfdaKfs);
+                }
+            }
+
+            // Remove it from the govMap so we know what codes from the govMap don't already exist in KFS.
+            govMap.remove(key);
+        }
+
+        // What's left in govMap now is just the codes that don't exist in KFS
+        for (String key : govMap.keySet()) {
+            CFDA cfdaGov = govMap.get(key);
+            cfdaGov.setCfdaMaintenanceTypeId("Automatic");
+            cfdaGov.setActive(true);
+            businessObjectService.save(cfdaGov);
+            results.setNumberOfRecordsNewlyAddedFromWebSite(results.getNumberOfRecordsNewlyAddedFromWebSite() + 1);
+        }
+
+        return results;
+    }
+
+    public void setBusinessObjectService(BusinessObjectService businessObjectService) {
+        this.businessObjectService = businessObjectService;
+    }
+
+    public CFDA getByPrimaryId(String cfdaNumber) {
+        if (StringUtils.isBlank(cfdaNumber)) {
+            return null;
+        }
+        return (CFDA) businessObjectService.findByPrimaryKey(CFDA.class, mapPrimaryKeys(cfdaNumber));
+    }
+
+    protected Map<String, Object> mapPrimaryKeys(String cfdaNumber) {
+        Map<String, Object> primaryKeys = new HashMap();
+        primaryKeys.put(KFSPropertyConstants.CFDA_NUMBER, cfdaNumber.trim());
+        return primaryKeys;
+    }
+
+}
Index: work/src/org/kuali/kfs/coa/service/impl/AccountReferencePersistenceExemption.java
===================================================================
--- work/src/org/kuali/kfs/coa/service/impl/AccountReferencePersistenceExemption.java	(revision 0)
+++ work/src/org/kuali/kfs/coa/service/impl/AccountReferencePersistenceExemption.java	(revision 37225)
@@ -0,0 +1,78 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.coa.service.impl;
+
+import org.apache.commons.lang.StringUtils;
+
+/**
+ * Represents an exemption in AccountReferencePersistencestructureServiceImpl - a business object and related-to-object
+ * keys which will lawlessly not abide by the rules
+ */
+public class AccountReferencePersistenceExemption {
+    protected Class<?> parentBusinessObjectClass;
+    protected String chartOfAccountsCodePropertyName;
+    protected String accountNumberPropertyName;
+    
+    /**
+     * @return the business object class which owns a relationship that will be exempted
+     */
+    public Class<?> getParentBusinessObjectClass() {
+        return parentBusinessObjectClass;
+    }
+    /**
+     * Sets the business object class which owns a relationship that will be exempted
+     * @param parentBusinessObjectClass the business object class which owns a relationship that will be exempted
+     */
+    public void setParentBusinessObjectClass(Class<?> parentBusinessObjectClass) {
+        this.parentBusinessObjectClass = parentBusinessObjectClass;
+    }
+    /**
+     * @return the name of the property on the parentBusinessObjectClass which represents the chart of accounts code portion of the Account relationship 
+     */
+    public String getChartOfAccountsCodePropertyName() {
+        return chartOfAccountsCodePropertyName;
+    }
+    /**
+     * Sets the name of the property on the parentBusinessObjectClass which represents the chart of accounts code portion of the Account relationship
+     * @param chartOfAccountsCodePropertyName the name of the property on the parentBusinessObjectClass which represents the chart of accounts code portion of the Account relationship
+     */
+    public void setChartOfAccountsCodePropertyName(String chartOfAccountsCodePropertyName) {
+        this.chartOfAccountsCodePropertyName = chartOfAccountsCodePropertyName;
+    }
+    /**
+     * @return the name of the property on the parentBusinessObjectClass which represents the account number portion of the Account relationship
+     */
+    public String getAccountNumberPropertyName() {
+        return accountNumberPropertyName;
+    }
+    /**
+     * Sets the name of the property on the parentBusinessObjectClass which represents the account number portion of the Account relationship
+     * @param accountNumberPropertyName the name of the property on the parentBusinessObjectClass which represents the account number portion of the Account relationship
+     */
+    public void setAccountNumberPropertyName(String accountNumberPropertyName) {
+        this.accountNumberPropertyName = accountNumberPropertyName;
+    }
+
+    /**
+     * Determines if the given chart of accounts code property name and account number property name would match the relationship-to-account chart of accounts code property name and account number property name encapsulated herein
+     * @param chartOfAccountsCodePropertyName the name of the chart of accounts code property name in the relationship
+     * @param accountNumberPropertyName the name of the account number property name in the relationship
+     * @return true if the property names all match
+     */
+    public boolean matches(String chartOfAccountsCodePropertyName, String accountNumberPropertyName) {
+        return ( ( !StringUtils.isBlank(chartOfAccountsCodePropertyName) && !StringUtils.isBlank(getChartOfAccountsCodePropertyName()) && chartOfAccountsCodePropertyName.equals(getChartOfAccountsCodePropertyName()) ) && ( !StringUtils.isBlank(accountNumberPropertyName) && !StringUtils.isBlank(getAccountNumberPropertyName()) && accountNumberPropertyName.equals(getAccountNumberPropertyName()) ) );
+    }
+}
\ No newline at end of file
Index: work/src/org/kuali/kfs/coa/batch/CfdaBatchStep.java
===================================================================
--- work/src/org/kuali/kfs/coa/batch/CfdaBatchStep.java	(revision 0)
+++ work/src/org/kuali/kfs/coa/batch/CfdaBatchStep.java	(revision 37225)
@@ -0,0 +1,164 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.coa.batch;
+
+import java.io.IOException;
+import java.util.Date;
+import java.util.List;
+
+import org.apache.log4j.Logger;
+import org.kuali.kfs.coa.businessobject.CfdaUpdateResults;
+import org.kuali.kfs.coa.service.CfdaService;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.KFSKeyConstants;
+import org.kuali.kfs.sys.batch.AbstractStep;
+import org.kuali.rice.kns.mail.InvalidAddressException;
+import org.kuali.rice.kns.mail.MailMessage;
+import org.kuali.rice.kns.service.KualiConfigurationService;
+import org.kuali.rice.kns.service.MailService;
+import org.kuali.rice.kns.service.ParameterService;
+
+/**
+ * Parses data from a government web page listing the valid CFDA codes. The codes are then compared with what's in the CFDA table in
+ * Kuali. Codes set to be managed automatically are reconciled with what's on the web page. Codes managed manually are left alone.
+ * Finally an email containing a summary of what was done by the step execution is sent to the member of the CG_CFDA_BATCH_NOTIFY workgroup.
+ */
+public class CfdaBatchStep extends AbstractStep {
+
+    private static Logger LOG = org.apache.log4j.Logger.getLogger(CfdaBatchStep.class);
+
+    private CfdaService cfdaService;
+    private MailService mailService;
+    private ParameterService parameterService;
+    private KualiConfigurationService configurationService;
+    /**
+     * See the class description.
+     * 
+     * @see org.kuali.kfs.sys.batch.Step#execute(String, Date)
+     */
+    public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
+        MailMessage message = new MailMessage();
+
+        try {
+            CfdaUpdateResults results = cfdaService.update();
+
+            List<String> listservAddresses = parameterService.getParameterValues(CfdaBatchStep.class, KFSConstants.RESULT_SUMMARY_TO_EMAIL_ADDRESSES);
+            if (listservAddresses == null || listservAddresses.size() == 0) {
+                LOG.fatal("Couldn't find address to send notification to.");
+                return true;
+            }
+            
+            for (String listserv : listservAddresses) {
+                if (LOG.isDebugEnabled()) {
+                    LOG.debug("Mailing to: "+listserv);
+                }
+                message.addToAddress(listserv);
+            }
+            
+            message.setFromAddress(listservAddresses.get(0));
+
+            // TODO this message should come from some config file.
+            StringBuilder builder = new StringBuilder();
+            builder.append("The CFDA batch script is complete.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite());
+            builder.append(" records were deactivated because they are no longer on the web site.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecordsInKfsDatabase());
+            builder.append(" records were in the KFS database.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecordsNewlyAddedFromWebSite());
+            builder.append(" records were newly added from the web site.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecordsNotUpdatedBecauseManual());
+            builder.append(" records were not updated because they are manual.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecordsReActivated());
+            builder.append(" records were re-activated.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecordsRetrievedFromWebSite());
+            builder.append(" records were retrieved from the web site.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecordsUpdatedBecauseAutomatic());
+            builder.append(" records were updated because they are automatic.\n");
+            builder.append(" - ");
+            builder.append(results.getNumberOfRecrodsNotUpdatedForHistoricalPurposes());
+            builder.append(" records were not updated for historical reasons.\n");
+            builder.append(" - Message\n");
+            builder.append(null != results.getMessage() ? results.getMessage() : "");
+
+            message.setSubject(getConfigurationService().getPropertyString(KFSKeyConstants.CFDA_UPDATE_EMAIL_SUBJECT_LINE));
+            message.setMessage(builder.toString());
+            mailService.sendMessage(message);
+
+        }
+        catch (IOException ioe) {
+            LOG.warn("Exception while updating CFDA codes.", ioe);
+            return false;
+        }
+        catch (InvalidAddressException iae) {
+
+           LOG.warn("The email address for "+CfdaBatchStep.class+":"+KFSConstants.RESULT_SUMMARY_TO_EMAIL_ADDRESSES+" is invalid.", iae);
+            return true;
+        }
+        return true;
+    }
+
+    /**
+     * Sets the {@link CfdaService}. For use by Spring.
+     * 
+     * @param cfdaService The service to be assigned.
+     */
+    public void setCfdaService(CfdaService cfdaService) {
+        this.cfdaService = cfdaService;
+    }
+
+    /**
+     * Set the {@link MailService}. For use by Spring.
+     * 
+     * @param mailService The service to be assigned.
+     */
+    public void setMailService(MailService mailService) {
+        this.mailService = mailService;
+    }
+    
+    /**
+     * Sets the {@link ParameterService}. For use by Spring.
+     * 
+     * @param parameterService The service to be assigned.
+     */
+    public void setParameterService(ParameterService parameterService) {
+        this.parameterService = parameterService;
+    }
+
+    /**
+     * Gets the configurationService attribute. 
+     * @return Returns the configurationService.
+     */
+    public KualiConfigurationService getConfigurationService() {
+        return configurationService;
+    }
+
+    /**
+     * Sets the configurationService attribute value.
+     * @param configurationService The configurationService to set.
+     */
+    public void setConfigurationService(KualiConfigurationService configurationService) {
+        this.configurationService = configurationService;
+    }
+
+}
+
Index: work/src/org/kuali/kfs/coa/businessobject/datadictionary/CFDA.xml
===================================================================
--- work/src/org/kuali/kfs/coa/businessobject/datadictionary/CFDA.xml	(revision 0)
+++ work/src/org/kuali/kfs/coa/businessobject/datadictionary/CFDA.xml	(revision 37225)
@@ -0,0 +1,147 @@
+<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
+<!--
+ Copyright 2007-2009 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
+
+  <bean id="Cfda" parent="CFDA-parentBean"/>
+
+  <bean id="CFDA-parentBean" abstract="true" parent="BusinessObjectEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.coa.businessobject.CFDA"/>
+    <property name="inquiryDefinition">
+      <ref bean="CFDA-inquiryDefinition"/>
+    </property>
+    <property name="lookupDefinition">
+      <ref bean="CFDA-lookupDefinition"/>
+    </property>
+    <property name="objectLabel" value="CFDA Reference"/>
+    <property name="attributes">
+      <list>
+        <ref bean="CFDA-cfdaMaintenanceTypeId"/>
+        <ref bean="CFDA-cfdaNumber"/>
+        <ref bean="CFDA-cfdaProgramTitleName"/>
+        <ref bean="CFDA-active"/>
+      </list>
+    </property>
+  </bean>
+
+<!-- Attribute Definitions -->
+
+
+  <bean id="CFDA-cfdaMaintenanceTypeId" parent="CFDA-cfdaMaintenanceTypeId-parentBean"/>
+
+  <bean id="CFDA-cfdaMaintenanceTypeId-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="cfdaMaintenanceTypeId"/>
+    <property name="label" value="CFDA Maintenance Type Id"/>
+    <property name="shortLabel" value="Id"/>
+    <property name="maxLength" value="10"/>
+    <property name="validationPattern">
+      <ref bean="AnyCharacterValidation" />
+    </property>
+    <property name="control">
+      <bean parent="SelectControlDefinition" p:valuesFinderClass="org.kuali.kfs.coa.businessobject.options.CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder" p:includeKeyInLabel="false"/>
+    </property>
+  </bean>
+  <bean id="CFDA-cfdaNumber" parent="CFDA-cfdaNumber-parentBean"/>
+
+  <bean id="CFDA-cfdaNumber-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="cfdaNumber"/>
+    <property name="forceUppercase" value="true"/>
+    <property name="label" value="CFDA Number"/>
+    <property name="shortLabel" value="Number"/>
+    <property name="maxLength" value="6"/>
+    <property name="validationPattern">
+      <ref bean="AnyCharacterValidation" />
+    </property>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="8"/>
+    </property>
+  </bean>
+  <bean id="CFDA-cfdaProgramTitleName" parent="CFDA-cfdaProgramTitleName-parentBean"/>
+
+  <bean id="CFDA-cfdaProgramTitleName-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="cfdaProgramTitleName"/>
+    <property name="label" value="CFDA Program Title Name"/>
+    <property name="shortLabel" value="Name"/>
+    <property name="maxLength" value="300"/>
+    <property name="validationPattern">
+      <ref bean="AnyCharacterWithWhitespaceValidation" />
+    </property>
+    <property name="control">
+      <bean parent="TextareaControlDefinition" p:rows="5" p:cols="80"/>
+    </property>
+  </bean>
+  
+  <bean id="CFDA-active" parent="CFDA-active-parentBean"/>
+
+  <bean id="CFDA-active-parentBean" abstract="true" parent="GenericAttributes-activeIndicator">
+	<property name="name" value="active"/>
+  </bean>
+
+
+<!-- Business Object Inquiry Definition -->
+
+
+  <bean id="CFDA-inquiryDefinition" parent="CFDA-inquiryDefinition-parentBean"/>
+
+  <bean id="CFDA-inquiryDefinition-parentBean" abstract="true" parent="InquiryDefinition">
+    <property name="title" value="CFDA Reference Inquiry"/>
+    <property name="inquirySections">
+      <list>
+        <bean parent="InquirySectionDefinition">
+          <property name="title" value="Catalog of Federal Domestic Assistance Details"/>
+          <property name="numberOfColumns" value="1"/>
+          <property name="inquiryFields">
+            <list>
+              <bean parent="FieldDefinition" p:attributeName="cfdaMaintenanceTypeId"/>
+              <bean parent="FieldDefinition" p:attributeName="cfdaNumber"/>
+              <bean parent="FieldDefinition" p:attributeName="cfdaProgramTitleName"/>
+              <bean parent="FieldDefinition" p:attributeName="active"/>
+            </list>
+          </property>
+        </bean>
+      </list>
+    </property>
+  </bean>
+
+<!-- Business Object Lookup Definition -->
+
+
+  <bean id="CFDA-lookupDefinition" parent="CFDA-lookupDefinition-parentBean"/>
+
+  <bean id="CFDA-lookupDefinition-parentBean" abstract="true" parent="LookupDefinition">
+    <property name="title" value="CFDA Reference Lookup"/>
+    
+    <property name="defaultSort">
+      <bean parent="SortDefinition">
+      </bean>
+    </property>
+    <property name="lookupFields">
+      <list>
+        <bean parent="FieldDefinition" p:attributeName="cfdaMaintenanceTypeId"/>
+        <bean parent="FieldDefinition" p:attributeName="cfdaNumber"/>
+        <bean parent="FieldDefinition" p:attributeName="cfdaProgramTitleName"/>
+        <bean parent="FieldDefinition" p:attributeName="active"/>
+      </list>
+    </property>
+    <property name="resultFields">
+      <list>
+        <bean parent="FieldDefinition" p:attributeName="cfdaMaintenanceTypeId"/>
+        <bean parent="FieldDefinition" p:attributeName="cfdaNumber"/>
+        <bean parent="FieldDefinition" p:attributeName="cfdaProgramTitleName"/>
+        <bean parent="FieldDefinition" p:attributeName="active"/>
+      </list>
+    </property>
+  </bean>
+</beans>
Index: work/src/org/kuali/kfs/coa/businessobject/datadictionary/Account.xml
===================================================================
--- work/src/org/kuali/kfs/coa/businessobject/datadictionary/Account.xml	(revision 30259)
+++ work/src/org/kuali/kfs/coa/businessobject/datadictionary/Account.xml	(revision 37225)
@@ -155,13 +155,6 @@
         		</list>
         	</property>
         </bean>
-        <bean parent="RelationshipDefinition" p:objectAttributeName="cfda">
-        	<property name="primitiveAttributes">
-        		<list>
-        			<bean parent="PrimitiveAttributeDefinition" p:sourceName="accountCfdaNumber" p:targetName="cfdaNumber" />
-        		</list>
-        	</property>
-        </bean>
         <bean parent="RelationshipDefinition" p:objectAttributeName="awards" p:targetClass="org.kuali.kfs.integration.cg.ContractsAndGrantsAccountAwardInformation">
         	<property name="primitiveAttributes">
         		<list>
@@ -585,7 +578,7 @@
   
   <bean id="Account-accountCfdaNumber" parent="Account-accountCfdaNumber-parentBean"/>
 
-  <bean id="Account-accountCfdaNumber-parentBean" abstract="true" parent="ExternalizableAttributeDefinitionProxy" p:sourceExternalizableBusinessObjectInterface="org.kuali.kfs.integration.cg.ContractsAndGrantsCfda" p:sourceAttributeName="cfdaNumber"> 
+  <bean id="Account-accountCfdaNumber-parentBean" abstract="true" parent="CFDA-cfdaNumber" > 
 	<property name="name" value="accountCfdaNumber"/>
     <property name="required" value="false"/>
   </bean>
@@ -637,7 +630,7 @@
 
   <bean id="Account-accountFiscalOfficerUser.principalName-parentBean" parent="PersonImpl-principalName" abstract="true" p:name="accountFiscalOfficerUser.principalName" p:label="Fiscal Officer Principal Name" p:shortLabel="Principal Name" p:required="false">
     <property name="control">
-      <bean parent="KualiUserControlDefinition" p:universalIdAttributeName="accountFiscalOfficerSystemIdentifier" p:userIdAttributeName="accountFiscalOfficerUser"/>
+      <bean parent="KualiUserControlDefinition" p:personNameAttributeName="accountFiscalOfficerUser.name" p:universalIdAttributeName="accountFiscalOfficerSystemIdentifier" p:userIdAttributeName="accountFiscalOfficerUser.principalName"/>
     </property>
   </bean>
 
Index: work/src/org/kuali/kfs/coa/businessobject/CfdaUpdateResults.java
===================================================================
--- work/src/org/kuali/kfs/coa/businessobject/CfdaUpdateResults.java	(revision 0)
+++ work/src/org/kuali/kfs/coa/businessobject/CfdaUpdateResults.java	(revision 37225)
@@ -0,0 +1,190 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.coa.businessobject;
+
+/**
+ * Encapsulates the result of scraping the government CFDA web-page.
+ */
+public class CfdaUpdateResults {
+    private int numberOfRecordsRetrievedFromWebSite;
+    private int numberOfRecordsInKfsDatabase;
+    private int numberOfRecrodsNotUpdatedForHistoricalPurposes;
+    private int numberOfRecordsDeactivatedBecauseNoLongerOnWebSite;
+    private int numberOfRecordsReActivated;
+    private int numberOfRecordsNotUpdatedBecauseManual;
+    private int numberOfRecordsUpdatedBecauseAutomatic;
+    private int numberOfRecordsNewlyAddedFromWebSite;
+    private String message;
+
+    /**
+     * @return
+     */
+    public int getNumberOfRecordsNewlyAddedFromWebSite() {
+        return numberOfRecordsNewlyAddedFromWebSite;
+    }
+
+    /**
+     * @param numberOfRecordsNewlyAddedFromWebSite
+     */
+    public void setNumberOfRecordsNewlyAddedFromWebSite(int numberOfRecordsNewlyAddedFromWebSite) {
+        this.numberOfRecordsNewlyAddedFromWebSite = numberOfRecordsNewlyAddedFromWebSite;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public int getNumberOfRecordsReActivated() {
+        return numberOfRecordsReActivated;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param numberOfRecordsReActivated
+     */
+    public void setNumberOfRecordsReActivated(int numberOfRecordsReActivated) {
+        this.numberOfRecordsReActivated = numberOfRecordsReActivated;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public int getNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite() {
+        return numberOfRecordsDeactivatedBecauseNoLongerOnWebSite;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param numberOfRecordsDeactivatedBecauseNoLongerOnWebSite
+     */
+    public void setNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite(int numberOfRecordsDeactivatedBecauseNoLongerOnWebSite) {
+        this.numberOfRecordsDeactivatedBecauseNoLongerOnWebSite = numberOfRecordsDeactivatedBecauseNoLongerOnWebSite;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public int getNumberOfRecrodsNotUpdatedForHistoricalPurposes() {
+        return numberOfRecrodsNotUpdatedForHistoricalPurposes;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param numberOfRecrodsNotUpdatedForHistoricalPurposes
+     */
+    public void setNumberOfRecrodsNotUpdatedForHistoricalPurposes(int numberOfRecrodsNotUpdatedForHistoricalPurposes) {
+        this.numberOfRecrodsNotUpdatedForHistoricalPurposes = numberOfRecrodsNotUpdatedForHistoricalPurposes;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public int getNumberOfRecordsRetrievedFromWebSite() {
+        return numberOfRecordsRetrievedFromWebSite;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param numberOfRecordsRetrievedFromWebSite
+     */
+    public void setNumberOfRecordsRetrievedFromWebSite(int numberOfRecordsRetrievedFromWebSite) {
+        this.numberOfRecordsRetrievedFromWebSite = numberOfRecordsRetrievedFromWebSite;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public int getNumberOfRecordsInKfsDatabase() {
+        return numberOfRecordsInKfsDatabase;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param numberOfRecordsInKfsDatabase
+     */
+    public void setNumberOfRecordsInKfsDatabase(int numberOfRecordsInKfsDatabase) {
+        this.numberOfRecordsInKfsDatabase = numberOfRecordsInKfsDatabase;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public int getNumberOfRecordsUpdatedBecauseAutomatic() {
+        return numberOfRecordsUpdatedBecauseAutomatic;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param numberOfRecordsUpdatedBecauseAutomatic
+     */
+    public void setNumberOfRecordsUpdatedBecauseAutomatic(int numberOfRecordsUpdatedBecauseAutomatic) {
+        this.numberOfRecordsUpdatedBecauseAutomatic = numberOfRecordsUpdatedBecauseAutomatic;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public int getNumberOfRecordsNotUpdatedBecauseManual() {
+        return numberOfRecordsNotUpdatedBecauseManual;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param numberOfRecordsNotUpdatedBecauseManual
+     */
+    public void setNumberOfRecordsNotUpdatedBecauseManual(int numberOfRecordsNotUpdatedBecauseManual) {
+        this.numberOfRecordsNotUpdatedBecauseManual = numberOfRecordsNotUpdatedBecauseManual;
+    }
+
+    /**
+     * This method...
+     * 
+     * @return
+     */
+    public String getMessage() {
+        return message;
+    }
+
+    /**
+     * This method...
+     * 
+     * @param message
+     */
+    public void setMessage(String message) {
+        this.message = message;
+    }
+
+}
Index: work/src/org/kuali/kfs/coa/businessobject/options/CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder.java
===================================================================
--- work/src/org/kuali/kfs/coa/businessobject/options/CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/coa/businessobject/options/CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder.java	(revision 37225)
@@ -0,0 +1,78 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.coa.businessobject.options;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Iterator;
+import java.util.List;
+
+import org.kuali.kfs.coa.businessobject.CFDA;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
+import org.kuali.rice.kns.service.KeyValuesService;
+import org.kuali.rice.core.util.KeyLabelPair;
+
+/**
+ * Allows some information about persisted {@link Cfda} instances to be looked up.
+ */
+public class CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder extends KeyValuesBase {
+
+    /**
+     * Retrieves the list of possible CFDA Maintenance Type IDs and generates a collection with all the possible values.
+     * 
+     * @see org.kuali.keyvalues.KeyValuesFinder#getKeyValues()
+     */
+    public List getKeyValues() {
+
+        KeyValuesService boService = SpringContext.getBean(KeyValuesService.class);
+        Collection codes = boService.findAll(CFDA.class);
+
+        List<KeyLabelPair> labels = new ArrayList<KeyLabelPair>();
+        labels.add(new KeyLabelPair("", ""));
+
+        for (Iterator iter = codes.iterator(); iter.hasNext();) {
+            CFDA cfdaReference = (CFDA) iter.next();
+
+            if (!isDuplicateValue(labels, cfdaReference.getCfdaMaintenanceTypeId())) {
+                labels.add(new KeyLabelPair(cfdaReference.getCfdaMaintenanceTypeId(), cfdaReference.getCfdaMaintenanceTypeId()));
+            }
+        }
+
+        return labels;
+    }
+
+    /**
+     * This method determines if a value already exists in the collection.
+     * 
+     * @param collection The collection to be examined.
+     * @param value The value to be added to the collection if it does not already exist within it.
+     * @return True if the value passed in already exists in the collection, false otherwise.
+     */
+    private boolean isDuplicateValue(List<KeyLabelPair> collection, String value) {
+        boolean duplicate = false;
+
+        for (KeyLabelPair klp : collection) {
+            String klpLabel = klp.getLabel();
+            if (klpLabel != null) {
+                duplicate |= klpLabel.trim().equalsIgnoreCase(value.trim());
+            }
+        }
+
+        return duplicate;
+    }
+
+}
Index: work/src/org/kuali/kfs/coa/businessobject/ObjectCode.java
===================================================================
--- work/src/org/kuali/kfs/coa/businessobject/ObjectCode.java	(revision 30259)
+++ work/src/org/kuali/kfs/coa/businessobject/ObjectCode.java	(revision 37225)
@@ -20,7 +20,6 @@
 import org.apache.ojb.broker.PersistenceBroker;
 import org.apache.ojb.broker.PersistenceBrokerException;
 import org.kuali.kfs.gl.businessobject.SufficientFundRebuild;
-import org.kuali.kfs.integration.cg.ContractsAndGrantsCfda;
 import org.kuali.kfs.integration.kc.BudgetCategory;
 import org.kuali.kfs.sys.businessobject.SystemOptions;
 import org.kuali.kfs.sys.context.SpringContext;
Index: work/src/org/kuali/kfs/coa/businessobject/CFDA.java
===================================================================
--- work/src/org/kuali/kfs/coa/businessobject/CFDA.java	(revision 0)
+++ work/src/org/kuali/kfs/coa/businessobject/CFDA.java	(revision 37225)
@@ -0,0 +1,123 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.kuali.kfs.coa.businessobject;
+
+import java.util.LinkedHashMap;
+
+import org.kuali.rice.kns.bo.Inactivateable;
+import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
+
+
+/**
+ * Instances of this class refer to Catalog of Federal Domestic Assistance codes. Some of these codes are taken directly from a
+ * government web-site. Additional codes can be created manually however. Codes can be updated automatically via the CfdaBatchStep.
+ */
+public class CFDA extends PersistableBusinessObjectBase implements  Inactivateable {
+
+    private String cfdaNumber;
+    private String cfdaProgramTitleName;
+    private String cfdaMaintenanceTypeId;
+    private boolean active;
+
+    /**
+     * Default constructor.
+     */
+    public CFDA() {
+    }
+
+    /**
+     * Gets the cfdaNumber attribute.
+     * 
+     * @return Returns the cfdaNumber
+     */
+    public String getCfdaNumber() {
+        return cfdaNumber;
+    }
+
+    /**
+     * Sets the cfdaNumber attribute.
+     * 
+     * @param cfdaNumber The cfdaNumber to set.
+     */
+    public void setCfdaNumber(String cfdaNumber) {
+        this.cfdaNumber = cfdaNumber;
+    }
+
+
+    /**
+     * Gets the cfdaProgramTitleName attribute.
+     * 
+     * @return Returns the cfdaProgramTitleName
+     */
+    public String getCfdaProgramTitleName() {
+        return cfdaProgramTitleName;
+    }
+
+    /**
+     * Sets the cfdaProgramTitleName attribute.
+     * 
+     * @param cfdaProgramTitleName The cfdaProgramTitleName to set.
+     */
+    public void setCfdaProgramTitleName(String cfdaProgramTitleName) {
+        this.cfdaProgramTitleName = cfdaProgramTitleName;
+    }
+   
+    /**
+     * Gets the cfdaMaintenanceTypeId attribute.
+     * 
+     * @return Returns the cfdaMaintenanceTypeId
+     */
+    public String getCfdaMaintenanceTypeId() {
+        return cfdaMaintenanceTypeId;
+    }
+
+    /**
+     * Sets the cfdaMaintenanceTypeId attribute.
+     * 
+     * @param cfdaMaintenanceTypeId The cfdaMaintenanceTypeId to set.
+     */
+    public void setCfdaMaintenanceTypeId(String cfdaMaintenanceTypeId) {
+        this.cfdaMaintenanceTypeId = cfdaMaintenanceTypeId;
+    }
+
+    /**
+     * @see org.kuali.rice.kns.bo.BusinessObjectBase#toStringMapper()
+     */
+    protected LinkedHashMap toStringMapper() {
+        LinkedHashMap m = new LinkedHashMap();
+        m.put("cfdaNumber", this.cfdaNumber);
+        return m;
+    }
+
+    /**
+     * This method gets the active value.
+     * 
+     * @return The value of the active attribute.
+     */
+    public boolean isActive() {
+        return active;
+    }
+
+    /**
+     * This method sets the active for this object.
+     * 
+     * @param active The value to be assigned to the active attribute.
+     */
+    public void setActive(boolean active) {
+        this.active = active;
+    }
+}
Index: work/src/org/kuali/kfs/coa/document/datadictionary/CFDAMaintenanceDocument.xml
===================================================================
--- work/src/org/kuali/kfs/coa/document/datadictionary/CFDAMaintenanceDocument.xml	(revision 0)
+++ work/src/org/kuali/kfs/coa/document/datadictionary/CFDAMaintenanceDocument.xml	(revision 37225)
@@ -0,0 +1,68 @@
+<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:dd="http://rice.kuali.org/dd" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd         http://rice.kuali.org/dd         http://rice.kuali.org/dd/dd.xsd">
+<!--
+ Copyright 2008-2009 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
+
+  <bean id="CFDAMaintenanceDocument" parent="CFDAMaintenanceDocument-parentBean"/>
+
+  <bean id="CFDAMaintenanceDocument-parentBean" abstract="true" parent="MaintenanceDocumentEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.coa.businessobject.CFDA"/>
+    <property name="maintainableClass" value="org.kuali.kfs.sys.document.FinancialSystemMaintainable"/>
+    <property name="maintainableSections">
+      <list>
+        <ref bean="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference"/>
+      </list>
+    </property>
+    <property name="lockingKeys">
+      <list>
+        <value>cfdaNumber</value>
+      </list>
+    </property>
+    
+    
+    
+    
+    
+    <property name="documentTypeName" value="CFDM"/>
+    <property name="documentAuthorizerClass" value="org.kuali.kfs.sys.document.authorization.FinancialSystemMaintenanceDocumentAuthorizerBase"/>
+    <property name="workflowAttributes">
+    	<ref bean="CFDAMaintenanceDocument-workflowAttributes"/>
+    </property>
+  </bean>
+
+<!-- Maintenance Section Definitions -->
+
+
+  <bean id="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference" parent="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference-parentBean"/>
+
+  <bean id="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference-parentBean" abstract="true" parent="MaintainableSectionDefinition">
+    <property name="id" value="Edit Catalog of Federal Domestic Assistance Reference"/>
+    <property name="title" value="Edit Catalog of Federal Domestic Assistance Reference"/>
+    <property name="maintainableItems">
+      <list>
+        <bean parent="MaintainableFieldDefinition" p:name="cfdaNumber" p:required="true"/>
+        <bean parent="MaintainableFieldDefinition" p:name="cfdaProgramTitleName" p:required="true"/>
+        <bean parent="MaintainableFieldDefinition" p:name="cfdaMaintenanceTypeId" p:defaultValue="MANUAL" p:required="true"/>
+        <bean parent="MaintainableFieldDefinition" p:name="active" p:defaultValue="true"/>
+      </list>
+    </property>
+  </bean>
+
+	<!-- workflow attributes -->
+  	<bean id="CFDAMaintenanceDocument-workflowAttributes" parent="CFDAMaintenanceDocument-workflowAttributes-parentBean"/>
+  
+	<bean id="CFDAMaintenanceDocument-workflowAttributes-parentBean" class="org.kuali.rice.kns.datadictionary.WorkflowAttributes" abstract="true"/>
+
+</beans>
Index: work/src/org/kuali/kfs/gl/businessobject/options/ZeroEncumbranceOptionFinder.java
===================================================================
--- work/src/org/kuali/kfs/gl/businessobject/options/ZeroEncumbranceOptionFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/gl/businessobject/options/ZeroEncumbranceOptionFinder.java	(revision 37225)
@@ -0,0 +1,52 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.gl.businessobject.options;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import org.kuali.kfs.gl.Constant;
+import org.kuali.rice.core.util.KeyLabelPair;
+import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
+import org.kuali.rice.kns.lookup.valueFinder.ValueFinder;
+
+/**
+ * Options finder for the options to include zero encumbrances on the open encumbrance lookup
+ */
+public class ZeroEncumbranceOptionFinder extends KeyValuesBase implements ValueFinder {
+
+    /**
+     * Get the values: to include or exclude the zeroed out encumbrances
+     * @see org.kuali.rice.kns.lookup.keyvalues.KeyValuesFinder#getKeyValues()
+     */
+    @Override
+    public List<KeyLabelPair> getKeyValues() {
+        List<KeyLabelPair> options = new ArrayList<KeyLabelPair>();
+        options.add(new KeyLabelPair(Constant.ZERO_ENCUMBRANCE_INCLUDE, Constant.ZERO_ENCUMBRANCE_INCLUDE));
+        options.add(new KeyLabelPair(Constant.ZERO_ENCUMBRANCE_EXCLUDE, Constant.ZERO_ENCUMBRANCE_EXCLUDE));
+        return options;
+    }
+
+    /**
+     * Return the default value - which is to Exclude the zeroed out encumbrances
+     * @see org.kuali.rice.kns.lookup.valueFinder.ValueFinder#getValue()
+     */
+    @Override
+    public String getValue() {
+        return Constant.ZERO_ENCUMBRANCE_EXCLUDE;
+    }
+
+}
Index: work/src/org/kuali/kfs/gl/businessobject/options/DebitCreditOptionFinder.java
===================================================================
--- work/src/org/kuali/kfs/gl/businessobject/options/DebitCreditOptionFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/gl/businessobject/options/DebitCreditOptionFinder.java	(revision 37225)
@@ -0,0 +1,47 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.gl.businessobject.options;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import org.kuali.kfs.gl.Constant;
+import org.kuali.rice.core.util.KeyLabelPair;
+import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
+import org.kuali.rice.kns.lookup.valueFinder.ValueFinder;
+
+public class DebitCreditOptionFinder extends KeyValuesBase implements ValueFinder {
+    /**
+     * Returns the default value for this ValueFinder, in this case, exclude debit/credit 
+     * @return a String with the default key
+     * @see org.kuali.rice.kns.lookup.valueFinder.ValueFinder#getValue()
+     */
+    public String getValue() {
+        return Constant.DEBIT_CREDIT_EXCLUDE;
+    }
+
+    /**
+     * Returns a list of possible values for this ValueFinder, in this case include cost share entries or exclude cost share entries
+     * @return a List of key/value pairs to populate radio buttons
+     * @see org.kuali.rice.kns.lookup.keyvalues.KeyValuesFinder#getKeyValues()
+     */
+    public List getKeyValues() {
+        List labels = new ArrayList();
+        labels.add(new KeyLabelPair(Constant.DEBIT_CREDIT_INCLUDE, Constant.DEBIT_CREDIT_INCLUDE));
+        labels.add(new KeyLabelPair(Constant.DEBIT_CREDIT_EXCLUDE, Constant.DEBIT_CREDIT_EXCLUDE));
+        return labels;
+    }
+}
Index: work/src/org/kuali/kfs/pdp/batch/service/impl/InactivatePayeeAchAccountsServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/pdp/batch/service/impl/InactivatePayeeAchAccountsServiceImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/batch/service/impl/InactivatePayeeAchAccountsServiceImpl.java	(revision 37225)
@@ -0,0 +1,157 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.batch.service.impl;
+
+import java.util.Date;
+import java.util.List;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.pdp.PdpConstants.PayeeIdTypeCodes;
+import org.kuali.kfs.pdp.batch.service.InactivatePayeeAchAccountsService;
+import org.kuali.kfs.pdp.businessobject.PayeeACHAccount;
+import org.kuali.kfs.pdp.service.AchService;
+import org.kuali.kfs.sys.service.ReportWriterService;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+import org.kuali.kfs.vnd.document.service.VendorService;
+import org.kuali.rice.kim.bo.Person;
+import org.kuali.rice.kim.bo.entity.dto.KimEntityDefaultInfo;
+import org.kuali.rice.kim.service.IdentityManagementService;
+import org.kuali.rice.kim.service.PersonService;
+import org.kuali.rice.kns.service.BusinessObjectService;
+import org.kuali.rice.kns.service.DateTimeService;
+import org.kuali.rice.kns.util.ObjectUtils;
+
+/**
+ * Implementation for InactivatePayeeAchAccountsService interface.
+ */
+public class InactivatePayeeAchAccountsServiceImpl implements InactivatePayeeAchAccountsService {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(InactivatePayeeAchAccountsServiceImpl.class);
+
+    private BusinessObjectService businessObjectService;
+    private DateTimeService dateTimeService;
+    private IdentityManagementService identityManagementService;
+    private PersonService personService;    
+    private VendorService vendorService;
+    private AchService achService;
+    private ReportWriterService reportWriterService;
+    
+    /**
+     * @see rg.kuali.kfs.pdp.batch.service.#inactivatePayeeAchAccounts()
+     */
+    public boolean inactivatePayeeAchAccounts() {
+        LOG.info("Retrieving currently active Payee ACH Accounts ...");              
+        List<PayeeACHAccount> accounts = achService.getActiveAchAccounts();
+        
+        LOG.info("Inactivating ACH Accounts for inactive Payees and writing to the report ...");     
+        reportWriterService.writeTableHeader(PayeeACHAccount.class);
+        int countEmployee = 0;
+        int countEntity = 0;
+        int countVendor = 0;
+        Date currentDate = dateTimeService.getCurrentDate();           
+        
+        for (PayeeACHAccount account : accounts) {
+            String idType = account.getPayeeIdentifierTypeCode();
+            String idNumber = account.getPayeeIdNumber();
+            
+            // for Employee, retrieve from Person table by employee ID
+            if (StringUtils.equalsIgnoreCase(idType, PayeeIdTypeCodes.EMPLOYEE)) {
+                Person person = personService.getPersonByEmployeeId(idNumber);   
+                // inactivate the account if the person doesn't exist anymore or is inactive
+                if (ObjectUtils.isNull(person) || !person.isActive()) {
+                    LOG.info("Inactivating Payee ACH account for employee with ID # " + idNumber);
+                    account.setActive(false);
+                    businessObjectService.save(account);
+                    countEmployee++;
+                    reportWriterService.writeTableRow(account);
+                }
+            }
+            // for Entity, retrieve from Entity table by entity ID
+            else if (StringUtils.equalsIgnoreCase(idType, PayeeIdTypeCodes.ENTITY)) {
+                KimEntityDefaultInfo entity = identityManagementService.getEntityDefaultInfo(idNumber);
+                // inactivate the account if the entity doesn't exist anymore or is inactive
+                if (ObjectUtils.isNull(entity) || !entity.isActive()) {
+                    LOG.info("Inactivating Payee ACH account for entity with ID # " + idNumber);
+                    account.setActive(false);
+                    businessObjectService.save(account);
+                    countEntity++;
+                    reportWriterService.writeTableRow(account);
+                }
+            }
+            // for Vendor, retrieve from Vendor table by vendor number
+            else if (StringUtils.equalsIgnoreCase(idType, PayeeIdTypeCodes.VENDOR_ID)) { 
+                /*
+                // in PayeeACHAccount table, in case the vendor number only refers to the headerId, 
+                // with default detailId being 0, we need to add the default detailId to the vendor number
+                String vendorNumber = idNumber;
+                if (!StringUtils.contains(idNumber, VendorConstants.DASH)) {
+                    vendorNumber += VendorConstants.DASH + VendorConstants.DEFAULT_VENDOR_DETAIL_ID;
+                }
+                VendorDetail vendor = vendorService.getVendorDetail(vendorNumber);
+                */
+                VendorDetail vendor = vendorService.getVendorDetail(idNumber);
+                // inactivate the account if the vendor doesn't exist anymore or is inactive
+                if (ObjectUtils.isNull(vendor) || !vendor.isActiveIndicator()) {
+                    LOG.info("Inactivating Payee ACH account for vendor with vendor # " + idNumber);
+                    account.setActive(false);
+                    businessObjectService.save(account);                
+                    countVendor++;
+                    reportWriterService.writeTableRow(account);
+                }
+            }
+        }
+        
+        LOG.info("Total number of Employee Payee ACH accounts inacticated:" + countEmployee);    
+        LOG.info("Total number of Entity Payee ACH accounts inacticated:" + countEntity);    
+        LOG.info("Total number of Vendor Payee ACH accounts inacticated:" + countVendor); 
+        
+        reportWriterService.writeStatisticLine("%s %s", "TOTAL ACTIVE ACCOUNTS BEFORE RUNNING THE JOB:", accounts.size());
+        reportWriterService.writeStatisticLine("%s %s", "TOTAL ACCOUNTS INACTIVATED FOR EMPLOYEES:    ", countEmployee);
+        reportWriterService.writeStatisticLine("%s %s", "TOTAL ACCOUNTS INACTIVATED FOR ENTITIES:     ", countEntity);
+        reportWriterService.writeStatisticLine("%s %s", "TOTAL ACCOUNTS INACTIVATED FOR VENDORS:      ", countVendor);
+        reportWriterService.writeStatisticLine("%s %s", "ACCOUNTS INACTIVATION DATE:                  ", currentDate);  
+
+        return true;
+    }
+
+    public void setBusinessObjectService(BusinessObjectService businessObjectService) {
+        this.businessObjectService = businessObjectService;
+    }
+
+    public void setDateTimeService(DateTimeService dateTimeService) {
+        this.dateTimeService = dateTimeService;
+    }
+
+    public void setIdentityManagementService(IdentityManagementService identityManagementService) {
+        this.identityManagementService = identityManagementService;
+    }
+
+    public void setPersonService(PersonService personService) {
+        this.personService = personService;
+    }
+
+    public void setVendorService(VendorService vendorService) {
+        this.vendorService = vendorService;
+    }
+
+    public void setAchService(AchService achService) {
+        this.achService = achService;
+    }
+
+    public void setReportWriterService(ReportWriterService reportWriterService) {
+        this.reportWriterService = reportWriterService;
+    }
+    
+}
Index: work/src/org/kuali/kfs/pdp/batch/service/InactivatePayeeAchAccountsService.java
===================================================================
--- work/src/org/kuali/kfs/pdp/batch/service/InactivatePayeeAchAccountsService.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/batch/service/InactivatePayeeAchAccountsService.java	(revision 37225)
@@ -0,0 +1,28 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.batch.service;
+
+/**
+ * Service interface to provide processes needed for InactivatePayeeACHAccounts Job.
+ */
+public interface InactivatePayeeAchAccountsService {
+
+    /**
+     * Inactivates ACH accounts for inactive Payees, and writes information about inactivated records into a report.
+     */
+    public boolean inactivatePayeeAchAccounts();
+    
+}
Index: work/src/org/kuali/kfs/pdp/batch/InactivatePayeeAchAccountsStep.java
===================================================================
--- work/src/org/kuali/kfs/pdp/batch/InactivatePayeeAchAccountsStep.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/batch/InactivatePayeeAchAccountsStep.java	(revision 37225)
@@ -0,0 +1,43 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.batch;
+
+import org.kuali.kfs.pdp.batch.service.InactivatePayeeAchAccountsService;
+import org.kuali.kfs.sys.batch.AbstractWrappedBatchStep;
+import org.kuali.kfs.sys.batch.service.WrappedBatchExecutorService.CustomBatchExecutor;
+
+/**
+ * Batch step to inactivate the Payee ACH Accounts for which thes payee are inactive. 
+ * Payee active status is obtained from the associated Person or Vendor, depending on the payee ID type.
+ */
+public class InactivatePayeeAchAccountsStep extends AbstractWrappedBatchStep {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(InactivatePayeeAchAccountsStep.class);
+
+    private InactivatePayeeAchAccountsService inactivatePayeeAchAccountsService;
+    
+    protected CustomBatchExecutor getCustomBatchExecutor() {
+        return new CustomBatchExecutor() {
+            public boolean execute() {
+                return inactivatePayeeAchAccountsService.inactivatePayeeAchAccounts();
+            }                
+        };
+    }
+
+    public void setInactivatePayeeAchAccountsService(InactivatePayeeAchAccountsService inactivatePayeeAchAccountsService) {
+        this.inactivatePayeeAchAccountsService = inactivatePayeeAchAccountsService;
+    }
+        
+}
Index: work/src/org/kuali/kfs/pdp/batch/DownLoadFileViaHttpsStep.java
===================================================================
--- work/src/org/kuali/kfs/pdp/batch/DownLoadFileViaHttpsStep.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/batch/DownLoadFileViaHttpsStep.java	(revision 37225)
@@ -0,0 +1,93 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.batch;
+
+import java.io.BufferedReader;
+import java.io.InputStreamReader;
+import java.io.PrintWriter;
+import java.net.URL;
+import java.util.Date;
+
+import javax.net.ssl.HttpsURLConnection;
+import javax.net.ssl.SSLContext;
+import javax.net.ssl.SSLSocketFactory;
+import javax.net.ssl.TrustManager;
+import javax.net.ssl.X509TrustManager;
+
+import org.kuali.kfs.pdp.PdpConstants;
+import org.kuali.kfs.pdp.PdpParameterConstants;
+import org.kuali.kfs.pdp.util.HttpsTrustManager;
+import org.kuali.kfs.sys.batch.AbstractStep;
+import org.kuali.kfs.sys.service.impl.KfsParameterConstants;
+
+/**
+ * Batch step to download a text file from an HTTPS URL to the specified target directory.
+ */
+public class DownLoadFileViaHttpsStep extends AbstractStep {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(DownLoadFileViaHttpsStep.class);
+
+    private String targetDirectoryPath;
+    
+    /**
+     * @see org.kuali.kfs.sys.batch.Step#execute(java.lang.String, java.util.Date)
+     */
+    public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
+        //String sourceFileUrl = "https://www.fededirectory.frb.org/FedACHdir.txt";
+        String sourceFileUrl = getParameterService().getParameterValue(KfsParameterConstants.PRE_DISBURSEMENT_BATCH.class, PdpParameterConstants.FEDERAL_ACH_BANK_FILE_URL);
+        String targetFileName = getParameterService().getParameterValue(KfsParameterConstants.PRE_DISBURSEMENT_BATCH.class, PdpParameterConstants.ACH_BANK_INPUT_FILE);
+        String targetFilePath = targetDirectoryPath + targetFileName;
+
+        LOG.info("Downloading file from " + sourceFileUrl + " to " + targetFilePath);      
+
+        try {
+            X509TrustManager manager = new HttpsTrustManager();
+            TrustManager managers[] = {manager};
+            SSLContext context = SSLContext.getInstance(PdpConstants.SECURE_SOCKET_PROTOCOL);
+            context.init(null, managers, null);            
+            SSLSocketFactory factory = context.getSocketFactory();
+            
+            URL url = new URL(sourceFileUrl);
+            HttpsURLConnection connection = (HttpsURLConnection)url.openConnection();
+            connection.setDoOutput(true);   
+            connection.setSSLSocketFactory(factory);
+            
+            BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream()));
+            PrintWriter out = new PrintWriter(targetFilePath);
+            
+            String line;
+            int count = 0;
+            while ((line = in.readLine()) != null) {
+               out.println(line);
+               count++;
+            }
+            
+            in.close();
+            out.close();
+            
+            LOG.info("Total number of ACH Bank records downloaded: " + count);
+        }
+        catch (Exception e) {
+            throw new RuntimeException(e);
+        }
+        
+        return true;
+    }
+
+    public void setTargetDirectoryPath(String targetDirectoryPath) {
+        this.targetDirectoryPath = targetDirectoryPath;
+    }    
+        
+}
Index: work/src/org/kuali/kfs/pdp/businessobject/options/AchTransactionTypeCodeValuesFinder.java
===================================================================
--- work/src/org/kuali/kfs/pdp/businessobject/options/AchTransactionTypeCodeValuesFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/businessobject/options/AchTransactionTypeCodeValuesFinder.java	(revision 37225)
@@ -0,0 +1,44 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.businessobject.options;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import org.kuali.kfs.pdp.PdpConstants;
+import org.kuali.kfs.pdp.businessobject.ACHTransactionType;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.core.util.KeyLabelPair;
+import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
+import org.kuali.rice.kns.service.KeyValuesService;
+
+public class AchTransactionTypeCodeValuesFinder extends KeyValuesBase {
+
+    /**
+     * @see org.kuali.rice.kns.lookup.keyvalues.KeyValuesFinder#getKeyValues()
+     */
+    @SuppressWarnings("unchecked")
+    public List<KeyLabelPair> getKeyValues() {
+        List<ACHTransactionType> boList = (List) SpringContext.getBean(KeyValuesService.class).findAll(ACHTransactionType.class);
+        List<KeyLabelPair> keyValues = new ArrayList();
+        keyValues.add(new KeyLabelPair("", ""));
+        for (ACHTransactionType element : boList) {
+            keyValues.add(new KeyLabelPair(element.getCode(), element.getName()));
+        }
+
+        return keyValues;
+    }
+}
Index: work/src/org/kuali/kfs/pdp/identity/PayeeACHAccountRoleTypeServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/pdp/identity/PayeeACHAccountRoleTypeServiceImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/identity/PayeeACHAccountRoleTypeServiceImpl.java	(revision 37225)
@@ -0,0 +1,22 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.identity;
+
+import org.kuali.rice.kim.service.support.impl.KimRoleTypeServiceBase;
+
+public class PayeeACHAccountRoleTypeServiceImpl extends KimRoleTypeServiceBase {
+
+}
Index: work/src/org/kuali/kfs/pdp/util/HttpsTrustManager.java
===================================================================
--- work/src/org/kuali/kfs/pdp/util/HttpsTrustManager.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/util/HttpsTrustManager.java	(revision 37225)
@@ -0,0 +1,42 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.util;
+
+import java.security.cert.CertificateException;
+import java.security.cert.X509Certificate;
+
+import javax.net.ssl.X509TrustManager;
+
+/**
+ * A simple implementation of X509TrustManager which bypass any server certificate.
+ * This implementation can be used for known trusted HTTPS URLs that don't require authentication.
+ */
+public class HttpsTrustManager implements X509TrustManager {
+
+    public HttpsTrustManager() { 
+    }
+
+    public void checkClientTrusted(X509Certificate chain[], String authType) throws CertificateException {
+    }
+
+    public void checkServerTrusted(X509Certificate chain[], String authType) throws CertificateException {
+    }
+
+    public X509Certificate[] getAcceptedIssuers() {
+        return new X509Certificate[0];
+    }
+
+}
Index: work/src/org/kuali/kfs/pdp/document/authorization/PayeeACHAccountMaintenanceDocumentAuthorizer.java
===================================================================
--- work/src/org/kuali/kfs/pdp/document/authorization/PayeeACHAccountMaintenanceDocumentAuthorizer.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/document/authorization/PayeeACHAccountMaintenanceDocumentAuthorizer.java	(revision 37225)
@@ -0,0 +1,41 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.document.authorization;
+
+import java.util.Map;
+
+import org.kuali.kfs.pdp.businessobject.PayeeACHAccount;
+import org.kuali.kfs.sys.document.authorization.FinancialSystemMaintenanceDocumentAuthorizerBase;
+import org.kuali.kfs.sys.identity.KfsKimAttributes;
+import org.kuali.rice.kns.bo.BusinessObject;
+
+public class PayeeACHAccountMaintenanceDocumentAuthorizer extends FinancialSystemMaintenanceDocumentAuthorizerBase {
+
+    /**
+     * Overridden to add the Payee ACH Account Transaction Type to the qualification
+     * @see org.kuali.rice.kns.document.authorization.MaintenanceDocumentAuthorizerBase#addRoleQualification(org.kuali.rice.kns.bo.BusinessObject, java.util.Map)
+     */
+    @Override
+    protected void addRoleQualification(BusinessObject businessObject, Map<String, String> qualifications) {
+        super.addRoleQualification(businessObject, qualifications);
+        
+        if (businessObject instanceof PayeeACHAccount) {
+            final PayeeACHAccount payeeACHAccount = (PayeeACHAccount)businessObject;
+            qualifications.put(KfsKimAttributes.ACH_TRANSACTION_TYPE_CODE, payeeACHAccount.getAchTransactionType());
+        }
+    }
+
+}
\ No newline at end of file
Index: work/src/org/kuali/kfs/pdp/document/authorization/PayeeACHAccountMaintenanceDocumentPresentationController.java
===================================================================
--- work/src/org/kuali/kfs/pdp/document/authorization/PayeeACHAccountMaintenanceDocumentPresentationController.java	(revision 0)
+++ work/src/org/kuali/kfs/pdp/document/authorization/PayeeACHAccountMaintenanceDocumentPresentationController.java	(revision 37225)
@@ -0,0 +1,53 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.pdp.document.authorization;
+
+import java.util.Set;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.pdp.PdpPropertyConstants;
+import org.kuali.kfs.pdp.PdpConstants.PayeeIdTypeCodes;
+import org.kuali.kfs.pdp.businessobject.PayeeACHAccount;
+import org.kuali.kfs.sys.document.authorization.FinancialSystemMaintenanceDocumentPresentationControllerBase;
+import org.kuali.rice.kns.document.MaintenanceDocument;
+
+public class PayeeACHAccountMaintenanceDocumentPresentationController extends FinancialSystemMaintenanceDocumentPresentationControllerBase {
+    /**
+     * Adds the payeeEmailAddress field as readOnly if payee type is Employee or Entity.
+     * @see org.kuali.rice.kns.document.authorization.MaintenanceDocumentPresentationControllerBase#getConditionallyReadOnlyPropertyNames(org.kuali.rice.kns.document.MaintenanceDocument)
+     */
+    @Override
+    public Set<String> getConditionallyReadOnlyPropertyNames(MaintenanceDocument document) {
+        Set<String> readOnlyPropertyNames = super.getConditionallyReadOnlyPropertyNames(document);
+        
+        PayeeACHAccount payeeAccount = (PayeeACHAccount)document.getNewMaintainableObject().getBusinessObject();
+        String payeeIdTypeCode = payeeAccount.getPayeeIdentifierTypeCode();
+
+        // make name and email address readOnly if payee type is Employee or Entity
+        if (StringUtils.equalsIgnoreCase(payeeIdTypeCode, PayeeIdTypeCodes.EMPLOYEE) ||
+                StringUtils.equalsIgnoreCase(payeeIdTypeCode, PayeeIdTypeCodes.ENTITY)) {
+            readOnlyPropertyNames.add(PdpPropertyConstants.PAYEE_NAME);
+            readOnlyPropertyNames.add(PdpPropertyConstants.PAYEE_EMAIL_ADDRESS);
+        }
+        // make name readOnly if payee type is Vendor
+        else if (StringUtils.equalsIgnoreCase(payeeIdTypeCode, PayeeIdTypeCodes.VENDOR_ID)) {
+            readOnlyPropertyNames.add(PdpPropertyConstants.PAYEE_NAME);
+        }
+        
+        return readOnlyPropertyNames;                
+    }
+
+}
Index: work/src/org/kuali/kfs/fp/businessobject/RevolvingFundDetail.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/RevolvingFundDetail.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/RevolvingFundDetail.java	(revision 37225)
@@ -1,252 +0,0 @@
-/*
- * Copyright 2005-2006 The Kuali Foundation
- * 
- * Licensed under the Educational Community License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.opensource.org/licenses/ecl2.php
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.kuali.kfs.fp.businessobject;
-
-import java.sql.Date;
-import java.util.LinkedHashMap;
-
-import org.kuali.kfs.sys.KFSPropertyConstants;
-import org.kuali.kfs.sys.businessobject.Bank;
-import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
-import org.kuali.rice.kns.util.KualiDecimal;
-
-/**
- * This class is used to represent a revolving fund detail business object.
- */
-public class RevolvingFundDetail extends PersistableBusinessObjectBase {
-
-    private String documentNumber;
-    private String financialDocumentTypeCode;
-    private String financialDocumentColumnTypeCode;
-    private Integer financialDocumentLineNumber;
-    private Date financialDocumentRevolvingFundDate;
-    private String financialDocumentRevolvingFundReferenceNumber;
-    private String financialDocumentRevolvingFundDescription;
-    private KualiDecimal financialDocumentRevolvingFundAmount;
-    private String financialDocumentBankCode;
-    
-    private Bank bank;
-
-    /**
-     * Default constructor.
-     */
-    public RevolvingFundDetail() {
-        bank = new Bank();
-    }
-
-    /**
-     * Gets the documentNumber attribute.
-     * 
-     * @return Returns the documentNumber
-     */
-    public String getDocumentNumber() {
-        return documentNumber;
-    }
-
-    /**
-     * Sets the documentNumber attribute.
-     * 
-     * @param documentNumber The documentNumber to set.
-     */
-    public void setDocumentNumber(String documentNumber) {
-        this.documentNumber = documentNumber;
-    }
-
-
-    /**
-     * Gets the financialDocumentTypeCode attribute.
-     * 
-     * @return Returns the financialDocumentTypeCode
-     */
-    public String getFinancialDocumentTypeCode() {
-        return financialDocumentTypeCode;
-    }
-
-    /**
-     * Sets the financialDocumentTypeCode attribute.
-     * 
-     * @param financialDocumentTypeCode The financialDocumentTypeCode to set.
-     */
-    public void setFinancialDocumentTypeCode(String financialDocumentTypeCode) {
-        this.financialDocumentTypeCode = financialDocumentTypeCode;
-    }
-
-
-    /**
-     * Gets the financialDocumentColumnTypeCode attribute.
-     * 
-     * @return Returns the financialDocumentColumnTypeCode
-     */
-    public String getFinancialDocumentColumnTypeCode() {
-        return financialDocumentColumnTypeCode;
-    }
-
-    /**
-     * Sets the financialDocumentColumnTypeCode attribute.
-     * 
-     * @param financialDocumentColumnTypeCode The financialDocumentColumnTypeCode to set.
-     */
-    public void setFinancialDocumentColumnTypeCode(String financialDocumentColumnTypeCode) {
-        this.financialDocumentColumnTypeCode = financialDocumentColumnTypeCode;
-    }
-
-
-    /**
-     * Gets the financialDocumentLineNumber attribute.
-     * 
-     * @return Returns the financialDocumentLineNumber
-     */
-    public Integer getFinancialDocumentLineNumber() {
-        return financialDocumentLineNumber;
-    }
-
-    /**
-     * Sets the financialDocumentLineNumber attribute.
-     * 
-     * @param financialDocumentLineNumber The financialDocumentLineNumber to set.
-     */
-    public void setFinancialDocumentLineNumber(Integer financialDocumentLineNumber) {
-        this.financialDocumentLineNumber = financialDocumentLineNumber;
-    }
-
-
-    /**
-     * Gets the financialDocumentRevolvingFundDate attribute.
-     * 
-     * @return Returns the financialDocumentRevolvingFundDate
-     */
-    public Date getFinancialDocumentRevolvingFundDate() {
-        return financialDocumentRevolvingFundDate;
-    }
-
-    /**
-     * Sets the financialDocumentRevolvingFundDate attribute.
-     * 
-     * @param financialDocumentRevolvingFundDate The financialDocumentRevolvingFundDate to set.
-     */
-    public void setFinancialDocumentRevolvingFundDate(Date financialDocumentRevolvingFundDate) {
-        this.financialDocumentRevolvingFundDate = financialDocumentRevolvingFundDate;
-    }
-
-
-    /**
-     * Gets the financialDocumentRevolvingFundReferenceNumber attribute.
-     * 
-     * @return Returns the financialDocumentRevolvingFundReferenceNumber
-     */
-    public String getFinancialDocumentRevolvingFundReferenceNumber() {
-        return financialDocumentRevolvingFundReferenceNumber;
-    }
-
-    /**
-     * Sets the financialDocumentRevolvingFundReferenceNumber attribute.
-     * 
-     * @param financialDocumentRevolvingFundReferenceNumber The financialDocumentRevolvingFundReferenceNumber to set.
-     */
-    public void setFinancialDocumentRevolvingFundReferenceNumber(String financialDocumentRevolvingFundReferenceNumber) {
-        this.financialDocumentRevolvingFundReferenceNumber = financialDocumentRevolvingFundReferenceNumber;
-    }
-
-
-    /**
-     * Gets the financialDocumentRevolvingFundDescription attribute.
-     * 
-     * @return Returns the financialDocumentRevolvingFundDescription
-     */
-    public String getFinancialDocumentRevolvingFundDescription() {
-        return financialDocumentRevolvingFundDescription;
-    }
-
-    /**
-     * Sets the financialDocumentRevolvingFundDescription attribute.
-     * 
-     * @param financialDocumentRevolvingFundDescription The financialDocumentRevolvingFundDescription to set.
-     */
-    public void setFinancialDocumentRevolvingFundDescription(String financialDocumentRevolvingFundDescription) {
-        this.financialDocumentRevolvingFundDescription = financialDocumentRevolvingFundDescription;
-    }
-
-
-    /**
-     * Gets the financialDocumentRevolvingFundAmount attribute.
-     * 
-     * @return Returns the financialDocumentRevolvingFundAmount
-     */
-    public KualiDecimal getFinancialDocumentRevolvingFundAmount() {
-        return financialDocumentRevolvingFundAmount;
-    }
-
-    /**
-     * Sets the financialDocumentRevolvingFundAmount attribute.
-     * 
-     * @param financialDocumentRevolvingFundAmount The financialDocumentRevolvingFundAmount to set.
-     */
-    public void setFinancialDocumentRevolvingFundAmount(KualiDecimal financialDocumentRevolvingFundAmount) {
-        this.financialDocumentRevolvingFundAmount = financialDocumentRevolvingFundAmount;
-    }
-
-
-    /**
-     * Gets the financialDocumentBankCode attribute.
-     * 
-     * @return Returns the financialDocumentBankCode
-     */
-    public String getFinancialDocumentBankCode() {
-        return financialDocumentBankCode;
-    }
-
-    /**
-     * Sets the financialDocumentBankCode attribute.
-     * 
-     * @param financialDocumentBankCode The financialDocumentBankCode to set.
-     */
-    public void setFinancialDocumentBankCode(String financialDocumentBankCode) {
-        this.financialDocumentBankCode = financialDocumentBankCode;
-    }
-
-    /**
-     * Gets the bank attribute.
-     * 
-     * @return Returns the bank.
-     */
-    public Bank getBank() {
-        return bank;
-    }
-
-    /**
-     * Sets the bank attribute value.
-     * 
-     * @param bank The bank to set.
-     */
-    public void setBank(Bank bank) {
-        this.bank = bank;
-    }
-
-    /**
-     * @see org.kuali.rice.kns.bo.BusinessObjectBase#toStringMapper()
-     */
-    protected LinkedHashMap toStringMapper() {
-        LinkedHashMap m = new LinkedHashMap();
-        m.put(KFSPropertyConstants.DOCUMENT_NUMBER, this.documentNumber);
-        m.put("financialDocumentTypeCode", this.financialDocumentTypeCode);
-        m.put("financialDocumentColumnTypeCode", this.financialDocumentColumnTypeCode);
-        if (this.financialDocumentLineNumber != null) {
-            m.put("financialDocumentLineNumber", this.financialDocumentLineNumber.toString());
-        }
-        return m;
-    }
-}
Index: work/src/org/kuali/kfs/fp/businessobject/CheckBase.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/CheckBase.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/CheckBase.java	(revision 37225)
@@ -37,7 +37,7 @@
     private KualiDecimal amount;
     private String documentNumber;
     private String financialDocumentTypeCode;
-    private String cashieringRecordSource;
+    private String cashieringStatus;
     private Integer financialDocumentDepositLineNumber;
 
     /**
@@ -159,21 +159,21 @@
     }
 
     /**
-     * Gets the cashieringRecordSource attribute.
+     * Gets the cashieringStatus attribute.
      * 
-     * @return Returns the cashieringRecordSource.
+     * @return Returns the cashieringStatus.
      */
-    public String getCashieringRecordSource() {
-        return cashieringRecordSource;
+    public String getCashieringStatus() {
+        return cashieringStatus;
     }
 
     /**
-     * Sets the cashieringRecordSource attribute value.
+     * Sets the cashieringStatus attribute value.
      * 
-     * @param cashieringRecordSource The cashieringRecordSource to set.
+     * @param cashieringStatus The cashieringStatus to set.
      */
-    public void setCashieringRecordSource(String financialDocumentColumnTypeCode) {
-        this.cashieringRecordSource = financialDocumentColumnTypeCode;
+    public void setCashieringStatus(String financialDocumentColumnTypeCode) {
+        this.cashieringStatus = financialDocumentColumnTypeCode;
     }
 
     /**
@@ -226,7 +226,7 @@
         m.put("description", this.description);
         m.put("documentHeaderId", this.documentNumber);
         m.put("financialDocumentTypeCode", this.financialDocumentTypeCode);
-        m.put("cashieringRecordSource", this.cashieringRecordSource);
+        m.put("cashieringStatus", this.cashieringStatus);
 
         return m;
     }
@@ -240,7 +240,7 @@
 
         if (StringUtils.equals(checkNumber, other.getCheckNumber())) {
             if (StringUtils.equals(description, other.getDescription())) {
-                if (StringUtils.equals(financialDocumentTypeCode, other.getFinancialDocumentTypeCode()) && StringUtils.equals(cashieringRecordSource, other.getCashieringRecordSource())) {
+                if (StringUtils.equals(financialDocumentTypeCode, other.getFinancialDocumentTypeCode()) && StringUtils.equals(cashieringStatus, other.getCashieringStatus())) {
                     if (StringUtils.equals(documentNumber, other.getDocumentNumber())) {
                         if (NumberUtils.equals(sequenceId, other.getSequenceId())) {
                             if (NumberUtils.equals(financialDocumentDepositLineNumber, other.getFinancialDocumentDepositLineNumber())) {
Index: work/src/org/kuali/kfs/fp/businessobject/CoinDetail.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/CoinDetail.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/CoinDetail.java	(revision 37225)
@@ -30,7 +30,7 @@
 
     private String documentNumber;
     private String financialDocumentTypeCode;
-    private String cashieringRecordSource;
+    private String cashieringStatus;
     private KualiDecimal financialDocumentFiftyCentAmount;
     private KualiDecimal financialDocumentTwentyFiveCentAmount;
     private KualiDecimal financialDocumentTenCentAmount;
@@ -84,21 +84,21 @@
 
 
     /**
-     * Gets the cashieringRecordSource attribute.
+     * Gets the cashieringStatus attribute.
      * 
-     * @return Returns the cashieringRecordSource
+     * @return Returns the cashieringStatus
      */
-    public String getCashieringRecordSource() {
-        return cashieringRecordSource;
+    public String getCashieringStatus() {
+        return cashieringStatus;
     }
 
     /**
-     * Sets the cashieringRecordSource attribute.
+     * Sets the cashieringStatus attribute.
      * 
-     * @param cashieringRecordSource The cashieringRecordSource to set.
+     * @param cashieringStatus The cashieringStatus to set.
      */
-    public void setCashieringRecordSource(String financialDocumentColumnTypeCode) {
-        this.cashieringRecordSource = financialDocumentColumnTypeCode;
+    public void setCashieringStatus(String financialDocumentColumnTypeCode) {
+        this.cashieringStatus = financialDocumentColumnTypeCode;
     }
 
     /**
@@ -554,7 +554,7 @@
         LinkedHashMap m = new LinkedHashMap();
         m.put(KFSPropertyConstants.DOCUMENT_NUMBER, this.documentNumber);
         m.put("financialDocumentTypeCode", this.financialDocumentTypeCode);
-        m.put("cashieringRecordSource", this.cashieringRecordSource);
+        m.put("cashieringStatus", this.cashieringStatus);
         return m;
     }
 }
Index: work/src/org/kuali/kfs/fp/businessobject/datadictionary/ProcurementCardDefault.xml
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/datadictionary/ProcurementCardDefault.xml	(revision 0)
+++ work/src/org/kuali/kfs/fp/businessobject/datadictionary/ProcurementCardDefault.xml	(revision 37225)
@@ -0,0 +1,326 @@
+<beans xmlns="http://www.springframework.org/schema/beans"
+    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+    xmlns:p="http://www.springframework.org/schema/p"
+    xmlns:dd="http://rice.kuali.org/dd"
+    xsi:schemaLocation="
+http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
+http://rice.kuali.org/dd http://rice.kuali.org/dd/dd.xsd">
+
+        
+  <bean id="ProcurementCardDefault" parent="ProcurementCardDefault-parentBean" />
+
+  <bean id="ProcurementCardDefault-parentBean" abstract="true" parent="BusinessObjectEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.fp.businessobject.ProcurementCardDefault" />
+    <property name="inquiryDefinition" >
+      <ref bean="ProcurementCardDefault-inquiryDefinition" />
+    </property>
+    <property name="lookupDefinition" >
+      <ref bean="ProcurementCardDefault-lookupDefinition" />
+    </property>
+    <property name="titleAttribute" value="creditCardNumber" />
+    <property name="objectLabel" value="Procurement Cardholder" />    
+    <property name="attributes" >
+      <list>
+        <ref bean="ProcurementCardDefault-creditCardNumber" />
+        <ref bean="ProcurementCardDefault-cardHolderName" />
+        <ref bean="ProcurementCardDefault-cardHolderAlternateName" />        
+        <ref bean="ProcurementCardDefault-cardHolderLine1Address" />
+        <ref bean="ProcurementCardDefault-cardHolderLine2Address" />
+        <ref bean="ProcurementCardDefault-cardHolderCityName" />
+        <ref bean="ProcurementCardDefault-cardHolderStateCode" />
+        <ref bean="ProcurementCardDefault-cardHolderZipCode" />
+        <ref bean="ProcurementCardDefault-cardHolderWorkPhoneNumber" />
+        <ref bean="ProcurementCardDefault-cardLimit" />
+        <ref bean="ProcurementCardDefault-cardCycleAmountLimit" />        
+        <ref bean="ProcurementCardDefault-cardCycleVolumeLimit" /> 
+        <ref bean="ProcurementCardDefault-cardStatusCode" /> 
+        <ref bean="ProcurementCardDefault-cardNoteText" /> 
+        <ref bean="ProcurementCardDefault-chartOfAccountsCode" />
+        <ref bean="ProcurementCardDefault-accountNumber" />             
+        <ref bean="ProcurementCardDefault-subAccountNumber" />   
+        <ref bean="ProcurementCardDefault-financialObjectCode" />
+        <ref bean="ProcurementCardDefault-financialSubObjectCode" />  
+        <ref bean="ProcurementCardDefault-projectCode" />
+        <ref bean="ProcurementCardDefault-active" />           
+      </list>
+    </property>
+  </bean>
+
+<!-- Attribute Definitions -->
+
+  <bean id="ProcurementCardDefault-creditCardNumber" parent="ProcurementCardDefault-creditCardNumber-parentBean" />
+	
+  <bean id="ProcurementCardDefault-creditCardNumber-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="creditCardNumber" />
+    <property name="label" value="Procurement Card Number" />
+    <property name="shortLabel" value="Number" />
+    <property name="maxLength" value="16" />
+    <property name="validationPattern" >
+    <bean parent="AlphaNumericValidationPattern"
+            p:exactLength="16" />     
+    </property>
+    <property name="control" >
+      <bean parent="TextControlDefinition"
+            p:size="16" />
+    </property>
+     <property name="attributeSecurity">
+		<bean parent="AttributeSecurity">
+  			<property name="mask" value="true" /> 
+			<property name="maskFormatter">
+  				<bean parent="MaskFormatterSubString" p:maskCharacter="*" p:maskLength="13" />
+  			</property>
+  		</bean>
+  	</property>  	
+  </bean>	
+  
+  <bean id="ProcurementCardDefault-cardHolderName" parent="ProcurementCardDefault-cardHolderName-parentBean" />
+  
+   <bean id="ProcurementCardDefault-cardHolderName-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderName-parentBean">
+    <property name="label" value="Cardholder Name" />      
+  </bean>
+  
+  <bean id="ProcurementCardDefault-cardHolderAlternateName" parent="ProcurementCardDefault-cardHolderAlternateName-parentBean" />
+
+  <bean id="ProcurementCardDefault-cardHolderAlternateName-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderAlternateName-parentBean">
+   <property name="label" value="Cardholder Alternate Name" />     
+  </bean>
+  
+  <bean id="ProcurementCardDefault-cardHolderLine1Address" parent="ProcurementCardDefault-cardHolderLine1Address-parentBean" />
+
+  <bean id="ProcurementCardDefault-cardHolderLine1Address-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderLine1Address-parentBean">
+    <property name="label" value="Delivery Address 1" />        
+  </bean> 
+  
+  <bean id="ProcurementCardDefault-cardHolderLine2Address" parent="ProcurementCardDefault-cardHolderLine2Address-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderLine2Address-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderLine2Address-parentBean">
+    <property name="label" value="Delivery Address 2" />        
+  </bean> 
+  
+  <bean id="ProcurementCardDefault-cardHolderCityName" parent="ProcurementCardDefault-cardHolderCityName-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderCityName-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderCityName-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderStateCode" parent="ProcurementCardDefault-cardHolderStateCode-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderStateCode-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderStateCode-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderZipCode" parent="ProcurementCardDefault-cardHolderZipCode-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderZipCode-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderZipCode-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderWorkPhoneNumber" parent="ProcurementCardDefault-cardHolderWorkPhoneNumber-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardHolderWorkPhoneNumber-parentBean" abstract="true" parent="ProcurementCardHolder-cardHolderWorkPhoneNumber-parentBean" />
+
+  <bean id="ProcurementCardDefault-cardLimit" parent="ProcurementCardDefault-cardLimit-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardLimit-parentBean" abstract="true" parent="ProcurementCardHolder-cardLimit-parentBean">
+    <property name="label" value="Monthly Spend Limit" />
+    <property name="shortLabel" value="Mnth Spend Lim" />
+  </bean>
+  
+  <bean id="ProcurementCardDefault-cardCycleAmountLimit" parent="ProcurementCardDefault-cardCycleAmountLimit-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardCycleAmountLimit-parentBean" abstract="true" parent="ProcurementCardHolder-cardCycleAmountLimit-parentBean">
+	<property name="label" value="Single Transaction Limit" />
+    <property name="shortLabel" value="Single Trans Lim" />
+  </bean> 
+  
+  <bean id="ProcurementCardDefault-cardCycleVolumeLimit" parent="ProcurementCardDefault-cardCycleVolumeLimit-parentBean" />
+	
+  <bean id="ProcurementCardDefault-cardCycleVolumeLimit-parentBean" abstract="true" parent="ProcurementCardHolder-cardCycleVolumeLimit"/>
+  
+  <bean id="ProcurementCardDefault-cardStatusCode" parent="ProcurementCardDefault-cardStatusCode-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardStatusCode-parentBean" abstract="true" parent="ProcurementCardHolder-cardStatusCode-parentBean">
+    <property name="required" value="false" />
+  </bean>
+  
+  <bean id="ProcurementCardDefault-cardNoteText" parent="ProcurementCardDefault-cardNoteText-parentBean" />
+  
+  <bean id="ProcurementCardDefault-cardNoteText-parentBean" abstract="true" parent="ProcurementCardHolder-cardNoteText-parentBean">
+    <property name="label" value="MCC Groups" />
+    <property name="shortLabel" value="MCC Groups" />    
+  </bean>
+  
+  <bean id="ProcurementCardDefault-chartOfAccountsCode" parent="ProcurementCardDefault-chartOfAccountsCode-parentBean" />
+     
+  <bean id="ProcurementCardDefault-chartOfAccountsCode-parentBean" abstract="true" parent="Chart-chartOfAccountsCode">
+    <property name="label" value="Default Chart" />
+    <property name="shortLabel" value="Dflt Chrt" />
+    <property name="control" >
+      <bean parent="SelectControlDefinition"
+            p:valuesFinderClass="org.kuali.kfs.coa.businessobject.options.ChartValuesFinder"
+            p:includeKeyInLabel="false" />
+    </property>
+  </bean>
+  
+  <bean id="ProcurementCardDefault-accountNumber" parent="ProcurementCardDefault-accountNumber-parentBean"/>
+  
+  <bean id="ProcurementCardDefault-accountNumber-parentBean" abstract="true" parent="ProcurementCardHolder-accountNumber-parentBean" />  
+
+  <bean id="ProcurementCardDefault-subAccountNumber" parent="ProcurementCardDefault-subAccountNumber-parentBean" />
+  
+  <bean id="ProcurementCardDefault-subAccountNumber-parentBean" abstract="true" parent="ProcurementCardHolder-subAccountNumber-parentBean" />
+    	
+  <bean id="ProcurementCardDefault-financialObjectCode" parent="ProcurementCardDefault-financialObjectCode-parentBean" />
+  
+  <bean id="ProcurementCardDefault-financialObjectCode-parentBean" abstract="true" parent="ObjectCode-financialObjectCode">
+    <property name="label" value="Default Object Code" />
+    <property name="required" value="false" />    
+  </bean> 
+  
+  <bean id="ProcurementCardDefault-financialSubObjectCode" parent="ProcurementCardDefault-financialSubObjectCode-parentBean" />
+
+  <bean id="ProcurementCardDefault-financialSubObjectCode-parentBean" abstract="true" parent="SubObjectCode-financialSubObjectCode">
+    <property name="label" value="Default Sub-Object Code" />    
+    <property name="required" value="false" />    
+  </bean>
+  
+  <bean id="ProcurementCardDefault-projectCode" parent="ProcurementCardDefault-projectCode-parentBean" />
+  
+  <bean id="ProcurementCardDefault-projectCode-parentBean" abstract="true" parent="ProjectCode-code">
+    <property name="name" value="projectCode" />       
+  </bean>
+  
+  <bean id="ProcurementCardDefault-active" parent="ProcurementCardDefault-active-parentBean"/>
+  <bean id="ProcurementCardDefault-active-parentBean" abstract="true" parent="GenericAttributes-activeIndicator">
+    <property name="name" value="active"/>
+    <property name="shortLabel" value="Active"/>
+  </bean>
+  
+  <!-- Business Object Inquiry Definition -->
+
+  <bean id="ProcurementCardDefault-inquiryDefinition" parent="ProcurementCardDefault-inquiryDefinition-parentBean" />
+
+  <bean id="ProcurementCardDefault-inquiryDefinition-parentBean" abstract="true" parent="InquiryDefinition">
+    <property name="title" value="Procurement Cardholder Inquiry" />
+    <property name="inquirySections" >
+      <list>
+        <bean parent="InquirySectionDefinition">
+          <property name="title" value="Bearer of the Card of Procurement" />
+          <property name="numberOfColumns" value="1" />
+          <property name="inquiryFields" >
+            <list>        
+               	<bean parent="FieldDefinition"
+                    p:attributeName="creditCardNumber" /> 
+              	<bean parent="FieldDefinition"
+                    p:attributeName="cardHolderName" />          
+            </list>
+          </property>
+        </bean>
+        <bean parent="InquirySectionDefinition">
+        	<property name="title" value="Card Holder Default Information" />
+          	<property name="numberOfColumns" value="1" />
+          	<property name="inquiryFields" >
+            	<list>
+            		<bean parent="FieldDefinition"
+                    		p:attributeName="cardHolderAlternateName" />   
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardHolderLine1Address" />
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardHolderLine2Address" />   
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardHolderCityName" />              
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardHolderStateCode" />  
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardHolderZipCode" />  
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardHolderWorkPhoneNumber" />   
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardLimit" />                   
+					<bean parent="FieldDefinition"              
+		                    p:attributeName="cardCycleAmountLimit" />              
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardCycleVolumeLimit" />             
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardStatusCode" />              
+					<bean parent="FieldDefinition"
+		                    p:attributeName="cardNoteText" />
+            	</list>
+            </property>  
+        </bean>
+        <bean parent="InquirySectionDefinition">
+        	<property name="title" value="Accounting Default Information" />
+          	<property name="numberOfColumns" value="1" />
+          	<property name="inquiryFields" >
+            	<list>
+            		<bean parent="FieldDefinition"
+						p:attributeName="chartOfAccountsCode" />
+					<bean parent="FieldDefinition"
+						p:attributeName="accountNumber" />
+					<bean parent="FieldDefinition"
+						p:attributeName="subAccountNumber" />
+					<bean parent="FieldDefinition"
+						p:attributeName="financialObjectCode" />
+					<bean parent="FieldDefinition"
+						p:attributeName="financialSubObjectCode" />
+					<bean parent="FieldDefinition"
+ 						p:attributeName="projectCode" />                                           
+					<bean parent="FieldDefinition" p:attributeName="active" />
+            	</list>
+            </property>
+        </bean>
+      </list>
+    </property>
+  </bean>
+  
+  <!-- Business Object Lookup Definition -->
+
+  <bean id="ProcurementCardDefault-lookupDefinition" parent="ProcurementCardDefault-lookupDefinition-parentBean" />
+  
+  <bean id="ProcurementCardDefault-lookupDefinition-parentBean" abstract="true" parent="LookupDefinition">
+    <property name="title" value="Procurement Cardholder Lookup" />
+    <!-- property name="instructions" value="Lookup a Procurement Cardholder" / -->
+    <property name="defaultSort" >
+      <bean parent="SortDefinition">
+        <property name="attributeNames" >
+          <list>
+            <value>creditCardNumber</value>
+          </list>
+        </property>
+      </bean>
+    </property>
+    <property name="lookupFields" >
+      <list>
+        <bean parent="FieldDefinition"        
+              p:attributeName="cardHolderName" />
+        <bean parent="FieldDefinition"
+              p:attributeName="cardHolderAlternateName" /> 
+        <bean parent="FieldDefinition"
+              p:attributeName="chartOfAccountsCode" />
+        <bean parent="FieldDefinition"
+              p:attributeName="accountNumber" /> 
+        <bean parent="FieldDefinition"
+              p:attributeName="cardStatusCode" />
+        <bean parent="FieldDefinition" p:attributeName="active" />           
+      </list>
+    </property>
+    <property name="resultFields" >
+      <list>
+        <bean parent="FieldDefinition"
+              p:attributeName="creditCardNumber"  />      
+        <bean parent="FieldDefinition"
+              p:attributeName="cardStatusCode" /> 
+        <bean parent="FieldDefinition"        
+              p:attributeName="cardHolderName" />
+        <bean parent="FieldDefinition"
+              p:attributeName="cardHolderAlternateName" /> 
+        <bean parent="FieldDefinition"
+              p:attributeName="cardCycleVolumeLimit" />   
+        <bean parent="FieldDefinition"              
+              p:attributeName="cardCycleAmountLimit" />   
+        <bean parent="FieldDefinition"
+              p:attributeName="cardLimit" />             
+        <bean parent="FieldDefinition"
+              p:attributeName="chartOfAccountsCode" />
+        <bean parent="FieldDefinition"
+              p:attributeName="accountNumber" />
+        <bean parent="FieldDefinition"
+        	  p:attributeName="active" />                          
+      </list>
+    </property>
+  </bean>
+</beans>
\ No newline at end of file
Index: work/src/org/kuali/kfs/fp/businessobject/datadictionary/CoinDetail.xml
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/datadictionary/CoinDetail.xml	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/datadictionary/CoinDetail.xml	(revision 37225)
@@ -24,7 +24,7 @@
       <list>
         <ref bean="CoinDetail-documentNumber"/>
         <ref bean="CoinDetail-financialDocumentTypeCode"/>
-        <ref bean="CoinDetail-cashieringRecordSource"/>
+        <ref bean="CoinDetail-cashieringStatus"/>
         <ref bean="CoinDetail-financialDocumentHundredCentAmount"/>
         <ref bean="CoinDetail-hundredCentCount"/>
         <ref bean="CoinDetail-financialDocumentFiftyCentAmount"/>
@@ -63,10 +63,10 @@
       <ref bean="HiddenControl" />
     </property>
   </bean>
-  <bean id="CoinDetail-cashieringRecordSource" parent="CoinDetail-cashieringRecordSource-parentBean"/>
+  <bean id="CoinDetail-cashieringStatus" parent="CoinDetail-cashieringStatus-parentBean"/>
 
-  <bean id="CoinDetail-cashieringRecordSource-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="cashieringRecordSource"/>
+  <bean id="CoinDetail-cashieringStatus-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="cashieringStatus"/>
     <property name="forceUppercase" value="true"/>
     <property name="label" value="Cashiering Record Source"/>
     <property name="shortLabel" value="CshrgRcdSrc"/>
Index: work/src/org/kuali/kfs/fp/businessobject/datadictionary/CreditCardDetail.xml
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/datadictionary/CreditCardDetail.xml	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/datadictionary/CreditCardDetail.xml	(revision 37225)
@@ -24,7 +24,6 @@
       <list>
         <ref bean="CreditCardDetail-documentNumber"/>
         <ref bean="CreditCardDetail-financialDocumentTypeCode"/>
-        <ref bean="CreditCardDetail-financialDocumentColumnTypeCode"/>
         <ref bean="CreditCardDetail-financialDocumentLineNumber"/>
         <ref bean="CreditCardDetail-financialDocumentCreditCardTypeCode"/>
         <ref bean="CreditCardDetail-financialDocumentCreditCardVendorNumber"/>
@@ -49,22 +48,6 @@
     <property name="name" value="financialDocumentTypeCode"/>
     <property name="forceUppercase" value="true"/>
   </bean>
-  <bean id="CreditCardDetail-financialDocumentColumnTypeCode" parent="CreditCardDetail-financialDocumentColumnTypeCode-parentBean"/>
-
-  <bean id="CreditCardDetail-financialDocumentColumnTypeCode-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="financialDocumentColumnTypeCode"/>
-    <property name="forceUppercase" value="true"/>
-    <property name="label" value="Column Type Code"/>
-    <property name="shortLabel" value="Col Type Code"/>
-    <property name="maxLength" value="1"/>
-    <property name="validationPattern">
-      <bean parent="AlphaValidationPattern"/>
-    </property>
-    <property name="required" value="true"/>
-    <property name="control">
-      <bean parent="TextControlDefinition" p:size="3"/>
-    </property>
-  </bean>
   <bean id="CreditCardDetail-financialDocumentLineNumber" parent="CreditCardDetail-financialDocumentLineNumber-parentBean"/>
 
   <bean id="CreditCardDetail-financialDocumentLineNumber-parentBean" abstract="true" parent="GenericAttributes-genericAmount">
Index: work/src/org/kuali/kfs/fp/businessobject/datadictionary/CheckBase.xml
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/datadictionary/CheckBase.xml	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/datadictionary/CheckBase.xml	(revision 37225)
@@ -26,7 +26,7 @@
         <ref bean="CheckBase-checkDate"/>
         <ref bean="CheckBase-description"/>
         <ref bean="CheckBase-financialDocumentTypeCode"/>
-        <ref bean="CheckBase-cashieringRecordSource"/>
+        <ref bean="CheckBase-cashieringStatus"/>
         <ref bean="CheckBase-financialDocumentDepositLineNumber"/>
         <ref bean="CheckBase-amount"/>
         <ref bean="CheckBase-sequenceId"/>
@@ -85,10 +85,10 @@
       <ref bean="HiddenControl" />
     </property>
   </bean>
-  <bean id="CheckBase-cashieringRecordSource" parent="CheckBase-cashieringRecordSource-parentBean"/>
+  <bean id="CheckBase-cashieringStatus" parent="CheckBase-cashieringStatus-parentBean"/>
 
-  <bean id="CheckBase-cashieringRecordSource-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="cashieringRecordSource"/>
+  <bean id="CheckBase-cashieringStatus-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="cashieringStatus"/>
     <property name="forceUppercase" value="true"/>
     <property name="label" value="Cashiering Record Source"/>
     <property name="shortLabel" value="CshrgRcdSrc"/>
Index: work/src/org/kuali/kfs/fp/businessobject/datadictionary/AdvanceDepositDetail.xml
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/datadictionary/AdvanceDepositDetail.xml	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/datadictionary/AdvanceDepositDetail.xml	(revision 37225)
@@ -24,7 +24,6 @@
       <list>
         <ref bean="AdvanceDepositDetail-documentNumber"/>
         <ref bean="AdvanceDepositDetail-financialDocumentTypeCode"/>
-        <ref bean="AdvanceDepositDetail-financialDocumentColumnTypeCode"/>
         <ref bean="AdvanceDepositDetail-financialDocumentLineNumber"/>
         <ref bean="AdvanceDepositDetail-financialDocumentAdvanceDepositAmount"/>
         <ref bean="AdvanceDepositDetail-financialDocumentAdvanceDepositDate"/>
@@ -49,22 +48,6 @@
     <property name="name" value="financialDocumentTypeCode"/>
     <property name="forceUppercase" value="true"/>
   </bean>
-  <bean id="AdvanceDepositDetail-financialDocumentColumnTypeCode" parent="AdvanceDepositDetail-financialDocumentColumnTypeCode-parentBean"/>
-
-  <bean id="AdvanceDepositDetail-financialDocumentColumnTypeCode-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="financialDocumentColumnTypeCode"/>
-    <property name="forceUppercase" value="true"/>
-    <property name="label" value="Column Type Code"/>
-    <property name="shortLabel" value="Column Type Code"/>
-    <property name="maxLength" value="1"/>
-    <property name="validationPattern">
-      <bean parent="AlphaValidationPattern"/>
-    </property>
-    <property name="required" value="true"/>
-    <property name="control">
-      <bean parent="TextControlDefinition" p:size="3"/>
-    </property>
-  </bean>
   <bean id="AdvanceDepositDetail-financialDocumentLineNumber" parent="AdvanceDepositDetail-financialDocumentLineNumber-parentBean"/>
 
   <bean id="AdvanceDepositDetail-financialDocumentLineNumber-parentBean" abstract="true" parent="GenericAttributes-genericAmount">
Index: work/src/org/kuali/kfs/fp/businessobject/datadictionary/CurrencyDetail.xml
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/datadictionary/CurrencyDetail.xml	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/datadictionary/CurrencyDetail.xml	(revision 37225)
@@ -24,7 +24,7 @@
       <list>
         <ref bean="CurrencyDetail-documentNumber"/>
         <ref bean="CurrencyDetail-financialDocumentTypeCode"/>
-        <ref bean="CurrencyDetail-cashieringRecordSource"/>
+        <ref bean="CurrencyDetail-cashieringStatus"/>
         <ref bean="CurrencyDetail-financialDocumentHundredDollarAmount"/>
         <ref bean="CurrencyDetail-hundredDollarCount"/>
         <ref bean="CurrencyDetail-financialDocumentFiftyDollarAmount"/>
@@ -65,10 +65,10 @@
       <ref bean="HiddenControl" />
     </property>
   </bean>
-  <bean id="CurrencyDetail-cashieringRecordSource" parent="CurrencyDetail-cashieringRecordSource-parentBean"/>
+  <bean id="CurrencyDetail-cashieringStatus" parent="CurrencyDetail-cashieringStatus-parentBean"/>
 
-  <bean id="CurrencyDetail-cashieringRecordSource-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="cashieringRecordSource"/>
+  <bean id="CurrencyDetail-cashieringStatus-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="cashieringStatus"/>
     <property name="forceUppercase" value="true"/>
     <property name="label" value="Cashiering Record Source"/>
     <property name="shortLabel" value="CshrgRcdSrc"/>
Index: work/src/org/kuali/kfs/fp/businessobject/ProcurementCardDefault.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/ProcurementCardDefault.java	(revision 0)
+++ work/src/org/kuali/kfs/fp/businessobject/ProcurementCardDefault.java	(revision 37225)
@@ -0,0 +1,574 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.fp.businessobject;
+
+import java.sql.Date;
+import java.util.LinkedHashMap;
+
+import org.kuali.kfs.coa.businessobject.Account;
+import org.kuali.kfs.coa.businessobject.Chart;
+import org.kuali.kfs.coa.businessobject.ObjectCode;
+import org.kuali.kfs.coa.businessobject.Organization;
+import org.kuali.kfs.coa.businessobject.ProjectCode;
+import org.kuali.kfs.coa.businessobject.SubAccount;
+import org.kuali.kfs.coa.businessobject.SubObjectCode;
+import org.kuali.kfs.sys.KFSPropertyConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kim.bo.Person;
+import org.kuali.rice.kim.bo.impl.GroupImpl;
+import org.kuali.rice.kns.bo.Inactivateable;
+import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
+import org.kuali.rice.kns.util.KualiDecimal;
+
+/**
+ * This class is used to represent a procurement card holder, or the individual whose name is on the card.
+ */
+
+public class ProcurementCardDefault extends PersistableBusinessObjectBase implements Inactivateable {
+    private String creditCardNumber;
+    
+    private String cardHolderName;
+    private String cardHolderAlternateName;
+    private String cardHolderLine1Address;
+    private String cardHolderLine2Address;
+    private String cardHolderCityName;
+    private String cardHolderStateCode;
+    private String cardHolderZipCode;
+    private String cardHolderWorkPhoneNumber;
+    private KualiDecimal cardLimit;
+    private KualiDecimal cardCycleAmountLimit;    
+    private KualiDecimal cardCycleVolumeLimit;
+    private String cardStatusCode;
+    private String cardNoteText;
+    
+    private String chartOfAccountsCode;
+    private String accountNumber;
+    private String subAccountNumber;
+    private String financialObjectCode;
+    private String financialSubObjectCode;
+    private String projectCode;
+    
+    private boolean active;
+
+    private Account account;
+    private Chart chartOfAccounts;    
+    private SubAccount subAccount;
+    private ObjectCode objectCode;
+    private SubObjectCode subObjectCode;
+    private ProjectCode project;
+       
+    /**
+     * Default constructor.
+     */
+    public ProcurementCardDefault() {
+
+    }
+
+     /**
+     * Gets the creditCardNumber attribute.
+     * 
+     * @return Returns the creditCardNumber
+     */
+    public String getCreditCardNumber() {
+        return creditCardNumber;
+    }
+
+    /**
+     * Sets the creditCardNumber attribute.
+     * 
+     * @param creditCardNumber The creditCardNumber to set.
+     */
+    public void setCreditCardNumber(String creditCardNumber) {
+        this.creditCardNumber = creditCardNumber;
+    }
+
+    /**
+     * Gets the cardHolderName attribute.
+     * 
+     * @return Returns the cardHolderName
+     */
+    public String getCardHolderName() {
+        return cardHolderName;
+    }
+
+    /**
+     * Sets the cardHolderName attribute.
+     * 
+     * @param cardHolderName The cardHolderName to set.
+     */
+    public void setCardHolderName(String cardHolderName) {
+        this.cardHolderName = cardHolderName;
+    }
+
+    /**
+     * Gets the cardHolderAlternateName attribute.
+     * 
+     * @return Returns the cardHolderAlternateName
+     */
+    public String getCardHolderAlternateName() {
+        return cardHolderAlternateName;
+    }
+
+    /**
+     * Sets the cardHolderAlternateName attribute.
+     * 
+     * @param cardHolderAlternateName The cardHolderAlternateName to set.
+     */
+    public void setCardHolderAlternateName(String cardHolderAlternateName) {
+        this.cardHolderAlternateName = cardHolderAlternateName;
+    }
+
+    /**
+     * Gets the cardHolderLine1Address attribute.
+     * 
+     * @return Returns the cardHolderLine1Address
+     */
+    public String getCardHolderLine1Address() {
+        return cardHolderLine1Address;
+    }
+
+    /**
+     * Sets the cardHolderLine1Address attribute.
+     * 
+     * @param cardHolderLine1Address The cardHolderLine1Address to set.
+     */
+    public void setCardHolderLine1Address(String cardHolderLine1Address) {
+        this.cardHolderLine1Address = cardHolderLine1Address;
+    }
+
+    /**
+     * Gets the cardHolderLine2Address attribute.
+     * 
+     * @return Returns the cardHolderLine2Address
+     */
+    public String getCardHolderLine2Address() {
+        return cardHolderLine2Address;
+    }
+
+    /**
+     * Sets the cardHolderLine2Address attribute.
+     * 
+     * @param cardHolderLine2Address The cardHolderLine2Address to set.
+     */
+    public void setCardHolderLine2Address(String cardHolderLine2Address) {
+        this.cardHolderLine2Address = cardHolderLine2Address;
+    }
+
+    /**
+     * Gets the cardHolderCityName attribute.
+     * 
+     * @return Returns the cardHolderCityName
+     */
+    public String getCardHolderCityName() {
+        return cardHolderCityName;
+    }
+
+    /**
+     * Sets the cardHolderCityName attribute.
+     * 
+     * @param cardHolderCityName The cardHolderCityName to set.
+     */
+    public void setCardHolderCityName(String cardHolderCityName) {
+        this.cardHolderCityName = cardHolderCityName;
+    }
+
+    /**
+     * Gets the cardHolderStateCode attribute.
+     * 
+     * @return Returns the cardHolderStateCode
+     */
+    public String getCardHolderStateCode() {
+        return cardHolderStateCode;
+    }
+
+    /**
+     * Sets the cardHolderStateCode attribute.
+     * 
+     * @param cardHolderStateCode The cardHolderStateCode to set.
+     */
+    public void setCardHolderStateCode(String cardHolderStateCode) {
+        this.cardHolderStateCode = cardHolderStateCode;
+    }
+
+    /**
+     * Gets the cardHolderZipCode attribute.
+     * 
+     * @return Returns the cardHolderZipCode
+     */
+    public String getCardHolderZipCode() {
+        return cardHolderZipCode;
+    }
+
+    /**
+     * Sets the cardHolderZipCode attribute.
+     * 
+     * @param cardHolderZipCode The cardHolderZipCode to set.
+     */
+    public void setCardHolderZipCode(String cardHolderZipCode) {
+        this.cardHolderZipCode = cardHolderZipCode;
+    }
+
+    /**
+     * Gets the cardHolderWorkPhoneNumber attribute.
+     * 
+     * @return Returns the cardHolderWorkPhoneNumber
+     */
+    public String getCardHolderWorkPhoneNumber() {
+        return cardHolderWorkPhoneNumber;
+    }
+
+    /**
+     * Sets the cardHolderWorkPhoneNumber attribute.
+     * 
+     * @param cardHolderWorkPhoneNumber The cardHolderWorkPhoneNumber to set.
+     */
+    public void setCardHolderWorkPhoneNumber(String cardHolderWorkPhoneNumber) {
+        this.cardHolderWorkPhoneNumber = cardHolderWorkPhoneNumber;
+    }
+
+    /**
+     * Gets the cardLimit attribute.
+     * 
+     * @return Returns the cardLimit
+     */
+    public KualiDecimal getCardLimit() {
+        return cardLimit;
+    }
+
+    /**
+     * Sets the cardLimit attribute.
+     * 
+     * @param cardLimit The cardLimit to set.
+     */
+    public void setCardLimit(KualiDecimal cardLimit) {
+        this.cardLimit = cardLimit;
+    }
+
+    /**
+     * Gets the cardCycleAmountLimit attribute.
+     * 
+     * @return Returns the cardCycleAmountLimit
+     */
+    public KualiDecimal getCardCycleAmountLimit() {
+        return cardCycleAmountLimit;
+    }
+
+    /**
+     * Sets the cardCycleAmountLimit attribute.
+     * 
+     * @param cardCycleAmountLimit The cardCycleAmountLimit to set.
+     */
+    public void setCardCycleAmountLimit(KualiDecimal cardCycleAmountLimit) {
+        this.cardCycleAmountLimit = cardCycleAmountLimit;
+    }    
+   
+    /**
+     * Gets the cardCycleVolumeLimit attribute.
+     * 
+     * @return Returns the cardCycleVolumeLimit
+     */
+    public KualiDecimal getCardCycleVolumeLimit() {
+        return cardCycleVolumeLimit;
+    }
+
+    /**
+     * Sets the cardCycleVolumeLimit attribute.
+     * 
+     * @param cardCycleVolumeLimit The cardCycleVolumeLimit to set.
+     */
+    public void setCardCycleVolumeLimit(KualiDecimal cardCycleVolumeLimit) {
+        this.cardCycleVolumeLimit = cardCycleVolumeLimit;
+    }
+
+    /**
+     * Gets the cardStatusCode attribute.
+     * 
+     * @return Returns the cardStatusCode
+     */
+    public String getCardStatusCode() {
+        return cardStatusCode;
+    }
+
+    /**
+     * Sets the cardStatusCode attribute.
+     * 
+     * @param cardStatusCode The cardStatusCode to set.
+     */
+    public void setCardStatusCode(String cardStatusCode) {
+        this.cardStatusCode = cardStatusCode;
+    }
+
+    /**
+     * Gets the cardNoteText attribute.
+     * 
+     * @return Returns the cardNoteText
+     */
+    public String getCardNoteText() {
+        return cardNoteText;
+    }
+
+    /**
+     * Sets the cardNoteText attribute.
+     * 
+     * @param cardNoteText The cardNoteText to set.
+     */
+    public void setCardNoteText(String cardNoteText) {
+        this.cardNoteText = cardNoteText;
+    }
+
+    /**
+     * Gets the chartOfAccountsCode attribute.
+     * 
+     * @return Returns the chartOfAccountsCode
+     */
+    public String getChartOfAccountsCode() {
+        return chartOfAccountsCode;
+    }
+
+    /**
+     * Sets the chartOfAccountsCode attribute.
+     * 
+     * @param chartOfAccountsCode The chartOfAccountsCode to set.
+     */
+    public void setChartOfAccountsCode(String chartOfAccountsCode) {
+        this.chartOfAccountsCode = chartOfAccountsCode;
+    }
+
+
+    /**
+     * Gets the accountNumber attribute.
+     * 
+     * @return Returns the accountNumber
+     */
+    public String getAccountNumber() {
+        return accountNumber;
+    }
+
+    /**
+     * Sets the accountNumber attribute.
+     * 
+     * @param accountNumber The accountNumber to set.
+     */
+    public void setAccountNumber(String accountNumber) {
+        this.accountNumber = accountNumber;
+    }
+
+    /**
+     * Gets the subAccountNumber attribute.
+     * 
+     * @return Returns the subAccountNumber
+     */
+    public String getSubAccountNumber() {
+        return subAccountNumber;
+    }
+
+    /**
+     * Sets the subAccountNumber attribute.
+     * 
+     * @param subAccountNumber The subAccountNumber to set.
+     */
+    public void setSubAccountNumber(String subAccountNumber) {
+        this.subAccountNumber = subAccountNumber;
+    }
+      
+    /**
+     * Gets the financialObjectCode attribute.
+     * 
+     * @return Returns the financialObjectCode
+     */
+    public String getFinancialObjectCode() {
+        return financialObjectCode;
+    }
+
+    /**
+     * Sets the financialObjectCode attribute.
+     * 
+     * @param financialObjectCode The financialObjectCode to set.
+     */
+    public void setFinancialObjectCode(String financialObjectCode) {
+        this.financialObjectCode = financialObjectCode;
+    }
+
+    /**
+     * Gets the financialSubObjectCode attribute.
+     * 
+     * @return Returns the financialSubObjectCode
+     */
+    public String getFinancialSubObjectCode() {
+        return financialSubObjectCode;
+    }
+
+    /**
+     * Sets the financialSubObjectCode attribute.
+     * 
+     * @param financialSubObjectCode The financialSubObjectCode to set.
+     */
+    public void setFinancialSubObjectCode(String financialSubObjectCode) {
+        this.financialSubObjectCode = financialSubObjectCode;
+    }
+
+    /**
+     * @return the project code associated with this card holder
+     */
+    public String getProjectCode() {
+        return projectCode;
+    }
+
+    /**
+     * Sets the project code associated with this card holder
+     * @param projectCode the project code associated with this card holder
+     */
+    public void setProjectCode(String projectCode) {
+        this.projectCode = projectCode;
+    }
+
+    /**
+     * @see org.kuali.rice.kns.bo.Inactivateable#isActive()
+     * @return true if this procurement card holder detail is active, false otherwise
+     */
+    public boolean isActive() {
+        return active;
+    }
+
+    /**
+     * @see org.kuali.rice.kns.bo.Inactivateable#setActive(boolean)
+     * Sets whether this procurement card holder detail is active or not
+     */
+    public void setActive(boolean active) {
+        this.active = active;
+    }
+
+    /**
+     * Gets the account attribute.
+     * 
+     * @return Returns the account
+     */
+    public Account getAccount() {
+        return account;
+    }
+
+    /**
+     * Sets the account attribute.
+     * 
+     * @param account The account to set.
+     * @deprecated
+     */
+    public void setAccount(Account account) {
+        this.account = account;
+    }
+
+    /**
+     * Gets the chartOfAccounts attribute.
+     * 
+     * @return Returns the chartOfAccounts
+     */
+    public Chart getChartOfAccounts() {
+        return chartOfAccounts;
+    }
+
+    /**
+     * Sets the chartOfAccounts attribute.
+     * 
+     * @param chartOfAccounts The chartOfAccounts to set.
+     * @deprecated
+     */
+    public void setChartOfAccounts(Chart chartOfAccounts) {
+        this.chartOfAccounts = chartOfAccounts;
+    }
+
+    /**
+     * @return Returns the subAccount.
+     */
+    public SubAccount getSubAccount() {
+        return subAccount;
+    }
+
+    /**
+     * Sets the subAccount attribute.
+     * 
+     * @param subAccount The subAccount to set.
+     * @deprecated
+     */
+    public void setSubAccount(SubAccount subAccount) {
+        this.subAccount = subAccount;
+    }
+        
+    /**
+     * Gets the objectCode attribute.
+     * 
+     * @return Returns the objectCode
+     */
+     public ObjectCode getObjectCode() {
+        return objectCode;
+    }
+
+     /**
+      * Sets the objectCode attribute.
+      * 
+      * @param objectCode The objectCode to set.
+      * @deprecated
+      */ 
+    public void setObjectCode(ObjectCode objectCode) {
+        this.objectCode = objectCode;
+    }
+
+    /**
+     * Gets the subObjectCode attribute.
+     * 
+     * @return Returns the subObjectCode
+     */
+    public SubObjectCode getSubObjectCode() {
+        return subObjectCode;
+    }
+
+    /**
+     * Sets the subObjectCode attribute.
+     * 
+     * @param subObjectCode The subObjectCode to set.
+     * @deprecated
+     */
+    public void setSubObjectCode(SubObjectCode subObjectCode) {
+        this.subObjectCode = subObjectCode;
+    }
+
+    /**
+     * @return the ProjectCode associated with this procurement card holder detail
+     */
+    public ProjectCode getProject() {
+        return project;
+    }
+
+    /**
+     * Sets the ProjectCode associated with this procurement card holder detail.  Deprecated because, basically, this method is meant for OJB.
+     * @param project the project code for OJB to set.
+     * @deprecated
+     */
+    public void setProject(ProjectCode project) {
+        this.project = project;
+    }
+    
+    /**
+     * @see org.kuali.rice.kns.bo.BusinessObjectBase#toStringMapper()
+     */
+    @SuppressWarnings("unchecked")
+    protected LinkedHashMap toStringMapper() {
+        LinkedHashMap m = new LinkedHashMap();
+        m.put(KFSPropertyConstants.CREDIT_CARD_NUMBER, this.creditCardNumber);
+        return m;
+    }    
+
+
+}
Index: work/src/org/kuali/kfs/fp/businessobject/CashieringTransaction.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/CashieringTransaction.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/CashieringTransaction.java	(revision 37225)
@@ -32,7 +32,7 @@
  * This class represents a cashiering-related transaction used in the cash management document
  */
 public class CashieringTransaction extends TransientBusinessObjectBase {
-    public static final String DETAIL_DOCUMENT_TYPE = "CM";
+    public static final String DETAIL_DOCUMENT_TYPE = "CMD";
 
     private String campusCode;
     private String referenceFinancialDocumentNumber;
@@ -340,19 +340,19 @@
     public void prepareForSave() {
         moneyInCoin.setDocumentNumber(this.referenceFinancialDocumentNumber);
         moneyInCoin.setFinancialDocumentTypeCode(DETAIL_DOCUMENT_TYPE);
-        moneyInCoin.setCashieringRecordSource(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN);
+        moneyInCoin.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN);
 
         moneyInCurrency.setDocumentNumber(this.referenceFinancialDocumentNumber);
         moneyInCurrency.setFinancialDocumentTypeCode(DETAIL_DOCUMENT_TYPE);
-        moneyInCurrency.setCashieringRecordSource(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN);
+        moneyInCurrency.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN);
 
         moneyOutCoin.setDocumentNumber(this.referenceFinancialDocumentNumber);
         moneyOutCoin.setFinancialDocumentTypeCode(DETAIL_DOCUMENT_TYPE);
-        moneyOutCoin.setCashieringRecordSource(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_OUT);
+        moneyOutCoin.setCashieringStatus(KFSConstants.CurrencyCoinSources.DEPOSITS);
 
         moneyOutCurrency.setDocumentNumber(this.referenceFinancialDocumentNumber);
         moneyOutCurrency.setFinancialDocumentTypeCode(DETAIL_DOCUMENT_TYPE);
-        moneyOutCurrency.setCashieringRecordSource(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_OUT);
+        moneyOutCurrency.setCashieringStatus(KFSConstants.CurrencyCoinSources.DEPOSITS);
 
         newItemInProcess.setCampusCode(this.campusCode);
     }
@@ -497,7 +497,7 @@
     public Check createNewCheck() {
         Check newCheck = new CheckBase();
         newCheck.setFinancialDocumentTypeCode(DETAIL_DOCUMENT_TYPE);
-        newCheck.setCashieringRecordSource(KFSConstants.CheckSources.CASH_MANAGEMENT);
+        newCheck.setCashieringStatus(KFSConstants.CheckSources.CASH_MANAGEMENT);
         return newCheck;
     }
 
Index: work/src/org/kuali/kfs/fp/businessobject/AdvanceDepositDetail.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/AdvanceDepositDetail.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/AdvanceDepositDetail.java	(revision 37225)
@@ -34,7 +34,6 @@
 public class AdvanceDepositDetail extends PersistableBusinessObjectBase {
     private String documentNumber;
     private String financialDocumentTypeCode;
-    private String financialDocumentColumnTypeCode;
     private Integer financialDocumentLineNumber;
     private Date financialDocumentAdvanceDepositDate;
     private String financialDocumentAdvanceDepositReferenceNumber;
@@ -99,27 +98,7 @@
         this.financialDocumentTypeCode = financialDocumentTypeCode;
     }
 
-
     /**
-     * Gets the financialDocumentColumnTypeCode attribute.
-     * 
-     * @return Returns the financialDocumentColumnTypeCode
-     */
-    public String getFinancialDocumentColumnTypeCode() {
-        return financialDocumentColumnTypeCode;
-    }
-
-    /**
-     * Sets the financialDocumentColumnTypeCode attribute.
-     * 
-     * @param financialDocumentColumnTypeCode The financialDocumentColumnTypeCode to set.
-     */
-    public void setFinancialDocumentColumnTypeCode(String financialDocumentColumnTypeCode) {
-        this.financialDocumentColumnTypeCode = financialDocumentColumnTypeCode;
-    }
-
-
-    /**
      * Gets the financialDocumentLineNumber attribute.
      * 
      * @return Returns the financialDocumentLineNumber
@@ -267,7 +246,6 @@
         LinkedHashMap m = new LinkedHashMap();
         m.put(KFSPropertyConstants.DOCUMENT_NUMBER, this.documentNumber);
         m.put("financialDocumentTypeCode", this.financialDocumentTypeCode);
-        m.put("financialDocumentColumnTypeCode", this.financialDocumentColumnTypeCode);
         if (this.financialDocumentLineNumber != null) {
             m.put("financialDocumentLineNumber", this.financialDocumentLineNumber.toString());
         }
Index: work/src/org/kuali/kfs/fp/businessobject/Check.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/Check.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/Check.java	(revision 37225)
@@ -147,14 +147,14 @@
      * 
      * @return the cashiering record source
      */
-    public String getCashieringRecordSource();
+    public String getCashieringStatus();
 
     /**
      * Sets the source of this cashiering record.
      * 
-     * @param cashieringRecordSource
+     * @param cashieringStatus
      */
-    public void setCashieringRecordSource(String cashieringRecordSource);
+    public void setCashieringStatus(String cashieringStatus);
 
     /**
      * Returns true if this check has the same primitive field values as the given one
Index: work/src/org/kuali/kfs/fp/businessobject/CreditCardDetail.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/CreditCardDetail.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/CreditCardDetail.java	(revision 37225)
@@ -30,7 +30,6 @@
 public class CreditCardDetail extends PersistableBusinessObjectBase {
     private String documentNumber;
     private String financialDocumentTypeCode;
-    private String financialDocumentColumnTypeCode;
     private Integer financialDocumentLineNumber;
     private String financialDocumentCreditCardTypeCode;
     private String financialDocumentCreditCardVendorNumber;
@@ -87,27 +86,7 @@
         this.financialDocumentTypeCode = financialDocumentTypeCode;
     }
 
-
     /**
-     * Gets the financialDocumentColumnTypeCode attribute.
-     * 
-     * @return Returns the financialDocumentColumnTypeCode
-     */
-    public String getFinancialDocumentColumnTypeCode() {
-        return financialDocumentColumnTypeCode;
-    }
-
-    /**
-     * Sets the financialDocumentColumnTypeCode attribute.
-     * 
-     * @param financialDocumentColumnTypeCode The financialDocumentColumnTypeCode to set.
-     */
-    public void setFinancialDocumentColumnTypeCode(String financialDocumentColumnTypeCode) {
-        this.financialDocumentColumnTypeCode = financialDocumentColumnTypeCode;
-    }
-
-
-    /**
      * Gets the financialDocumentLineNumber attribute.
      * 
      * @return Returns the financialDocumentLineNumber
@@ -256,7 +235,6 @@
         LinkedHashMap m = new LinkedHashMap();
         m.put(KFSPropertyConstants.DOCUMENT_NUMBER, this.documentNumber);
         m.put("financialDocumentTypeCode", this.financialDocumentTypeCode);
-        m.put("financialDocumentColumnTypeCode", this.financialDocumentColumnTypeCode);
         if (this.financialDocumentLineNumber != null) {
             m.put("financialDocumentLineNumber", this.financialDocumentLineNumber.toString());
         }
Index: work/src/org/kuali/kfs/fp/businessobject/CurrencyDetail.java
===================================================================
--- work/src/org/kuali/kfs/fp/businessobject/CurrencyDetail.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/businessobject/CurrencyDetail.java	(revision 37225)
@@ -30,7 +30,7 @@
 
     private String documentNumber;
     private String financialDocumentTypeCode;
-    private String cashieringRecordSource;
+    private String cashieringStatus;
     private KualiDecimal financialDocumentHundredDollarAmount;
     private KualiDecimal financialDocumentFiftyDollarAmount;
     private KualiDecimal financialDocumentTwentyDollarAmount;
@@ -86,21 +86,21 @@
 
 
     /**
-     * Gets the cashieringRecordSource attribute.
+     * Gets the cashieringStatus attribute.
      * 
-     * @return Returns the cashieringRecordSource
+     * @return Returns the cashieringStatus
      */
-    public String getCashieringRecordSource() {
-        return cashieringRecordSource;
+    public String getCashieringStatus() {
+        return cashieringStatus;
     }
 
     /**
-     * Sets the cashieringRecordSource attribute.
+     * Sets the cashieringStatus attribute.
      * 
-     * @param cashieringRecordSource The cashieringRecordSource to set.
+     * @param cashieringStatus The cashieringStatus to set.
      */
-    public void setCashieringRecordSource(String financialDocumentColumnTypeCode) {
-        this.cashieringRecordSource = financialDocumentColumnTypeCode;
+    public void setCashieringStatus(String financialDocumentColumnTypeCode) {
+        this.cashieringStatus = financialDocumentColumnTypeCode;
     }
 
 
@@ -626,7 +626,7 @@
         LinkedHashMap m = new LinkedHashMap();
         m.put(KFSPropertyConstants.DOCUMENT_NUMBER, this.documentNumber);
         m.put("financialDocumentTypeCode", this.financialDocumentTypeCode);
-        m.put("cashieringRecordSource", this.cashieringRecordSource);
+        m.put("cashieringStatus", this.cashieringStatus);
         return m;
     }
 }
Index: work/src/org/kuali/kfs/fp/document/validation/impl/CashReceiptFamilyDocumentTotalValidation.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/validation/impl/CashReceiptFamilyDocumentTotalValidation.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/document/validation/impl/CashReceiptFamilyDocumentTotalValidation.java	(revision 37225)
@@ -17,6 +17,7 @@
 
 import static org.kuali.kfs.sys.document.validation.impl.AccountingDocumentRuleBaseConstants.ERROR_PATH.DOCUMENT_ERROR_PREFIX;
 
+import org.kuali.kfs.fp.document.CashReceiptDocument;
 import org.kuali.kfs.fp.document.CashReceiptFamilyBase;
 import org.kuali.kfs.sys.KFSKeyConstants;
 import org.kuali.kfs.sys.KFSPropertyConstants;
@@ -46,7 +47,8 @@
 
         if (isValid) {
             // make sure the document is in balance
-            isValid = getCashReceiptFamilyDocumentForValidation().getSourceTotal().compareTo(getCashReceiptFamilyDocumentForValidation().getTotalDollarAmount()) == 0;
+            isValid = getCashReceiptFamilyDocumentForValidation().getSourceTotal().compareTo(getCashReceiptFamilyDocumentForValidation().getTotalDollarAmount().subtract( 
+                    ((CashReceiptDocument)getCashReceiptFamilyDocumentForValidation()).getTotalChangeAmount())) == 0;
 
             if (!isValid) {
                 GlobalVariables.getMessageMap().putError(DOCUMENT_ERROR_PREFIX + KFSPropertyConstants.SUM_TOTAL_AMOUNT, KFSKeyConstants.CashReceipt.ERROR_DOCUMENT_CASH_RECEIPT_BALANCE);
Index: work/src/org/kuali/kfs/fp/document/validation/impl/ProcurementCardDefaultRule.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/validation/impl/ProcurementCardDefaultRule.java	(revision 0)
+++ work/src/org/kuali/kfs/fp/document/validation/impl/ProcurementCardDefaultRule.java	(revision 37225)
@@ -0,0 +1,179 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.fp.document.validation.impl;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.fp.batch.ProcurementCardCreateDocumentsStep;
+import org.kuali.kfs.fp.businessobject.ProcurementCardDefault;
+import org.kuali.kfs.sys.KFSKeyConstants;
+import org.kuali.kfs.sys.KFSPropertyConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kns.document.MaintenanceDocument;
+import org.kuali.rice.kns.maintenance.rules.MaintenanceDocumentRuleBase;
+import org.kuali.rice.kns.service.ParameterService;
+
+/**
+ * This class represents business rules for the procurement cardholder maintenance document
+ */
+
+public class ProcurementCardDefaultRule extends MaintenanceDocumentRuleBase {
+    protected static final String WARNING_CARDHOLDER_LAST_ACTIVE_MEMBER = "warning.document.procurementcardholderdetail.cardholder.last.active";
+    protected static ParameterService parameterService;
+
+    /**
+     * Returns true procurement card defaults maintenance document is routed successfully
+     * 
+     * @param document submitted procurement card defaults maintenance document
+     * @return true if chart/account/organization is valid
+     * 
+     * @see org.kuali.rice.kns.maintenance.rules.MaintenanceDocumentRuleBase#processCustomRouteDocumentBusinessRules(org.kuali.rice.kns.document.MaintenanceDocument)
+     */
+    @Override
+    protected boolean processCustomRouteDocumentBusinessRules(MaintenanceDocument document) {
+        boolean continueRouting = super.processCustomRouteDocumentBusinessRules(document);
+        final ProcurementCardDefault newProcurementCardDefault = (ProcurementCardDefault)getNewBo();
+        
+        continueRouting &= validateCardHolderDefault(newProcurementCardDefault);
+        continueRouting &= validateAccountingDefault(newProcurementCardDefault);
+        
+        return continueRouting;
+    }
+    /**
+     * Always returns true; provides user feedback on procurement card defaults maintenance document
+     * @see org.kuali.rice.kns.rules.DocumentRuleBase#processCustomSaveDocumentBusinessRules(org.kuali.rice.kns.document.Document)
+     */
+    @Override
+    protected boolean processCustomSaveDocumentBusinessRules(MaintenanceDocument document) {
+        super.processCustomSaveDocumentBusinessRules(document);
+        
+        final ProcurementCardDefault newProcurementCardDefault = (ProcurementCardDefault)getNewBo();
+        validateCardHolderDefault(newProcurementCardDefault);
+        validateAccountingDefault(newProcurementCardDefault);
+        
+        return true;
+    }
+
+    /**
+     * @return true if use of card holder defaults is turned on via parameter, false if it is turned off
+     */
+    protected boolean isCardHolderDefaultTurnedOn() {
+        return getParameterService().getIndicatorParameter(ProcurementCardCreateDocumentsStep.class, ProcurementCardCreateDocumentsStep.USE_CARD_HOLDER_DEFAULT_PARAMETER_NAME);
+    }
+    
+    /**
+     * @return true if use of accounting defaults is turned on via parameter, false if it is turned off
+     */
+    protected boolean isAccountDefaultTurnedOn() {
+        return getParameterService().getIndicatorParameter(ProcurementCardCreateDocumentsStep.class, ProcurementCardCreateDocumentsStep.USE_ACCOUNTING_DEFAULT_PARAMETER_NAME);
+    }
+    
+    /**
+     * Validates the card holder information
+     * @return true if the card holder is valid, false otherwise
+     */
+    protected boolean validateCardHolderDefault(ProcurementCardDefault newProcurementCardDefault) {
+        boolean valid = true;
+        if (isCardHolderDefaultTurnedOn()) {
+            if (StringUtils.isBlank(newProcurementCardDefault.getCardHolderLine1Address())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_HOLDER_LINE1_ADDRESS, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getCardHolderCityName())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_HOLDER_CITY_NAME, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getCardHolderStateCode())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_HOLDER_STATE, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getCardHolderZipCode())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_HOLDER_ZIP_CODE, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getCardHolderWorkPhoneNumber())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_HOLDER_WORK_PHONE_NUMBER, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (newProcurementCardDefault.getCardLimit() == null) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_LIMIT, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (newProcurementCardDefault.getCardCycleAmountLimit() == null) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_CYCLE_AMOUNT_LIMIT, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (newProcurementCardDefault.getCardCycleVolumeLimit() == null) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_CYCLE_VOLUME_LIMIT, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getCardStatusCode())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_STATUS_CODE, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getCardNoteText())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.PROCUREMENT_CARD_NOTE_TEXT, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+        }
+        return valid;
+    }
+    
+    /**
+     * Validates the accounting default information
+     * @return true if the accounting default information is valid, false otherwise
+     */
+    protected boolean validateAccountingDefault(ProcurementCardDefault newProcurementCardDefault) {
+        boolean valid = true;
+        if (isAccountDefaultTurnedOn() || isCardHolderDefaultTurnedOn()) {
+            if (StringUtils.isBlank(newProcurementCardDefault.getChartOfAccountsCode())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.CHART_OF_ACCOUNTS_CODE, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getAccountNumber())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.ACCOUNT_NUMBER, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+            if (StringUtils.isBlank(newProcurementCardDefault.getFinancialObjectCode())) {
+                putFieldErrorWithLabel(KFSPropertyConstants.FINANCIAL_OBJECT_CODE, KFSKeyConstants.ERROR_REQUIRED);
+                valid = false;
+            }
+        }
+        return valid;
+    }
+    
+    /**
+     * Adds a property-specific error to the global errors list, with the DD short label as the single argument.
+     *
+     * @param propertyName - Property name of the element that is associated with the error. Used to mark the field as errored in
+     *        the UI.
+     * @param errorConstant - Error Constant that can be mapped to a resource for the actual text message.
+     */
+    protected void putFieldErrorWithLabel(String propertyName, String errorConstant) {
+        final String label = getDataDictionaryService().getAttributeLabel(getNewBo().getClass(), propertyName);
+        putFieldError(propertyName, errorConstant, label);
+    }
+    
+    /**
+     * @return the default implementation of the ParameterService
+     */
+    protected synchronized ParameterService getParameterService() {
+        if (parameterService == null) {
+            parameterService = SpringContext.getBean(ParameterService.class); 
+        }
+        return parameterService;
+    }
+
+}
Index: work/src/org/kuali/kfs/fp/document/validation/impl/CashReceiptCashManagerValidation.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/validation/impl/CashReceiptCashManagerValidation.java	(revision 0)
+++ work/src/org/kuali/kfs/fp/document/validation/impl/CashReceiptCashManagerValidation.java	(revision 37225)
@@ -0,0 +1,52 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.fp.document.validation.impl;
+
+import org.kuali.kfs.fp.document.CashReceiptDocument;
+import org.kuali.kfs.fp.document.CashReceiptFamilyBase;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.KFSKeyConstants;
+import org.kuali.kfs.sys.document.validation.RouteNodeValidation;
+import org.kuali.kfs.sys.document.validation.event.AttributedDocumentEvent;
+import org.kuali.rice.kns.util.GlobalVariables;
+
+public class CashReceiptCashManagerValidation extends RouteNodeValidation {
+    
+    private CashReceiptFamilyBase cashReceiptDocumentForValidation;
+    
+    @Override
+    public boolean validate(AttributedDocumentEvent event) {
+      //check whether cash manager confirmed amount equals to the old amount
+        CashReceiptDocument crDoc = (CashReceiptDocument) getCashReceiptDocumentForValidation();
+         if ((crDoc.getTotalDollarAmount().compareTo(crDoc.getTotalConfirmedCashAmount().add(crDoc.getTotalConfirmedCheckAmount()).add(crDoc.getTotalConfirmedCoinAmount()))) != 0) {
+            GlobalVariables.getMessageMap().putError(KFSConstants.GLOBAL_ERRORS, KFSKeyConstants.CashReceipt.ERROR_CONFIRMED_TOTAL, crDoc.getTotalDollarAmount().toString());
+            return false;
+        }
+         
+        return true;
+        
+    }
+
+    public CashReceiptFamilyBase getCashReceiptDocumentForValidation() {
+        return cashReceiptDocumentForValidation;
+    }
+
+    public void setCashReceiptDocumentForValidation(CashReceiptFamilyBase cashReceiptDocumentForValidation) {
+        this.cashReceiptDocumentForValidation = cashReceiptDocumentForValidation;
+    }
+    
+    
+}
Index: work/src/org/kuali/kfs/fp/document/validation/impl/DisbursementVoucherNonEmployeeTravelCompanyValidation.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/validation/impl/DisbursementVoucherNonEmployeeTravelCompanyValidation.java	(revision 0)
+++ work/src/org/kuali/kfs/fp/document/validation/impl/DisbursementVoucherNonEmployeeTravelCompanyValidation.java	(revision 37225)
@@ -0,0 +1,123 @@
+/*
+ * Copyright 2008 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.fp.document.validation.impl;
+
+import java.text.MessageFormat;
+import java.util.List;
+
+import org.kuali.kfs.fp.businessobject.DisbursementVoucherNonEmployeeExpense;
+import org.kuali.kfs.fp.businessobject.DisbursementVoucherNonEmployeeTravel;
+import org.kuali.kfs.fp.businessobject.TravelCompanyCode;
+import org.kuali.kfs.fp.document.DisbursementVoucherDocument;
+import org.kuali.kfs.sys.KFSKeyConstants;
+import org.kuali.kfs.sys.KFSPropertyConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.sys.document.AccountingDocument;
+import org.kuali.kfs.sys.document.validation.GenericValidation;
+import org.kuali.kfs.sys.document.validation.event.AttributedDocumentEvent;
+import org.kuali.rice.kns.service.BusinessObjectService;
+import org.kuali.rice.kns.util.GlobalVariables;
+import org.kuali.rice.kns.util.MessageMap;
+import org.kuali.rice.kns.util.ObjectUtils;
+
+public class DisbursementVoucherNonEmployeeTravelCompanyValidation extends GenericValidation {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(DisbursementVoucherNonEmployeeTravelCompanyValidation.class);
+
+    private AccountingDocument accountingDocumentForValidation;
+
+    public final static String DV_PRE_PAID_EMPLOYEE_EXPENSES_PROPERTY_PATH = KFSPropertyConstants.DOCUMENT + "." + KFSPropertyConstants.DV_NON_EMPLOYEE_TRAVEL + "." + KFSPropertyConstants.DV_PRE_PAID_EMPLOYEE_EXPENSES;
+    public final static String DV_NON_EMPLOYEE_EXPENSES_PROPERTY_PATH = KFSPropertyConstants.DOCUMENT + "." + KFSPropertyConstants.DV_NON_EMPLOYEE_TRAVEL + "." + KFSPropertyConstants.DV_NON_EMPLOYEE_EXPENSES;
+
+    /**
+     * @see org.kuali.kfs.sys.document.validation.Validation#validate(org.kuali.kfs.sys.document.validation.event.AttributedDocumentEvent)
+     */
+    public boolean validate(AttributedDocumentEvent event) {
+        LOG.debug("validate start");
+        
+        boolean isValid = true;
+        DisbursementVoucherDocument disbursementVoucherDocument = (DisbursementVoucherDocument) accountingDocumentForValidation;
+        DisbursementVoucherNonEmployeeTravel nonEmployeeTravel = disbursementVoucherDocument.getDvNonEmployeeTravel();
+        
+        MessageMap errors = GlobalVariables.getMessageMap();
+        errors.addToErrorPath(KFSPropertyConstants.DOCUMENT);
+
+        // check non employee travel company exists
+        int index = 0;
+        List<DisbursementVoucherNonEmployeeExpense> expenses = nonEmployeeTravel.getDvNonEmployeeExpenses();
+        for (DisbursementVoucherNonEmployeeExpense expense : expenses) {
+            TravelCompanyCode travelCompanyCode = retrieveCompany(expense.getDisbVchrExpenseCode(), expense.getDisbVchrExpenseCompanyName());
+
+            if (ObjectUtils.isNull(travelCompanyCode)) {
+                String fullPropertyName = this.buildFullPropertyName(DV_NON_EMPLOYEE_EXPENSES_PROPERTY_PATH, index, KFSPropertyConstants.DISB_VCHR_EXPENSE_COMPANY_NAME);
+                errors.putErrorWithoutFullErrorPath(fullPropertyName, KFSKeyConstants.ERROR_EXISTENCE, "Company ");
+                isValid = false;
+            }
+
+            index++;
+        }
+
+        // check prepaid expenses company exists
+        index = 0;
+        List<DisbursementVoucherNonEmployeeExpense> prePaidExpenses = nonEmployeeTravel.getDvPrePaidEmployeeExpenses();
+        for (DisbursementVoucherNonEmployeeExpense prePaidExpense : prePaidExpenses) {
+            TravelCompanyCode travelCompanyCode = retrieveCompany(prePaidExpense.getDisbVchrExpenseCode(), prePaidExpense.getDisbVchrExpenseCompanyName());
+
+            if (ObjectUtils.isNull(travelCompanyCode)) {
+                String fullPropertyName = this.buildFullPropertyName(DV_PRE_PAID_EMPLOYEE_EXPENSES_PROPERTY_PATH, index, KFSPropertyConstants.DISB_VCHR_EXPENSE_COMPANY_NAME);
+                errors.putErrorWithoutFullErrorPath(fullPropertyName, KFSKeyConstants.ERROR_EXISTENCE, "Company ");
+                isValid = false;
+            }
+
+            index++;
+        }
+        
+        errors.removeFromErrorPath(KFSPropertyConstants.DOCUMENT);
+        
+        return isValid;
+    }
+
+    // build the full name of a document property
+    protected String buildFullPropertyName(String propertyPath, int index, String propertyName) {
+        String fileNamePattern = "{0}[{1}].{2}";
+
+        return MessageFormat.format(fileNamePattern, propertyPath, index, propertyName);
+    }
+
+    // Retrieves the Company object from the company name
+    protected TravelCompanyCode retrieveCompany(String companyCode, String companyName) {
+        TravelCompanyCode travelCompanyCode = new TravelCompanyCode();
+        travelCompanyCode.setCode(companyCode);
+        travelCompanyCode.setName(companyName);
+        return (TravelCompanyCode) SpringContext.getBean(BusinessObjectService.class).retrieve(travelCompanyCode);
+    }
+
+    /**
+     * Sets the accountingDocumentForValidation attribute value.
+     * 
+     * @param accountingDocumentForValidation The accountingDocumentForValidation to set.
+     */
+    public void setAccountingDocumentForValidation(AccountingDocument accountingDocumentForValidation) {
+        this.accountingDocumentForValidation = accountingDocumentForValidation;
+    }
+
+    /**
+     * Gets the accountingDocumentForValidation attribute. 
+     * @return Returns the accountingDocumentForValidation.
+     */
+    public AccountingDocument getAccountingDocumentForValidation() {
+        return accountingDocumentForValidation;
+    }
+}

Property changes on: work/src/org/kuali/kfs/fp/document/validation/impl/DisbursementVoucherNonEmployeeTravelCompanyValidation.java
___________________________________________________________________
Added: svn:mergeinfo

Index: work/src/org/kuali/kfs/fp/document/CashManagementDocument.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/CashManagementDocument.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/document/CashManagementDocument.java	(revision 37225)
@@ -69,7 +69,6 @@
     protected static Logger LOG = Logger.getLogger(CashManagementDocument.class);
 
     protected String campusCode;
-    protected String referenceFinancialDocumentNumber;
 
     protected List<Deposit> deposits;
 
@@ -78,6 +77,23 @@
     protected CashieringTransaction currentTransaction;
     protected CashDrawer cashDrawer;
     protected Campus campus;
+    
+    private KualiDecimal financialDocumentHundredDollarAmount;
+    private KualiDecimal financialDocumentFiftyDollarAmount;
+    private KualiDecimal financialDocumentTwentyDollarAmount;
+    private KualiDecimal financialDocumentTenDollarAmount;
+    private KualiDecimal financialDocumentFiveDollarAmount;
+    private KualiDecimal financialDocumentTwoDollarAmount;
+    private KualiDecimal financialDocumentOneDollarAmount;
+    private KualiDecimal financialDocumentOtherDollarAmount;
+    private KualiDecimal financialDocumentHundredCentAmount;
+    private KualiDecimal financialDocumentFiftyCentAmount;
+    private KualiDecimal financialDocumentTwentyFiveCentAmount;
+    private KualiDecimal financialDocumentTenCentAmount;
+    private KualiDecimal financialDocumentFiveCentAmount;
+    private KualiDecimal financialDocumentOneCentAmount;
+    private KualiDecimal financialDocumentOtherCentAmount;
+    
 
     /**
      * Default constructor.
@@ -91,23 +107,6 @@
 
 
     /**
-     * @return current value of referenceFinancialDocumentNumber.
-     */
-    public String getReferenceFinancialDocumentNumber() {
-        return referenceFinancialDocumentNumber;
-    }
-
-    /**
-     * Sets the referenceFinancialDocumentNumber attribute value.
-     * 
-     * @param referenceFinancialDocumentNumber The referenceFinancialDocumentNumber to set.
-     */
-    public void setReferenceFinancialDocumentNumber(String referenceFinancialDocumentNumber) {
-        this.referenceFinancialDocumentNumber = referenceFinancialDocumentNumber;
-    }
-
-
-    /**
      * @return current value of campusCode.
      */
     public String getCampusCode() {
@@ -382,7 +381,7 @@
         if (this.currentTransaction != null) {
             this.currentTransaction.setTransactionEnded(SpringContext.getBean(DateTimeService.class).getCurrentDate());
         }
-        currentTransaction = new CashieringTransaction(campusCode, referenceFinancialDocumentNumber);
+        currentTransaction = new CashieringTransaction(campusCode, documentNumber);
         if (this.getCampusCode() != null) {
             List<CashieringItemInProcess> openItemsInProcess = SpringContext.getBean(CashManagementService.class).getOpenItemsInProcess(this);
             if (openItemsInProcess != null) {
@@ -555,4 +554,274 @@
         criteria.put(KNSPropertyConstants.CAMPUS_CODE, campusCode);
         return campus = (Campus) SpringContext.getBean(KualiModuleService.class).getResponsibleModuleService(Campus.class).getExternalizableBusinessObject(Campus.class, criteria);
     }
+
+
+    /**
+     * Gets the financialDocumentHundredDollarAmount attribute. 
+     * @return Returns the financialDocumentHundredDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentHundredDollarAmount() {
+        return financialDocumentHundredDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentHundredDollarAmount attribute value.
+     * @param financialDocumentHundredDollarAmount The financialDocumentHundredDollarAmount to set.
+     */
+    public void setFinancialDocumentHundredDollarAmount(KualiDecimal financialDocumentHundredDollarAmount) {
+        this.financialDocumentHundredDollarAmount = financialDocumentHundredDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentFiftyDollarAmount attribute. 
+     * @return Returns the financialDocumentFiftyDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentFiftyDollarAmount() {
+        return financialDocumentFiftyDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentFiftyDollarAmount attribute value.
+     * @param financialDocumentFiftyDollarAmount The financialDocumentFiftyDollarAmount to set.
+     */
+    public void setFinancialDocumentFiftyDollarAmount(KualiDecimal financialDocumentFiftyDollarAmount) {
+        this.financialDocumentFiftyDollarAmount = financialDocumentFiftyDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentTwentyDollarAmount attribute. 
+     * @return Returns the financialDocumentTwentyDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentTwentyDollarAmount() {
+        return financialDocumentTwentyDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentTwentyDollarAmount attribute value.
+     * @param financialDocumentTwentyDollarAmount The financialDocumentTwentyDollarAmount to set.
+     */
+    public void setFinancialDocumentTwentyDollarAmount(KualiDecimal financialDocumentTwentyDollarAmount) {
+        this.financialDocumentTwentyDollarAmount = financialDocumentTwentyDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentTenDollarAmount attribute. 
+     * @return Returns the financialDocumentTenDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentTenDollarAmount() {
+        return financialDocumentTenDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentTenDollarAmount attribute value.
+     * @param financialDocumentTenDollarAmount The financialDocumentTenDollarAmount to set.
+     */
+    public void setFinancialDocumentTenDollarAmount(KualiDecimal financialDocumentTenDollarAmount) {
+        this.financialDocumentTenDollarAmount = financialDocumentTenDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentFiveDollarAmount attribute. 
+     * @return Returns the financialDocumentFiveDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentFiveDollarAmount() {
+        return financialDocumentFiveDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentFiveDollarAmount attribute value.
+     * @param financialDocumentFiveDollarAmount The financialDocumentFiveDollarAmount to set.
+     */
+    public void setFinancialDocumentFiveDollarAmount(KualiDecimal financialDocumentFiveDollarAmount) {
+        this.financialDocumentFiveDollarAmount = financialDocumentFiveDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentTwoDollarAmount attribute. 
+     * @return Returns the financialDocumentTwoDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentTwoDollarAmount() {
+        return financialDocumentTwoDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentTwoDollarAmount attribute value.
+     * @param financialDocumentTwoDollarAmount The financialDocumentTwoDollarAmount to set.
+     */
+    public void setFinancialDocumentTwoDollarAmount(KualiDecimal financialDocumentTwoDollarAmount) {
+        this.financialDocumentTwoDollarAmount = financialDocumentTwoDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentOneDollarAmount attribute. 
+     * @return Returns the financialDocumentOneDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentOneDollarAmount() {
+        return financialDocumentOneDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentOneDollarAmount attribute value.
+     * @param financialDocumentOneDollarAmount The financialDocumentOneDollarAmount to set.
+     */
+    public void setFinancialDocumentOneDollarAmount(KualiDecimal financialDocumentOneDollarAmount) {
+        this.financialDocumentOneDollarAmount = financialDocumentOneDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentOtherDollarAmount attribute. 
+     * @return Returns the financialDocumentOtherDollarAmount.
+     */
+    public KualiDecimal getFinancialDocumentOtherDollarAmount() {
+        return financialDocumentOtherDollarAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentOtherDollarAmount attribute value.
+     * @param financialDocumentOtherDollarAmount The financialDocumentOtherDollarAmount to set.
+     */
+    public void setFinancialDocumentOtherDollarAmount(KualiDecimal financialDocumentOtherDollarAmount) {
+        this.financialDocumentOtherDollarAmount = financialDocumentOtherDollarAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentHundredCentAmount attribute. 
+     * @return Returns the financialDocumentHundredCentAmount.
+     */
+    public KualiDecimal getFinancialDocumentHundredCentAmount() {
+        return financialDocumentHundredCentAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentHundredCentAmount attribute value.
+     * @param financialDocumentHundredCentAmount The financialDocumentHundredCentAmount to set.
+     */
+    public void setFinancialDocumentHundredCentAmount(KualiDecimal financialDocumentHundredCentAmount) {
+        this.financialDocumentHundredCentAmount = financialDocumentHundredCentAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentFiftyCentAmount attribute. 
+     * @return Returns the financialDocumentFiftyCentAmount.
+     */
+    public KualiDecimal getFinancialDocumentFiftyCentAmount() {
+        return financialDocumentFiftyCentAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentFiftyCentAmount attribute value.
+     * @param financialDocumentFiftyCentAmount The financialDocumentFiftyCentAmount to set.
+     */
+    public void setFinancialDocumentFiftyCentAmount(KualiDecimal financialDocumentFiftyCentAmount) {
+        this.financialDocumentFiftyCentAmount = financialDocumentFiftyCentAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentTwentyFiveCentAmount attribute. 
+     * @return Returns the financialDocumentTwentyFiveCentAmount.
+     */
+    public KualiDecimal getFinancialDocumentTwentyFiveCentAmount() {
+        return financialDocumentTwentyFiveCentAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentTwentyFiveCentAmount attribute value.
+     * @param financialDocumentTwentyFiveCentAmount The financialDocumentTwentyFiveCentAmount to set.
+     */
+    public void setFinancialDocumentTwentyFiveCentAmount(KualiDecimal financialDocumentTwentyFiveCentAmount) {
+        this.financialDocumentTwentyFiveCentAmount = financialDocumentTwentyFiveCentAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentTenCentAmount attribute. 
+     * @return Returns the financialDocumentTenCentAmount.
+     */
+    public KualiDecimal getFinancialDocumentTenCentAmount() {
+        return financialDocumentTenCentAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentTenCentAmount attribute value.
+     * @param financialDocumentTenCentAmount The financialDocumentTenCentAmount to set.
+     */
+    public void setFinancialDocumentTenCentAmount(KualiDecimal financialDocumentTenCentAmount) {
+        this.financialDocumentTenCentAmount = financialDocumentTenCentAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentFiveCentAmount attribute. 
+     * @return Returns the financialDocumentFiveCentAmount.
+     */
+    public KualiDecimal getFinancialDocumentFiveCentAmount() {
+        return financialDocumentFiveCentAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentFiveCentAmount attribute value.
+     * @param financialDocumentFiveCentAmount The financialDocumentFiveCentAmount to set.
+     */
+    public void setFinancialDocumentFiveCentAmount(KualiDecimal financialDocumentFiveCentAmount) {
+        this.financialDocumentFiveCentAmount = financialDocumentFiveCentAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentOneCentAmount attribute. 
+     * @return Returns the financialDocumentOneCentAmount.
+     */
+    public KualiDecimal getFinancialDocumentOneCentAmount() {
+        return financialDocumentOneCentAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentOneCentAmount attribute value.
+     * @param financialDocumentOneCentAmount The financialDocumentOneCentAmount to set.
+     */
+    public void setFinancialDocumentOneCentAmount(KualiDecimal financialDocumentOneCentAmount) {
+        this.financialDocumentOneCentAmount = financialDocumentOneCentAmount;
+    }
+
+
+    /**
+     * Gets the financialDocumentOtherCentAmount attribute. 
+     * @return Returns the financialDocumentOtherCentAmount.
+     */
+    public KualiDecimal getFinancialDocumentOtherCentAmount() {
+        return financialDocumentOtherCentAmount;
+    }
+
+
+    /**
+     * Sets the financialDocumentOtherCentAmount attribute value.
+     * @param financialDocumentOtherCentAmount The financialDocumentOtherCentAmount to set.
+     */
+    public void setFinancialDocumentOtherCentAmount(KualiDecimal financialDocumentOtherCentAmount) {
+        this.financialDocumentOtherCentAmount = financialDocumentOtherCentAmount;
+    }
 }
Index: work/src/org/kuali/kfs/fp/document/datadictionary/ProcurementCardDefaultMaintenanceDocument.xml
===================================================================
--- work/src/org/kuali/kfs/fp/document/datadictionary/ProcurementCardDefaultMaintenanceDocument.xml	(revision 0)
+++ work/src/org/kuali/kfs/fp/document/datadictionary/ProcurementCardDefaultMaintenanceDocument.xml	(revision 37225)
@@ -0,0 +1,121 @@
+<beans xmlns="http://www.springframework.org/schema/beans"
+    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+    xmlns:p="http://www.springframework.org/schema/p"
+    xmlns:dd="http://rice.kuali.org/dd"
+    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd    http://rice.kuali.org/dd    http://rice.kuali.org/dd/dd.xsd">
+
+  <bean id="ProcurementCardDefaultMaintenanceDocument" parent="ProcurementCardDefaultMaintenanceDocument-parentBean" />
+
+  <bean id="ProcurementCardDefaultMaintenanceDocument-parentBean" abstract="true" parent="MaintenanceDocumentEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.fp.businessobject.ProcurementCardDefault" />
+    <property name="maintainableClass" value="org.kuali.kfs.sys.document.FinancialSystemMaintainable" />
+    <property name="maintainableSections" >
+      <list>
+        <ref bean="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardDefaultCommon" />
+        <ref bean="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardHolder" />
+        <ref bean="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardAccounting" />
+      </list>
+    </property>
+    <property name="defaultExistenceChecks">    
+     <list>
+      	<bean parent="ReferenceDefinition" p:attributeName="chartOfAccounts" p:attributeToHighlightOnFail="chartOfAccountsCode" />
+      	<bean parent="ReferenceDefinition" p:attributeName="account" p:attributeToHighlightOnFail="accountNumber" />
+      	<bean parent="ReferenceDefinition" p:attributeName="subAccount" p:attributeToHighlightOnFail="subAccountNumber" />
+      	<bean parent="ReferenceDefinition" p:attributeName="objectCode" p:attributeToHighlightOnFail="financialObjectCode" />
+      	<bean parent="ReferenceDefinition" p:attributeName="subObjectCode" p:attributeToHighlightOnFail="financialSubObjectCode" />
+      	<bean parent="ReferenceDefinition" p:attributeName="project" p:attributeToHighlightOnFail="projectCode"/>
+     </list>      
+    </property>
+    <property name="lockingKeys" >
+      <list>
+        <value>creditCardNumber</value>
+      </list>
+    </property>   
+    <property name="documentTypeName" value="PCDM" />
+    <property name="businessRulesClass" value="org.kuali.kfs.fp.document.validation.impl.ProcurementCardDefaultRule"/>
+    <property name="documentAuthorizerClass" value="org.kuali.kfs.sys.document.authorization.FinancialSystemMaintenanceDocumentAuthorizerBase" />
+    <property name="documentPresentationControllerClass" value="org.kuali.kfs.fp.document.authorization.ProcurementCardDefaultMaintenanceDocumentPresentationController"/>
+    <property name="workflowAttributes">
+    	<ref bean="ProcurementCardDefaultMaintenanceDocument-workflowAttributes" />
+    </property>
+  </bean>
+
+<!-- Maintenance Section Definitions -->
+
+  <bean id="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardDefaultCommon" parent="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardDefaultCommon-parentBean" />
+
+  <bean id="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardDefaultCommon-parentBean" abstract="true" parent="MaintainableSectionDefinition">
+    <property name="id" value="Edit Procurement Card Default Settings" />
+    <property name="title" value="Edit Procurement Card Default Settings" />
+    <property name="maintainableItems" >
+      <list>
+        <bean parent="MaintainableFieldDefinition" p:name="creditCardNumber" p:required="true" />              
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderName" p:required="true" />
+        <bean parent="MaintainableFieldDefinition" p:name="active" p:defaultValue="Y" /> 
+      </list>
+    </property>
+  </bean>
+
+  <bean id="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardHolder" parent="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardHolder-parentBean" />
+
+  <bean id="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardHolder-parentBean" abstract="true" parent="MaintainableSectionDefinition">
+    <property name="id" value="KFS-FP_ProcurementCardDefault-EditProcurementCardHolder" />
+    <property name="title" value="Edit Default Procurement Card Holder Information" />
+    <property name="maintainableItems" >
+      <list>
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderAlternateName" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderLine1Address" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderLine2Address" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderCityName" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderStateCode" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderZipCode" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="cardHolderWorkPhoneNumber" p:required="false" />            
+        <bean parent="MaintainableFieldDefinition" p:name="cardLimit" p:required="false" />  
+        <bean parent="MaintainableFieldDefinition" p:name="cardCycleAmountLimit" p:required="false" /> 
+        <bean parent="MaintainableFieldDefinition" p:name="cardCycleVolumeLimit" p:required="false" />  
+        <bean parent="MaintainableFieldDefinition" p:name="cardStatusCode" p:required="false" />  
+        <bean parent="MaintainableFieldDefinition" p:name="cardNoteText" p:required="false" />
+      </list>
+    </property>
+  </bean>
+  
+  <bean id="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardAccounting" parent="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardAccounting-parentBean" />
+
+  <bean id="ProcurementCardDefaultMaintenanceDocument-EditProcurementCardAccounting-parentBean" abstract="true" parent="MaintainableSectionDefinition">
+    <property name="id" value="KFS-FP_ProcurementCardDefault-EditProcurementCardAccounting" />
+    <property name="title" value="Edit Procurement Card Default Account Information" />
+    <property name="maintainableItems" >
+      <list>
+        <bean parent="MaintainableFieldDefinition" p:name="chartOfAccountsCode" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="accountNumber" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="subAccountNumber" p:required="false" />
+        <bean parent="MaintainableFieldDefinition" p:name="financialObjectCode" p:required="false"  />
+        <bean parent="MaintainableFieldDefinition" p:name="financialSubObjectCode" p:required="false"  />
+        <bean parent="MaintainableFieldDefinition" p:name="projectCode" p:required="false" />             
+      </list>
+    </property>
+  </bean>
+  
+  <!-- workflow attributes -->
+  <bean id="ProcurementCardDefaultMaintenanceDocument-workflowAttributes" parent="ProcurementCardDefaultMaintenanceDocument-workflowAttributes-parentBean" />
+  
+  <bean id="ProcurementCardDefaultMaintenanceDocument-workflowAttributes-parentBean" class="org.kuali.rice.kns.datadictionary.WorkflowAttributes" abstract="true">
+  	 <property name="searchingTypeDefinitions">
+    	<list>    		
+        	<bean class="org.kuali.rice.kns.datadictionary.SearchingTypeDefinition">                    
+            	<property name="searchingAttribute">
+                	<bean class="org.kuali.rice.kns.datadictionary.SearchingAttribute">
+                    	<property name="businessObjectClassName" value="org.kuali.kfs.fp.businessobject.ProcurementCardDefault"/>
+                        <property name="attributeName" value="creditCardNumber"/>
+                  	</bean>
+             	</property>
+                <property name="documentValues">
+                	<list>
+                		<value>newMaintainableObject.businessObject.creditCardNumber</value>   
+                    </list>
+                </property>
+        	</bean>       			
+    	</list>
+  	</property>
+  </bean>
+</beans>
Index: work/src/org/kuali/kfs/fp/document/authorization/ProcurementCardDefaultMaintenanceDocumentPresentationController.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/authorization/ProcurementCardDefaultMaintenanceDocumentPresentationController.java	(revision 0)
+++ work/src/org/kuali/kfs/fp/document/authorization/ProcurementCardDefaultMaintenanceDocumentPresentationController.java	(revision 37225)
@@ -0,0 +1,76 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.fp.document.authorization;
+
+import java.util.Set;
+
+import org.kuali.kfs.fp.batch.ProcurementCardCreateDocumentsStep;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.sys.document.authorization.FinancialSystemMaintenanceDocumentPresentationControllerBase;
+import org.kuali.rice.kns.bo.BusinessObject;
+import org.kuali.rice.kns.service.ParameterService;
+
+/**
+ * Presentation controller for the ProcurementCardDefault Maintenance Document
+ */
+public class ProcurementCardDefaultMaintenanceDocumentPresentationController extends FinancialSystemMaintenanceDocumentPresentationControllerBase {
+    protected static ParameterService parameterService;
+    
+    protected final static String PROCUREMENT_CARD_DEFAULT_HOLDER_SECTION_ID = "KFS-FP_ProcurementCardDefault-EditProcurementCardHolder";
+    protected final static String PROCUREMENT_CARD_DEFAULT_ACCOUNTING_SECTION_ID = "KFS-FP_ProcurementCardDefault-EditProcurementCardAccounting";
+
+    /**
+     * Displays or hides the KFS-FP_ProcurementCardDefault-EditProcurementCardHolder and KFS-FP_ProcurementCardDefault-EditProcurementCardAccounting
+     * sections based on if parameters for use are turned on
+     * @see org.kuali.rice.kns.document.authorization.MaintenanceDocumentPresentationControllerBase#getConditionallyHiddenSectionIds(org.kuali.rice.kns.bo.BusinessObject)
+     */
+    @Override
+    public Set<String> getConditionallyHiddenSectionIds(BusinessObject businessObject) {
+        Set<String> sectionIds = super.getConditionallyHiddenSectionIds(businessObject);
+        final boolean cardHolderDefaultTurnedOn = isCardHolderDefaultTurnedOn();
+        if (!cardHolderDefaultTurnedOn) {
+            sectionIds.add(PROCUREMENT_CARD_DEFAULT_HOLDER_SECTION_ID);
+        }
+        if (!cardHolderDefaultTurnedOn && !isAccountDefaultTurnedOn()) {
+            sectionIds.add(PROCUREMENT_CARD_DEFAULT_ACCOUNTING_SECTION_ID);
+        }
+        return sectionIds;
+    }
+
+    /**
+     * @return true if use of card holder defaults is turned on via parameter, false if it is turned off
+     */
+    protected boolean isCardHolderDefaultTurnedOn() {
+        return getParameterService().getIndicatorParameter(ProcurementCardCreateDocumentsStep.class, ProcurementCardCreateDocumentsStep.USE_CARD_HOLDER_DEFAULT_PARAMETER_NAME);
+    }
+    
+    /**
+     * @return true if use of accounting defaults is turned on via parameter, false if it is turned off
+     */
+    protected boolean isAccountDefaultTurnedOn() {
+        return getParameterService().getIndicatorParameter(ProcurementCardCreateDocumentsStep.class, ProcurementCardCreateDocumentsStep.USE_ACCOUNTING_DEFAULT_PARAMETER_NAME);
+    }
+    
+    /**
+     * @return the default implementation of the ParameterService
+     */
+    protected synchronized ParameterService getParameterService() {
+        if (parameterService == null) {
+            parameterService = SpringContext.getBean(ParameterService.class); 
+        }
+        return parameterService;
+    }
+}
Index: work/src/org/kuali/kfs/fp/document/authorization/NonCheckDisbursementDocumentPresentationController.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/authorization/NonCheckDisbursementDocumentPresentationController.java	(revision 0)
+++ work/src/org/kuali/kfs/fp/document/authorization/NonCheckDisbursementDocumentPresentationController.java	(revision 37225)
@@ -0,0 +1,57 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.fp.document.authorization;
+
+import java.util.Set;
+
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.document.AmountTotaling;
+import org.kuali.kfs.sys.document.FinancialSystemTransactionalDocument;
+import org.kuali.kfs.sys.document.authorization.FinancialSystemTransactionalDocumentPresentationControllerBase;
+import org.kuali.rice.kns.document.Document;
+
+public class NonCheckDisbursementDocumentPresentationController extends FinancialSystemTransactionalDocumentPresentationControllerBase{
+    
+    @Override
+    public Set<String> getDocumentActions(Document document) {
+
+        Set<String> documentActions = super.getDocumentActions(document);
+
+        if (document instanceof FinancialSystemTransactionalDocument) {
+            if (canErrorCorrect((FinancialSystemTransactionalDocument) document)) {
+                documentActions.add(KFSConstants.KFS_ACTION_CAN_ERROR_CORRECT);
+            }
+            
+            documentActions.add(KFSConstants.KFS_ACTION_CAN_EDIT_BANK);
+        }
+
+        return documentActions;
+    }
+
+    @Override
+    public Set<String> getEditModes(Document document) {
+
+        Set<String> editModes = super.getEditModes(document);
+        if (document instanceof AmountTotaling) {
+            editModes.add(KFSConstants.AMOUNT_TOTALING_EDITING_MODE);
+        }
+        
+        editModes.add(KFSConstants.BANK_ENTRY_VIEWABLE_EDITING_MODE);
+        
+        return editModes;
+
+    }
+}
Index: work/src/org/kuali/kfs/fp/document/authorization/AdvanceDepositDocumentPresentationController.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/authorization/AdvanceDepositDocumentPresentationController.java	(revision 0)
+++ work/src/org/kuali/kfs/fp/document/authorization/AdvanceDepositDocumentPresentationController.java	(revision 37225)
@@ -0,0 +1,57 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.fp.document.authorization;
+
+import java.util.Set;
+
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.document.AmountTotaling;
+import org.kuali.kfs.sys.document.FinancialSystemTransactionalDocument;
+import org.kuali.kfs.sys.document.authorization.FinancialSystemTransactionalDocumentPresentationControllerBase;
+import org.kuali.rice.kns.document.Document;
+
+public class AdvanceDepositDocumentPresentationController extends FinancialSystemTransactionalDocumentPresentationControllerBase{
+
+    @Override
+    public Set<String> getDocumentActions(Document document) {
+
+        Set<String> documentActions = super.getDocumentActions(document);
+
+        if (document instanceof FinancialSystemTransactionalDocument) {
+            if (canErrorCorrect((FinancialSystemTransactionalDocument) document)) {
+                documentActions.add(KFSConstants.KFS_ACTION_CAN_ERROR_CORRECT);
+            }
+            
+            documentActions.add(KFSConstants.KFS_ACTION_CAN_EDIT_BANK);
+        }
+
+        return documentActions;
+    }
+
+    @Override
+    public Set<String> getEditModes(Document document) {
+
+        Set<String> editModes = super.getEditModes(document);
+        if (document instanceof AmountTotaling) {
+            editModes.add(KFSConstants.AMOUNT_TOTALING_EDITING_MODE);
+        }
+        
+        editModes.add(KFSConstants.BANK_ENTRY_VIEWABLE_EDITING_MODE);
+        
+        return editModes;
+
+    }
+}
Index: work/src/org/kuali/kfs/fp/document/AdvanceDepositDocument.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/AdvanceDepositDocument.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/document/AdvanceDepositDocument.java	(revision 37225)
@@ -135,7 +135,6 @@
      */
     public final void prepareNewAdvanceDeposit(AdvanceDepositDetail advanceDepositDetail) {
         advanceDepositDetail.setFinancialDocumentLineNumber(this.nextAdvanceDepositLineNumber);
-        advanceDepositDetail.setFinancialDocumentColumnTypeCode(KFSConstants.AdvanceDepositConstants.CASH_RECEIPT_ADVANCE_DEPOSIT_COLUMN_TYPE_CODE);
         advanceDepositDetail.setDocumentNumber(this.getDocumentNumber());
         advanceDepositDetail.setFinancialDocumentTypeCode(SpringContext.getBean(DataDictionaryService.class).getDocumentTypeNameByClass(this.getClass()));
     }
Index: work/src/org/kuali/kfs/fp/document/web/struts/CashReceiptAction.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/web/struts/CashReceiptAction.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/document/web/struts/CashReceiptAction.java	(revision 37225)
@@ -211,7 +211,37 @@
 
         return mapping.findForward(KFSConstants.MAPPING_BASIC);
     }
+    
+    /**
+     * Adds confirmed Check instance created from the current "new check" line to the document
+     * 
+     * @param mapping
+     * @param form
+     * @param request
+     * @param response
+     * @return ActionForward
+     * @throws Exception
+     */
+    public ActionForward addConfirmedCheck(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {
+        CashReceiptForm crForm = (CashReceiptForm) form;
+        CashReceiptDocument crDoc = crForm.getCashReceiptDocument();
 
+        Check newCheck = crForm.getNewConfirmedCheck();
+        newCheck.setDocumentNumber(crDoc.getDocumentNumber());
+
+        // check business rules
+        boolean rulePassed = SpringContext.getBean(KualiRuleService.class).applyRules(new AddCheckEvent(KFSConstants.NEW_CHECK_PROPERTY_NAME, crDoc, newCheck));
+        if (rulePassed) {
+            // add check
+            crDoc.addConfirmedCheck(newCheck);
+
+            // clear the used newCheck
+            crForm.setNewConfirmedCheck(crDoc.createNewConfirmedCheck());
+        }
+
+        return mapping.findForward(KFSConstants.MAPPING_BASIC);
+    }
+
     /**
      * Deletes the selected check (line) from the document
      * 
@@ -247,8 +277,44 @@
 
         return mapping.findForward(KFSConstants.MAPPING_BASIC);
     }
+    
+    /**
+     * Deletes the selected check (line) from the document
+     * 
+     * @param mapping
+     * @param form
+     * @param request
+     * @param response
+     * @return ActionForward
+     * @throws Exception
+     */
+    public ActionForward deleteConfirmedCheck(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {
+        CashReceiptForm crForm = (CashReceiptForm) form;
+        CashReceiptDocument crDoc = crForm.getCashReceiptDocument();
 
+        int deleteIndex = getLineToDelete(request);
+        Check oldCheck = crDoc.getConfirmedCheck(deleteIndex);
 
+
+        boolean rulePassed = SpringContext.getBean(KualiRuleService.class).applyRules(new DeleteCheckEvent(KFSConstants.EXISTING_CHECK_PROPERTY_NAME, crDoc, oldCheck));
+
+        if (rulePassed) {
+            // delete check
+            crDoc.removeConfirmedCheck(deleteIndex);
+
+            // delete baseline check, if any
+            if (crForm.hasBaselineCheck(deleteIndex)) {
+                crForm.getBaselineChecks().remove(deleteIndex);
+            }
+        }
+        else {
+            GlobalVariables.getMessageMap().putError("document.confirmedCheck[" + deleteIndex + "]", KFSKeyConstants.Check.ERROR_CHECK_DELETERULE, Integer.toString(deleteIndex));
+        }
+
+        return mapping.findForward(KFSConstants.MAPPING_BASIC);
+    }
+
+
     /**
      * Changes the current check-entry mode, if necessary
      * 
@@ -313,16 +379,28 @@
 
         /* initialize currency and coin detail */
         CurrencyDetail currencyDetail = new CurrencyDetail();
-        currencyDetail.setCashieringRecordSource(KFSConstants.CurrencyCoinSources.CASH_RECEIPTS);
+        currencyDetail.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_RECEIPTS); 
         currencyDetail.setFinancialDocumentTypeCode(CashReceiptDocument.DOCUMENT_TYPE);
         currencyDetail.setDocumentNumber(crDoc.getDocumentNumber());
         crDoc.setCurrencyDetail(currencyDetail);
 
         CoinDetail coinDetail = new CoinDetail();
-        coinDetail.setCashieringRecordSource(KFSConstants.CurrencyCoinSources.CASH_RECEIPTS);
+        coinDetail.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_RECEIPTS);
         coinDetail.setFinancialDocumentTypeCode(CashReceiptDocument.DOCUMENT_TYPE);
         coinDetail.setDocumentNumber(crDoc.getDocumentNumber());
         crDoc.setCoinDetail(coinDetail);
+        
+        CurrencyDetail confirmedCurrencyDetail = new CurrencyDetail();
+        confirmedCurrencyDetail.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN); 
+        confirmedCurrencyDetail.setFinancialDocumentTypeCode(CashReceiptDocument.DOCUMENT_TYPE);
+        confirmedCurrencyDetail.setDocumentNumber(crDoc.getDocumentNumber());
+        crDoc.setConfirmedCurrencyDetail(confirmedCurrencyDetail);
+        
+        CoinDetail confirmedCoinDetail = new CoinDetail();
+        confirmedCoinDetail.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN);
+        confirmedCoinDetail.setFinancialDocumentTypeCode(CashReceiptDocument.DOCUMENT_TYPE);
+        confirmedCoinDetail.setDocumentNumber(crDoc.getDocumentNumber());
+        crDoc.setConfirmedCoinDetail(confirmedCoinDetail);
 
         initDerivedCheckValues(crForm);
     }
@@ -363,5 +441,87 @@
         initDerivedCheckValues((CashReceiptForm)form);
         return forward;
     }
+    
+    /**
+     * Copy all original checks to cash manager confirmed checks
+     * 
+     * @param mapping
+     * @param form
+     * @param request
+     * @param response
+     * @return ActionForward
+     * @throws Exception
+     */
+    public ActionForward copyAllChecks(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {
+        CashReceiptForm crForm = (CashReceiptForm) form;
+        CashReceiptDocument crDoc = crForm.getCashReceiptDocument();
+        
+        Check c, confirmedCheck;
+        for (Iterator<Check> i = crDoc.getChecks().iterator(); i.hasNext();) {
+            c = i.next();
+            confirmedCheck = crForm.getNewConfirmedCheck();
+            confirmedCheck.setDocumentNumber(c.getDocumentNumber());
+            confirmedCheck.setCheckDate(c.getCheckDate());
+            confirmedCheck.setCheckNumber(c.getCheckNumber());
+            confirmedCheck.setAmount(c.getAmount());
+            confirmedCheck.setDescription(c.getDescription());
+            
+            crDoc.addConfirmedCheck(confirmedCheck);
+            // clear the used newCheck
+            crForm.setNewConfirmedCheck(crDoc.createNewConfirmedCheck());
+        }
+
+        return mapping.findForward(KFSConstants.MAPPING_BASIC);
+    }
+    
+    /**
+     * Copy all original currency and coin to cash manager confirmed currency and coin
+     * 
+     * @param mapping
+     * @param form
+     * @param request
+     * @param response
+     * @return ActionForward
+     * @throws Exception
+     */
+    public ActionForward copyAllCurrencyAndCoin(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {
+        CashReceiptForm crForm = (CashReceiptForm) form;
+        CashReceiptDocument crDoc = crForm.getCashReceiptDocument();
+        CurrencyDetail currencyDetail = crDoc.getCurrencyDetail();
+        CoinDetail coinDetail = crDoc.getCoinDetail();
+        
+        //populate new confirmedCurrencyDetail object
+        CurrencyDetail confCurrencyDetail = new CurrencyDetail();
+        confCurrencyDetail.setDocumentNumber(crDoc.getDocumentNumber());
+        confCurrencyDetail.setFinancialDocumentTypeCode(CashReceiptDocument.DOCUMENT_TYPE);
+        confCurrencyDetail.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN);
+        confCurrencyDetail.setFinancialDocumentHundredDollarAmount(currencyDetail.getFinancialDocumentHundredDollarAmount());
+        confCurrencyDetail.setFinancialDocumentFiftyDollarAmount(currencyDetail.getFinancialDocumentFiftyDollarAmount());
+        confCurrencyDetail.setFinancialDocumentTwentyDollarAmount(currencyDetail.getFinancialDocumentTwentyDollarAmount());
+        confCurrencyDetail.setFinancialDocumentTenDollarAmount(currencyDetail.getFinancialDocumentTenDollarAmount());
+        confCurrencyDetail.setFinancialDocumentFiveDollarAmount(currencyDetail.getFinancialDocumentFiveDollarAmount());
+        confCurrencyDetail.setFinancialDocumentTwoDollarAmount(currencyDetail.getFinancialDocumentTwoDollarAmount());
+        confCurrencyDetail.setFinancialDocumentOneDollarAmount(currencyDetail.getFinancialDocumentOneDollarAmount());
+        confCurrencyDetail.setFinancialDocumentOtherDollarAmount(currencyDetail.getFinancialDocumentOtherDollarAmount());
+        
+        //populate new confirmedCoinDetail object
+        CoinDetail confCoinDetail = new CoinDetail();
+        confCoinDetail.setDocumentNumber(crDoc.getDocumentNumber());
+        confCoinDetail.setFinancialDocumentTypeCode(CashReceiptDocument.DOCUMENT_TYPE);
+        confCoinDetail.setCashieringStatus(KFSConstants.CurrencyCoinSources.CASH_MANAGEMENT_IN);
+        confCoinDetail.setFinancialDocumentHundredCentAmount(coinDetail.getFinancialDocumentHundredCentAmount());
+        confCoinDetail.setFinancialDocumentFiftyCentAmount(coinDetail.getFinancialDocumentFiftyCentAmount());
+        confCoinDetail.setFinancialDocumentTwentyFiveCentAmount(coinDetail.getFinancialDocumentTwentyFiveCentAmount());
+        confCoinDetail.setFinancialDocumentTenCentAmount(coinDetail.getFinancialDocumentTenCentAmount());
+        confCoinDetail.setFinancialDocumentFiveCentAmount(coinDetail.getFinancialDocumentFiveCentAmount());
+        confCoinDetail.setFinancialDocumentOneCentAmount(coinDetail.getFinancialDocumentOneCentAmount());
+        confCoinDetail.setFinancialDocumentOtherCentAmount(coinDetail.getFinancialDocumentOtherCentAmount());
+        
+        crDoc.setConfirmedCurrencyDetail(confCurrencyDetail);
+        crDoc.setConfirmedCoinDetail(confCoinDetail);
+
+        return mapping.findForward(KFSConstants.MAPPING_BASIC);
+    }
+    
 }
 
Index: work/src/org/kuali/kfs/fp/document/dataaccess/CashManagementDao.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/dataaccess/CashManagementDao.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/document/dataaccess/CashManagementDao.java	(revision 37225)
@@ -45,20 +45,20 @@
      * 
      * @param documentNumber the document number this currency detail was associated with
      * @param documentTypeCode the type code of that document
-     * @param cashieringRecordSource the cashiering record source
+     * @param cashieringStatus the cashiering status
      * @return a list of currency details matching that criteria
      */
-    public CurrencyDetail findCurrencyDetailByCashieringRecordSource(String documentNumber, String documentTypeCode, String cashieringRecordSource);
+    public CurrencyDetail findCurrencyDetailByCashieringStatus(String documentNumber, String documentTypeCode, String cashieringStatus);
 
     /**
      * Retrieves all coin detail records with the given document number, document type code, and cashiering record source
      * 
      * @param documentNumber the document the coin details were associated with
      * @param documentTypeCode the type of that document
-     * @param cashieringRecordSource the cashiering record source
+     * @param cashieringStatus the cashiering status
      * @return a list of coin details meeting those criteria
      */
-    public CoinDetail findCoinDetailByCashieringRecordSource(String documentNumber, String documentTypeCode, String cashieringRecordSource);
+    public CoinDetail findCoinDetailByCashieringStatus(String documentNumber, String documentTypeCode, String cashieringStatus);
 
     /**
      * Retrieves from the database any undeposited cashiering transaction checks associated with the given cash management document
Index: work/src/org/kuali/kfs/fp/document/dataaccess/impl/CashManagementDaoOjb.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/dataaccess/impl/CashManagementDaoOjb.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/document/dataaccess/impl/CashManagementDaoOjb.java	(revision 37225)
@@ -82,19 +82,19 @@
     }
 
     /**
-     * @see org.kuali.kfs.fp.document.dataaccess.CashManagementDao#findCoinDetailByCashieringRecordSource(java.lang.String,
+     * @see org.kuali.kfs.fp.document.dataaccess.CashManagementDao#findCoinDetailByCashieringStatus(java.lang.String,
      *      java.lang.String, java.lang.String)
      */
-    public CoinDetail findCoinDetailByCashieringRecordSource(String documentNumber, String documentTypeCode, String cashieringRecordSource) {
-        return (CoinDetail) retrieveCashDetail(documentNumber, documentTypeCode, cashieringRecordSource, CoinDetail.class);
+    public CoinDetail findCoinDetailByCashieringStatus(String documentNumber, String documentTypeCode, String cashieringStatus) {
+        return (CoinDetail) retrieveCashDetail(documentNumber, documentTypeCode, cashieringStatus, CoinDetail.class);
     }
 
     /**
-     * @see org.kuali.kfs.fp.document.dataaccess.CashManagementDao#findCurrencyDetailByCashieringRecordSource(java.lang.String,
+     * @see org.kuali.kfs.fp.document.dataaccess.CashManagementDao#findCurrencyDetailByCashieringStatus(java.lang.String,
      *      java.lang.String, java.lang.String)
      */
-    public CurrencyDetail findCurrencyDetailByCashieringRecordSource(String documentNumber, String documentTypeCode, String cashieringRecordSource) {
-        return (CurrencyDetail) retrieveCashDetail(documentNumber, documentTypeCode, cashieringRecordSource, CurrencyDetail.class);
+    public CurrencyDetail findCurrencyDetailByCashieringStatus(String documentNumber, String documentTypeCode, String cashieringStatus) {
+        return (CurrencyDetail) retrieveCashDetail(documentNumber, documentTypeCode, cashieringStatus, CurrencyDetail.class);
     }
 
     /**
@@ -102,14 +102,14 @@
      * 
      * @param documentNumber document number to retrieve
      * @param documentTypeCode type code of the document
-     * @param cashieringRecordSource the cashiering record source
+     * @param cashieringStatus the cashiering status
      * @return a criteria, based on all of the given information
      */
-    protected Criteria getCashDetailCriteria(String documentNumber, String documentTypeCode, String cashieringRecordSource) {
+    protected Criteria getCashDetailCriteria(String documentNumber, String documentTypeCode, String cashieringStatus) {
         Criteria criteria = new Criteria();
         criteria.addEqualTo("documentNumber", documentNumber);
         criteria.addEqualTo("financialDocumentTypeCode", documentTypeCode);
-        criteria.addEqualTo("cashieringRecordSource", cashieringRecordSource);
+        criteria.addEqualTo("cashieringStatus", cashieringStatus);
         return criteria;
     }
 
@@ -118,12 +118,12 @@
      * 
      * @param documentNumber the document number to retrieve from
      * @param documentTypeCode the document type of the document the cash detail to look up is associated with
-     * @param cashieringRecordSource the cashiering record source to look up from
+     * @param cashieringStatus the cashiering status to look up from
      * @param detailType the class of the cash detail type we want
      * @return the cash detail type record
      */
-    protected Object retrieveCashDetail(String documentNumber, String documentTypeCode, String cashieringRecordSource, Class detailType) {
-        QueryByCriteria cashDetailQuery = QueryFactory.newQuery(detailType, getCashDetailCriteria(documentNumber, documentTypeCode, cashieringRecordSource));
+    protected Object retrieveCashDetail(String documentNumber, String documentTypeCode, String cashieringStatus, Class detailType) {
+        QueryByCriteria cashDetailQuery = QueryFactory.newQuery(detailType, getCashDetailCriteria(documentNumber, documentTypeCode, cashieringStatus));
         Iterator iter = getPersistenceBrokerTemplate().getIteratorByQuery(cashDetailQuery);
         return (iter.hasNext() ? iter.next() : null);
     }
@@ -254,7 +254,7 @@
             // select all cashiering checks associated with document
             Criteria criteria = new Criteria();
             criteria.addEqualTo("documentNumber", documentNumber);
-            criteria.addEqualTo("cashieringRecordSource", KFSConstants.CheckSources.CASH_MANAGEMENT);
+            criteria.addEqualTo("cashieringStatus", KFSConstants.CheckSources.CASH_MANAGEMENT);
             criteria.addEqualTo("financialDocumentTypeCode", CashieringTransaction.DETAIL_DOCUMENT_TYPE);
 
             QueryByCriteria cmChecksQuery = QueryFactory.newQuery(CheckBase.class, criteria);
Index: work/src/org/kuali/kfs/fp/document/service/impl/CashReceiptServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/fp/document/service/impl/CashReceiptServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/fp/document/service/impl/CashReceiptServiceImpl.java	(revision 37225)
@@ -244,18 +244,22 @@
         CashDrawer drawer = retrieveCashDrawer(crDoc);
         // we need to to add the currency and coin to the cash management doc's cumulative CR as well
         if (crDoc.getCurrencyDetail() != null && !crDoc.getCurrencyDetail().isEmpty()) {
-            CurrencyDetail cumulativeCurrencyDetail = cashManagementDao.findCurrencyDetailByCashieringRecordSource(drawer.getReferenceFinancialDocumentNumber(), CashieringTransaction.DETAIL_DOCUMENT_TYPE, KFSConstants.CurrencyCoinSources.CASH_RECEIPTS);
-            cumulativeCurrencyDetail.add(crDoc.getCurrencyDetail());
+            CurrencyDetail cumulativeCurrencyDetail = cashManagementDao.findCurrencyDetailByCashieringStatus(drawer.getReferenceFinancialDocumentNumber(), CashieringTransaction.DETAIL_DOCUMENT_TYPE, KFSConstants.CurrencyCoinSources.CASH_RECEIPTS);
+            cumulativeCurrencyDetail.add(crDoc.getConfirmedCurrencyDetail());
+            cumulativeCurrencyDetail.subtract(crDoc.getChangeCurrencyDetail());
             businessObjectService.save(cumulativeCurrencyDetail);
             
-            drawer.addCurrency(crDoc.getCurrencyDetail());
+            drawer.addCurrency(crDoc.getConfirmedCurrencyDetail());
+            drawer.removeCurrency(crDoc.getChangeCurrencyDetail());
         }
         if (crDoc.getCoinDetail() != null && !crDoc.getCoinDetail().isEmpty()) {
-            CoinDetail cumulativeCoinDetail = cashManagementDao.findCoinDetailByCashieringRecordSource(drawer.getReferenceFinancialDocumentNumber(), CashieringTransaction.DETAIL_DOCUMENT_TYPE, KFSConstants.CurrencyCoinSources.CASH_RECEIPTS);
-            cumulativeCoinDetail.add(crDoc.getCoinDetail());
+            CoinDetail cumulativeCoinDetail = cashManagementDao.findCoinDetailByCashieringStatus(drawer.getReferenceFinancialDocumentNumber(), CashieringTransaction.DETAIL_DOCUMENT_TYPE, KFSConstants.CurrencyCoinSources.CASH_RECEIPTS);
+            cumulativeCoinDetail.add(crDoc.getConfirmedCoinDetail());
+            cumulativeCoinDetail.subtract(crDoc.getChangeCoinDetail());
             businessObjectService.save(cumulativeCoinDetail);
             
-            drawer.addCoin(crDoc.getCoinDetail());
+            drawer.addCoin(crDoc.getConfirmedCoinDetail());
+            drawer.removeCoin(crDoc.getChangeCoinDetail());
         }
         SpringContext.getBean(BusinessObjectService.class).save(drawer);
     }
Index: work/src/org/kuali/kfs/module/ld/businessobject/datadictionary/LedgerEntryGLSummary.xml
===================================================================
--- work/src/org/kuali/kfs/module/ld/businessobject/datadictionary/LedgerEntryGLSummary.xml	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/businessobject/datadictionary/LedgerEntryGLSummary.xml	(revision 37225)
@@ -0,0 +1,202 @@
+<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
+<!--
+ Copyright 2006-2009 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
+
+  <bean id="LedgerEntryGLSummary" parent="LedgerEntryGLSummary-parentBean"/>
+
+  <bean id="LedgerEntryGLSummary-parentBean" abstract="true" parent="BusinessObjectEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.module.ld.businessobject.LedgerEntryGLSummary"/>
+    <property name="objectLabel" value="Labor Ledger Entry" />
+    <property name="attributes">
+      <list>
+        <ref bean="LedgerEntryGLSummary-universityFiscalYear"/>
+        <ref bean="LedgerEntryGLSummary-universityFiscalPeriodCode"/>
+        <ref bean="LedgerEntryGLSummary-chartOfAccountsCode"/>
+        <ref bean="LedgerEntryGLSummary-accountNumber"/>
+        <ref bean="LedgerEntryGLSummary-subAccountNumber"/>
+        <ref bean="LedgerEntryGLSummary-financialObjectCode"/>
+        <ref bean="LedgerEntryGLSummary-financialSubObjectCode"/>
+        <ref bean="LedgerEntryGLSummary-financialBalanceTypeCode"/>
+        <ref bean="LedgerEntryGLSummary-financialObjectTypeCode"/>
+        <ref bean="LedgerEntryGLSummary-financialDocumentTypeCode"/>
+        <ref bean="LedgerEntryGLSummary-documentNumber"/>
+        <ref bean="LedgerEntryGLSummary-emplid"/>
+        <ref bean="LedgerEntryGLSummary-positionNumber"/>
+        <ref bean="LedgerEntryGLSummary-earnCode"/>
+        <ref bean="LedgerEntryGLSummary-transactionTotalHours"/>
+        <ref bean="LedgerEntryGLSummary-transactionLedgerEntryAmount"/>
+        <ref bean="LedgerEntryGLSummary-payPeriodEndDate"/>
+        <ref bean="LedgerEntryGLSummary-transactionLedgerEntryDescription"/>
+        <ref bean="LedgerEntryGLSummary-projectCode"/>
+        <ref bean="LedgerEntryGLSummary-organizationReferenceId"/>
+        <ref bean="LedgerEntryGLSummary-organizationDocumentNumber"/>
+        <ref bean="LedgerEntryGLSummary-financialSystemOriginationCode"/>
+        <ref bean="LedgerEntryGLSummary-employee.name" />
+      </list>
+    </property>
+    <property name="relationships">
+    	<list>
+    		<bean parent="RelationshipDefinition">
+    			<property name="objectAttributeName" value="financialSystemDocumentTypeCode"/>
+		        <property name="primitiveAttributes">
+		        	<list>
+		            	<bean parent="PrimitiveAttributeDefinition" p:sourceName="financialDocumentTypeCode" p:targetName="name"/>
+		            </list>
+		        </property>
+    		</bean>
+    		<bean parent="RelationshipDefinition">
+    			<property name="objectAttributeName" value="employee"/>
+		        <property name="primitiveAttributes">
+		        	<list>
+		            	<bean parent="PrimitiveAttributeDefinition" p:sourceName="emplid" p:targetName="employeeId"/>
+		            </list>
+		        </property>
+    		</bean>
+    	</list>
+    </property>
+  	<property name="lookupDefinition">
+      <ref bean="LedgerEntryGLSummary-lookupDefinition"/>
+    </property>
+  </bean>
+  
+  <bean id="LedgerEntryGLSummary-universityFiscalYear" parent="LedgerEntryGLSummary-universityFiscalYear-parentBean"/>
+  <bean id="LedgerEntryGLSummary-universityFiscalYear-parentBean" abstract="true" parent="LedgerEntry-universityFiscalYear">
+  	<property name="label" value="Fiscal Year"/>
+  	<property name="shortLabel" value="Fiscal Year"/>
+  </bean>
+
+  <bean id="LedgerEntryGLSummary-subAccountNumber" parent="LedgerEntryGLSummary-subAccountNumber-parentBean"/>
+  <bean id="LedgerEntryGLSummary-subAccountNumber-parentBean" abstract="true" parent="LedgerEntry-subAccountNumber" />
+
+  <bean id="LedgerEntryGLSummary-accountNumber" parent="LedgerEntryGLSummary-accountNumber-parentBean"/>
+  <bean id="LedgerEntryGLSummary-accountNumber-parentBean" abstract="true" parent="LedgerEntry-accountNumber" />
+
+  <bean id="LedgerEntryGLSummary-chartOfAccountsCode" parent="LedgerEntryGLSummary-chartOfAccountsCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-chartOfAccountsCode-parentBean" abstract="true" parent="LedgerEntry-chartOfAccountsCode" />
+
+  <bean id="LedgerEntryGLSummary-financialBalanceTypeCode" parent="LedgerEntryGLSummary-financialBalanceTypeCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-financialBalanceTypeCode-parentBean" abstract="true" parent="LedgerEntry-financialBalanceTypeCode"/>
+
+  <bean id="LedgerEntryGLSummary-financialObjectCode" parent="LedgerEntryGLSummary-financialObjectCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-financialObjectCode-parentBean" abstract="true" parent="ObjectCode-financialObjectCode" />
+
+  <bean id="LedgerEntryGLSummary-financialObjectTypeCode" parent="LedgerEntryGLSummary-financialObjectTypeCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-financialObjectTypeCode-parentBean" abstract="true" parent="LedgerEntry-financialObjectTypeCode"/>
+
+  <bean id="LedgerEntryGLSummary-financialSubObjectCode" parent="LedgerEntryGLSummary-financialSubObjectCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-financialSubObjectCode-parentBean" abstract="true" parent="LedgerEntry-financialSubObjectCode"/>
+
+  <bean id="LedgerEntryGLSummary-earnCode" parent="LedgerEntryGLSummary-earnCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-earnCode-parentBean" abstract="true" parent="LedgerEntry-earnCode"/>
+
+  <bean id="LedgerEntryGLSummary-emplid" parent="LedgerEntryGLSummary-emplid-parentBean"/>
+  <bean id="LedgerEntryGLSummary-emplid-parentBean" abstract="true" parent="LedgerEntry-emplid"/>
+
+  <bean id="LedgerEntryGLSummary-documentNumber" parent="LedgerEntryGLSummary-documentNumber-parentBean"/>
+  <bean id="LedgerEntryGLSummary-documentNumber-parentBean" abstract="true" parent="LedgerEntry-documentNumber"/>
+
+  <bean id="LedgerEntryGLSummary-financialDocumentTypeCode" parent="LedgerEntryGLSummary-financialDocumentTypeCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-financialDocumentTypeCode-parentBean" abstract="true" parent="LedgerEntry-financialDocumentTypeCode"/>
+
+  <bean id="LedgerEntryGLSummary-financialSystemOriginationCode" parent="LedgerEntryGLSummary-financialSystemOriginationCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-financialSystemOriginationCode-parentBean" abstract="true" parent="LedgerEntry-financialSystemOriginationCode"/>
+
+  <bean id="LedgerEntryGLSummary-organizationDocumentNumber" parent="LedgerEntryGLSummary-organizationDocumentNumber-parentBean"/>
+  <bean id="LedgerEntryGLSummary-organizationDocumentNumber-parentBean" abstract="true" parent="LedgerEntry-organizationDocumentNumber"/>
+
+  <bean id="LedgerEntryGLSummary-organizationReferenceId" parent="LedgerEntryGLSummary-organizationReferenceId-parentBean"/>
+  <bean id="LedgerEntryGLSummary-organizationReferenceId-parentBean" abstract="true" parent="LedgerEntry-organizationReferenceId"/>
+
+  <bean id="LedgerEntryGLSummary-payPeriodEndDate" parent="LedgerEntryGLSummary-payPeriodEndDate-parentBean"/>
+  <bean id="LedgerEntryGLSummary-payPeriodEndDate-parentBean" abstract="true" parent="LedgerEntry-payPeriodEndDate"/>
+
+  <bean id="LedgerEntryGLSummary-positionNumber" parent="LedgerEntryGLSummary-positionNumber-parentBean"/>
+  <bean id="LedgerEntryGLSummary-positionNumber-parentBean" abstract="true" parent="LedgerEntry-positionNumber" />
+
+  <bean id="LedgerEntryGLSummary-projectCode" parent="LedgerEntryGLSummary-projectCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-projectCode-parentBean" abstract="true" parent="LedgerEntry-projectCode"/>
+
+  <bean id="LedgerEntryGLSummary-transactionLedgerEntryAmount" parent="LedgerEntryGLSummary-transactionLedgerEntryAmount-parentBean"/>
+  <bean id="LedgerEntryGLSummary-transactionLedgerEntryAmount-parentBean" abstract="true" parent="LedgerEntry-transactionLedgerEntryAmount"/>
+  
+  <bean id="LedgerEntryGLSummary-transactionLedgerEntryDescription" parent="LedgerEntryGLSummary-transactionLedgerEntryDescription-parentBean"/>
+  <bean id="LedgerEntryGLSummary-transactionLedgerEntryDescription-parentBean" abstract="true" parent="LedgerEntry-transactionLedgerEntryDescription"/>
+
+  <bean id="LedgerEntryGLSummary-transactionTotalHours" parent="LedgerEntryGLSummary-transactionTotalHours-parentBean"/>
+  <bean id="LedgerEntryGLSummary-transactionTotalHours-parentBean" abstract="true" parent="LedgerEntry-transactionTotalHours" />
+
+  <bean id="LedgerEntryGLSummary-universityFiscalPeriodCode" parent="LedgerEntryGLSummary-universityFiscalPeriodCode-parentBean"/>
+  <bean id="LedgerEntryGLSummary-universityFiscalPeriodCode-parentBean" abstract="true" parent="LedgerEntry-universityFiscalPeriodCode"/>
+
+  <bean id="LedgerEntryGLSummary-employee.name" parent="LedgerEntryGLSummary-employee.name-parentBean"/>
+  <bean id="LedgerEntryGLSummary-employee.name-parentBean" abstract="true" parent="PersonImpl-name">
+  	<property name="name" value="employee.name"/>
+  	<property name="label" value="Employee Name"/>
+  	<property name="shortLabel" value="Emp. Name"/>
+  </bean>
+
+  <!-- look up definition -->  
+  <bean id="LedgerEntryGLSummary-lookupDefinition" parent="LedgerEntryGLSummary-lookupDefinition-parentBean"/>
+
+  <bean id="LedgerEntryGLSummary-lookupDefinition-parentBean" abstract="true" parent="LookupDefinition">
+    <property name="title" value="Ledger Entry Lookup"/>
+    <property name="lookupableID" value="laborLedgerEntryLookupable"/>
+    
+    <property name="defaultSort">
+      <bean parent="SortDefinition">
+      	<property name="attributeNames">
+      		<list>
+      			<value>employee.name</value>
+      		</list>
+      	</property>
+      </bean>
+    </property>
+  	<property name="lookupFields">
+      <list>
+      	<bean parent="FieldDefinition" p:attributeName="universityFiscalYear"/>
+      	<bean parent="FieldDefinition" p:attributeName="universityFiscalPeriodCode"/>
+      	<bean parent="FieldDefinition" p:attributeName="chartOfAccountsCode"/>
+        <bean parent="FieldDefinition" p:attributeName="accountNumber"/>
+        <bean parent="FieldDefinition" p:attributeName="subAccountNumber"/>
+        <bean parent="FieldDefinition" p:attributeName="financialObjectCode"/>
+        <bean parent="FieldDefinition" p:attributeName="financialSubObjectCode"/>
+        <bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode"/>
+        <bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode"/>
+        <bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode"/>
+        <bean parent="FieldDefinition" p:attributeName="documentNumber"/>
+      </list>
+    </property>
+    <property name="resultFields">
+      <list>
+      	<bean parent="FieldDefinition" p:attributeName="employee.name"/>
+      	<bean parent="FieldDefinition" p:attributeName="positionNumber"/>
+      	<bean parent="FieldDefinition" p:attributeName="earnCode"/>
+      	<bean parent="FieldDefinition" p:attributeName="transactionTotalHours"/>
+      	<bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryAmount"/>
+      	<bean parent="FieldDefinition" p:attributeName="payPeriodEndDate"/>
+      	<bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryDescription"/>
+      	<bean parent="FieldDefinition" p:attributeName="projectCode"/>
+      	<bean parent="FieldDefinition" p:attributeName="organizationReferenceId"/>
+      	<bean parent="FieldDefinition" p:attributeName="organizationDocumentNumber"/>
+      	<bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode"/>
+      	<bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode"/>
+      	<bean parent="FieldDefinition" p:attributeName="financialSystemOriginationCode"/>
+		<bean parent="FieldDefinition" p:attributeName="documentNumber"/>      	
+		<bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode"/>
+      </list>
+    </property>
+  </bean>
+</beans>
\ No newline at end of file
Index: work/src/org/kuali/kfs/module/ld/businessobject/datadictionary/BenefitInquiry.xml
===================================================================
--- work/src/org/kuali/kfs/module/ld/businessobject/datadictionary/BenefitInquiry.xml	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/businessobject/datadictionary/BenefitInquiry.xml	(revision 37225)
@@ -0,0 +1,60 @@
+<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
+<!--
+ Copyright 2006-2008 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
+
+  <bean id="BenefitInquiry" parent="BenefitsType-parentBean"/>
+
+  <bean id="BenefitInquiry-parentBean" abstract="true" parent="BusinessObjectEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.module.ld.businessobject.BenefitInquiry"/>
+    <property name="objectLabel" value="Benefits Inquiry"/>
+    <property name="titleAttribute" value=""/>
+    <property name="attributes">
+      <list>
+        <ref bean="BenefitInquiry-benefitAmount"/>
+        <ref bean="BenefitInquiry-fringeBenefitObjectCode"/>
+      </list>
+    </property>
+  </bean>
+
+<!-- Attribute Definitions -->
+
+
+  <bean id="BenefitInquiry-benefitAmount" parent="BenefitInquiry-benefitAmount-parentBean"/>
+
+  <bean id="BenefitInquiry-benefitAmount-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="benefitAmount"/>
+    <property name="forceUppercase" value="false"/>
+    <property name="label" value="Benefit Amount"/>
+    <property name="shortLabel" value="amount"/>
+    <property name="maxLength" value="12"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="42"/>
+    </property>
+  </bean>
+  <bean id="BenefitInquiry-fringeBenefitObjectCode" parent="BenefitInquiry-fringeBenefitObjectCode-parentBean"/>
+
+  <bean id="BenefitInquiry-fringeBenefitObjectCode-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="fringeBenefitObjectCode"/>
+    <property name="forceUppercase" value="false"/>
+    <property name="label" value="Object Code"/>
+    <property name="shortLabel" value="Object Cd"/>
+    <property name="maxLength" value="4"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="4"/>
+    </property>
+  </bean>
+
+</beans>
Index: work/src/org/kuali/kfs/module/ld/businessobject/LedgerEntryGLSummary.java
===================================================================
--- work/src/org/kuali/kfs/module/ld/businessobject/LedgerEntryGLSummary.java	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/businessobject/LedgerEntryGLSummary.java	(revision 37225)
@@ -0,0 +1,25 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.ld.businessobject;
+
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kim.bo.Person;
+import org.kuali.rice.kim.service.PersonService;
+
+/**
+ * Extension of Labor LedgerEntry to allow for GL Summarization lookup
+ */
+public class LedgerEntryGLSummary extends LedgerEntry {}
\ No newline at end of file
Index: work/src/org/kuali/kfs/module/ld/businessobject/BenefitInquiry.java
===================================================================
--- work/src/org/kuali/kfs/module/ld/businessobject/BenefitInquiry.java	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/businessobject/BenefitInquiry.java	(revision 37225)
@@ -0,0 +1,47 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.ld.businessobject;
+
+import org.kuali.rice.kns.util.KualiDecimal;
+
+
+public class BenefitInquiry implements Comparable<BenefitInquiry> {
+    KualiDecimal benefitAmount;
+    String fringeBenefitObjectCode;
+    
+    public KualiDecimal getBenefitAmount() {
+        return benefitAmount;
+    }
+    
+    public void setBenefitAmount(KualiDecimal benefitAmount) {
+        this.benefitAmount = benefitAmount;
+    }
+    
+    public String getFringeBenefitObjectCode() {
+        return fringeBenefitObjectCode;
+    }
+    
+    public void setFringeBenefitObjectCode(String fringeBenefitObjectCode) {
+        this.fringeBenefitObjectCode = fringeBenefitObjectCode;
+    }
+    
+    public int compareTo(BenefitInquiry benefitInquiry) {
+        return ((BenefitInquiry) benefitInquiry).getFringeBenefitObjectCode().compareTo(this.fringeBenefitObjectCode);
+    }
+}
+
+    
+
Index: work/src/org/kuali/kfs/module/ld/businessobject/inquiry/ExpenseTransferAccountingLineInquirable.java
===================================================================
--- work/src/org/kuali/kfs/module/ld/businessobject/inquiry/ExpenseTransferAccountingLineInquirable.java	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/businessobject/inquiry/ExpenseTransferAccountingLineInquirable.java	(revision 37225)
@@ -0,0 +1,72 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.ld.businessobject.inquiry;
+
+import org.kuali.kfs.module.ld.businessobject.ExpenseTransferSourceAccountingLine;
+import org.kuali.kfs.module.ld.businessobject.ExpenseTransferTargetAccountingLine;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.businessobject.AccountingLineBase;
+import org.kuali.kfs.sys.businessobject.inquiry.KfsInquirableImpl;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+import org.kuali.rice.kns.bo.BusinessObject;
+import org.kuali.rice.kns.lookup.HtmlData;
+import org.kuali.rice.kns.lookup.HtmlData.AnchorHtmlData;
+import org.kuali.rice.kns.service.KualiConfigurationService;
+import org.kuali.rice.kns.util.KNSConstants;
+import org.kuali.rice.kns.util.ObjectUtils;
+
+public class ExpenseTransferAccountingLineInquirable extends KfsInquirableImpl {
+    
+    @Override
+    public HtmlData getInquiryUrl(BusinessObject businessObject, String attributeName, boolean forceInquiry) {
+        if ( businessObject instanceof ExpenseTransferSourceAccountingLine || 
+                businessObject instanceof ExpenseTransferTargetAccountingLine  ) {
+        if (attributeName.equalsIgnoreCase("fringeBenefitView")) {
+            Object objFieldValue = ObjectUtils.getPropertyValue(businessObject, attributeName);
+            String parameters = KFSConstants.EMPTY_STRING;
+            
+            if(businessObject instanceof ExpenseTransferSourceAccountingLine ){
+                ExpenseTransferSourceAccountingLine sourceAccountingLine = (ExpenseTransferSourceAccountingLine) businessObject;
+                parameters = "chartOfAccountsCode="+sourceAccountingLine.getChartOfAccountsCode()+
+                "&financialObjectCode="+sourceAccountingLine.getObjectCode().getFinancialObjectCode()+
+                "&payrollEndDateFiscalYear="+sourceAccountingLine.getPayrollEndDateFiscalYear()+
+                "&amount="+sourceAccountingLine.getAmount()+
+                "&methodToCall=calculateFringeBenefit";
+
+            }
+            else if(businessObject instanceof ExpenseTransferTargetAccountingLine ){
+                ExpenseTransferTargetAccountingLine targetAccountingLine = (ExpenseTransferTargetAccountingLine) businessObject;
+                parameters = "chartOfAccountsCode="+targetAccountingLine.getChartOfAccountsCode()+
+                "&financialObjectCode="+targetAccountingLine.getObjectCode().getFinancialObjectCode()+
+                "&payrollEndDateFiscalYear="+targetAccountingLine.getPayrollEndDateFiscalYear()+
+                "&amount="+targetAccountingLine.getAmount()+
+                "&methodToCall=calculateFringeBenefit";
+            }
+            
+            String fieldValue = objFieldValue == null ? KFSConstants.EMPTY_STRING : objFieldValue.toString();
+            final String url =  SpringContext.getBean(KualiConfigurationService.class).getPropertyString(KFSConstants.APPLICATION_URL_KEY)+"/fringeBenefitInquiry.do?" + parameters ;
+            
+            return new AnchorHtmlData(url, KNSConstants.EMPTY_STRING, "");
+        }
+        
+        }
+        
+        return super.getInquiryUrl(businessObject, attributeName, forceInquiry);
+        
+    }
+    
+}
Index: work/src/org/kuali/kfs/module/ld/web/struts/GLLaborEntrySummarizationInquiryAction.java
===================================================================
--- work/src/org/kuali/kfs/module/ld/web/struts/GLLaborEntrySummarizationInquiryAction.java	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/web/struts/GLLaborEntrySummarizationInquiryAction.java	(revision 37225)
@@ -0,0 +1,96 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.ld.web.struts;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.List;
+
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import org.apache.struts.action.ActionForm;
+import org.apache.struts.action.ActionForward;
+import org.apache.struts.action.ActionMapping;
+import org.kuali.kfs.module.ld.businessobject.LedgerEntry;
+import org.kuali.kfs.module.ld.businessobject.LedgerEntryGLSummary;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kim.service.KIMServiceLocator;
+import org.kuali.rice.kim.util.KimCommonUtils;
+import org.kuali.rice.kim.util.KimConstants;
+import org.kuali.rice.kns.datadictionary.BusinessObjectEntry;
+import org.kuali.rice.kns.exception.AuthorizationException;
+import org.kuali.rice.kns.lookup.Lookupable;
+import org.kuali.rice.kns.service.DataDictionaryService;
+import org.kuali.rice.kns.util.GlobalVariables;
+import org.kuali.rice.kns.util.KNSConstants;
+import org.kuali.rice.kns.web.struts.action.KualiAction;
+import org.kuali.rice.kns.web.struts.form.LookupForm;
+import org.kuali.rice.kns.web.ui.ResultRow;
+
+/**
+ * Action which will perform lookup and presentation of LD entries related to a GL entry
+ */
+public class GLLaborEntrySummarizationInquiryAction extends KualiAction {
+    protected volatile static DataDictionaryService dataDictionaryService;
+
+    /**
+     * Uses the inquire permission for the labor ledger entry to check if authorized
+     * @see org.kuali.rice.kns.web.struts.action.KualiAction#checkAuthorization(org.apache.struts.action.ActionForm, java.lang.String)
+     */
+    @Override
+    protected void checkAuthorization(ActionForm form, String methodToCall) throws AuthorizationException {
+        if (!KIMServiceLocator.getIdentityManagementService().isAuthorizedByTemplateName(GlobalVariables.getUserSession().getPrincipalId(), KNSConstants.KNS_NAMESPACE, KimConstants.PermissionTemplateNames.INQUIRE_INTO_RECORDS, KimCommonUtils.getNamespaceAndComponentSimpleName(LedgerEntry.class), null)) {
+            throw new AuthorizationException(GlobalVariables.getUserSession().getPerson().getPrincipalName(), "inquire", LedgerEntry.class.getSimpleName());
+        }
+    }
+    
+    /**
+     * Method which performs search for matching LaborEntry records
+     * @param mapping
+     * @param form
+     * @param request
+     * @param response
+     * @return
+     * @throws Exception
+     */
+    @SuppressWarnings("rawtypes")
+    public ActionForward viewResults(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {
+        final BusinessObjectEntry entry = getDataDictionaryService().getDataDictionary().getBusinessObjectEntry(LedgerEntryGLSummary.class.getSimpleName()); 
+        final String lookupId = entry.getLookupDefinition().getLookupableID();
+        Lookupable lookupable = (Lookupable)SpringContext.getService(lookupId);
+        lookupable.setBusinessObjectClass(LedgerEntryGLSummary.class);
+        
+        Collection displayList = new ArrayList();
+        List<ResultRow> resultTable = new ArrayList<ResultRow>();
+        displayList = lookupable.performLookup((LookupForm)form, resultTable, true);
+        
+        ((GLLaborEntrySummarizationInquiryForm)form).setEntries(resultTable);
+        ((GLLaborEntrySummarizationInquiryForm)form).buildInquiryUrls(lookupable.getLookupableHelperService());
+        return mapping.findForward(KFSConstants.MAPPING_BASIC);
+    }
+    
+    /**
+     * @return the configured default implementation of the DataDictionaryService
+     */
+    public DataDictionaryService getDataDictionaryService() {
+        if (dataDictionaryService == null) {
+            dataDictionaryService = SpringContext.getBean(DataDictionaryService.class);
+        }
+        return dataDictionaryService;
+    }
+}
\ No newline at end of file
Index: work/src/org/kuali/kfs/module/ld/web/struts/GLLaborEntrySummarizationInquiryForm.java
===================================================================
--- work/src/org/kuali/kfs/module/ld/web/struts/GLLaborEntrySummarizationInquiryForm.java	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/web/struts/GLLaborEntrySummarizationInquiryForm.java	(revision 37225)
@@ -0,0 +1,260 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.ld.web.struts;
+
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.Map;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.module.ld.businessobject.LedgerEntryGLSummary;
+import org.kuali.kfs.sys.KFSPropertyConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kns.datadictionary.BusinessObjectEntry;
+import org.kuali.rice.kns.lookup.HtmlData.AnchorHtmlData;
+import org.kuali.rice.kns.lookup.LookupableHelperService;
+import org.kuali.rice.kns.service.DataDictionaryService;
+import org.kuali.rice.kns.web.struts.form.LookupForm;
+
+/**
+ * The form which holds values used in the GLLaborEntry Summarization Inquiry screen
+ */
+public class GLLaborEntrySummarizationInquiryForm extends LookupForm {
+    private Integer universityFiscalYear;
+    private String universityFiscalYearInquiryUrl;
+    private String universityFiscalPeriodCode;
+    private String universityFiscalPeriodCodeInquiryUrl;
+    private String chartOfAccountsCode;
+    private String chartOfAccountsCodeInquiryUrl;
+    private String accountNumber;
+    private String accountNumberInquiryUrl;
+    private String subAccountNumber;
+    private String subAccountNumberInquiryUrl;
+    private String financialObjectCode;
+    private String financialObjectCodeInquiryUrl;
+    private String financialSubObjectCode;
+    private String financialSubObjectCodeInquiryUrl;
+    private String financialBalanceTypeCode;
+    private String financialObjectTypeCode;
+    private String financialDocumentTypeCode;
+    private String financialSystemOriginationCode;
+    private String documentNumber;
+        
+    @SuppressWarnings("rawtypes")
+    private Collection entries;
+    
+    protected static volatile String pageTitle;
+    
+    public Integer getUniversityFiscalYear() {
+        return universityFiscalYear;
+    }
+    public void setUniversityFiscalYear(Integer universityFiscalYear) {
+        this.universityFiscalYear = universityFiscalYear;
+    }
+    public String getUniversityFiscalPeriodCode() {
+        return universityFiscalPeriodCode;
+    }
+    public void setUniversityFiscalPeriodCode(String universityFiscalPeriodCode) {
+        this.universityFiscalPeriodCode = universityFiscalPeriodCode;
+    }
+    public String getChartOfAccountsCode() {
+        return chartOfAccountsCode;
+    }
+    public void setChartOfAccountsCode(String chartOfAccountsCode) {
+        this.chartOfAccountsCode = chartOfAccountsCode;
+    }
+    public String getAccountNumber() {
+        return accountNumber;
+    }
+    public void setAccountNumber(String accountNumber) {
+        this.accountNumber = accountNumber;
+    }
+    public String getSubAccountNumber() {
+        return subAccountNumber;
+    }
+    public void setSubAccountNumber(String subAccountNumber) {
+        this.subAccountNumber = subAccountNumber;
+    }
+    public String getFinancialObjectCode() {
+        return financialObjectCode;
+    }
+    public void setFinancialObjectCode(String financialObjectCode) {
+        this.financialObjectCode = financialObjectCode;
+    }
+    public String getFinancialSubObjectCode() {
+        return financialSubObjectCode;
+    }
+    public void setFinancialSubObjectCode(String financialSubObjectCode) {
+        this.financialSubObjectCode = financialSubObjectCode;
+    }
+    public String getFinancialBalanceTypeCode() {
+        return financialBalanceTypeCode;
+    }
+    public void setFinancialBalanceTypeCode(String financialBalanceTypeCode) {
+        this.financialBalanceTypeCode = financialBalanceTypeCode;
+    }
+    public String getFinancialObjectTypeCode() {
+        return financialObjectTypeCode;
+    }
+    public void setFinancialObjectTypeCode(String financialObjectTypeCode) {
+        this.financialObjectTypeCode = financialObjectTypeCode;
+    }
+    public String getFinancialDocumentTypeCode() {
+        return financialDocumentTypeCode;
+    }
+    public void setFinancialDocumentTypeCode(String financialDocumentTypeCode) {
+        this.financialDocumentTypeCode = financialDocumentTypeCode;
+    }
+    public String getFinancialSystemOriginationCode() {
+        return financialSystemOriginationCode;
+    }
+    public void setFinancialSystemOriginationCode(String financialSystemOriginationCode) {
+        this.financialSystemOriginationCode = financialSystemOriginationCode;
+    }
+    public String getDocumentNumber() {
+        return documentNumber;
+    }
+    public void setDocumentNumber(String documentNumber) {
+        this.documentNumber = documentNumber;
+    }
+    
+    @SuppressWarnings("rawtypes")
+    public Collection getEntries() {
+        return entries;
+    }
+    @SuppressWarnings("rawtypes")
+    public void setEntries(Collection entries) {
+        this.entries = entries;
+    }
+    
+    public String getPageTitle() {
+        if (pageTitle == null) {
+            final BusinessObjectEntry entry = SpringContext.getBean(DataDictionaryService.class).getDataDictionary().getBusinessObjectEntry(LedgerEntryGLSummary.class.getSimpleName());
+            pageTitle = entry.getObjectLabel();
+        }
+        return pageTitle;
+    }
+    
+    /**
+     * @return the inquiry url for the fiscal year property
+     */
+    public String getUniversityFiscalYearInquiryUrl() {
+        return universityFiscalYearInquiryUrl;
+    }
+    /**
+     * @return the inquiry url for the fiscal period code property
+     */
+    public String getUniversityFiscalPeriodCodeInquiryUrl() {
+        return universityFiscalPeriodCodeInquiryUrl;
+    }
+    /**
+     * @return the inquiry url for the chart of accounts code property
+     */
+    public String getChartOfAccountsCodeInquiryUrl() {
+        return chartOfAccountsCodeInquiryUrl;
+    }
+    /**
+     * @return the inquiry url for the account number property
+     */
+    public String getAccountNumberInquiryUrl() {
+        return accountNumberInquiryUrl;
+    }
+    /**
+     * @return the inquiry url for the sub-account number property
+     */
+    public String getSubAccountNumberInquiryUrl() {
+        return subAccountNumberInquiryUrl;
+    }
+    /**
+     * @return the inquiry url for the object code property
+     */
+    public String getFinancialObjectCodeInquiryUrl() {
+        return financialObjectCodeInquiryUrl;
+    }
+    /**
+     * @return the inquiry url for the sub-object code property
+     */
+    public String getFinancialSubObjectCodeInquiryUrl() {
+        return financialSubObjectCodeInquiryUrl;
+    }
+    /**
+     * @return a Map of the field values for each searching
+     */
+    @Override
+    public Map<String, String> getFieldsForLookup() {
+        Map<String, String> fieldValues = new HashMap<String, String>();
+        fieldValues.put(KFSPropertyConstants.UNIVERSITY_FISCAL_YEAR, (getUniversityFiscalYear() != null ? getUniversityFiscalYear().toString() : ""));
+        fieldValues.put(KFSPropertyConstants.UNIVERSITY_FISCAL_PERIOD_CODE, getUniversityFiscalPeriodCode());
+        fieldValues.put(KFSPropertyConstants.CHART_OF_ACCOUNTS_CODE, getChartOfAccountsCode());
+        fieldValues.put(KFSPropertyConstants.ACCOUNT_NUMBER, getAccountNumber());
+        fieldValues.put(KFSPropertyConstants.SUB_ACCOUNT_NUMBER, getSubAccountNumber());
+        fieldValues.put(KFSPropertyConstants.FINANCIAL_OBJECT_CODE, getFinancialObjectCode());
+        fieldValues.put(KFSPropertyConstants.FINANCIAL_SUB_OBJECT_CODE, getFinancialSubObjectCode());
+        fieldValues.put(KFSPropertyConstants.FINANCIAL_BALANCE_TYPE_CODE, getFinancialBalanceTypeCode());
+        fieldValues.put(KFSPropertyConstants.FINANCIAL_OBJECT_TYPE_CODE, getFinancialObjectTypeCode());
+        fieldValues.put(KFSPropertyConstants.FINANCIAL_DOCUMENT_TYPE_CODE, getFinancialDocumentTypeCode());
+        fieldValues.put(KFSPropertyConstants.FINANCIAL_SYSTEM_ORIGINATION_CODE, getFinancialSystemOriginationCode());
+        fieldValues.put(KFSPropertyConstants.DOCUMENT_NUMBER, getDocumentNumber());
+        return fieldValues;
+    }
+    
+    /**
+     * Builds the inquiry urls for the set fields - fiscal year, fiscal period, chart, account, sub-account, object, and sub-object
+     * @param lookupableHelperService the lookupable helper service which builds the related inquiry urls for us
+     */
+    protected void buildInquiryUrls(LookupableHelperService lookupableHelperService) {
+        final LedgerEntryGLSummary summary = buildBasicLedgerEntrySummary();
+        universityFiscalYearInquiryUrl = retrieveInquiryUrlForProperty(summary, lookupableHelperService, KFSPropertyConstants.UNIVERSITY_FISCAL_YEAR);        
+        universityFiscalPeriodCodeInquiryUrl = retrieveInquiryUrlForProperty(summary, lookupableHelperService, KFSPropertyConstants.UNIVERSITY_FISCAL_PERIOD_CODE);
+        chartOfAccountsCodeInquiryUrl = retrieveInquiryUrlForProperty(summary, lookupableHelperService, KFSPropertyConstants.CHART_OF_ACCOUNTS_CODE);
+        accountNumberInquiryUrl = retrieveInquiryUrlForProperty(summary, lookupableHelperService, KFSPropertyConstants.ACCOUNT_NUMBER);
+        subAccountNumberInquiryUrl = retrieveInquiryUrlForProperty(summary, lookupableHelperService, KFSPropertyConstants.SUB_ACCOUNT_NUMBER);
+        financialObjectCodeInquiryUrl = retrieveInquiryUrlForProperty(summary, lookupableHelperService, KFSPropertyConstants.FINANCIAL_OBJECT_CODE);
+        financialSubObjectCodeInquiryUrl = retrieveInquiryUrlForProperty(summary, lookupableHelperService, KFSPropertyConstants.FINANCIAL_SUB_OBJECT_CODE);
+    }
+    
+    /**
+     * @return a LedgerEntryGLSummary record filled with the known values from the form
+     */
+    protected LedgerEntryGLSummary buildBasicLedgerEntrySummary() {
+        LedgerEntryGLSummary summary = new LedgerEntryGLSummary();
+        summary.setUniversityFiscalYear(getUniversityFiscalYear());
+        summary.setUniversityFiscalPeriodCode(getUniversityFiscalPeriodCode());
+        summary.setChartOfAccountsCode(getChartOfAccountsCode());
+        summary.setAccountNumber(getAccountNumber());
+        summary.setSubAccountNumber(getSubAccountNumber());
+        summary.setFinancialObjectCode(getFinancialObjectCode());
+        summary.setFinancialSubObjectCode(getFinancialSubObjectCode());
+        return summary;
+    }
+    
+    /**
+     * Determines the inquiry url for the given property
+     * @param summary the LedgerEntryGLSummary populated with values to build inquiry links for
+     * @param lookupableHelperService the lookupable helper service to help us determine the inquiry url
+     * @param propertyName the property to build the inquiry url for
+     * @return the inquiry url, or null if none was built
+     */
+    protected String retrieveInquiryUrlForProperty(LedgerEntryGLSummary summary, LookupableHelperService lookupableHelperService, String propertyName) {
+        final AnchorHtmlData inquiryHtmlData = (AnchorHtmlData)lookupableHelperService.getInquiryUrl(summary, propertyName);
+        final String inquiryUrl = (inquiryHtmlData != null && !StringUtils.isBlank(inquiryHtmlData.getHref())) ? inquiryHtmlData.getHref() : null;
+        return inquiryUrl;
+    }
+    
+    public boolean isCanExport() {
+        return false;
+    }
+}
Index: work/src/org/kuali/kfs/module/ld/document/web/struts/FringeBenefitInquiryForm.java
===================================================================
--- work/src/org/kuali/kfs/module/ld/document/web/struts/FringeBenefitInquiryForm.java	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/document/web/struts/FringeBenefitInquiryForm.java	(revision 37225)
@@ -0,0 +1,75 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.ld.document.web.struts;
+
+import java.util.List;
+
+import org.kuali.rice.kns.web.struts.form.KualiForm;
+import org.kuali.kfs.module.ld.businessobject.BenefitInquiry;
+
+public class FringeBenefitInquiryForm extends KualiForm {
+    
+    private List<BenefitInquiry> benefitInquiry;
+    private String chartOfAccountsCode;
+    private String amount;
+    private String payrollEndDateFiscalYear;
+    private String financialObjectCode;
+   
+    
+   
+    public List<BenefitInquiry> getBenefitInquiry() {
+        return benefitInquiry;
+    }
+    public void setBenefitInquiry(List<BenefitInquiry> benefitInquiry) {
+        this.benefitInquiry = benefitInquiry;
+    }
+    
+    public String getChartOfAccountsCode() {
+        return chartOfAccountsCode;
+    }
+    public void setChartOfAccountsCode(String chartOfAccountsCode) {
+        this.chartOfAccountsCode = chartOfAccountsCode;
+    }
+   
+    public String getPayrollEndDateFiscalYear() {
+        return payrollEndDateFiscalYear;
+    }
+    public void setPayrollEndDateFiscalYear(String  payrollEndDateFiscalYear) {
+        this.payrollEndDateFiscalYear = payrollEndDateFiscalYear;
+    }
+    public String getFinancialObjectCode() {
+        return financialObjectCode;
+    }
+    
+    public void setFinancialObjectCode(String financialObjectCode) {
+        this.financialObjectCode = financialObjectCode;
+    }
+    
+    public String getAmount() {
+        return amount;
+    }
+    public void setAmount(String amount) {
+        this.amount = amount;
+    }
+    
+    
+    
+    
+    
+    
+    
+    
+}
Index: work/src/org/kuali/kfs/module/ld/document/web/struts/FringeBenefitInquiryAction.java
===================================================================
--- work/src/org/kuali/kfs/module/ld/document/web/struts/FringeBenefitInquiryAction.java	(revision 0)
+++ work/src/org/kuali/kfs/module/ld/document/web/struts/FringeBenefitInquiryAction.java	(revision 37225)
@@ -0,0 +1,72 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.ld.document.web.struts;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Collections;
+import java.util.List;
+
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.struts.action.ActionForm;
+import org.apache.struts.action.ActionForward;
+import org.apache.struts.action.ActionMapping;
+import org.kuali.kfs.module.bc.document.web.struts.DetailSalarySettingForm;
+import org.kuali.kfs.module.bc.document.web.struts.PositionSalarySettingForm;
+import org.kuali.kfs.module.ld.businessobject.BenefitInquiry;
+import org.kuali.kfs.module.ld.businessobject.LaborLedgerPendingEntry;
+import org.kuali.kfs.module.ld.businessobject.PositionObjectBenefit;
+import org.kuali.kfs.module.ld.service.LaborBenefitsCalculationService;
+import org.kuali.kfs.module.ld.service.LaborPositionObjectBenefitService;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kns.question.ConfirmationQuestion;
+import org.kuali.rice.kns.util.KualiDecimal;
+import org.kuali.rice.kns.web.struts.action.KualiAction;
+
+public class FringeBenefitInquiryAction extends KualiAction {
+    
+    public ActionForward calculateFringeBenefit(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {
+        FringeBenefitInquiryForm accountingLineForm = (FringeBenefitInquiryForm) form;
+        
+        Integer payrollFiscalyear = new Integer(accountingLineForm.getPayrollEndDateFiscalYear());
+        String chartOfAccountsCode = accountingLineForm.getChartOfAccountsCode();
+        String objectCode = accountingLineForm.getFinancialObjectCode();
+        KualiDecimal amount = new KualiDecimal(accountingLineForm.getAmount());
+        Collection<PositionObjectBenefit> positionObjectBenefits = SpringContext.getBean(LaborPositionObjectBenefitService.class).getPositionObjectBenefits(payrollFiscalyear, chartOfAccountsCode, objectCode);
+
+        List<BenefitInquiry> fringebenefitEntries = new ArrayList<BenefitInquiry>();
+        for (PositionObjectBenefit positionObjectBenefit : positionObjectBenefits) {
+            BenefitInquiry benefitInquiry = new BenefitInquiry();
+            String fringeBenefitObjectCode = positionObjectBenefit.getBenefitsCalculation().getPositionFringeBenefitObjectCode();
+            benefitInquiry.setFringeBenefitObjectCode(fringeBenefitObjectCode);
+            KualiDecimal benefitAmount = SpringContext.getBean(LaborBenefitsCalculationService.class).calculateFringeBenefit(positionObjectBenefit, amount);
+            benefitInquiry.setBenefitAmount(benefitAmount);
+            fringebenefitEntries.add(benefitInquiry);
+        }
+        
+        Collections.sort(fringebenefitEntries,Collections.reverseOrder());
+        
+        accountingLineForm.setBenefitInquiry(fringebenefitEntries);
+
+        return mapping.findForward(KFSConstants.MAPPING_BASIC);
+    }
+    
+    
+}
Index: work/src/org/kuali/kfs/module/cam/businessobject/datadictionary/AssetPaymentDocumentType.xml
===================================================================
--- work/src/org/kuali/kfs/module/cam/businessobject/datadictionary/AssetPaymentDocumentType.xml	(revision 0)
+++ work/src/org/kuali/kfs/module/cam/businessobject/datadictionary/AssetPaymentDocumentType.xml	(revision 37225)
@@ -0,0 +1,144 @@
+<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
+<!--
+ Copyright 2007-2009 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
+ 
+ <bean id="AssetPaymentDocumentType" parent="AssetPaymentDocumentType-parentBean"/>
+ 
+  <bean id="AssetPaymentDocumentType-parentBean" abstract="true" parent="BusinessObjectEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.module.cam.businessobject.AssetPaymentDocumentType"/>
+    <property name="inquiryDefinition" ref="AssetPaymentDocumentType-inquiryDefinition"/>
+    <property name="lookupDefinition" ref="AssetPaymentDocumentType-lookupDefinition"/>
+    <property name="titleAttribute" value="documentTypeId"/>
+    <property name="objectLabel" value="Document Type"/>
+    <property name="attributes">
+      <list>
+       	<ref bean="AssetPaymentDocumentType-documentTypeId"/>
+        <ref bean="AssetPaymentDocumentType-expenditureFinancialDocumentTypeCode"/>
+        <ref bean="AssetPaymentDocumentType-label"/>
+        <ref bean="AssetPaymentDocumentType-active"/>
+      </list>
+    </property>
+    <property name="relationships">
+    	<list>
+    		<bean parent="RelationshipDefinition">
+    			<property name="objectAttributeName" value="financialSystemDocumentTypeCode"/>
+		        <property name="primitiveAttributes">
+		        	<list>
+		            	<bean parent="PrimitiveAttributeDefinition" p:sourceName="expenditureFinancialDocumentTypeCode" p:targetName="name"/>
+		            </list>
+		        </property>
+    		</bean>
+    	</list>
+    </property>
+  </bean>
+
+
+<!-- Attribute Definitions -->
+
+  <bean id="AssetPaymentDocumentType-documentTypeId" parent="AssetPaymentDocumentType-documentTypeId-parentBean"/>
+
+  <bean id="AssetPaymentDocumentType-documentTypeId-parentBean" abstract="true" parent="AttributeDefinition">
+     <property name="shortLabel" value="Id"/>
+    <property name="maxLength" value="19"/>
+    <property name="validationPattern">
+      <bean parent="NumericValidationPattern"/>
+    </property>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="30"/>
+    </property>
+    <property name="name" value="documentTypeId"/>
+    <property name="label" value="Id"/>
+  </bean>
+	
+<bean id="AssetPaymentDocumentType-expenditureFinancialDocumentTypeCode" parent="AssetPaymentDocumentType-expenditureFinancialDocumentTypeCode-parentBean"/>
+  <bean id="AssetPaymentDocumentType-expenditureFinancialDocumentTypeCode-parentBean" abstract="true" parent="GenericAttributes-financialSystemDocumentTypeCode">
+    <property name="name" value="expenditureFinancialDocumentTypeCode"/>
+    <property name="shortLabel" value="Doc. Type"/>
+  </bean>
+	
+	  
+  <bean id="AssetPaymentDocumentType-label" parent="AssetPaymentDocumentType-label-parentBean"/>
+  <bean id="AssetPaymentDocumentType-label-parentBean" abstract="true" parent="DocumentType-label"/>
+	
+  <bean id="AssetPaymentDocumentType-active" parent="AssetPaymentDocumentType-active-parentBean"/>
+  <bean id="AssetPaymentDocumentType-active-parentBean" abstract="true" parent="GenericAttributes-activeIndicator">
+    <property name="name" value="active"/>
+  </bean>
+  
+ 
+  
+  <!-- Business Object Inquiry Definition -->
+
+ 
+  <bean id="AssetPaymentDocumentType-inquiryDefinition" parent="AssetPaymentDocumentType-inquiryDefinition-parentBean"/>
+
+  <bean id="AssetPaymentDocumentType-inquiryDefinition-parentBean" abstract="true" parent="InquiryDefinition">
+    <property name="title" value="Document Type Inquiry"/>
+    <property name="inquirySections">
+      <list>
+        <bean parent="InquirySectionDefinition">
+          <property name="title" value="Document Type Inquiry"/>
+          <property name="numberOfColumns" value="1"/>
+          <property name="inquiryFields">
+            <list>
+              <bean parent="FieldDefinition" p:attributeName="documentTypeId"/>
+              <bean parent="FieldDefinition" p:attributeName="expenditureFinancialDocumentTypeCode"/>
+              <bean parent="FieldDefinition" p:attributeName="label"/>
+              <bean parent="FieldDefinition" p:attributeName="active"/>
+            </list>
+          </property>
+        </bean>
+      </list>
+    </property>
+  </bean>
+
+<!-- Business Object Lookup Definition -->
+	
+
+  <bean id="AssetPaymentDocumentType-lookupDefinition" parent="AssetPaymentDocumentType-lookupDefinition-parentBean"/>
+
+  <bean id="AssetPaymentDocumentType-lookupDefinition-parentBean" abstract="true" parent="LookupDefinition">
+    <property name="title" value="Payment Document Type Lookup"/>
+    
+    <property name="defaultSort">
+      <bean parent="SortDefinition">
+         <property name="attributeNames">
+          <list>
+            <value>documentTypeId</value>
+          </list>
+        </property>
+      </bean>
+    </property>
+    <property name="lookupFields">
+      <list>
+      	<bean parent="FieldDefinition" p:attributeName="documentTypeId"/>
+        <bean parent="FieldDefinition" p:attributeName="expenditureFinancialDocumentTypeCode"/>
+        <bean parent="FieldDefinition" p:attributeName="label"/>
+        <bean parent="FieldDefinition" p:attributeName="active"/>
+      </list>
+    </property>
+    <property name="resultFields">
+      <list>
+      	<bean parent="FieldDefinition" p:attributeName="documentTypeId"/>
+        <bean parent="FieldDefinition" p:attributeName="expenditureFinancialDocumentTypeCode"/>
+        <bean parent="FieldDefinition" p:attributeName="label"/>
+        <bean parent="FieldDefinition" p:attributeName="active"/>
+      </list>
+    </property>
+  </bean>
+
+
+</beans>
\ No newline at end of file
Index: work/src/org/kuali/kfs/module/cam/businessobject/defaultvalue/NextDocumentTypeIdFinder.java
===================================================================
--- work/src/org/kuali/kfs/module/cam/businessobject/defaultvalue/NextDocumentTypeIdFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/module/cam/businessobject/defaultvalue/NextDocumentTypeIdFinder.java	(revision 37225)
@@ -0,0 +1,41 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.cam.businessobject.defaultvalue;
+
+import org.kuali.kfs.module.cam.businessobject.AssetPaymentDocumentType;
+import org.kuali.rice.kns.lookup.valueFinder.ValueFinder;
+import org.kuali.rice.kns.service.KNSServiceLocator;
+import org.kuali.rice.kns.service.SequenceAccessorService;
+
+public class NextDocumentTypeIdFinder implements ValueFinder {
+    /**
+     * @see org.kuali.rice.kns.lookup.valueFinder.ValueFinder#getValue()
+     */
+    public String getValue() {
+        return getLongValue().toString();
+    }
+
+    /**
+     * Gets the next sequence number as a long.
+     * 
+     * @return
+     */
+    public static Long getLongValue() {
+        SequenceAccessorService sas = KNSServiceLocator.getSequenceAccessorService();        
+        return sas.getNextAvailableSequenceNumber("CM_AST_PMT_DOC_TYP_SEQ", AssetPaymentDocumentType.class);
+    }
+
+}
Index: work/src/org/kuali/kfs/module/cam/businessobject/AssetPaymentDocumentType.java
===================================================================
--- work/src/org/kuali/kfs/module/cam/businessobject/AssetPaymentDocumentType.java	(revision 0)
+++ work/src/org/kuali/kfs/module/cam/businessobject/AssetPaymentDocumentType.java	(revision 37225)
@@ -0,0 +1,119 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.module.cam.businessobject;
+
+import java.util.LinkedHashMap;
+
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kew.doctype.bo.DocumentTypeEBO;
+import org.kuali.rice.kew.service.impl.KEWModuleService;
+import org.kuali.rice.kns.bo.Inactivateable;
+import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
+import org.kuali.rice.kns.util.ObjectUtils;
+
+/**
+ * 
+ * This class is to store document type use by the asset global document - Asset Payment tab.
+ */
+
+public class AssetPaymentDocumentType extends PersistableBusinessObjectBase implements Inactivateable {
+    private Long documentTypeId;
+    private String expenditureFinancialDocumentTypeCode;
+    private String label;
+    private boolean active;
+    
+    private DocumentTypeEBO financialSystemDocumentTypeCode;
+    
+    
+    
+    public Long getDocumentTypeId() {
+        return documentTypeId;
+    }
+
+
+
+
+    public void setDocumentTypeId(Long documentTypeId) {
+        this.documentTypeId = documentTypeId;
+    }
+
+
+
+
+
+
+    public String getExpenditureFinancialDocumentTypeCode() {
+        return expenditureFinancialDocumentTypeCode;
+    }
+
+
+
+
+    public void setExpenditureFinancialDocumentTypeCode(String expenditureFinancialDocumentTypeCode) {
+        this.expenditureFinancialDocumentTypeCode = expenditureFinancialDocumentTypeCode;
+    }
+
+
+
+
+    public String getLabel() {
+        if(!ObjectUtils.isNull(getFinancialSystemDocumentTypeCode())) {
+            return  getFinancialSystemDocumentTypeCode().getLabel();
+        }
+        return "";
+    }
+
+
+
+
+    public void setLabel(String label) {
+        this.label = label;
+    }
+
+
+    public boolean isActive() {
+        return active;
+    }
+
+
+    public void setActive(boolean active) {
+        this.active = active;
+    }
+
+
+
+
+    /**
+     * Gets the financialSystemDocumentTypeCode attribute. 
+     * @return Returns the financialSystemDocumentTypeCode.
+     */
+    public DocumentTypeEBO getFinancialSystemDocumentTypeCode() {
+        return financialSystemDocumentTypeCode = SpringContext.getBean(KEWModuleService.class).retrieveExternalizableBusinessObjectIfNecessary(this, financialSystemDocumentTypeCode, "financialSystemDocumentTypeCode");
+    }
+
+    @Override
+    protected LinkedHashMap toStringMapper() {
+        LinkedHashMap m = new LinkedHashMap();
+        if (this.documentTypeId != null) {
+            m.put("documentTypeId", this.documentTypeId.toString());
+        }
+        return m;
+            
+    }
+    
+    
+    
+}
Index: work/src/org/kuali/kfs/module/cam/document/datadictionary/AssetPaymentDocumentTypeMaintenanceDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/cam/document/datadictionary/AssetPaymentDocumentTypeMaintenanceDocument.xml	(revision 0)
+++ work/src/org/kuali/kfs/module/cam/document/datadictionary/AssetPaymentDocumentTypeMaintenanceDocument.xml	(revision 37225)
@@ -0,0 +1,59 @@
+<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:dd="http://rice.kuali.org/dd" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd         http://rice.kuali.org/dd         http://rice.kuali.org/dd/dd.xsd">
+<!--
+ Copyright 2006-2009 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
+
+  <bean id="AssetPaymentDocumentTypeMaintenanceDocument" parent="AssetPaymentDocumentTypeMaintenanceDocument-parentBean"/>
+
+  <bean id="AssetPaymentDocumentTypeMaintenanceDocument-parentBean" abstract="true" parent="MaintenanceDocumentEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.module.cam.businessobject.AssetPaymentDocumentType"/>
+    <property name="maintainableClass" value="org.kuali.kfs.sys.document.FinancialSystemMaintainable"/>
+    <property name="maintainableSections">
+      <list>
+        <ref bean="AssetPaymentDocumentTypeMaintenanceDocument-EditAssetPaymentDocumentType"/>
+      </list>
+    </property>
+    <property name="lockingKeys">
+      <list>
+        <value>documentTypeId</value>
+      </list>
+    </property>
+    <property name="documentTypeName" value="APDT"/>
+    <property name="documentAuthorizerClass" value="org.kuali.kfs.sys.document.authorization.FinancialSystemMaintenanceDocumentAuthorizerBase"/>
+    <property name="workflowAttributes">
+    	<ref bean="AssetPaymentDocumentTypeMaintenanceDocument-workflowAttributes"/>
+    </property>
+  </bean>
+
+<!-- Maintenance Section Definitions -->
+
+  <bean id="AssetPaymentDocumentTypeMaintenanceDocument-EditAssetPaymentDocumentType" parent="AssetPaymentDocumentTypeMaintenanceDocument-EditAssetPaymentDocumentType-parentBean"/>
+
+  <bean id="AssetPaymentDocumentTypeMaintenanceDocument-EditAssetPaymentDocumentType-parentBean" abstract="true" parent="MaintainableSectionDefinition">
+    <property name="id" value="Edit Asset Payment Document Type"/>
+    <property name="title" value="Edit Asset Payment Document Type"/>
+    <property name="maintainableItems">
+      <list>
+        <bean parent="MaintainableFieldDefinition" p:name="documentTypeId" p:unconditionallyReadOnly="true" p:required="true" p:defaultValueFinderClass="org.kuali.kfs.module.cam.businessobject.defaultvalue.NextDocumentTypeIdFinder"/>
+        <bean parent="MaintainableFieldDefinition" p:name="expenditureFinancialDocumentTypeCode"  p:required="true"/>
+        <bean parent="MaintainableFieldDefinition" p:name="active" p:defaultValue="true"/>
+        </list>
+    </property>
+  </bean>
+  
+    <!-- workflow attributes -->
+  <bean id="AssetPaymentDocumentTypeMaintenanceDocument-workflowAttributes" parent="AssetPaymentDocumentTypeMaintenanceDocument-workflowAttributes-parentBean"/>
+  <bean id="AssetPaymentDocumentTypeMaintenanceDocument-workflowAttributes-parentBean" class="org.kuali.rice.kns.datadictionary.WorkflowAttributes" abstract="true"/>
+</beans>
Index: work/src/org/kuali/kfs/module/external/kc/businessobject/AccountAutoCreateDefaults.java
===================================================================
--- work/src/org/kuali/kfs/module/external/kc/businessobject/AccountAutoCreateDefaults.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/external/kc/businessobject/AccountAutoCreateDefaults.java	(revision 37225)
@@ -25,7 +25,6 @@
 import org.kuali.kfs.coa.businessobject.Organization;
 import org.kuali.kfs.coa.businessobject.SubFundGroup;
 import org.kuali.kfs.coa.businessobject.SufficientFundsCode;
-import org.kuali.kfs.integration.cg.ContractsAndGrantsCfda;
 import org.kuali.kfs.module.external.kc.businessobject.UnitDTO;
 import org.kuali.kfs.sys.context.SpringContext;
 import org.kuali.rice.kim.bo.Person;
Index: work/src/org/kuali/kfs/module/purap/businessobject/RequisitionView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/RequisitionView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/RequisitionView.java	(revision 37225)
@@ -17,6 +17,7 @@
 
 import java.util.List;
 
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.rice.kns.bo.Note;
 
 /**
@@ -64,4 +65,12 @@
     public String getUrl() {
         return super.getUrl();
     }
+
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.REQUISITION;
+    }
 }
Index: work/src/org/kuali/kfs/module/purap/businessobject/LineItemReceivingView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/LineItemReceivingView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/LineItemReceivingView.java	(revision 37225)
@@ -17,6 +17,7 @@
 
 import java.util.List;
 
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.rice.kns.bo.Note;
 
 /**
@@ -71,4 +72,12 @@
     public String getUrl() {
         return super.getUrl();
     }
+
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.LINE_ITEM_RECEIVING;
+    }
 }
Index: work/src/org/kuali/kfs/module/purap/businessobject/PurchaseOrderView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/PurchaseOrderView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/PurchaseOrderView.java	(revision 37225)
@@ -20,6 +20,7 @@
 
 import org.kuali.kfs.module.purap.PurapConstants.PurchaseOrderStatuses;
 import org.kuali.kfs.module.purap.document.service.PurchaseOrderService;
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.kfs.sys.context.SpringContext;
 import org.kuali.rice.kns.bo.Note;
 import org.kuali.rice.kns.util.TypedArrayList;
@@ -152,4 +153,12 @@
     public boolean getNeedWarning() {
         return getPurchaseOrderInitialOpenTimestamp() == null;
     }
+
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.PURCHASE_ORDER;
+    }
 }
Index: work/src/org/kuali/kfs/module/purap/businessobject/PaymentRequestView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/PaymentRequestView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/PaymentRequestView.java	(revision 37225)
@@ -184,4 +184,12 @@
     public String getUrl() {
         return super.getUrl();
     }
+
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.PAYMENT_REQUEST;
+    }
 }
Index: work/src/org/kuali/kfs/module/purap/businessobject/ElectronicInvoiceRejectView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/ElectronicInvoiceRejectView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/ElectronicInvoiceRejectView.java	(revision 37225)
@@ -17,6 +17,7 @@
 
 import java.util.List;
 
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.rice.kns.bo.Note;
 
 /**
@@ -83,4 +84,11 @@
         return super.getUrl();
     }
 
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.ELECTRONIC_INVOICE_REJECT;
+    }
 }
Index: work/src/org/kuali/kfs/module/purap/businessobject/CorrectionReceivingView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/CorrectionReceivingView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/CorrectionReceivingView.java	(revision 37225)
@@ -17,6 +17,7 @@
 
 import java.util.List;
 
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.rice.kns.bo.Note;
 
 /**
@@ -64,4 +65,13 @@
     public String getUrl() {
         return super.getUrl();
     }
+
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.CORRECTION_RECEIVING;
+    }
+    
 }
Index: work/src/org/kuali/kfs/module/purap/businessobject/CreditMemoView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/CreditMemoView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/CreditMemoView.java	(revision 37225)
@@ -174,4 +174,13 @@
     public String getUrl() {
         return super.getUrl();
     }
+
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.VENDOR_CREDIT_MEMO;
+    }
+    
 }
Index: work/src/org/kuali/kfs/module/purap/businessobject/BulkReceivingView.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/businessobject/BulkReceivingView.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/businessobject/BulkReceivingView.java	(revision 37225)
@@ -17,6 +17,7 @@
 
 import java.util.List;
 
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.rice.kns.bo.Note;
 
 /**
@@ -73,4 +74,12 @@
     public String getUrl() {
         return super.getUrl();
     }
+
+    /**
+     * @see org.kuali.kfs.module.purap.businessobject.AbstractRelatedView#getDocumentTypeName()
+     */
+    @Override
+    public String getDocumentTypeName() {
+        return KFSConstants.FinancialDocumentTypeCodes.BULK_RECEIVING;
+    }
 }
Index: work/src/org/kuali/kfs/module/purap/util/PurApRelatedViews.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/util/PurApRelatedViews.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/util/PurApRelatedViews.java	(revision 37225)
@@ -276,8 +276,8 @@
      * A container for a List<PurchaseOrderView>, to be used by a nested c:forEach tag
      * in relatedPurchaseOrderDocumentsDetail.tag.
      */
-    protected class PurchaseOrderViewGroup {
-        private List<PurchaseOrderView> views = new ArrayList<PurchaseOrderView>();
+    public class PurchaseOrderViewGroup {
+        protected List<PurchaseOrderView> views = new ArrayList<PurchaseOrderView>();
         
         protected PurchaseOrderViewGroup() {
         }
@@ -290,9 +290,9 @@
     /**
      * A container for a LineItemReceivingView and a list of its associated CorrectionReceivingViews.
      */
-    protected class ReceivingViewGroup {
-        private LineItemReceivingView lineItemView;
-        private List<CorrectionReceivingView> correctionViews = new ArrayList<CorrectionReceivingView>();
+    public class ReceivingViewGroup {
+        protected LineItemReceivingView lineItemView;
+        protected List<CorrectionReceivingView> correctionViews = new ArrayList<CorrectionReceivingView>();
         
         protected ReceivingViewGroup() {
         }
Index: work/src/org/kuali/kfs/module/purap/document/datadictionary/PurchaseOrderQuoteListMaintenanceDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/purap/document/datadictionary/PurchaseOrderQuoteListMaintenanceDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/document/datadictionary/PurchaseOrderQuoteListMaintenanceDocument.xml	(revision 37225)
@@ -77,8 +77,7 @@
           </property>
           <property name="maintainableFields">
             <list>
-              <bean parent="MaintainableFieldDefinition" p:name="vendorDetail.vendorNumber" p:readOnlyAfterAdd="true" p:required="true" p:overrideLookupClass="org.kuali.kfs.vnd.businessobject.VendorDetail" p:overrideFieldConversions="vendorNumber:vendorDetail.vendorNumber,vendorName:vendorDetail.vendorName"/>
-              <bean parent="MaintainableFieldDefinition" p:name="newCollectionRecord"/>                    
+              <bean parent="MaintainableFieldDefinition" p:name="vendorDetail.vendorNumber"  p:template="vendorDetail.vendorNumber"  p:readOnlyAfterAdd="true" p:required="true" p:overrideFieldConversions="vendorNumber:vendorDetail.vendorNumber,vendorName:vendorDetail.vendorName,vendorHeaderGeneratedIdentifier:vendorHeaderGeneratedIdentifier,vendorDetailAssignedIdentifier:vendorDetailAssignedIdentifier"/>              <bean parent="MaintainableFieldDefinition" p:name="newCollectionRecord"/>                    
               <bean parent="MaintainableFieldDefinition" p:name="vendorHeaderGeneratedIdentifier" p:template="vendorHeaderGeneratedIdentifier"/>
               <bean parent="MaintainableFieldDefinition" p:name="vendorDetailAssignedIdentifier" p:template="vendorDetailAssignedIdentifier"/>
               <bean parent="MaintainableFieldDefinition" p:name="vendorDetail.vendorName" p:template="vendorDetail.vendorName" p:unconditionallyReadOnly="true"/>                    
Index: work/src/org/kuali/kfs/module/purap/document/service/ReceivingService.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/document/service/ReceivingService.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/document/service/ReceivingService.java	(revision 37225)
@@ -181,4 +181,13 @@
      * Returns true, if the po is active for receiving document creation
      */
     public boolean isPurchaseOrderActiveForLineItemReceivingDocumentCreation(Integer poId);
+    
+    /**
+     * Checks if there're newly added items in the given LineItemReceivingDocument.
+     * 
+     * @param rlDoc the given LineItemReceivingDocument
+     * @return true if there're newly added (unordered) items; false otherwise.
+     */
+    public boolean hasNewUnorderedItem(LineItemReceivingDocument rlDoc);
+    
 }
Index: work/src/org/kuali/kfs/module/purap/document/PurchaseOrderAmendmentDocument.java
===================================================================
--- work/src/org/kuali/kfs/module/purap/document/PurchaseOrderAmendmentDocument.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/purap/document/PurchaseOrderAmendmentDocument.java	(revision 37225)
@@ -73,6 +73,11 @@
         if (getDocumentHeader().getWorkflowDocument().stateIsProcessed()) {
             // generate GL entries
             SpringContext.getBean(PurapGeneralLedgerService.class).generateEntriesApproveAmendPurchaseOrder(this);
+            
+            // if gl entries created(means there is amount change) for amend purchase order send an FYI to all fiscal officers
+            if ((getGlOnlySourceAccountingLines() != null && !getGlOnlySourceAccountingLines().isEmpty())) {
+                SpringContext.getBean(PurchaseOrderService.class).sendFyiForGLEntries(this);
+            }
 
             // update indicators
             SpringContext.getBean(PurchaseOrderService.class).completePurchaseOrderAmendment(this);
Index: work/src/org/kuali/kfs/module/cg/ojb-cg.xml
===================================================================
--- work/src/org/kuali/kfs/module/cg/ojb-cg.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/ojb-cg.xml	(revision 37225)
@@ -117,20 +117,7 @@
     <field-descriptor name="active" column="CG_GRNT_DESC_ACTV_CD" jdbc-type="VARCHAR" conversion="org.kuali.rice.kns.util.OjbCharBooleanFieldAIConversion" />
 </class-descriptor>
 
-<!-- 
- 
- CATALOG OF FEDERAL DOMESTIC ASSISTANCE REFERENCE (CFDA)
 
--->
-<class-descriptor class="org.kuali.kfs.module.cg.businessobject.CFDA" table="CG_CFDA_REF_T">
-    <field-descriptor name="cfdaNumber" column="CG_CFDA_NBR" jdbc-type="VARCHAR" primarykey="true" index="true" />
-    <field-descriptor name="objectId" column="OBJ_ID" jdbc-type="VARCHAR" index="true" />
-    <field-descriptor name="versionNumber" column="VER_NBR" jdbc-type="BIGINT" locking="true" />
-    <field-descriptor name="cfdaProgramTitleName" column="CG_CFDA_PGM_TTL_NM" jdbc-type="VARCHAR" />
-    <!--field-descriptor name="cfdaStatusCode" column="CG_CFDA_STAT_CD" jdbc-type="VARCHAR" conversion="org.kuali.rice.kns.util.OjbCharBooleanFieldAIConversion"/-->
-    <field-descriptor name="cfdaMaintenanceTypeId" column="CG_CFDA_MAINT_TYP_ID" jdbc-type="VARCHAR" />
-    <field-descriptor name="active" column="ROW_ACTV_IND" jdbc-type="VARCHAR" conversion="org.kuali.rice.kns.util.OjbCharBooleanConversion" />
-</class-descriptor>
 
 <!-- 
  
@@ -182,7 +169,7 @@
     <reference-descriptor name="proposalPurpose" class-ref="org.kuali.kfs.module.cg.businessobject.ProposalPurpose" auto-retrieve="true" auto-update="none" auto-delete="none" proxy="true" >
         <foreignkey field-ref="proposalPurposeCode" />
     </reference-descriptor>
-    <reference-descriptor name="cfda" class-ref="org.kuali.kfs.module.cg.businessobject.CFDA" auto-retrieve="true" auto-update="none" auto-delete="none" proxy="true" >
+    <reference-descriptor name="cfda" class-ref="org.kuali.kfs.coa.businessobject.CFDA" auto-retrieve="true" auto-update="none" auto-delete="none" proxy="true" >
         <foreignkey field-ref="cfdaNumber" />
     </reference-descriptor>
     <collection-descriptor name="proposalSubcontractors" element-class-ref="org.kuali.kfs.module.cg.businessobject.ProposalSubcontractor" collection-class="org.apache.ojb.broker.util.collections.ManageableArrayList" proxy="true" auto-retrieve="true" auto-update="object" auto-delete="object">
Index: work/src/org/kuali/kfs/module/cg/service/CfdaService.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/service/CfdaService.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/service/CfdaService.java	(revision 37225)
@@ -1,31 +0,0 @@
-/*
- * Copyright 2007 The Kuali Foundation
- * 
- * Licensed under the Educational Community License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.opensource.org/licenses/ecl2.php
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.kuali.kfs.module.cg.service;
-
-import java.io.IOException;
-
-import org.kuali.kfs.module.cg.businessobject.CFDA;
-import org.kuali.kfs.module.cg.businessobject.CfdaUpdateResults;
-
-/**
- * 
- */
-public interface CfdaService {
-    CfdaUpdateResults update() throws IOException;
-
-    public CFDA getByPrimaryId(String cfdaNumber);
-
-}
Index: work/src/org/kuali/kfs/module/cg/service/impl/CfdaServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/service/impl/CfdaServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/service/impl/CfdaServiceImpl.java	(revision 37225)
@@ -1,249 +0,0 @@
-/*
- * Copyright 2007 The Kuali Foundation
- * 
- * Licensed under the Educational Community License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.opensource.org/licenses/ecl2.php
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.kuali.kfs.module.cg.service.impl;
-
-import java.io.BufferedReader;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.InputStreamReader;
-import java.util.Calendar;
-import java.util.Collection;
-import java.util.Comparator;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.SortedMap;
-import java.util.TreeMap;
-
-import org.apache.commons.lang.StringUtils;
-import org.apache.commons.net.ftp.FTPClient;
-import org.apache.commons.net.ftp.FTPReply;
-import org.kuali.kfs.module.cg.CGConstants;
-import org.kuali.kfs.module.cg.batch.CfdaBatchStep;
-import org.kuali.kfs.module.cg.businessobject.CFDA;
-import org.kuali.kfs.module.cg.businessobject.CfdaUpdateResults;
-import org.kuali.kfs.module.cg.service.CfdaService;
-import org.kuali.kfs.sys.KFSPropertyConstants;
-import org.kuali.kfs.sys.context.SpringContext;
-import org.kuali.rice.kns.service.BusinessObjectService;
-import org.kuali.rice.kns.service.DateTimeService;
-import org.kuali.rice.kns.service.ParameterService;
-
-import au.com.bytecode.opencsv.CSVReader;
-
-public class CfdaServiceImpl implements CfdaService {
-    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(CfdaServiceImpl.class);
-
-    private BusinessObjectService businessObjectService;
-    protected static Comparator cfdaComparator;
-
-    static {
-        cfdaComparator = new Comparator() {
-            public int compare(Object o1, Object o2) {
-                String lhs = (String) o1;
-                String rhs = (String) o2;
-                return lhs.compareTo(rhs);
-            }
-        };
-    }
-
-    /**
-     * @return
-     * @throws IOException
-     */
-    public SortedMap<String, CFDA> getGovCodes() throws IOException {
-        Calendar calendar = SpringContext.getBean(DateTimeService.class).getCurrentCalendar();
-        SortedMap<String, CFDA> govMap = new TreeMap<String, CFDA>();
-
-        // ftp://ftp.cfda.gov/programs09187.csv
-        String govURL = SpringContext.getBean(ParameterService.class).getParameterValue(CfdaBatchStep.class, CGConstants.SOURCE_URL_PARAMETER);
-        String fileName = StringUtils.substringAfterLast(govURL, "/");
-        govURL = StringUtils.substringBeforeLast(govURL, "/");
-        if (StringUtils.contains(govURL, "ftp://")) {
-            govURL = StringUtils.remove(govURL, "ftp://");
-        }
-
-        // need to pull off the '20' in 2009
-        String year = "" + calendar.get(Calendar.YEAR);
-        year = year.substring(2, 4);
-        fileName = fileName + year;
-
-        // the last 3 numbers in the file name are the day of the year, but the files are from "yesterday"
-        fileName = fileName + String.format("%03d", calendar.get(Calendar.DAY_OF_YEAR) - 1);
-        fileName = fileName + ".csv";
-
-        LOG.info("Getting government file: " + fileName + " for update");
-
-        InputStream inputStream = null;
-        FTPClient ftp = new FTPClient();
-        try {
-            ftp.connect(govURL);
-            int reply = ftp.getReplyCode();
-
-            if (!FTPReply.isPositiveCompletion(reply)) {
-                LOG.error("FTP connection to server not established.");
-                throw new IOException("FTP connection to server not established.");
-            }
-
-            boolean loggedIn = ftp.login("anonymous", "");
-            if (!loggedIn) {
-                LOG.error("Could not login as anonymous.");
-                throw new IOException("Could not login as anonymous.");
-            }
-
-            LOG.info("Successfully connected and logged in");
-
-            inputStream = ftp.retrieveFileStream(fileName);
-            if (inputStream != null) {
-                LOG.info("reading input stream");
-                InputStreamReader screenReader = new InputStreamReader(inputStream);
-                BufferedReader screen = new BufferedReader(screenReader);
-
-                CSVReader csvReader = new CSVReader(screenReader, ',', '"', 1);
-                List<String[]> lines = csvReader.readAll();
-                for (String[] line : lines) {
-                    String title = line[0];
-                    String number = line[1];
-
-                    CFDA cfda = new CFDA();
-                    cfda.setCfdaNumber(number);
-                    cfda.setCfdaProgramTitleName(title);
-
-                    govMap.put(number, cfda);
-                }
-            }
-
-            ftp.logout();
-            ftp.disconnect();
-        }
-        finally {
-            if (ftp.isConnected()) {
-                ftp.disconnect();
-            }
-        }
-
-        return govMap;
-    }
-
-    /**
-     * @return
-     * @throws IOException
-     */
-    public SortedMap<String, CFDA> getKfsCodes() throws IOException {
-        Collection allCodes = businessObjectService.findAll(CFDA.class);
-
-        SortedMap<String, CFDA> kfsMapAll = new TreeMap<String, CFDA>(cfdaComparator);
-        for (Object o : allCodes) {
-            CFDA c = (CFDA) o;
-            kfsMapAll.put(c.getCfdaNumber(), c);
-        }
-        return kfsMapAll;
-    }
-
-    /**
-     *
-     */
-    public CfdaUpdateResults update() throws IOException {
-
-        CfdaUpdateResults results = new CfdaUpdateResults();
-        Map<String, CFDA> govMap = null;
-
-        try {
-            govMap = getGovCodes();
-        }
-        catch (IOException ioe) {
-            LOG.error("Error connecting to URL resource: " + ioe.getMessage(), ioe);
-            StringBuilder builder = new StringBuilder();
-            builder.append("No updates took place.\n");
-            builder.append(ioe.getMessage());
-            results.setMessage(builder.toString());
-            return results;
-        }
-        Map<String, CFDA> kfsMap = getKfsCodes();
-
-        results.setNumberOfRecordsInKfsDatabase(kfsMap.keySet().size());
-        results.setNumberOfRecordsRetrievedFromWebSite(govMap.keySet().size());
-
-        for (Object key : kfsMap.keySet()) {
-
-            CFDA cfdaKfs = kfsMap.get(key);
-            CFDA cfdaGov = govMap.get(key);
-
-            if (cfdaKfs.getCfdaMaintenanceTypeId().startsWith("M")) {
-                // Leave it alone. It's maintained manually.
-                results.setNumberOfRecordsNotUpdatedBecauseManual(1 + results.getNumberOfRecordsNotUpdatedBecauseManual());
-            }
-            else if (cfdaKfs.getCfdaMaintenanceTypeId().startsWith("A")) {
-
-                if (cfdaGov == null) {
-                    if (cfdaKfs.isActive()) {
-                        cfdaKfs.setActive(false);
-                        businessObjectService.save(cfdaKfs);
-                        results.setNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite(results.getNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite() + 1);
-                    }
-                    else {
-                        // Leave it alone for historical purposes
-                        results.setNumberOfRecrodsNotUpdatedForHistoricalPurposes(results.getNumberOfRecrodsNotUpdatedForHistoricalPurposes() + 1);
-                    }
-                }
-                else {
-                    if (cfdaKfs.isActive()) {
-                        results.setNumberOfRecordsUpdatedBecauseAutomatic(results.getNumberOfRecordsUpdatedBecauseAutomatic() + 1);
-                    }
-                    else {
-                        cfdaKfs.setActive(true);
-                        results.setNumberOfRecordsReActivated(results.getNumberOfRecordsReActivated() + 1);
-                    }
-
-                    cfdaKfs.setCfdaProgramTitleName(cfdaGov.getCfdaProgramTitleName());
-                    businessObjectService.save(cfdaKfs);
-                }
-            }
-
-            // Remove it from the govMap so we know what codes from the govMap don't already exist in KFS.
-            govMap.remove(key);
-        }
-
-        // What's left in govMap now is just the codes that don't exist in KFS
-        for (String key : govMap.keySet()) {
-            CFDA cfdaGov = govMap.get(key);
-            cfdaGov.setCfdaMaintenanceTypeId("Automatic");
-            cfdaGov.setActive(true);
-            businessObjectService.save(cfdaGov);
-            results.setNumberOfRecordsNewlyAddedFromWebSite(results.getNumberOfRecordsNewlyAddedFromWebSite() + 1);
-        }
-
-        return results;
-    }
-
-    public void setBusinessObjectService(BusinessObjectService businessObjectService) {
-        this.businessObjectService = businessObjectService;
-    }
-
-    public CFDA getByPrimaryId(String cfdaNumber) {
-        if (StringUtils.isBlank(cfdaNumber)) {
-            return null;
-        }
-        return (CFDA) businessObjectService.findByPrimaryKey(CFDA.class, mapPrimaryKeys(cfdaNumber));
-    }
-
-    protected Map<String, Object> mapPrimaryKeys(String cfdaNumber) {
-        Map<String, Object> primaryKeys = new HashMap();
-        primaryKeys.put(KFSPropertyConstants.CFDA_NUMBER, cfdaNumber.trim());
-        return primaryKeys;
-    }
-
-}
Index: work/src/org/kuali/kfs/module/cg/service/impl/ContractsAndGrantsModuleServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/service/impl/ContractsAndGrantsModuleServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/service/impl/ContractsAndGrantsModuleServiceImpl.java	(revision 37225)
@@ -26,7 +26,7 @@
 import org.kuali.kfs.module.cg.CGConstants;
 import org.kuali.kfs.module.cg.businessobject.AwardAccount;
 import org.kuali.kfs.module.cg.service.AgencyService;
-import org.kuali.kfs.module.cg.service.CfdaService;
+import org.kuali.kfs.coa.service.CfdaService;
 import org.kuali.kfs.sys.KFSPropertyConstants;
 import org.kuali.kfs.sys.context.SpringContext;
 import org.kuali.kfs.sys.service.NonTransactional;
Index: work/src/org/kuali/kfs/module/cg/batch/CfdaBatchStep.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/batch/CfdaBatchStep.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/batch/CfdaBatchStep.java	(revision 37225)
@@ -1,164 +0,0 @@
-/*
- * Copyright 2007 The Kuali Foundation
- * 
- * Licensed under the Educational Community License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.opensource.org/licenses/ecl2.php
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.kuali.kfs.module.cg.batch;
-
-import java.io.IOException;
-import java.util.Date;
-import java.util.List;
-
-import org.apache.log4j.Logger;
-import org.kuali.kfs.module.cg.CGConstants;
-import org.kuali.kfs.module.cg.businessobject.CfdaUpdateResults;
-import org.kuali.kfs.module.cg.service.CfdaService;
-import org.kuali.kfs.sys.KFSKeyConstants;
-import org.kuali.kfs.sys.batch.AbstractStep;
-import org.kuali.rice.kns.mail.InvalidAddressException;
-import org.kuali.rice.kns.mail.MailMessage;
-import org.kuali.rice.kns.service.KualiConfigurationService;
-import org.kuali.rice.kns.service.MailService;
-import org.kuali.rice.kns.service.ParameterService;
-
-/**
- * Parses data from a government web page listing the valid CFDA codes. The codes are then compared with what's in the CFDA table in
- * Kuali. Codes set to be managed automatically are reconciled with what's on the web page. Codes managed manually are left alone.
- * Finally an email containing a summary of what was done by the step execution is sent to the member of the CG_CFDA_BATCH_NOTIFY workgroup.
- */
-public class CfdaBatchStep extends AbstractStep {
-
-    private static Logger LOG = org.apache.log4j.Logger.getLogger(CfdaBatchStep.class);
-
-    private CfdaService cfdaService;
-    private MailService mailService;
-    private ParameterService parameterService;
-    private KualiConfigurationService configurationService;
-    /**
-     * See the class description.
-     * 
-     * @see org.kuali.kfs.sys.batch.Step#execute(String, Date)
-     */
-    public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
-        MailMessage message = new MailMessage();
-
-        try {
-            CfdaUpdateResults results = cfdaService.update();
-
-            List<String> listservAddresses = parameterService.getParameterValues(CfdaBatchStep.class, CGConstants.RESULT_SUMMARY_TO_EMAIL_ADDRESSES);
-            if (listservAddresses == null || listservAddresses.size() == 0) {
-                LOG.fatal("Couldn't find address to send notification to.");
-                return true;
-            }
-            
-            for (String listserv : listservAddresses) {
-                if (LOG.isDebugEnabled()) {
-                    LOG.debug("Mailing to: "+listserv);
-                }
-                message.addToAddress(listserv);
-            }
-            
-            message.setFromAddress(listservAddresses.get(0));
-
-            // TODO this message should come from some config file.
-            StringBuilder builder = new StringBuilder();
-            builder.append("The CFDA batch script is complete.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite());
-            builder.append(" records were deactivated because they are no longer on the web site.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecordsInKfsDatabase());
-            builder.append(" records were in the KFS database.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecordsNewlyAddedFromWebSite());
-            builder.append(" records were newly added from the web site.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecordsNotUpdatedBecauseManual());
-            builder.append(" records were not updated because they are manual.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecordsReActivated());
-            builder.append(" records were re-activated.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecordsRetrievedFromWebSite());
-            builder.append(" records were retrieved from the web site.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecordsUpdatedBecauseAutomatic());
-            builder.append(" records were updated because they are automatic.\n");
-            builder.append(" - ");
-            builder.append(results.getNumberOfRecrodsNotUpdatedForHistoricalPurposes());
-            builder.append(" records were not updated for historical reasons.\n");
-            builder.append(" - Message\n");
-            builder.append(null != results.getMessage() ? results.getMessage() : "");
-
-            message.setSubject(getConfigurationService().getPropertyString(KFSKeyConstants.CFDA_UPDATE_EMAIL_SUBJECT_LINE));
-            message.setMessage(builder.toString());
-            mailService.sendMessage(message);
-
-        }
-        catch (IOException ioe) {
-            LOG.warn("Exception while updating CFDA codes.", ioe);
-            return false;
-        }
-        catch (InvalidAddressException iae) {
-
-           LOG.warn("The email address for "+CfdaBatchStep.class+":"+CGConstants.RESULT_SUMMARY_TO_EMAIL_ADDRESSES+" is invalid.", iae);
-            return true;
-        }
-        return true;
-    }
-
-    /**
-     * Sets the {@link CfdaService}. For use by Spring.
-     * 
-     * @param cfdaService The service to be assigned.
-     */
-    public void setCfdaService(CfdaService cfdaService) {
-        this.cfdaService = cfdaService;
-    }
-
-    /**
-     * Set the {@link MailService}. For use by Spring.
-     * 
-     * @param mailService The service to be assigned.
-     */
-    public void setMailService(MailService mailService) {
-        this.mailService = mailService;
-    }
-    
-    /**
-     * Sets the {@link ParameterService}. For use by Spring.
-     * 
-     * @param parameterService The service to be assigned.
-     */
-    public void setParameterService(ParameterService parameterService) {
-        this.parameterService = parameterService;
-    }
-
-    /**
-     * Gets the configurationService attribute. 
-     * @return Returns the configurationService.
-     */
-    public KualiConfigurationService getConfigurationService() {
-        return configurationService;
-    }
-
-    /**
-     * Sets the configurationService attribute value.
-     * @param configurationService The configurationService to set.
-     */
-    public void setConfigurationService(KualiConfigurationService configurationService) {
-        this.configurationService = configurationService;
-    }
-
-}
-
Index: work/src/org/kuali/kfs/module/cg/businessobject/CfdaUpdateResults.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/businessobject/CfdaUpdateResults.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/businessobject/CfdaUpdateResults.java	(revision 37225)
@@ -1,190 +0,0 @@
-/*
- * Copyright 2007 The Kuali Foundation
- * 
- * Licensed under the Educational Community License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.opensource.org/licenses/ecl2.php
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.kuali.kfs.module.cg.businessobject;
-
-/**
- * Encapsulates the result of scraping the government CFDA web-page.
- */
-public class CfdaUpdateResults {
-    private int numberOfRecordsRetrievedFromWebSite;
-    private int numberOfRecordsInKfsDatabase;
-    private int numberOfRecrodsNotUpdatedForHistoricalPurposes;
-    private int numberOfRecordsDeactivatedBecauseNoLongerOnWebSite;
-    private int numberOfRecordsReActivated;
-    private int numberOfRecordsNotUpdatedBecauseManual;
-    private int numberOfRecordsUpdatedBecauseAutomatic;
-    private int numberOfRecordsNewlyAddedFromWebSite;
-    private String message;
-
-    /**
-     * @return
-     */
-    public int getNumberOfRecordsNewlyAddedFromWebSite() {
-        return numberOfRecordsNewlyAddedFromWebSite;
-    }
-
-    /**
-     * @param numberOfRecordsNewlyAddedFromWebSite
-     */
-    public void setNumberOfRecordsNewlyAddedFromWebSite(int numberOfRecordsNewlyAddedFromWebSite) {
-        this.numberOfRecordsNewlyAddedFromWebSite = numberOfRecordsNewlyAddedFromWebSite;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public int getNumberOfRecordsReActivated() {
-        return numberOfRecordsReActivated;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param numberOfRecordsReActivated
-     */
-    public void setNumberOfRecordsReActivated(int numberOfRecordsReActivated) {
-        this.numberOfRecordsReActivated = numberOfRecordsReActivated;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public int getNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite() {
-        return numberOfRecordsDeactivatedBecauseNoLongerOnWebSite;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param numberOfRecordsDeactivatedBecauseNoLongerOnWebSite
-     */
-    public void setNumberOfRecordsDeactivatedBecauseNoLongerOnWebSite(int numberOfRecordsDeactivatedBecauseNoLongerOnWebSite) {
-        this.numberOfRecordsDeactivatedBecauseNoLongerOnWebSite = numberOfRecordsDeactivatedBecauseNoLongerOnWebSite;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public int getNumberOfRecrodsNotUpdatedForHistoricalPurposes() {
-        return numberOfRecrodsNotUpdatedForHistoricalPurposes;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param numberOfRecrodsNotUpdatedForHistoricalPurposes
-     */
-    public void setNumberOfRecrodsNotUpdatedForHistoricalPurposes(int numberOfRecrodsNotUpdatedForHistoricalPurposes) {
-        this.numberOfRecrodsNotUpdatedForHistoricalPurposes = numberOfRecrodsNotUpdatedForHistoricalPurposes;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public int getNumberOfRecordsRetrievedFromWebSite() {
-        return numberOfRecordsRetrievedFromWebSite;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param numberOfRecordsRetrievedFromWebSite
-     */
-    public void setNumberOfRecordsRetrievedFromWebSite(int numberOfRecordsRetrievedFromWebSite) {
-        this.numberOfRecordsRetrievedFromWebSite = numberOfRecordsRetrievedFromWebSite;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public int getNumberOfRecordsInKfsDatabase() {
-        return numberOfRecordsInKfsDatabase;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param numberOfRecordsInKfsDatabase
-     */
-    public void setNumberOfRecordsInKfsDatabase(int numberOfRecordsInKfsDatabase) {
-        this.numberOfRecordsInKfsDatabase = numberOfRecordsInKfsDatabase;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public int getNumberOfRecordsUpdatedBecauseAutomatic() {
-        return numberOfRecordsUpdatedBecauseAutomatic;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param numberOfRecordsUpdatedBecauseAutomatic
-     */
-    public void setNumberOfRecordsUpdatedBecauseAutomatic(int numberOfRecordsUpdatedBecauseAutomatic) {
-        this.numberOfRecordsUpdatedBecauseAutomatic = numberOfRecordsUpdatedBecauseAutomatic;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public int getNumberOfRecordsNotUpdatedBecauseManual() {
-        return numberOfRecordsNotUpdatedBecauseManual;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param numberOfRecordsNotUpdatedBecauseManual
-     */
-    public void setNumberOfRecordsNotUpdatedBecauseManual(int numberOfRecordsNotUpdatedBecauseManual) {
-        this.numberOfRecordsNotUpdatedBecauseManual = numberOfRecordsNotUpdatedBecauseManual;
-    }
-
-    /**
-     * This method...
-     * 
-     * @return
-     */
-    public String getMessage() {
-        return message;
-    }
-
-    /**
-     * This method...
-     * 
-     * @param message
-     */
-    public void setMessage(String message) {
-        this.message = message;
-    }
-
-}
Index: work/src/org/kuali/kfs/module/cg/businessobject/CFDA.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/businessobject/CFDA.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/businessobject/CFDA.java	(revision 37225)
@@ -1,124 +0,0 @@
-/*
- * Copyright 2007 The Kuali Foundation
- * 
- * Licensed under the Educational Community License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.opensource.org/licenses/ecl2.php
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.kuali.kfs.module.cg.businessobject;
-
-import java.util.LinkedHashMap;
-
-import org.kuali.rice.kns.bo.Inactivateable;
-import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
-import org.kuali.kfs.integration.cg.ContractsAndGrantsCfda;
-import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
-
-/**
- * Instances of this class refer to Catalog of Federal Domestic Assistance codes. Some of these codes are taken directly from a
- * government web-site. Additional codes can be created manually however. Codes can be updated automatically via the CfdaBatchStep.
- */
-public class CFDA extends PersistableBusinessObjectBase implements ContractsAndGrantsCfda, Inactivateable {
-
-    private String cfdaNumber;
-    private String cfdaProgramTitleName;
-    private String cfdaMaintenanceTypeId;
-    private boolean active;
-
-    /**
-     * Default constructor.
-     */
-    public CFDA() {
-    }
-
-    /**
-     * Gets the cfdaNumber attribute.
-     * 
-     * @return Returns the cfdaNumber
-     */
-    public String getCfdaNumber() {
-        return cfdaNumber;
-    }
-
-    /**
-     * Sets the cfdaNumber attribute.
-     * 
-     * @param cfdaNumber The cfdaNumber to set.
-     */
-    public void setCfdaNumber(String cfdaNumber) {
-        this.cfdaNumber = cfdaNumber;
-    }
-
-
-    /**
-     * Gets the cfdaProgramTitleName attribute.
-     * 
-     * @return Returns the cfdaProgramTitleName
-     */
-    public String getCfdaProgramTitleName() {
-        return cfdaProgramTitleName;
-    }
-
-    /**
-     * Sets the cfdaProgramTitleName attribute.
-     * 
-     * @param cfdaProgramTitleName The cfdaProgramTitleName to set.
-     */
-    public void setCfdaProgramTitleName(String cfdaProgramTitleName) {
-        this.cfdaProgramTitleName = cfdaProgramTitleName;
-    }
-   
-    /**
-     * Gets the cfdaMaintenanceTypeId attribute.
-     * 
-     * @return Returns the cfdaMaintenanceTypeId
-     */
-    public String getCfdaMaintenanceTypeId() {
-        return cfdaMaintenanceTypeId;
-    }
-
-    /**
-     * Sets the cfdaMaintenanceTypeId attribute.
-     * 
-     * @param cfdaMaintenanceTypeId The cfdaMaintenanceTypeId to set.
-     */
-    public void setCfdaMaintenanceTypeId(String cfdaMaintenanceTypeId) {
-        this.cfdaMaintenanceTypeId = cfdaMaintenanceTypeId;
-    }
-
-    /**
-     * @see org.kuali.rice.kns.bo.BusinessObjectBase#toStringMapper()
-     */
-    protected LinkedHashMap toStringMapper() {
-        LinkedHashMap m = new LinkedHashMap();
-        m.put("cfdaNumber", this.cfdaNumber);
-        return m;
-    }
-
-    /**
-     * This method gets the active value.
-     * 
-     * @return The value of the active attribute.
-     */
-    public boolean isActive() {
-        return active;
-    }
-
-    /**
-     * This method sets the active for this object.
-     * 
-     * @param active The value to be assigned to the active attribute.
-     */
-    public void setActive(boolean active) {
-        this.active = active;
-    }
-}
Index: work/src/org/kuali/kfs/module/cg/businessobject/Proposal.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/businessobject/Proposal.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/businessobject/Proposal.java	(revision 37225)
@@ -24,6 +24,7 @@
 
 import org.apache.ojb.broker.PersistenceBroker;
 import org.apache.ojb.broker.PersistenceBrokerException;
+import org.kuali.kfs.coa.businessobject.CFDA;
 import org.kuali.kfs.integration.cg.ContractAndGrantsProposal;
 import org.kuali.kfs.module.cg.CGConstants;
 import org.kuali.kfs.sys.KFSConstants;
Index: work/src/org/kuali/kfs/module/cg/businessobject/options/CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/businessobject/options/CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/businessobject/options/CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder.java	(revision 37225)
@@ -1,78 +0,0 @@
-/*
- * Copyright 2007 The Kuali Foundation
- * 
- * Licensed under the Educational Community License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.opensource.org/licenses/ecl2.php
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.kuali.kfs.module.cg.businessobject.options;
-
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.Iterator;
-import java.util.List;
-
-import org.kuali.kfs.module.cg.businessobject.CFDA;
-import org.kuali.kfs.sys.context.SpringContext;
-import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
-import org.kuali.rice.kns.service.KeyValuesService;
-import org.kuali.rice.core.util.KeyLabelPair;
-
-/**
- * Allows some information about persisted {@link Cfda} instances to be looked up.
- */
-public class CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder extends KeyValuesBase {
-
-    /**
-     * Retrieves the list of possible CFDA Maintenance Type IDs and generates a collection with all the possible values.
-     * 
-     * @see org.kuali.keyvalues.KeyValuesFinder#getKeyValues()
-     */
-    public List getKeyValues() {
-
-        KeyValuesService boService = SpringContext.getBean(KeyValuesService.class);
-        Collection codes = boService.findAll(CFDA.class);
-
-        List<KeyLabelPair> labels = new ArrayList<KeyLabelPair>();
-        labels.add(new KeyLabelPair("", ""));
-
-        for (Iterator iter = codes.iterator(); iter.hasNext();) {
-            CFDA cfdaReference = (CFDA) iter.next();
-
-            if (!isDuplicateValue(labels, cfdaReference.getCfdaMaintenanceTypeId())) {
-                labels.add(new KeyLabelPair(cfdaReference.getCfdaMaintenanceTypeId(), cfdaReference.getCfdaMaintenanceTypeId()));
-            }
-        }
-
-        return labels;
-    }
-
-    /**
-     * This method determines if a value already exists in the collection.
-     * 
-     * @param collection The collection to be examined.
-     * @param value The value to be added to the collection if it does not already exist within it.
-     * @return True if the value passed in already exists in the collection, false otherwise.
-     */
-    private boolean isDuplicateValue(List<KeyLabelPair> collection, String value) {
-        boolean duplicate = false;
-
-        for (KeyLabelPair klp : collection) {
-            String klpLabel = klp.getLabel();
-            if (klpLabel != null) {
-                duplicate |= klpLabel.trim().equalsIgnoreCase(value.trim());
-            }
-        }
-
-        return duplicate;
-    }
-
-}
Index: work/src/org/kuali/kfs/module/cg/businessobject/datadictionary/CFDA.xml
===================================================================
--- work/src/org/kuali/kfs/module/cg/businessobject/datadictionary/CFDA.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/businessobject/datadictionary/CFDA.xml	(revision 37225)
@@ -1,147 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
-<!--
- Copyright 2007-2009 The Kuali Foundation
- 
- Licensed under the Educational Community License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
- 
- http://www.opensource.org/licenses/ecl2.php
- 
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-
-  <bean id="Cfda" parent="CFDA-parentBean"/>
-
-  <bean id="CFDA-parentBean" abstract="true" parent="BusinessObjectEntry">
-    <property name="businessObjectClass" value="org.kuali.kfs.module.cg.businessobject.CFDA"/>
-    <property name="inquiryDefinition">
-      <ref bean="CFDA-inquiryDefinition"/>
-    </property>
-    <property name="lookupDefinition">
-      <ref bean="CFDA-lookupDefinition"/>
-    </property>
-    <property name="objectLabel" value="CFDA Reference"/>
-    <property name="attributes">
-      <list>
-        <ref bean="CFDA-cfdaMaintenanceTypeId"/>
-        <ref bean="CFDA-cfdaNumber"/>
-        <ref bean="CFDA-cfdaProgramTitleName"/>
-        <ref bean="CFDA-active"/>
-      </list>
-    </property>
-  </bean>
-
-<!-- Attribute Definitions -->
-
-
-  <bean id="CFDA-cfdaMaintenanceTypeId" parent="CFDA-cfdaMaintenanceTypeId-parentBean"/>
-
-  <bean id="CFDA-cfdaMaintenanceTypeId-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="cfdaMaintenanceTypeId"/>
-    <property name="label" value="CFDA Maintenance Type Id"/>
-    <property name="shortLabel" value="Id"/>
-    <property name="maxLength" value="10"/>
-    <property name="validationPattern">
-      <ref bean="AnyCharacterValidation" />
-    </property>
-    <property name="control">
-      <bean parent="SelectControlDefinition" p:valuesFinderClass="org.kuali.kfs.module.cg.businessobject.options.CatalogOfFederalDomesticAssistanceMaintenanceTypeIdFinder" p:includeKeyInLabel="false"/>
-    </property>
-  </bean>
-  <bean id="CFDA-cfdaNumber" parent="CFDA-cfdaNumber-parentBean"/>
-
-  <bean id="CFDA-cfdaNumber-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="cfdaNumber"/>
-    <property name="forceUppercase" value="true"/>
-    <property name="label" value="CFDA Number"/>
-    <property name="shortLabel" value="Number"/>
-    <property name="maxLength" value="6"/>
-    <property name="validationPattern">
-      <ref bean="AnyCharacterValidation" />
-    </property>
-    <property name="control">
-      <bean parent="TextControlDefinition" p:size="8"/>
-    </property>
-  </bean>
-  <bean id="CFDA-cfdaProgramTitleName" parent="CFDA-cfdaProgramTitleName-parentBean"/>
-
-  <bean id="CFDA-cfdaProgramTitleName-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="cfdaProgramTitleName"/>
-    <property name="label" value="CFDA Program Title Name"/>
-    <property name="shortLabel" value="Name"/>
-    <property name="maxLength" value="300"/>
-    <property name="validationPattern">
-      <ref bean="AnyCharacterWithWhitespaceValidation" />
-    </property>
-    <property name="control">
-      <bean parent="TextareaControlDefinition" p:rows="5" p:cols="80"/>
-    </property>
-  </bean>
-  
-  <bean id="CFDA-active" parent="CFDA-active-parentBean"/>
-
-  <bean id="CFDA-active-parentBean" abstract="true" parent="GenericAttributes-activeIndicator">
-	<property name="name" value="active"/>
-  </bean>
-
-
-<!-- Business Object Inquiry Definition -->
-
-
-  <bean id="CFDA-inquiryDefinition" parent="CFDA-inquiryDefinition-parentBean"/>
-
-  <bean id="CFDA-inquiryDefinition-parentBean" abstract="true" parent="InquiryDefinition">
-    <property name="title" value="CFDA Reference Inquiry"/>
-    <property name="inquirySections">
-      <list>
-        <bean parent="InquirySectionDefinition">
-          <property name="title" value="Catalog of Federal Domestic Assistance Details"/>
-          <property name="numberOfColumns" value="1"/>
-          <property name="inquiryFields">
-            <list>
-              <bean parent="FieldDefinition" p:attributeName="cfdaMaintenanceTypeId"/>
-              <bean parent="FieldDefinition" p:attributeName="cfdaNumber"/>
-              <bean parent="FieldDefinition" p:attributeName="cfdaProgramTitleName"/>
-              <bean parent="FieldDefinition" p:attributeName="active"/>
-            </list>
-          </property>
-        </bean>
-      </list>
-    </property>
-  </bean>
-
-<!-- Business Object Lookup Definition -->
-
-
-  <bean id="CFDA-lookupDefinition" parent="CFDA-lookupDefinition-parentBean"/>
-
-  <bean id="CFDA-lookupDefinition-parentBean" abstract="true" parent="LookupDefinition">
-    <property name="title" value="CFDA Reference Lookup"/>
-    
-    <property name="defaultSort">
-      <bean parent="SortDefinition">
-      </bean>
-    </property>
-    <property name="lookupFields">
-      <list>
-        <bean parent="FieldDefinition" p:attributeName="cfdaMaintenanceTypeId"/>
-        <bean parent="FieldDefinition" p:attributeName="cfdaNumber"/>
-        <bean parent="FieldDefinition" p:attributeName="cfdaProgramTitleName"/>
-        <bean parent="FieldDefinition" p:attributeName="active"/>
-      </list>
-    </property>
-    <property name="resultFields">
-      <list>
-        <bean parent="FieldDefinition" p:attributeName="cfdaMaintenanceTypeId"/>
-        <bean parent="FieldDefinition" p:attributeName="cfdaNumber"/>
-        <bean parent="FieldDefinition" p:attributeName="cfdaProgramTitleName"/>
-        <bean parent="FieldDefinition" p:attributeName="active"/>
-      </list>
-    </property>
-  </bean>
-</beans>
Index: work/src/org/kuali/kfs/module/cg/CGConstants.java
===================================================================
--- work/src/org/kuali/kfs/module/cg/CGConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/CGConstants.java	(revision 37225)
@@ -41,10 +41,6 @@
 
     public static final String DROPDOWN_LIST_SELECT = "select:";
 
-    // System Parameters
-    public static final String RESULT_SUMMARY_TO_EMAIL_ADDRESSES = "RESULT_SUMMARY_TO_EMAIL_ADDRESSES";
-
-    public static final String SOURCE_URL_PARAMETER = "SOURCE_URL";
     
     public static final String MANUAL_BASE = "MN";
     public static final String MODIFIED_TOTAL_DIRECT_COST = "MT";
Index: work/src/org/kuali/kfs/module/cg/spring-cg.xml
===================================================================
--- work/src/org/kuali/kfs/module/cg/spring-cg.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/spring-cg.xml	(revision 37225)
@@ -56,17 +56,10 @@
 		<property name="jobNames">
 			<list>
 				<value>closeJob</value>
-				<value>cfdaJob</value>
 			</list>
 		</property>
-		<property name="triggerNames">
-			<list>
-				<value>cfdaJobTrigger</value>
-			</list>
-		</property>
 		<property name="externalizableBusinessObjectImplementations">
             <map>
-                <entry key="org.kuali.kfs.integration.cg.ContractsAndGrantsCfda" value="org.kuali.kfs.module.cg.businessobject.CFDA" />
                 <entry key="org.kuali.kfs.integration.cg.ContractsAndGrantsAccountAwardInformation" value="org.kuali.kfs.module.cg.businessobject.AwardAccount" />
                 <entry key="org.kuali.kfs.integration.cg.ContractsAndGrantsAward" value="org.kuali.kfs.module.cg.businessobject.Award" />
                 <entry key="org.kuali.kfs.integration.cg.ContractsAndGrantsAccountAwardInformation" value="org.kuali.kfs.module.cg.businessobject.AwardAccount" />
@@ -142,38 +135,6 @@
         </property>
     </bean>
 
-    <bean id="cfdaService" class="org.kuali.kfs.module.cg.service.impl.CfdaServiceImpl">
-        <property name="businessObjectService">
-            <ref bean="businessObjectService" />
-        </property>
-    </bean>
-	
-    <bean id="cfdaBatchStep" class="org.kuali.kfs.module.cg.batch.CfdaBatchStep" parent="step">
-        <property name="cfdaService">
-            <ref bean="cfdaService" />
-        </property>
-        <property name="mailService">
-            <ref bean="mailService" />
-        </property>
-        <property name="parameterService">
-            <ref bean="parameterService" />
-        </property>
-        <property name="configurationService" ref="kualiConfigurationService" />
-    </bean>
-
-    <bean id="cfdaJob" parent="scheduledJobDescriptor">
-		<property name="steps">
-			<list>
-				<ref bean="cfdaBatchStep" />
-			</list>
-		</property>
-	</bean>
-
-	<bean id="cfdaJobTrigger" parent="cronTrigger">
-		<property name="jobName" value="cfdaJob" />
-		<property name="cronExpression" value="00 00 00 1 1,4,7,10  ?" />
-	</bean>
-
     <bean id="closeBatchStep" class="org.kuali.kfs.module.cg.batch.CloseBatchStep" parent="step">
         <property name="closeService">
             <ref bean="closeService" />
Index: work/src/org/kuali/kfs/module/cg/document/datadictionary/CFDAMaintenanceDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/cg/document/datadictionary/CFDAMaintenanceDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/document/datadictionary/CFDAMaintenanceDocument.xml	(revision 37225)
@@ -1,68 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:dd="http://rice.kuali.org/dd" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd         http://rice.kuali.org/dd         http://rice.kuali.org/dd/dd.xsd">
-<!--
- Copyright 2008-2009 The Kuali Foundation
- 
- Licensed under the Educational Community License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
- 
- http://www.opensource.org/licenses/ecl2.php
- 
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-
-  <bean id="CFDAMaintenanceDocument" parent="CFDAMaintenanceDocument-parentBean"/>
-
-  <bean id="CFDAMaintenanceDocument-parentBean" abstract="true" parent="MaintenanceDocumentEntry">
-    <property name="businessObjectClass" value="org.kuali.kfs.module.cg.businessobject.CFDA"/>
-    <property name="maintainableClass" value="org.kuali.kfs.sys.document.FinancialSystemMaintainable"/>
-    <property name="maintainableSections">
-      <list>
-        <ref bean="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference"/>
-      </list>
-    </property>
-    <property name="lockingKeys">
-      <list>
-        <value>cfdaNumber</value>
-      </list>
-    </property>
-    
-    
-    
-    
-    
-    <property name="documentTypeName" value="CFDM"/>
-    <property name="documentAuthorizerClass" value="org.kuali.kfs.sys.document.authorization.FinancialSystemMaintenanceDocumentAuthorizerBase"/>
-    <property name="workflowAttributes">
-    	<ref bean="CFDAMaintenanceDocument-workflowAttributes"/>
-    </property>
-  </bean>
-
-<!-- Maintenance Section Definitions -->
-
-
-  <bean id="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference" parent="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference-parentBean"/>
-
-  <bean id="CFDAMaintenanceDocument-EditCatalogofFederalDomesticAssistanceReference-parentBean" abstract="true" parent="MaintainableSectionDefinition">
-    <property name="id" value="Edit Catalog of Federal Domestic Assistance Reference"/>
-    <property name="title" value="Edit Catalog of Federal Domestic Assistance Reference"/>
-    <property name="maintainableItems">
-      <list>
-        <bean parent="MaintainableFieldDefinition" p:name="cfdaNumber" p:required="true"/>
-        <bean parent="MaintainableFieldDefinition" p:name="cfdaProgramTitleName" p:required="true"/>
-        <bean parent="MaintainableFieldDefinition" p:name="cfdaMaintenanceTypeId" p:defaultValue="MANUAL" p:required="true"/>
-        <bean parent="MaintainableFieldDefinition" p:name="active" p:defaultValue="true"/>
-      </list>
-    </property>
-  </bean>
-
-	<!-- workflow attributes -->
-  	<bean id="CFDAMaintenanceDocument-workflowAttributes" parent="CFDAMaintenanceDocument-workflowAttributes-parentBean"/>
-  
-	<bean id="CFDAMaintenanceDocument-workflowAttributes-parentBean" class="org.kuali.rice.kns.datadictionary.WorkflowAttributes" abstract="true"/>
-
-</beans>
Index: work/src/org/kuali/kfs/module/cg/document/datadictionary/ProposalAwardCloseDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/cg/document/datadictionary/ProposalAwardCloseDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/cg/document/datadictionary/ProposalAwardCloseDocument.xml	(revision 37225)
@@ -23,6 +23,7 @@
     
     <property name="documentTypeName" value="CLOS"/>
     <property name="documentClass" value="org.kuali.kfs.module.cg.document.ProposalAwardCloseDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.cg.document.ProposalAwardCloseDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.cg.document.validation.impl.CloseDocumentRule"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.cg.document.authorization.CloseDocumentAuthorizer"/>
     <property name="workflowProperties">
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/EndowmentUnitShareAdjustmentDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/EndowmentUnitShareAdjustmentDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/EndowmentUnitShareAdjustmentDocument.xml	(revision 37225)
@@ -20,6 +20,7 @@
   <bean id="EndowmentUnitShareAdjustmentDocument-parentBean" abstract="true" parent="TransactionalDocumentEntry">
     <property name="documentTypeName" value="EUSA"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.EndowmentUnitShareAdjustmentDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.EndowmentUnitShareAdjustmentDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.EndowmentUnitShareAdjustmentDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.EndowmentUnitShareAdjustmentDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.EndowmentUnitShareAdjustmentDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/HoldingAdjustmentDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/HoldingAdjustmentDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/HoldingAdjustmentDocument.xml	(revision 37225)
@@ -20,6 +20,7 @@
   <bean id="HoldingAdjustmentDocument-parentBean" abstract="true" parent="TransactionalDocumentEntry">
     <property name="documentTypeName" value="EHA"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.HoldingAdjustmentDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.HoldingAdjustmentDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.HoldingAdjustmentDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.HoldingAdjustmentDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.HoldingAdjustmentDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/CashTransferDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/CashTransferDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/CashTransferDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     <property name="allowsErrorCorrection" value="true"/>    
     <property name="documentTypeName" value="ECT"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.CashTransferDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.CashTransferDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.CashTransferDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.CashTransferDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.CashTransferDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/CashIncreaseDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/CashIncreaseDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/CashIncreaseDocument.xml	(revision 37225)
@@ -20,6 +20,7 @@
   <bean id="CashIncreaseDocument-parentBean" abstract="true" parent="TransactionalDocumentEntry">
     <property name="documentTypeName" value="ECI"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.CashIncreaseDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.CashIncreaseDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.CashIncreaseDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.CashIncreaseDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.CashIncreaseDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/AssetIncreaseDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/AssetIncreaseDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/AssetIncreaseDocument.xml	(revision 37225)
@@ -22,6 +22,7 @@
     <property name="allowsCopy" value="true"/>
     <property name="documentTypeName" value="EAI"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.AssetIncreaseDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.AssetIncreaseDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.AssetIncreaseDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.AssetIncreaseDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.AssetIncreaseDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/LiabilityIncreaseDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/LiabilityIncreaseDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/LiabilityIncreaseDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     
     <property name="documentTypeName" value="ELI"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.LiabilityIncreaseDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.LiabilityIncreaseDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.LiabilityIncreaseDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.LiabilityIncreaseDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.LiabilityIncreaseDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/HoldingHistoryValueAdjustmentDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/HoldingHistoryValueAdjustmentDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/HoldingHistoryValueAdjustmentDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     
     <property name="documentTypeName" value="EHVA"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.HoldingHistoryValueAdjustmentDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.HoldingHistoryValueAdjustmentDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.HoldingHistoryValueAdjustmentDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.HoldingHistoryValueAdjustmentDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.HoldingHistoryValueAdjustmentDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/CorpusAdjustmentDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/CorpusAdjustmentDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/CorpusAdjustmentDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     
     <property name="documentTypeName" value="ECA"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.CorpusAdjustmentDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.CorpusAdjustmentDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.CorpusAdjustmentDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.CorpusAdjustmentDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.CorpusAdjustmentDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/CorporateReorganizationDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/CorporateReorganizationDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/CorporateReorganizationDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     
     <property name="documentTypeName" value="ECR"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.CorporateReorganizationDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.CorporateReorganizationDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.CorporateReorganizationDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.CorporateReorganizationDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.CorporateReorganizationDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/CashDecreaseDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/CashDecreaseDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/CashDecreaseDocument.xml	(revision 37225)
@@ -20,6 +20,7 @@
   <bean id="CashDecreaseDocument-parentBean" abstract="true" parent="TransactionalDocumentEntry">
     <property name="documentTypeName" value="ECDD"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.CashDecreaseDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.CashDecreaseDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.CashDecreaseDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.CashDecreaseDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.CashDecreaseDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/AssetDecreaseDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/AssetDecreaseDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/AssetDecreaseDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     
     <property name="documentTypeName" value="EAD"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.AssetDecreaseDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.AssetDecreaseDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.AssetDecreaseDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.AssetDecreaseDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.AssetDecreaseDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/SecurityTransferDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/SecurityTransferDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/SecurityTransferDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     
     <property name="documentTypeName" value="EST"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.SecurityTransferDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.SecurityTransferDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.SecurityTransferDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.SecurityTransferDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.SecurityTransferDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/LiabilityDecreaseDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/LiabilityDecreaseDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/LiabilityDecreaseDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     
     <property name="documentTypeName" value="ELD"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.LiabilityDecreaseDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.LiabilityDecreaseDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.LiabilityDecreaseDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.LiabilityDecreaseDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.LiabilityDecreaseDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/GLToEndowmentTransferOfFundsDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/GLToEndowmentTransferOfFundsDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/GLToEndowmentTransferOfFundsDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     <property name="allowsCopy" value="true"/>
     <property name="documentTypeName" value="GLET"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.GLToEndowmentTransferOfFundsDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.GLToEndowmentTransferOfFundsDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.GLToEndowmentTransferOfFundsDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.GLToEndowmentTransferOfFundsDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.GLToEndowmentTransferOfFundsDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/datadictionary/EndowmentToGLTransferOfFundsDocument.xml
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/datadictionary/EndowmentToGLTransferOfFundsDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/datadictionary/EndowmentToGLTransferOfFundsDocument.xml	(revision 37225)
@@ -21,6 +21,7 @@
     <property name="allowsCopy" value="true"/>
     <property name="documentTypeName" value="EGLT"/>
     <property name="documentClass" value="org.kuali.kfs.module.endow.document.EndowmentToGLTransferOfFundsDocument"/>
+    <property name="baseDocumentClass" value="org.kuali.kfs.module.endow.document.EndowmentToGLTransferOfFundsDocument"/>
     <property name="businessRulesClass" value="org.kuali.kfs.module.endow.document.validation.impl.EndowmentToGLTransferOfFundsDocumentRules"/>
     <property name="documentAuthorizerClass" value="org.kuali.kfs.module.endow.document.authorization.EndowmentToGLTransferOfFundsDocumentAuthorizer"/>
     <property name="documentPresentationControllerClass" value="org.kuali.kfs.module.endow.document.authorization.EndowmentToGLTransferOfFundsDocumentPresentationController"/>
Index: work/src/org/kuali/kfs/module/endow/document/EndowmentTransactionalDocumentBase.java
===================================================================
--- work/src/org/kuali/kfs/module/endow/document/EndowmentTransactionalDocumentBase.java	(revision 30259)
+++ work/src/org/kuali/kfs/module/endow/document/EndowmentTransactionalDocumentBase.java	(revision 37225)
@@ -244,13 +244,6 @@
         throw new UnsupportedOperationException("Cannot answer split question for this node you call \""+nodeName+"\"");
     }
 
-    protected BusinessObjectService getBusinessObjectService() {
-        if ( businessObjectService == null ) {
-            businessObjectService = SpringContext.getBean(BusinessObjectService.class);
-        }
-        return businessObjectService;
-    }
-
     public DateTimeService getDateTimeService() {
         if ( dateTimeService == null ) {
             dateTimeService = SpringContext.getBean(DateTimeService.class);
Index: work/src/org/kuali/kfs/vnd/batch/LoadEplsFileStep.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/LoadEplsFileStep.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/LoadEplsFileStep.java	(revision 37225)
@@ -0,0 +1,33 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch;
+
+import java.util.Date;
+
+import org.kuali.kfs.sys.batch.AbstractStep;
+import org.kuali.kfs.vnd.batch.service.VendorExcludeService;
+
+public class LoadEplsFileStep extends AbstractStep{
+    VendorExcludeService vendorExcludeService;
+    
+    public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
+        return vendorExcludeService.loadEplsFile();
+    }
+    
+    public void setVendorExcludeService(VendorExcludeService vendorExcludeService) {
+        this.vendorExcludeService = vendorExcludeService;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/batch/service/impl/VendorExcludeServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/service/impl/VendorExcludeServiceImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/service/impl/VendorExcludeServiceImpl.java	(revision 37225)
@@ -0,0 +1,252 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch.service.impl;
+
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+
+import org.apache.commons.io.IOUtils;
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.sys.batch.BatchInputFileType;
+import org.kuali.kfs.sys.batch.service.BatchInputFileService;
+import org.kuali.kfs.vnd.batch.dataaccess.DebarredVendorDao;
+import org.kuali.kfs.vnd.batch.dataaccess.DebarredVendorMatchDao;
+import org.kuali.kfs.vnd.batch.service.VendorExcludeService;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorDetail;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+import org.kuali.rice.kns.service.BusinessObjectService;
+import org.kuali.rice.kns.service.DateTimeService;
+import org.kuali.rice.kns.util.GlobalVariables;
+import org.springframework.transaction.annotation.Transactional;
+@Transactional
+public class VendorExcludeServiceImpl implements VendorExcludeService {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(VendorExcludeServiceImpl.class);
+
+    private BatchInputFileService batchInputFileService;
+    private BusinessObjectService businessObjectService;
+    private DateTimeService dateTimeService;
+    private BatchInputFileType batchInputFileType;
+    private DebarredVendorDao debarredVendorDao;
+    private DebarredVendorMatchDao debarredVendorMatchDao;
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.service.VendorExcludeService.loadEplsFile()
+     */
+    public boolean loadEplsFile() {
+        //  create a list of the files to process
+        List<String> fileNames = batchInputFileService.listInputFileNamesWithDoneFile(batchInputFileType);
+        String fileName = null;
+        long lastModified = 0;
+        if(fileNames.size() == 0) {
+            return true; 
+        }
+        File tempFile;
+        //Consider the latest file as the files are cumulative
+        for (String name : fileNames) {
+            tempFile = new File (name);
+            if(tempFile.lastModified() > lastModified) {
+                lastModified = tempFile.lastModified();
+                fileName = name;
+            }
+        }
+        if (fileName == null) {
+            LOG.error("BatchInputFileService.listInputFileNamesWithDoneFile(" + 
+                    batchInputFileType.getFileTypeIdentifer() + ") returned NULL which should never happen.");
+            throw new RuntimeException("BatchInputFileService.listInputFileNamesWithDoneFile(" + 
+                    batchInputFileType.getFileTypeIdentifer() + ") returned NULL which should never happen.");
+        }
+        byte[] fileByteContent;
+        List debarredVendorList = new ArrayList<DebarredVendorDetail> ();
+        try {
+            fileByteContent = IOUtils.toByteArray(new FileInputStream(fileName));
+        }
+        catch (FileNotFoundException ex) {
+            LOG.error("File not found [" + fileName + "]. " + ex.getMessage());
+            throw new RuntimeException("File not found [" + fileName + "]. " + ex.getMessage());
+        }
+        catch (IOException ex) {
+            LOG.error("IO Exception loading: [" + fileName + "]. " + ex.getMessage());
+            throw new RuntimeException("IO Exception loading: [" + fileName + "]. " + ex.getMessage());
+        }
+        Object parsedObject = batchInputFileService.parse(batchInputFileType, fileByteContent);
+        debarredVendorList = (List<DebarredVendorDetail>) parsedObject;
+        
+        purgeOldVendorRecords();
+        businessObjectService.save(debarredVendorList);
+        
+        removeDoneFiles(fileNames);
+        return true;
+    }
+    
+    /**
+     * Clears out associated .done files for the processed data files.
+     */
+    protected void removeDoneFiles(List<String> dataFileNames) {
+        for (String dataFileName : dataFileNames) {
+            File doneFile = new File(StringUtils.substringBeforeLast(dataFileName, ".") + ".done");
+            if (doneFile.exists()) {
+                doneFile.delete();
+            }
+        }
+    }
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.service.VendorExcludeService.matchVendors()
+     */
+    public boolean matchVendors() {
+        List<DebarredVendorMatch> matches = debarredVendorDao.match();
+        businessObjectService.save(matches);
+        return true;
+    }
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.service.VendorExcludeService.purgeOldVendorRecords()
+     */
+    public void purgeOldVendorRecords() {
+        businessObjectService.deleteMatching(DebarredVendorDetail.class, new HashMap());
+    }
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.service.VendorExcludeService.getDebarredVendorsUnmatched()
+     */ 
+    public List<VendorDetail> getDebarredVendorsUnmatched() {
+        return debarredVendorMatchDao.getDebarredVendorsUnmatched();          
+    }
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.service.VendorExcludeService.confirmDebarredVendor()
+     */
+    public void confirmDebarredVendor(int debarredVendorId) {
+        DebarredVendorMatch match = debarredVendorMatchDao.getDebarredVendor(debarredVendorId);
+        match.setConfirmStatusCode("C");
+        match.setLastUpdatedPrincipalName(GlobalVariables.getUserSession().getPerson().getPrincipalName());
+        match.setLastUpdatedTimeStamp(dateTimeService.getCurrentTimestamp());
+        businessObjectService.save(match);
+    }
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.service.VendorExcludeService.denyDebarredVendor()
+     */
+    public void denyDebarredVendor(int debarredVendorId) {
+        DebarredVendorMatch match = debarredVendorMatchDao.getDebarredVendor(debarredVendorId);
+        match.setConfirmStatusCode("D");
+        match.setLastUpdatedPrincipalName(GlobalVariables.getUserSession().getPerson().getPrincipalName());
+        match.setLastUpdatedTimeStamp(dateTimeService.getCurrentTimestamp());
+        businessObjectService.save(match);
+    }
+    
+    /**
+     * Gets the batchInputFileService attribute. 
+     * @return Returns the batchInputFileService.
+     */
+    public BatchInputFileService getBatchInputFileService() {
+        return batchInputFileService;
+    }
+
+    /**
+     * Sets the batchInputFileService attribute value.
+     * @param batchInputFileService The batchInputFileService to set.
+     */
+    public void setBatchInputFileService(BatchInputFileService batchInputFileService) {
+        this.batchInputFileService = batchInputFileService;
+    }
+
+    /**
+     * Gets the businessObjectService attribute. 
+     * @return Returns the businessObjectService.
+     */
+    public BusinessObjectService getBusinessObjectService() {
+        return businessObjectService;
+    }
+
+    /**
+     * Sets the businessObjectService attribute value.
+     * @param businessObjectService The businessObjectService to set.
+     */
+    public void setBusinessObjectService(BusinessObjectService businessObjectService) {
+        this.businessObjectService = businessObjectService;
+    }
+
+    /**
+     * Gets the dateTimeService attribute. 
+     * @return Returns the dateTimeService.
+     */
+    public DateTimeService getDateTimeService() {
+        return dateTimeService;
+    }
+
+    /**
+     * Sets the dateTimeService attribute value.
+     * @param dateTimeService The dateTimeService to set.
+     */
+    public void setDateTimeService(DateTimeService dateTimeService) {
+        this.dateTimeService = dateTimeService;
+    }
+
+    /**
+     * Gets the batchInputFileType attribute. 
+     * @return Returns the batchInputFileType.
+     */
+    public BatchInputFileType getBatchInputFileType() {
+        return batchInputFileType;
+    }
+
+    /**
+     * Sets the batchInputFileType attribute value.
+     * @param batchInputFileType The batchInputFileType to set.
+     */
+    public void setBatchInputFileType(BatchInputFileType batchInputFileType) {
+        this.batchInputFileType = batchInputFileType;
+    }
+
+    /**
+     * Gets the vendorExcludeDao attribute. 
+     * @return Returns the vendorExcludeDao.
+     */
+    public DebarredVendorDao getDebarredVendorDao() {
+        return debarredVendorDao;
+    }
+
+    /**
+     * Sets the vendorExcludeDao attribute value.
+     * @param vendorExcludeDao The vendorExcludeDao to set.
+     */
+    public void setDebarredVendorDao(DebarredVendorDao debarredVendorDao) {
+        this.debarredVendorDao = debarredVendorDao;
+    }
+
+    /**
+     * Gets the debarredVendorMatchDao attribute. 
+     * @return Returns the debarredVendorMatchDao.
+     */
+    public DebarredVendorMatchDao getDebarredVendorMatchDao() {
+        return debarredVendorMatchDao;
+    }
+
+    /**
+     * Sets the debarredVendorMatchDao attribute value.
+     * @param debarredVendorMatchDao The debarredVendorMatchDao to set.
+     */
+    public void setDebarredVendorMatchDao(DebarredVendorMatchDao debarredVendorMatchDao) {
+        this.debarredVendorMatchDao = debarredVendorMatchDao;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/batch/service/VendorExcludeService.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/service/VendorExcludeService.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/service/VendorExcludeService.java	(revision 37225)
@@ -0,0 +1,53 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch.service;
+
+import java.util.List;
+
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+
+public interface VendorExcludeService {
+    /**
+     * This method loads the epls file, retrieves and saves debarred vendors to a temp table in DB. 
+     */
+    public boolean loadEplsFile();
+    
+    /**
+     * This method retrieves the debarred vendors and match with the vendors in the system. Matches are stored in DB. 
+     */
+    public boolean matchVendors();
+    
+    /**
+     * This method purges the existing vendor records in MT table. 
+     */
+    public void purgeOldVendorRecords();
+    
+    /**
+     * This method returns the already debarred vendors in the system, which are not matched with the EPLS excluded vendors. 
+     */
+    public List<VendorDetail> getDebarredVendorsUnmatched();
+    
+    /**
+     * This method confirms the debarred vendor match record, as a debarred vendor in the DB.  
+     */
+    public void confirmDebarredVendor(int debarredVendorId);
+    
+    /**
+     * This method denies the debarred vendor match record in the DB.  
+     */
+    public void denyDebarredVendor(int debarredVendorId);
+}
Index: work/src/org/kuali/kfs/vnd/batch/VendorMatchStep.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/VendorMatchStep.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/VendorMatchStep.java	(revision 37225)
@@ -0,0 +1,35 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch;
+
+import java.util.Date;
+
+import org.kuali.kfs.sys.batch.AbstractStep;
+import org.kuali.kfs.vnd.batch.service.VendorExcludeService;
+
+public class VendorMatchStep extends AbstractStep {
+    VendorExcludeService vendorExcludeService;
+    
+    @Override
+    public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
+        return vendorExcludeService.matchVendors();
+    }
+    
+    public void setVendorExcludeService(VendorExcludeService vendorExcludeService) {
+        this.vendorExcludeService = vendorExcludeService;
+    }
+
+}
Index: work/src/org/kuali/kfs/vnd/batch/VendorExcludeInputFileType.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/VendorExcludeInputFileType.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/VendorExcludeInputFileType.java	(revision 37225)
@@ -0,0 +1,185 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch;
+
+import java.io.ByteArrayInputStream;
+import java.io.File;
+import java.io.IOException;
+import java.io.InputStreamReader;
+import java.sql.Date;
+import java.util.ArrayList;
+import java.util.List;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.module.purap.businessobject.ElectronicInvoice;
+import org.kuali.kfs.sys.batch.BatchInputFileTypeBase;
+import org.kuali.kfs.sys.exception.ParseException;
+import org.kuali.kfs.vnd.VendorConstants;
+import org.kuali.kfs.vnd.VendorKeyConstants;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorDetail;
+import org.kuali.rice.kns.service.DateTimeService;
+
+import au.com.bytecode.opencsv.CSVReader;
+
+public class VendorExcludeInputFileType extends BatchInputFileTypeBase{
+    
+    private static final String FILE_NAME_PREFIX = "epls_debarred_vendors_";
+    public static final int[] FIELD_SIZES = {200, 150, 50, 50, 20, 2, 20, 1000, 1000}; //Size limits for the fields
+    private String fileTypeIdentifier;
+    private DateTimeService dateTimeService;
+    
+    /**
+     * @return the electronic invoice file type identifier
+     */
+    public String getFileTypeIdentifer() {
+        return VendorConstants.VENDOR_EXCLUDE_FILE_TYPE_INDENTIFIER;
+    }
+    
+    /**
+     * doesn't do any validation
+     * @see org.kuali.kfs.sys.batch.BatchInputFileType#validate(java.lang.Object)
+     */
+    public boolean validate(Object parsedFileContents) {
+        return true;
+    }
+    
+    /**
+     * @see org.kuali.kfs.sys.batch.BatchInputType#getTitleKey()
+     */
+    public String getTitleKey() {
+        return VendorKeyConstants.MESSAGE_BATCH_UPLOAD_VENDOR_EXCLUDE;
+    }
+    
+    /** @see org.kuali.kfs.sys.batch.BatchInputFileType#getAuthorPrincipalName(File)
+     */
+    public String getAuthorPrincipalName(File file) {
+        return null;
+    }
+    
+    /**
+     * @see org.kuali.kfs.sys.batch.BatchInputFileType#process(java.lang.String, java.lang.Object)
+     */
+    public void process(String fileName, Object parsedFileContents) {
+        // does nothing
+    }
+    
+    /**
+     * @param principalName - not used
+     * @param parsedFileContents List - not used
+     * @param fileUserIdentifier - not used
+     * @return file name prefix appended by current date
+     * @see org.kuali.kfs.sys.batch.BatchInputFileType#getFileName(String, Object, String)
+     */
+    public String getFileName(String principalName, Object parsedFileContents, String fileUserIdentifuer) {
+        String fileName = FILE_NAME_PREFIX;
+        fileName += "_" + dateTimeService.toDateTimeStringForFilename(dateTimeService.getCurrentDate());
+        fileName = org.apache.commons.lang.StringUtils.remove(fileName, " ");
+
+        return fileName;
+    }
+
+    public Object parse(byte[] fileByteContent) throws ParseException {
+        CSVReader reader = new CSVReader(new InputStreamReader(new ByteArrayInputStream(fileByteContent)));
+        List <DebarredVendorDetail> debarredVendors = new ArrayList<DebarredVendorDetail>();
+        String[] nextLine;
+        DebarredVendorDetail vendor;
+        try {
+            nextLine = reader.readNext(); // skip first line
+            while ((nextLine = reader.readNext()) != null) {
+                vendor = new DebarredVendorDetail();
+                StringBuffer name = new StringBuffer();
+                if (StringUtils.isEmpty(nextLine[0])) {
+                    //If the name is empty then there must be a first/middle/last name
+                    name.append(StringUtils.remove(nextLine[1], "\"") + " " + StringUtils.remove(nextLine[2], "\""));
+                    if (nextLine.length > 3) {
+                        name.append(" " + StringUtils.remove(nextLine[3], "\""));
+                    }
+                    if (nextLine.length > 4) {
+                        name.append(" " + StringUtils.remove(nextLine[4], "\""));
+                    }
+                    if (nextLine.length > 5) {
+                        name.append(" " + StringUtils.remove(nextLine[5], "\""));
+                    }
+                } else {
+                    name.append(StringUtils.remove(nextLine[0], "\""));
+                }
+                vendor.setName(StringUtils.left(name.toString(), FIELD_SIZES[0]));
+                if (nextLine.length > 6) {
+                    vendor.setAddress1(StringUtils.left(nextLine[6], FIELD_SIZES[1]));
+                }
+                if (nextLine.length > 7) {
+                    vendor.setAddress2(StringUtils.left(nextLine[7], FIELD_SIZES[2]));
+                }
+                if (nextLine.length > 8) {
+                    vendor.setCity(StringUtils.left(nextLine[8], FIELD_SIZES[3]));
+                }
+                if (nextLine.length > 9) {
+                    vendor.setProvince(StringUtils.left(nextLine[9], FIELD_SIZES[4]));
+                }
+                if (nextLine.length > 10) {
+                    vendor.setState(StringUtils.left(nextLine[10], FIELD_SIZES[5]));
+                }
+                if (nextLine.length > 11) {
+                    vendor.setZip(StringUtils.left(nextLine[11], FIELD_SIZES[6]));
+                }
+                if (nextLine.length > 13) {
+                    vendor.setAliases(StringUtils.left(StringUtils.remove(nextLine[13], "\""), FIELD_SIZES[7]));
+                }
+                vendor.setLoadDate(new Date(new java.util.Date().getTime()));
+                if (nextLine.length > 18) {
+                    vendor.setDescription(StringUtils.left(nextLine[18], FIELD_SIZES[8]));
+                }
+                debarredVendors.add(vendor);
+            }
+        }
+        catch (IOException ex) {
+            throw new ParseException(ex.getMessage());
+        }
+        return debarredVendors;
+    }
+
+    /**
+     * Gets the fileTypeIdentifier attribute. 
+     * @return Returns the fileTypeIdentifier.
+     */
+    public String getFileTypeIdentifier() {
+        return fileTypeIdentifier;
+    }
+
+    /**
+     * Sets the fileTypeIdentifier attribute value.
+     * @param fileTypeIdentifier The fileTypeIdentifier to set.
+     */
+    public void setFileTypeIdentifier(String fileTypeIdentifier) {
+        this.fileTypeIdentifier = fileTypeIdentifier;
+    }
+
+    /**
+     * Gets the dateTimeService attribute. 
+     * @return Returns the dateTimeService.
+     */
+    public DateTimeService getDateTimeService() {
+        return dateTimeService;
+    }
+
+    /**
+     * Sets the dateTimeService attribute value.
+     * @param dateTimeService The dateTimeService to set.
+     */
+    public void setDateTimeService(DateTimeService dateTimeService) {
+        this.dateTimeService = dateTimeService;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorMatchDaoOjb.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorMatchDaoOjb.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorMatchDaoOjb.java	(revision 37225)
@@ -0,0 +1,113 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch.dataaccess;
+
+import java.util.List;
+
+import org.apache.ojb.broker.query.Criteria;
+import org.apache.ojb.broker.query.QueryByCriteria;
+import org.apache.ojb.broker.query.QueryFactory;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorDetail;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+import org.kuali.rice.kns.dao.impl.PlatformAwareDaoBaseOjb;
+
+public class DebarredVendorMatchDaoOjb extends  PlatformAwareDaoBaseOjb implements DebarredVendorMatchDao {
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.dataaccess.DebarredVendorMatchDao.getPreviousVendorExcludeConfirmation(org.kuali.kfs.vnd.businessobject.DebarredVendorMatch)
+     */
+    @Override
+    public DebarredVendorMatch getPreviousVendorExcludeConfirmation(DebarredVendorMatch match) {
+        Criteria criteria = new Criteria();
+        
+        criteria.addEqualTo("vendorHeaderGeneratedIdentifier", match.getVendorHeaderGeneratedIdentifier());
+        criteria.addEqualTo("vendorDetailAssignedIdentifier", match.getVendorDetailAssignedIdentifier());
+        
+        if (match.getName() != null) {
+            criteria.addEqualTo("upper(name)", match.getName().toUpperCase());
+        } else {
+            criteria.addIsNull("name");
+        }
+        if (match.getAddress1() != null) {
+            criteria.addEqualTo("upper(address1)", match.getAddress1().toUpperCase());
+        } else {
+            criteria.addIsNull("address1");
+        }
+        if (match.getAddress2() != null) {
+            criteria.addEqualTo("upper(address2)", match.getAddress2().toUpperCase());
+        } else {
+            criteria.addIsNull("address2");
+        }
+        if (match.getCity() != null) {
+            criteria.addEqualTo("upper(city)", match.getCity().toUpperCase());
+        } else {
+            criteria.addIsNull("city");
+        }
+        if (match.getState() != null) {
+            criteria.addEqualTo("upper(state)", match.getState().toUpperCase());
+        } else {
+            criteria.addIsNull("state");
+        }
+        if (match.getZip() != null) {
+            criteria.addEqualTo("zip", match.getZip());
+        } else {
+            criteria.addIsNull("zip");
+        }
+        QueryByCriteria query = QueryFactory.newQuery(DebarredVendorMatch.class, criteria);
+        List<DebarredVendorMatch> matches = (List<DebarredVendorMatch>)getPersistenceBrokerTemplate().getCollectionByQuery(query);
+        
+        DebarredVendorMatch oldMatch = null;
+        if (matches.size() > 0) {
+            oldMatch = matches.get(0);
+        }
+        return oldMatch;
+    }
+    
+    /**
+     * @see org.kuali.kfs.vnd.batch.dataaccess.DebarredVendorMatchDao.getDebarredVendorsUnmatched()
+     */
+    public List<VendorDetail> getDebarredVendorsUnmatched() {
+        
+        Criteria subcr = new Criteria();
+        subcr.addEqualToField("vendorHeaderGeneratedIdentifier", Criteria.PARENT_QUERY_PREFIX + "vendorHeaderGeneratedIdentifier");
+        subcr.addEqualToField("vendorDetailAssignedIdentifier", Criteria.PARENT_QUERY_PREFIX + "vendorDetailAssignedIdentifier");
+        Criteria orcr = new Criteria();     
+        orcr.addEqualTo("confirmStatusCode", "C");
+        Criteria orcr2 = new Criteria();        
+        orcr2.addEqualTo("confirmStatusCode", "U");
+        orcr.addOrCriteria(orcr2);
+        subcr.addAndCriteria(orcr);
+        QueryByCriteria subqr = QueryFactory.newQuery(DebarredVendorMatch.class, subcr);
+
+        Criteria criteria = new Criteria();
+        criteria.addEqualTo("vendorHeader.vendorDebarredIndicator", "Y");
+        criteria.addNotExists(subqr);
+        QueryByCriteria query = QueryFactory.newQuery(VendorDetail.class, criteria);
+        List<VendorDetail> vendors = (List<VendorDetail>) getPersistenceBrokerTemplate().getCollectionByQuery(query);
+
+        return vendors;
+      }
+
+    @Override
+    public DebarredVendorMatch getDebarredVendor(int debarredVendorId) {
+        Criteria criteria = new Criteria();
+        criteria.addEqualTo("debarredVendorId", debarredVendorId);
+        QueryByCriteria query = QueryFactory.newQuery(DebarredVendorMatch.class, criteria);
+        return (DebarredVendorMatch)getPersistenceBrokerTemplate().getObjectByQuery(query);
+    }
+
+}
Index: work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorMatchDao.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorMatchDao.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorMatchDao.java	(revision 37225)
@@ -0,0 +1,45 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch.dataaccess;
+
+import java.util.List;
+
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+
+public interface DebarredVendorMatchDao {
+    /**
+     * If the exact same match already exists in the Vendor exclude match table, this
+     * method will find that match and return
+     * @param match the specified match to compare with.
+     * @return the already existing match
+     */
+    public DebarredVendorMatch getPreviousVendorExcludeConfirmation(DebarredVendorMatch match);
+    
+    /**
+     * This method returns the list of already debarred vendors in the system, but unmatched with
+     * EPLS exclude vendors
+     * @return list of already debarred vendors
+     */
+    public List<VendorDetail> getDebarredVendorsUnmatched();
+    
+    /**
+     * This method returns a particular debarred vendor match, given the debarred vendor id
+     * @param debarred vendor id
+     * @return corresponding debarred vendor match
+     */
+    public DebarredVendorMatch getDebarredVendor(int debarredVendorId);
+}
Index: work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorDao.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorDao.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorDao.java	(revision 37225)
@@ -0,0 +1,28 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch.dataaccess;
+
+import java.util.List;
+
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+
+public interface DebarredVendorDao {
+    /**
+     * Match the vendors excluded in EPLS with the active vendors in EPIC based on their names, aliases, and addresses. 
+     * @return the match results as a list of vendor exclude confirmations.
+     */
+    public List<DebarredVendorMatch> match();
+}
Index: work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorDaoJdbc.java
===================================================================
--- work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorDaoJdbc.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/batch/dataaccess/DebarredVendorDaoJdbc.java	(revision 37225)
@@ -0,0 +1,258 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.batch.dataaccess;
+
+import java.sql.Connection;
+import java.sql.ResultSet;
+import java.sql.Statement;
+import java.util.ArrayList;
+import java.util.Iterator;
+import java.util.List;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.ojb.broker.PersistenceBroker;
+import org.apache.ojb.broker.query.Criteria;
+import org.apache.ojb.broker.query.QueryFactory;
+import org.apache.ojb.broker.query.ReportQueryByCriteria;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorDetail;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+import org.kuali.kfs.vnd.document.service.VendorService;
+import org.kuali.kfs.vnd.businessobject.VendorAddress;
+import org.kuali.rice.kns.dao.jdbc.PlatformAwareDaoBaseJdbc;
+import org.springframework.jdbc.support.rowset.SqlRowSet;
+
+public class DebarredVendorDaoJdbc extends  PlatformAwareDaoBaseJdbc implements DebarredVendorDao {
+    private VendorService vendorService;
+    private DebarredVendorMatchDao debarredVendorMatchDao;
+
+    @Override
+    public List<DebarredVendorMatch> match() {
+        String active = "dtl.DOBJ_MAINT_CD_ACTV_IND = 'Y'";
+        String joinDtl = " INNER JOIN pur_vndr_dtl_t dtl";
+        String joinExcl = " INNER JOIN PUR_VNDR_EXCL_MT excl";
+        String where = " WHERE " + active;
+        String eplsFields = "excl.VNDR_EXCL_ID, excl.VNDR_EXCL_LOAD_DT, excl.VNDR_EXCL_NM, excl.VNDR_EXCL_LN1_ADDR, excl.VNDR_EXCL_LN2_ADDR, excl.VNDR_EXCL_CTY_NM" +
+        		", excl.VNDR_EXCL_ST_CD, excl.VNDR_EXCL_PRVN_NM, excl.VNDR_EXCL_ZIP_CD, excl.VNDR_EXCL_OTHR_NM, excl.VNDR_EXCL_DESC_TXT";
+            
+        String selectName = "SELECT dtl.VNDR_HDR_GNRTD_ID, dtl.VNDR_DTL_ASND_ID, " + eplsFields + " , 0 VNDR_ADDR_GNRTD_ID";
+        String fromName = " FROM pur_vndr_dtl_t dtl";
+        String name = filter("dtl.VNDR_NM", "., ");
+        String eplsName = filter("excl.VNDR_EXCL_NM", "., ");
+        String onName = " ON " + compare(name, eplsName, false); // use = to compare        
+        String sqlName = selectName + fromName + joinExcl + onName + where;
+
+        String selectAlias = "SELECT als.VNDR_HDR_GNRTD_ID, als.VNDR_DTL_ASND_ID, " + eplsFields + " , 0 VNDR_ADDR_GNRTD_ID";
+        String fromAlias = " FROM pur_vndr_alias_t als";
+        String onAlsDtl = " ON als.VNDR_HDR_GNRTD_ID = dtl.VNDR_HDR_GNRTD_ID AND als.VNDR_DTL_ASND_ID = dtl.VNDR_DTL_ASND_ID";
+        String alias = filter("als.VNDR_ALIAS_NM", "., ");
+        String eplsAlias = filter("excl.VNDR_EXCL_NM", "., ");
+        String onAlias = " ON " + compare(alias, eplsAlias, false); // use = to compare     
+        String sqlAlias = selectAlias + fromAlias + joinDtl + onAlsDtl + joinExcl + onAlias + where;
+        
+        String selectAddr = "SELECT addr.VNDR_HDR_GNRTD_ID, addr.VNDR_DTL_ASND_ID, " + eplsFields + " , addr.VNDR_ADDR_GNRTD_ID";
+        String fromAddr = " FROM pur_vndr_addr_t addr";
+        String onAddrDtl = " ON addr.VNDR_HDR_GNRTD_ID = dtl.VNDR_HDR_GNRTD_ID AND addr.VNDR_DTL_ASND_ID = dtl.VNDR_DTL_ASND_ID";
+        //
+        String addr1 = filter("addr.VNDR_LN1_ADDR", ".,# ");
+        String eplsAddr1 = filter("excl.VNDR_EXCL_LN1_ADDR", ".,# ");
+        String cmpAddr1 = compare(addr1, eplsAddr1, true); // use LIKE to compare
+        //
+        String city = filter("addr.VNDR_CTY_NM", "., ");
+        String eplsCity = filter("excl.VNDR_EXCL_CTY_NM", "., ");
+        String cmpCity = compare(city, eplsCity, false); // use = to compare
+        //
+        String state = "upper(addr.VNDR_ST_CD)";
+        String eplsState = "upper(excl.VNDR_EXCL_ST_CD)";
+        String cmpState = compare(state, eplsState, false); // use = to compare
+        //
+        String zip = filter("addr.VNDR_ZIP_CD", "-");
+        String eplsZip = filter("excl.VNDR_EXCL_ZIP_CD", "-");
+        String cmpZip = compare(zip, eplsZip, false); // use = to compare
+        String fullZip = "length(addr.VNDR_ZIP_CD) > 5";
+        //
+        String onAddr = " ON (" + cmpAddr1 + " OR " + cmpZip + " AND " + fullZip + ") AND " + cmpCity + " AND " + cmpState;
+        String sqlAddr = selectAddr + fromAddr + joinDtl + onAddrDtl + joinExcl + onAddr + where;       
+        
+        String max = ", MAX(VNDR_ADDR_GNRTD_ID)";
+        String selectFields = "VNDR_HDR_GNRTD_ID, VNDR_DTL_ASND_ID, VNDR_EXCL_ID, VNDR_EXCL_LOAD_DT, VNDR_EXCL_NM, VNDR_EXCL_LN1_ADDR, VNDR_EXCL_LN2_ADDR, VNDR_EXCL_CTY_NM" +
+                ", VNDR_EXCL_ST_CD, VNDR_EXCL_PRVN_NM, VNDR_EXCL_ZIP_CD, VNDR_EXCL_OTHR_NM, VNDR_EXCL_DESC_TXT";
+        String select = "SELECT " + selectFields + max;
+        String subqr = sqlName + " UNION " + sqlAlias + " UNION " + sqlAddr;            
+        String from = " FROM (" + subqr + ")";      
+        String group = " GROUP BY " + selectFields;
+        String sql = select + from + group;
+
+        
+        List<DebarredVendorMatch> matches = new ArrayList<DebarredVendorMatch>();             
+        try {    
+            SqlRowSet rs = getJdbcTemplate().queryForRowSet(sql);
+            DebarredVendorMatch match;
+            
+            while(rs.next()) {
+                match = new DebarredVendorMatch();        
+                match.setVendorHeaderGeneratedIdentifier(new Integer(rs.getInt(1)));
+                match.setVendorDetailAssignedIdentifier(new Integer(rs.getInt(2)));
+                match.setLoadDate(rs.getDate(4));
+                match.setName(rs.getString(5));
+                match.setAddress1(rs.getString(6));
+                match.setAddress2(rs.getString(7));
+                match.setCity(rs.getString(8));
+                match.setState(rs.getString(9));
+                match.setProvince(rs.getString(10));
+                match.setZip(rs.getString(11));
+                match.setAliases(rs.getString(12));
+                match.setDescription(rs.getString(13));
+                match.setAddressGeneratedId(rs.getLong(14));
+                // didn't find a matched address, search for best one
+                if (match.getAddressGeneratedId() == 0) { 
+                    match.setAddressGeneratedId(getMatchAddressId(match)); 
+                }
+                
+                DebarredVendorMatch oldMatch = debarredVendorMatchDao.getPreviousVendorExcludeConfirmation(match);
+                if (oldMatch == null) {
+                    // store the match only if an exact old match doesn't exist
+                    match.setConfirmStatusCode("U"); // status - Unprocessed
+                    matches.add(match);                 
+                }
+            }           
+        } catch (Exception e) {
+            // if exception occurs, return empty results
+            throw new RuntimeException(e);
+        }
+
+        return matches;
+    }
+    
+    /**
+     * Gets the addressGeneratedId of the vendor address that matches best with the address of the 
+     * EPLS debarred vendor in the specified vendor exclude match.
+     * If no address matches, returns the default address for IU campus.
+     */
+    protected long getMatchAddressId(DebarredVendorMatch match) {
+        long bestid = 0;
+        long defaultId = 0;
+        int maxPriority = 0; 
+        List<VendorAddress> addresses = vendorService.getVendorDetail(match.getVendorHeaderGeneratedIdentifier(), 
+                match.getVendorDetailAssignedIdentifier()).getVendorAddresses();
+        if (addresses == null ) { 
+            return bestid;
+        }
+        
+        for (VendorAddress address : addresses) {     
+            if (address.isVendorDefaultAddressIndicator()) {
+                defaultId = address.getVendorAddressGeneratedIdentifier();
+            }
+            //each condition satisfied will increase the priority score for this address
+            int priority = 0;
+            String vendorAddr1 = StringUtils.replaceChars(address.getVendorLine1Address(), ".,# ", "");
+            String eplsAddr1 = StringUtils.replaceChars(match.getAddress1(), ".,# ", "");
+            if (StringUtils.equalsIgnoreCase(vendorAddr1, eplsAddr1)) {
+                priority++;
+            }
+            String vendorCity = StringUtils.replaceChars(address.getVendorCityName(), "., ", "");
+            String eplsCity = StringUtils.replaceChars(match.getCity(), "., ", "");
+            if (StringUtils.equalsIgnoreCase(vendorCity, eplsCity)) {
+                priority++;
+            }
+            if (StringUtils.equalsIgnoreCase(address.getVendorStateCode(), match.getState())) {
+                priority++;
+            }
+            String vendorZip = StringUtils.substring(address.getVendorZipCode(), 0, 5);
+            String eplsZip = StringUtils.substring(match.getZip(), 0, 5);
+            if (StringUtils.equals(vendorZip, eplsZip)) {
+                priority++;
+            }
+            if (priority >= maxPriority) {
+                bestid = address.getVendorAddressGeneratedIdentifier();
+                maxPriority = priority;
+            }
+        }
+        if (bestid == 0) {
+            bestid = defaultId;
+        }
+        return bestid;
+    }
+    
+    protected String filter(String field, String charset) {
+        // add upper function
+        String upper = "upper(" + field + ")";      
+        if (charset == null)
+            return upper;
+        
+        // add replace functions layer by layer to filter out the chars in the charset one by one
+        String replace = upper;
+        char[] chararr = charset.toCharArray();
+        for (char ch : chararr) {
+            // replace with empty string
+            replace = "replace(" + replace + ", '" + ch + "', '')"; 
+        }       
+        return replace;
+    }
+    
+    protected String compare(String fieldl, String fieldr, boolean useLike) {
+        String cmpstr = "";
+        
+        // whether neither field is null
+        String notnulll = fieldl + " IS NOT NULL";
+        String notnullr = fieldr + " IS NOT NULL";
+        
+        if (useLike) { 
+            // whether one of the two fields is substring of the other 
+            String like1 = notnullr + " AND " + fieldl + " LIKE '%'||" + fieldr + "||'%'";
+            String like2 = notnulll + " AND " + fieldr + " LIKE '%'||" + fieldl + "||'%'";          
+            cmpstr += "(" + like1 + " OR " + like2 + ")"; // put () around the 'OR' to ensure integrity
+        }
+        else { 
+            // whether the two fields equal
+            cmpstr = notnulll + " AND " + fieldl + " = " + fieldr;
+        }
+        
+        return cmpstr;
+    }
+
+    /**
+     * Gets the vendorService attribute. 
+     * @return Returns the vendorService.
+     */
+    public VendorService getVendorService() {
+        return vendorService;
+    }
+
+    /**
+     * Sets the vendorService attribute value.
+     * @param vendorService The vendorService to set.
+     */
+    public void setVendorService(VendorService vendorService) {
+        this.vendorService = vendorService;
+    }
+
+    /**
+     * Gets the debarredVendorMatchDao attribute. 
+     * @return Returns the debarredVendorMatchDao.
+     */
+    public DebarredVendorMatchDao getDebarredVendorMatchDao() {
+        return debarredVendorMatchDao;
+    }
+
+    /**
+     * Sets the debarredVendorMatchDao attribute value.
+     * @param debarredVendorMatchDao The debarredVendorMatchDao to set.
+     */
+    public void setDebarredVendorMatchDao(DebarredVendorMatchDao debarredVendorMatchDao) {
+        this.debarredVendorMatchDao = debarredVendorMatchDao;
+    }
+
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/DebarredVendorDetail.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/DebarredVendorDetail.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/DebarredVendorDetail.java	(revision 37225)
@@ -0,0 +1,218 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject;
+
+import java.util.Date;
+import java.util.LinkedHashMap;
+
+import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
+
+public class DebarredVendorDetail extends PersistableBusinessObjectBase {
+    private int debarredVendorId;
+    private Date loadDate;
+    private String name;
+    private String address1;
+    private String address2;
+    private String city;
+    private String state;
+    private String province;
+    private String zip;
+    private String aliases;
+    private String description;
+    
+    /**
+     * Gets the debarredVendorId attribute. 
+     * @return Returns the debarredVendorId.
+     */
+    public int getDebarredVendorId() {
+        return debarredVendorId;
+    }
+
+    /**
+     * Sets the debarredVendorId attribute value.
+     * @param debarredVendorId The debarredVendorId to set.
+     */
+    public void setDebarredVendorId(int debarredVendorId) {
+        this.debarredVendorId = debarredVendorId;
+    }
+
+    /**
+     * Gets the loadDate attribute. 
+     * @return Returns the loadDate.
+     */
+    public Date getLoadDate() {
+        return loadDate;
+    }
+
+    /**
+     * Sets the loadDate attribute value.
+     * @param loadDate The loadDate to set.
+     */
+    public void setLoadDate(Date loadDate) {
+        this.loadDate = loadDate;
+    }
+
+    /**
+     * Gets the name attribute. 
+     * @return Returns the name.
+     */
+    public String getName() {
+        return name;
+    }
+
+    /**
+     * Sets the name attribute value.
+     * @param name The name to set.
+     */
+    public void setName(String name) {
+        this.name = name;
+    }
+
+    /**
+     * Gets the address1 attribute. 
+     * @return Returns the address1.
+     */
+    public String getAddress1() {
+        return address1;
+    }
+
+    /**
+     * Sets the address1 attribute value.
+     * @param address1 The address1 to set.
+     */
+    public void setAddress1(String address1) {
+        this.address1 = address1;
+    }
+
+    /**
+     * Gets the address2 attribute. 
+     * @return Returns the address2.
+     */
+    public String getAddress2() {
+        return address2;
+    }
+
+    /**
+     * Sets the address2 attribute value.
+     * @param address2 The address2 to set.
+     */
+    public void setAddress2(String address2) {
+        this.address2 = address2;
+    }
+
+    /**
+     * Gets the city attribute. 
+     * @return Returns the city.
+     */
+    public String getCity() {
+        return city;
+    }
+
+    /**
+     * Sets the city attribute value.
+     * @param city The city to set.
+     */
+    public void setCity(String city) {
+        this.city = city;
+    }
+
+    /**
+     * Gets the stateOrCountry attribute. 
+     * @return Returns the stateOrCountry.
+     */
+    public String getState() {
+        return state;
+    }
+
+    /**
+     * Sets the stateOrCountry attribute value.
+     * @param stateOrCountry The stateOrCountry to set.
+     */
+    public void setState(String state) {
+        this.state = state;
+    }
+
+    /**
+     * Gets the province attribute. 
+     * @return Returns the province.
+     */
+    public String getProvince() {
+        return province;
+    }
+
+    /**
+     * Sets the province attribute value.
+     * @param country The province to set.
+     */
+    public void setProvince(String province) {
+        this.province = province;
+    }
+
+    /**
+     * Gets the zip attribute. 
+     * @return Returns the zip.
+     */
+    public String getZip() {
+        return zip;
+    }
+
+    /**
+     * Sets the zip attribute value.
+     * @param zip The zip to set.
+     */
+    public void setZip(String zip) {
+        this.zip = zip;
+    }
+    
+    /**
+     * Gets the alias attribute. 
+     * @return Returns the alias.
+     */
+    public String getAliases() {
+        return aliases;
+    }
+
+    /**
+     * Sets the alias attribute value.
+     * @param alias The alias to set.
+     */
+    public void setAliases(String aliases) {
+        this.aliases = aliases;
+    }
+
+    /**
+     * Gets the description attribute. 
+     * @return Returns the description.
+     */
+    public String getDescription() {
+        return description;
+    }
+
+    /**
+     * Sets the description attribute value.
+     * @param description The description to set.
+     */
+    public void setDescription(String description) {
+        this.description = description;
+    }
+
+    @Override
+    protected LinkedHashMap toStringMapper() {
+        LinkedHashMap toString = new LinkedHashMap();
+        toString.put("debarredVendorId", debarredVendorId);
+        return toString;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/datadictionary/VendorExclusion.xml
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/datadictionary/VendorExclusion.xml	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/datadictionary/VendorExclusion.xml	(revision 37225)
@@ -0,0 +1,349 @@
+<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:dd="http://rice.kuali.org/dd" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd         http://rice.kuali.org/dd         http://rice.kuali.org/dd/dd.xsd">
+
+  <bean id="VendorExclusion" parent="VendorExclusion-parentBean"/>
+
+  <bean id="VendorExclusion-parentBean" abstract="true" parent="BusinessObjectEntry">
+    <property name="businessObjectClass" value="org.kuali.kfs.vnd.businessobject.DebarredVendorMatch"/>
+    <property name="inquiryDefinition">
+      <ref bean="VendorExclusion-inquiryDefinition"/>
+    </property>
+    <property name="lookupDefinition">
+      <ref bean="VendorExclusion-lookupDefinition"/>
+    </property>
+    <property name="titleAttribute" value="debarredVendorId"/>
+    <property name="objectLabel" value="Vendor Exclusion"/>
+    <property name="attributes">
+      <list>
+        <ref bean="VendorExclusion-debarredVendorId"/>
+        <ref bean="VendorExclusion-name"/>
+        <ref bean="VendorExclusion-address1"/>
+        <ref bean="VendorExclusion-city"/>
+        <ref bean="VendorExclusion-state"/>
+        <ref bean="VendorExclusion-province"/>
+        <ref bean="VendorExclusion-zip"/>
+        <ref bean="VendorExclusion-aliases"/>
+        <ref bean="VendorExclusion-description"/>
+        <ref bean="VendorExclusion-confirmStatusCode"/>
+        <ref bean="VendorExclusion-lastUpdatedTimeStamp"/>
+        <ref bean="VendorExclusion-lastUpdatedPrincipalName"/>
+        <ref bean="VendorExclusion-vendorHeader.vendorTypeCode"/>
+        <ref bean="VendorExclusion-vendorExclusionStatus"/>
+        <ref bean="VendorExclusion-concatenatedId"/>
+        <ref bean="VendorExclusion-concatenatedAliases"/>
+        <ref bean="VendorExclusion-vendorDetail.vendorNumber"/>
+        <ref bean="VendorExclusion-vendorDetail.vendorName"/>
+        <ref bean="VendorExclusion-vendorAddress.vendorLine1Address"/>
+        <ref bean="VendorExclusion-vendorAddress.vendorCityName"/>
+        <ref bean="VendorExclusion-vendorAddress.vendorAddressInternationalProvinceName"/>
+        <ref bean="VendorExclusion-vendorAddress.vendorStateCode"/>
+        <ref bean="VendorExclusion-vendorAddress.vendorZipCode"/>
+      </list>
+    </property>
+  </bean>
+
+<!-- Attribute Definitions -->
+
+
+  <bean id="VendorExclusion-debarredVendorId" parent="VendorExclusion-debarredVendorId-parentBean"/>
+
+  <bean id="VendorExclusion-debarredVendorId-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="debarredVendorId"/>
+    <property name="label" value="EPLS #"/>
+    <property name="maxLength" value="10"/>
+    <property name="required" value="true"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="10"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-name" parent="VendorExclusion-name-parentBean"/>
+
+  <bean id="VendorExclusion-name-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="name"/>
+    <property name="label" value="EPLS Vendor Name"/>
+    <property name="shortLabel" value="Vendor Name/EPLS Name"/>
+    <property name="maxLength" value="200"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="200"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-address1" parent="VendorExclusion-address1-parentBean"/>
+
+  <bean id="VendorExclusion-address1-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="address1"/>
+    <property name="label" value="EPLS Address"/>
+    <property name="shortLabel" value="Address"/>
+    <property name="maxLength" value="150"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="150"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-city" parent="VendorExclusion-city-parentBean"/>
+
+  <bean id="VendorExclusion-city-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="city"/>
+    <property name="label" value="EPLS City"/>
+    <property name="shortLabel" value="Vendor City/EPLS City"/>
+    <property name="maxLength" value="50"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="50"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-state" parent="VendorExclusion-state-parentBean"/>
+  
+  <bean id="VendorExclusion-state-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="state"/>
+    <property name="label" value="EPLS State/Country"/>
+    <property name="shortLabel" value="Vendor State-Country / EPLS State-Country"/>
+    <property name="maxLength" value="2"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="2"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-province" parent="VendorExclusion-province-parentBean"/>
+  
+  <bean id="VendorExclusion-province-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="province"/>
+    <property name="label" value="EPLS Province"/>
+    <property name="shortLabel" value="Province"/>
+    <property name="maxLength" value="50"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="50"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-zip" parent="VendorExclusion-zip-parentBean"/>
+  
+  <bean id="VendorExclusion-zip-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="zip"/>
+    <property name="label" value="EPLS Zip"/>
+    <property name="shortLabel" value="Zip"/>
+    <property name="maxLength" value="20"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="20"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-aliases" parent="VendorExclusion-aliases-parentBean"/>
+  
+  <bean id="VendorExclusion-aliases-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="aliases"/>
+    <property name="label" value="EPLS Aliases"/>
+    <property name="shortLabel" value="Aliases"/>
+    <property name="maxLength" value="1000"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="1000"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-description" parent="VendorExclusion-description-parentBean"/>
+  
+  <bean id="VendorExclusion-description-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="description"/>
+    <property name="label" value="EPLS Notes"/>
+    <property name="shortLabel" value="Notes"/>
+    <property name="maxLength" value="1000"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="1000"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-confirmStatusCode" parent="VendorExclusion-confirmStatusCode-parentBean"/>
+  
+  <bean id="VendorExclusion-confirmStatusCode-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="confirmStatusCode"/>
+    <property name="label" value="Confirm Match Status"/>
+    <property name="shortLabel" value="Status"/>
+    <property name="maxLength" value="1"/>
+    <property name="control">
+      <bean parent="SelectControlDefinition" p:valuesFinderClass="org.kuali.kfs.vnd.businessobject.options.VendorExclusionConfirmStatusValuesFinder"/>
+    </property>
+    <property name="formatterClass" value="org.kuali.kfs.vnd.businessobject.format.DebarredVendorConfirmStatusFormatter"/>
+  </bean>
+  
+  <bean id="VendorExclusion-lastUpdatedTimeStamp" parent="VendorExclusion-lastUpdatedTimeStamp-parentBean"/>
+  
+  <bean id="VendorExclusion-lastUpdatedTimeStamp-parentBean" abstract="true" parent="GenericAttributes-genericDate">
+    <property name="name" value="lastUpdatedTimeStamp"/>
+    <property name="label" value="Last Updated Date"/>
+    <property name="shortLabel" value="Updated"/>
+    <property name="maxLength" value="7"/>
+  </bean>
+  
+  <bean id="VendorExclusion-lastUpdatedPrincipalName" parent="VendorExclusion-lastUpdatedPrincipalName-parentBean"/>
+  
+  <bean id="VendorExclusion-lastUpdatedPrincipalName-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="lastUpdatedPrincipalName"/>
+    <property name="label" value="Last Updated Person"/>
+    <property name="shortLabel" value="Updated Person"/>
+    <property name="maxLength" value="100"/>
+    <property name="control">
+      <bean parent="TextControlDefinition" p:size="100"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorHeader.vendorTypeCode" parent="VendorExclusion-vendorHeader.vendorTypeCode-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorHeader.vendorTypeCode-parentBean" abstract="true" parent="VendorHeader-vendorTypeCode">
+    <property name="name" value="vendorHeader.vendorTypeCode"/>
+    <property name="control">
+      <bean parent="SelectControlDefinition" p:valuesFinderClass="org.kuali.kfs.vnd.businessobject.options.ExclusionVendorTypeValuesFinder"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorExclusionStatus" parent="VendorExclusion-vendorExclusionStatus-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorExclusionStatus-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="vendorExclusionStatus"/>
+    <property name="label" value="Vendor Exclusion Status"/>
+    <property name="shortLabel" value="Exclusion Status"/>
+    <property name="maxLength" value="1"/>
+    <property name="control">
+      <bean parent="SelectControlDefinition" p:valuesFinderClass="org.kuali.kfs.vnd.businessobject.options.VendorExclusionStatusValuesFinder"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-concatenatedId" parent="VendorExclusion-concatenatedId-parentBean"/>
+  
+  <bean id="VendorExclusion-concatenatedId-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="concatenatedId"/>
+    <property name="label" value="Vendor # / EPLS #"/>
+   <property name="control">
+      <bean parent="TextControlDefinition" p:size="100"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-concatenatedAliases" parent="VendorExclusion-concatenatedAliases-parentBean"/>
+  
+  <bean id="VendorExclusion-concatenatedAliases-parentBean" abstract="true" parent="AttributeDefinition">
+    <property name="name" value="concatenatedAliases"/>
+    <property name="label" value="Aliases"/>
+   <property name="control">
+      <bean parent="TextControlDefinition" p:size="1000"/>
+    </property>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorDetail.vendorNumber" parent="VendorExclusion-vendorDetail.vendorNumber-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorDetail.vendorNumber-parentBean" abstract="true" parent="VendorDetail-vendorNumber">
+    <property name="name" value="vendorDetail.vendorNumber"/>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorDetail.vendorName" parent="VendorExclusion-vendorDetail.vendorName-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorDetail.vendorName-parentBean" abstract="true" parent="VendorDetail-vendorName">
+    <property name="name" value="vendorDetail.vendorName"/>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorLine1Address" parent="VendorExclusion-vendorAddress.vendorLine1Address-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorLine1Address-parentBean" abstract="true" parent="VendorAddress-vendorLine1Address">
+    <property name="name" value="vendorAddress.vendorLine1Address"/>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorCityName" parent="VendorExclusion-vendorAddress.vendorCityName-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorCityName-parentBean" abstract="true" parent="VendorAddress-vendorCityName">
+    <property name="name" value="vendorAddress.vendorCityName"/>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorAddressInternationalProvinceName" parent="VendorExclusion-vendorAddress.vendorAddressInternationalProvinceName-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorAddressInternationalProvinceName-parentBean" abstract="true" parent="VendorAddress-vendorAddressInternationalProvinceName">
+    <property name="name" value="vendorAddress.vendorAddressInternationalProvinceName"/>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorStateCode" parent="VendorExclusion-vendorAddress.vendorStateCode-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorStateCode-parentBean" abstract="true" parent="VendorAddress-vendorStateCode">
+    <property name="name" value="vendorAddress.vendorStateCode"/>
+  </bean>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorZipCode" parent="VendorExclusion-vendorAddress.vendorZipCode-parentBean"/>
+  
+  <bean id="VendorExclusion-vendorAddress.vendorZipCode-parentBean" abstract="true" parent="VendorAddress-vendorZipCode">
+    <property name="name" value="vendorAddress.vendorZipCode"/>
+  </bean>
+  
+<!-- Business Object Inquiry Definition -->
+
+  <bean id="VendorExclusion-inquiryDefinition" parent="VendorExclusion-inquiryDefinition-parentBean"/>
+
+  <bean id="VendorExclusion-inquiryDefinition-parentBean" abstract="true" parent="InquiryDefinition">
+    <property name="title" value="Vendor Exclusion Inquiry"/>
+    <property name="inquirableClass" value="org.kuali.kfs.vnd.businessobject.inquiry.VendorExclusionInquirable"/>
+    <property name="inquirySections">
+      <list>
+        <bean parent="InquirySectionDefinition">
+          <property name="title" value="General Information"/>
+          <property name="numberOfColumns" value="2"/>
+          <property name="inquiryFields">
+            <list>
+              <bean parent="FieldDefinition" p:attributeName="confirmStatusCode"/>
+              <bean parent="FieldDefinition" p:attributeName="vendorHeader.vendorTypeCode"/>
+              <bean parent="FieldDefinition" p:attributeName="lastUpdatedTimeStamp"/>
+              <bean parent="FieldDefinition" p:attributeName="description"/>
+              <bean parent="FieldDefinition" p:attributeName="lastUpdatedPrincipalName"/>
+            </list>
+          </property>
+        </bean>
+        <bean parent="InquirySectionDefinition">
+          <property name="title" value="Matching Fields"/>
+          <property name="numberOfColumns" value="2"/>
+          <property name="inquiryFields">
+            <list>
+              <bean parent="FieldDefinition" p:attributeName="vendorDetail.vendorNumber"/>
+              <bean parent="FieldDefinition" p:attributeName="debarredVendorId"/>
+              <bean parent="FieldDefinition" p:attributeName="vendorDetail.vendorName"/>
+              <bean parent="FieldDefinition" p:attributeName="name"/>
+              <bean parent="FieldDefinition" p:attributeName="concatenatedAliases"/>
+              <bean parent="FieldDefinition" p:attributeName="aliases"/>
+              <bean parent="FieldDefinition" p:attributeName="vendorAddress.vendorLine1Address"/>
+              <bean parent="FieldDefinition" p:attributeName="address1"/>
+              <bean parent="FieldDefinition" p:attributeName="vendorAddress.vendorCityName"/>
+              <bean parent="FieldDefinition" p:attributeName="city"/>
+              <bean parent="FieldDefinition" p:attributeName="vendorAddress.vendorAddressInternationalProvinceName"/>
+              <bean parent="FieldDefinition" p:attributeName="province"/>
+              <bean parent="FieldDefinition" p:attributeName="vendorAddress.vendorStateCode"/>
+              <bean parent="FieldDefinition" p:attributeName="state"/>
+              <bean parent="FieldDefinition" p:attributeName="vendorAddress.vendorZipCode"/>
+              <bean parent="FieldDefinition" p:attributeName="zip"/>
+            </list>
+          </property>
+        </bean>
+      </list>
+    </property>
+  </bean>
+
+<!-- Business Object Lookup Definition -->
+
+
+  <bean id="VendorExclusion-lookupDefinition" parent="VendorExclusion-lookupDefinition-parentBean"/>
+
+  <bean id="VendorExclusion-lookupDefinition-parentBean" abstract="true" parent="LookupDefinition">
+    <property name="title" value="Vendor Exclusion Lookup"/>
+    <property name="resultSetLimit" value="-1"/>
+    <property name="lookupableID" value="vendorExclusionLookupable" />
+    <property name="lookupFields">
+      <list>
+        <bean parent="FieldDefinition" p:attributeName="vendorHeader.vendorTypeCode"/> 
+        <bean parent="FieldDefinition" p:attributeName="confirmStatusCode"/>
+        <bean parent="FieldDefinition" p:attributeName="vendorExclusionStatus" p:required="true"/>
+      </list>
+    </property>
+    <property name="resultFields">
+      <list>
+        <bean parent="FieldDefinition" p:attributeName="concatenatedId"/>
+        <bean parent="FieldDefinition" p:attributeName="name" p:useShortLabel="true"/>
+        <bean parent="FieldDefinition" p:attributeName="city" p:useShortLabel="true"/>
+        <bean parent="FieldDefinition" p:attributeName="state" p:useShortLabel="true"/>
+        <bean parent="FieldDefinition" p:attributeName="vendorHeader.vendorTypeCode"/>
+        <bean parent="FieldDefinition" p:attributeName="confirmStatusCode"/>
+      </list>
+    </property>
+  </bean>
+</beans>
Index: work/src/org/kuali/kfs/vnd/businessobject/datadictionary/DebarredUnmatchedVendor.xml
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/datadictionary/DebarredUnmatchedVendor.xml	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/datadictionary/DebarredUnmatchedVendor.xml	(revision 37225)
@@ -0,0 +1,77 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<beans xmlns="http://www.springframework.org/schema/beans"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
+	xmlns:dd="http://rice.kuali.org/dd"
+	xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd         http://rice.kuali.org/dd         http://rice.kuali.org/dd/dd.xsd">
+
+	<bean id="DebarredVendorUnmatched" parent="DebarredVendorUnmatched-parentBean" />
+
+	<bean id="DebarredVendorUnmatched-parentBean" abstract="true" parent="VendorDetail">
+		<property name="businessObjectClass" value="org.kuali.kfs.vnd.businessobject.DebarredUnmatchedVendor"/>
+		<property name="lookupDefinition">
+			<ref bean="DebarredVendorUnmatched-lookupDefinition" />
+		</property>
+		<property name="objectLabel" value="Debarred Unmatched Vendors" />
+		<property name="attributes">
+      		<list merge="true">
+      			<ref bean="DebarredVendorUnmatched-defaultAddressCity"/>
+      			<ref bean="DebarredVendorUnmatched-defaultAddressStateCode"/>
+      			<ref bean="DebarredVendorUnmatched-defaultAddressCountryCode"/>
+      			<ref bean="DebarredVendorUnmatched-vendorTypeCode"/>
+      		</list>
+      	</property>	
+	</bean>
+	
+	<bean id="DebarredVendorUnmatched-defaultAddressCity" parent="DebarredVendorUnmatched-defaultAddressCity-parentBean" />
+
+	<bean id="DebarredVendorUnmatched-defaultAddressCity-parentBean" abstract="true" parent="VendorAddress-vendorCityName">
+		<property name="name" value="defaultAddressCity" />
+	</bean>
+	
+	<bean id="DebarredVendorUnmatched-defaultAddressStateCode" parent="DebarredVendorUnmatched-defaultAddressStateCode-parentBean" />
+
+	<bean id="DebarredVendorUnmatched-defaultAddressStateCode-parentBean" abstract="true" parent="VendorAddress-vendorStateCode">
+		<property name="name" value="defaultAddressStateCode" />
+	</bean>
+	
+	<bean id="DebarredVendorUnmatched-defaultAddressCountryCode" parent="DebarredVendorUnmatched-defaultAddressCountryCode-parentBean" />
+
+	<bean id="DebarredVendorUnmatched-defaultAddressCountryCode-parentBean" abstract="true" parent="VendorAddress-vendorCountryCode">
+		<property name="name" value="defaultAddressCountryCode" />
+	</bean>
+  
+  <bean id="DebarredVendorUnmatched-vendorTypeCode" parent="DebarredVendorUnmatched-vendorTypeCode-parentBean"/>
+  
+  <bean id="DebarredVendorUnmatched-vendorTypeCode-parentBean" abstract="true" parent="VendorHeader-vendorTypeCode">
+ 	 <property name="name" value="vendorTypeCode"/>
+     <property name="control">
+     	 <bean parent="SelectControlDefinition" p:valuesFinderClass="org.kuali.kfs.vnd.businessobject.options.ExclusionVendorTypeValuesFinder"/>
+     </property>
+  </bean>
+
+	<!-- Business Object Lookup Definition -->
+
+
+	<bean id="DebarredVendorUnmatched-lookupDefinition" parent="DebarredVendorUnmatched-lookupDefinition-parentBean" />
+
+	<bean id="DebarredVendorUnmatched-lookupDefinition-parentBean" abstract="true"
+		parent="LookupDefinition">
+		<property name="title" value="Debarred Unmatched Vendor Lookup" />
+		<property name="lookupableID" value="debarredVendorUnmatchedLookupable" />
+		<property name="lookupFields">
+			<list>
+				<bean parent="FieldDefinition" p:attributeName="vendorTypeCode" />
+			</list>
+		</property>
+		<property name="resultFields">
+			<list>
+				<bean parent="FieldDefinition" p:attributeName="vendorNumber" />
+				<bean parent="FieldDefinition" p:attributeName="vendorName" p:useShortLabel="true" />
+				<bean parent="FieldDefinition" p:attributeName="defaultAddressCity" p:useShortLabel="true" />
+				<bean parent="FieldDefinition" p:attributeName="defaultAddressStateCode" p:useShortLabel="true" />
+				<bean parent="FieldDefinition" p:attributeName="vendorHeader.vendorTypeCode" />
+			</list>
+		</property>
+	</bean>
+
+</beans>
\ No newline at end of file
Index: work/src/org/kuali/kfs/vnd/businessobject/OwnershipType.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/OwnershipType.java	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/businessobject/OwnershipType.java	(revision 37225)
@@ -27,7 +27,7 @@
  * 
  * @see org.kuali.kfs.vnd.businessobject.OwnershipCategory
  */
-public class OwnershipType extends DocumentBase implements Inactivateable{
+public class OwnershipType extends PersistableBusinessObjectBase implements Inactivateable{
 
     protected String vendorOwnershipCode;
     protected String vendorOwnershipDescription;
Index: work/src/org/kuali/kfs/vnd/businessobject/lookup/DebarredVendorUnmatchedLookupableHelperServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/lookup/DebarredVendorUnmatchedLookupableHelperServiceImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/lookup/DebarredVendorUnmatchedLookupableHelperServiceImpl.java	(revision 37225)
@@ -0,0 +1,98 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject.lookup;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+
+import org.apache.cxf.common.util.StringUtils;
+import org.kuali.kfs.vnd.VendorConstants;
+import org.kuali.kfs.vnd.VendorPropertyConstants;
+import org.kuali.kfs.vnd.batch.service.VendorExcludeService;
+import org.kuali.kfs.vnd.businessobject.VendorAddress;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+import org.kuali.kfs.vnd.document.service.VendorService;
+import org.kuali.rice.kns.bo.BusinessObject;
+import org.kuali.rice.kns.lookup.KualiLookupableHelperServiceImpl;
+
+public class DebarredVendorUnmatchedLookupableHelperServiceImpl extends KualiLookupableHelperServiceImpl {
+    VendorExcludeService vendorExcludeService;
+    VendorService vendorService;
+    
+    @Override
+    public List<? extends BusinessObject> getSearchResults(Map<String, String> fieldValues) {
+        return getDebarredVendorUnmatchedSearchResults(fieldValues);
+    }
+
+    @Override
+    public List<? extends BusinessObject> getSearchResultsUnbounded(Map<String, String> fieldValues) {
+        return getDebarredVendorUnmatchedSearchResults(fieldValues);
+    }
+    
+    protected List<? extends BusinessObject> getDebarredVendorUnmatchedSearchResults(Map<String, String> fieldValues) {
+        List<VendorDetail> vendorResultList = vendorExcludeService.getDebarredVendorsUnmatched();
+        List<VendorDetail> filteredVendorList = new ArrayList<VendorDetail> ();
+        VendorAddress defaultAddress;
+        String vendorType = fieldValues.get("vendorTypeCode");
+        for (VendorDetail vendor : vendorResultList) {
+            if (!StringUtils.isEmpty(vendorType) && !vendor.getVendorHeader().getVendorTypeCode().equals(vendorType)) {
+                continue;
+            }
+            defaultAddress = vendorService.getVendorDefaultAddress(vendor.getVendorAddresses(), vendor.getVendorHeader().getVendorType().getAddressType().getVendorAddressTypeCode(), "");
+            if (defaultAddress != null ) {
+                vendor.setDefaultAddressLine1(defaultAddress.getVendorLine1Address());
+                vendor.setDefaultAddressCity(defaultAddress.getVendorCityName());
+                vendor.setDefaultAddressStateCode(defaultAddress.getVendorStateCode());
+                vendor.setDefaultAddressCountryCode(defaultAddress.getVendorCountryCode());
+            }
+            filteredVendorList.add(vendor);
+        }
+        return filteredVendorList;
+    }
+    
+    /**
+     * Gets the vendorExcludeService attribute. 
+     * @return Returns the vendorExcludeService.
+     */
+    public VendorExcludeService getVendorExcludeService() {
+        return vendorExcludeService;
+    }
+
+    /**
+     * Sets the vendorExcludeService attribute value.
+     * @param vendorExcludeService The vendorExcludeService to set.
+     */
+    public void setVendorExcludeService(VendorExcludeService vendorExcludeService) {
+        this.vendorExcludeService = vendorExcludeService;
+    }
+
+    /**
+     * Gets the vendorService attribute. 
+     * @return Returns the vendorService.
+     */
+    public VendorService getVendorService() {
+        return vendorService;
+    }
+
+    /**
+     * Sets the vendorService attribute value.
+     * @param vendorService The vendorService to set.
+     */
+    public void setVendorService(VendorService vendorService) {
+        this.vendorService = vendorService;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/lookup/VendorExclusionLookupableHelperServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/lookup/VendorExclusionLookupableHelperServiceImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/lookup/VendorExclusionLookupableHelperServiceImpl.java	(revision 37225)
@@ -0,0 +1,226 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject.lookup;
+
+import java.util.ArrayList;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+import java.util.Properties;
+
+import org.kuali.kfs.integration.cam.CapitalAssetManagementAsset;
+import org.kuali.kfs.module.cam.CamsConstants;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.vnd.VendorConstants;
+import org.kuali.kfs.vnd.VendorPropertyConstants;
+import org.kuali.kfs.vnd.batch.service.VendorExcludeService;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+import org.kuali.kfs.vnd.businessobject.VendorAddress;
+import org.kuali.kfs.vnd.businessobject.VendorAlias;
+import org.kuali.kfs.vnd.businessobject.VendorDetail;
+import org.kuali.kfs.vnd.document.service.VendorService;
+import org.kuali.rice.kns.bo.BusinessObject;
+import org.kuali.rice.kns.lookup.HtmlData;
+import org.kuali.rice.kns.lookup.KualiLookupableHelperServiceImpl;
+import org.kuali.rice.kns.lookup.HtmlData.AnchorHtmlData;
+import org.kuali.rice.kns.service.KualiConfigurationService;
+import org.kuali.rice.kns.util.KNSConstants;
+import org.kuali.rice.kns.util.ObjectUtils;
+import org.kuali.rice.kns.util.UrlFactory;
+import org.kuali.rice.kns.web.format.Formatter;
+
+public class VendorExclusionLookupableHelperServiceImpl extends KualiLookupableHelperServiceImpl{
+    VendorExcludeService vendorExcludeService;
+    VendorService vendorService;
+    KualiConfigurationService kualiConfigurationService;
+    
+    private String confirmStatusFieldValue="";
+    
+    /**
+     * Custom action urls for Asset.
+     * 
+     * @see org.kuali.rice.kns.lookup.AbstractLookupableHelperServiceImpl#getCustomActionUrls(org.kuali.rice.kns.bo.BusinessObject,
+     *      List pkNames)
+     */
+    @Override
+    public List<HtmlData> getCustomActionUrls(BusinessObject bo, List pkNames) {
+        List<HtmlData> anchorHtmlDataList = super.getCustomActionUrls(bo, pkNames);
+        anchorHtmlDataList.add(getInquiryUrl(bo));
+        anchorHtmlDataList.add(getEditUrl(bo));
+        anchorHtmlDataList.add(getConfirmUrl(bo));
+        anchorHtmlDataList.add(getDenyUrl(bo));
+        return anchorHtmlDataList;
+    }
+    
+    protected String getVendorInquiryUrl(DebarredVendorMatch match) {
+        Properties properties = new Properties();
+        properties.put(KFSConstants.DISPATCH_REQUEST_PARAMETER, KFSConstants.START_METHOD);
+        properties.put(KFSConstants.BUSINESS_OBJECT_CLASS_ATTRIBUTE, VendorDetail.class.getName());
+        properties.put("vendorDetailAssignedIdentifier", new Integer(match.getVendorDetailAssignedIdentifier()).toString());
+        properties.put("vendorHeaderGeneratedIdentifier", new Integer(match.getVendorHeaderGeneratedIdentifier()).toString());
+        
+        return UrlFactory.parameterizeUrl(KNSConstants.INQUIRY_ACTION, properties); 
+    }
+    
+    protected HtmlData getInquiryUrl(BusinessObject bo){
+        Properties properties = new Properties();
+        properties.put(KFSConstants.DISPATCH_REQUEST_PARAMETER, KFSConstants.START_METHOD);
+        properties.put("debarredVendorId", new Integer(((DebarredVendorMatch)bo).getDebarredVendorId()).toString());
+        properties.put(KFSConstants.BUSINESS_OBJECT_CLASS_ATTRIBUTE, DebarredVendorMatch.class.getName());
+        
+        String href = UrlFactory.parameterizeUrl(KNSConstants.INQUIRY_ACTION, properties); 
+        AnchorHtmlData anchorHtmlData = new AnchorHtmlData(href, KFSConstants.START_METHOD, "Inquiry");
+        anchorHtmlData.setTarget(KFSConstants.NEW_WINDOW_URL_TARGET);
+        return anchorHtmlData;
+    }
+    
+    protected HtmlData getEditUrl(BusinessObject bo){
+        String label = "edit";
+        Integer vendorDetailAssignedIdentifier = ((DebarredVendorMatch)bo).getVendorDetailAssignedIdentifier();
+        Integer vendorHeaderGeneratedIdentifier = ((DebarredVendorMatch)bo).getVendorHeaderGeneratedIdentifier();
+        VendorDetail vendor = vendorService.getVendorDetail(vendorHeaderGeneratedIdentifier, vendorDetailAssignedIdentifier);
+        VendorDetail parent;
+        if (!vendor.isVendorParentIndicator()) {
+            label = "edit parent";
+            parent = vendorService.getParentVendor(vendorHeaderGeneratedIdentifier);
+            vendorDetailAssignedIdentifier = parent.getVendorDetailAssignedIdentifier();
+            vendorHeaderGeneratedIdentifier = parent.getVendorHeaderGeneratedIdentifier();
+        }
+        
+        Properties properties = new Properties();
+        properties.put(KFSConstants.DISPATCH_REQUEST_PARAMETER, KFSConstants.MAINTENANCE_EDIT_METHOD_TO_CALL);
+        properties.put(VendorPropertyConstants.VENDOR_HEADER_GENERATED_ID, vendorHeaderGeneratedIdentifier.toString());
+        properties.put(VendorPropertyConstants.VENDOR_DETAIL_ASSIGNED_ID, vendorDetailAssignedIdentifier.toString());
+        properties.put(KFSConstants.BUSINESS_OBJECT_CLASS_ATTRIBUTE, VendorDetail.class.getName());
+        String href = UrlFactory.parameterizeUrl(KFSConstants.MAINTENANCE_ACTION, properties); 
+        AnchorHtmlData anchorHtmlData = new AnchorHtmlData(href, KFSConstants.MAINTENANCE_EDIT_METHOD_TO_CALL, label);
+        anchorHtmlData.setTarget(KFSConstants.NEW_WINDOW_URL_TARGET);
+        return anchorHtmlData;
+    }
+    
+    protected HtmlData getConfirmUrl(BusinessObject bo){
+        Properties properties = new Properties();
+        properties.put(KFSConstants.DISPATCH_REQUEST_PARAMETER, "confirmDebarredVendor");
+        properties.put(DebarredVendorMatch.CONFIRM_STATUS, confirmStatusFieldValue);
+        properties.put(DebarredVendorMatch.DEBARRED_VENDOR_ID, String.valueOf(((DebarredVendorMatch)bo).getDebarredVendorId()));
+        properties.put(KFSConstants.BUSINESS_OBJECT_CLASS_ATTRIBUTE, DebarredVendorMatch.class.getName());
+        properties.put("returnLocation", kualiConfigurationService.getPropertyString(KFSConstants.APPLICATION_URL_KEY)+ "/kr/lookup.do");
+        properties.put(DebarredVendorMatch.EXCLUSION_STATUS, ((DebarredVendorMatch)bo).getVendorExclusionStatus());
+        
+        String href = UrlFactory.parameterizeUrl("vendorExclusion.do", properties); 
+        href = kualiConfigurationService.getPropertyString(KFSConstants.APPLICATION_URL_KEY)+"/"+ href;
+        AnchorHtmlData anchorHtmlData = new AnchorHtmlData(href, KFSConstants.START_METHOD, "confirm");
+        return anchorHtmlData;
+    }
+    
+    protected HtmlData getDenyUrl(BusinessObject bo){
+        Properties properties = new Properties();
+        properties.put(KFSConstants.DISPATCH_REQUEST_PARAMETER, "denyDebarredVendor");
+        properties.put(DebarredVendorMatch.CONFIRM_STATUS, confirmStatusFieldValue);
+        properties.put(DebarredVendorMatch.DEBARRED_VENDOR_ID, String.valueOf(((DebarredVendorMatch)bo).getDebarredVendorId()));
+        properties.put(KFSConstants.BUSINESS_OBJECT_CLASS_ATTRIBUTE, DebarredVendorMatch.class.getName());
+        properties.put("returnLocation", kualiConfigurationService.getPropertyString(KFSConstants.APPLICATION_URL_KEY)+ "/kr/lookup.do");
+        properties.put("formKey", "88888888");
+        
+        String href = UrlFactory.parameterizeUrl("vendorExclusion.do", properties); 
+        href = kualiConfigurationService.getPropertyString(KFSConstants.APPLICATION_URL_KEY)+"/"+ href;
+        AnchorHtmlData anchorHtmlData = new AnchorHtmlData(href, KFSConstants.START_METHOD, "deny");
+        return anchorHtmlData;
+    }
+    
+    @Override
+    public List<? extends BusinessObject> getSearchResults(Map<String, String> fieldValues) {
+        return getDebarredVendorSearchResults(fieldValues);
+    }
+
+    @Override
+    public List<? extends BusinessObject> getSearchResultsUnbounded(Map<String, String> fieldValues) {
+        return getDebarredVendorSearchResults(fieldValues);
+    }
+    
+    protected List<? extends BusinessObject> getDebarredVendorSearchResults(Map<String, String> fieldValues) {
+        List<DebarredVendorMatch> vendorResultList = new ArrayList<DebarredVendorMatch>();
+        String exclusionStatus = fieldValues.get(DebarredVendorMatch.EXCLUSION_STATUS);
+        confirmStatusFieldValue = fieldValues.get(DebarredVendorMatch.CONFIRM_STATUS);
+        fieldValues.remove(DebarredVendorMatch.EXCLUSION_STATUS);
+        List<DebarredVendorMatch> searchResults = (List<DebarredVendorMatch>) super.getSearchResults(fieldValues);
+        boolean status = exclusionStatus.equals(VendorConstants.EXCLUDED_MATCHED_VENDOR_STATUS) ? true : false;
+        boolean debarred;
+        for (DebarredVendorMatch match : searchResults) {
+            debarred = match.getVendorHeader().getVendorDebarredIndicator() == null ? false : match.getVendorHeader().getVendorDebarredIndicator();
+            if ((status && debarred) || (!status && !debarred)) {
+                match.setConcatenatedId("<a href=\"" + getVendorInquiryUrl(match) + "\">" + match.getVendorDetail().getVendorNumber() + "</a> / " + 
+                        "<a href=\"http://www.epls.gov/epls/search.do?ssn=true&ssn_name=" + match.getName() + "&ssn_tin=" + 
+                        match.getVendorHeader().getVendorTaxNumber() + "\">" + match.getDebarredVendorId() + "</a>");
+                match.setName(match.getVendorDetail().getVendorName() + " / " + match.getName());
+                match.setCity(match.getVendorAddress().getVendorCityName() + " / " + match.getCity());
+                match.setState(match.getVendorAddress().getVendorStateCode() == null ? match.getVendorAddress().getVendorCountryCode() : match.getVendorAddress().getVendorStateCode() + " / " + match.getState());
+                match.setVendorExclusionStatus(exclusionStatus);
+                vendorResultList.add(match);
+            }
+        }
+        return vendorResultList;
+    }
+
+    /**
+     * Gets the vendorExcludeService attribute. 
+     * @return Returns the vendorExcludeService.
+     */
+    public VendorExcludeService getVendorExcludeService() {
+        return vendorExcludeService;
+    }
+
+    /**
+     * Sets the vendorExcludeService attribute value.
+     * @param vendorExcludeService The vendorExcludeService to set.
+     */
+    public void setVendorExcludeService(VendorExcludeService vendorExcludeService) {
+        this.vendorExcludeService = vendorExcludeService;
+    }
+
+    /**
+     * Gets the vendorService attribute. 
+     * @return Returns the vendorService.
+     */
+    public VendorService getVendorService() {
+        return vendorService;
+    }
+
+    /**
+     * Sets the vendorService attribute value.
+     * @param vendorService The vendorService to set.
+     */
+    public void setVendorService(VendorService vendorService) {
+        this.vendorService = vendorService;
+    }
+
+    /**
+     * Gets the kualiConfigurationService attribute. 
+     * @return Returns the kualiConfigurationService.
+     */
+    public KualiConfigurationService getKualiConfigurationService() {
+        return kualiConfigurationService;
+    }
+
+    /**
+     * Sets the kualiConfigurationService attribute value.
+     * @param kualiConfigurationService The kualiConfigurationService to set.
+     */
+    public void setKualiConfigurationService(KualiConfigurationService kualiConfigurationService) {
+        this.kualiConfigurationService = kualiConfigurationService;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/DebarredVendorMatch.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/DebarredVendorMatch.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/DebarredVendorMatch.java	(revision 37225)
@@ -0,0 +1,434 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject;
+
+import java.util.Date;
+import java.util.LinkedHashMap;
+import java.util.List;
+
+import org.kuali.rice.kns.bo.PersistableBusinessObjectBase;
+import org.kuali.rice.kns.util.TypedArrayList;
+
+import antlr.StringUtils;
+
+public class DebarredVendorMatch extends PersistableBusinessObjectBase {
+    public static final String VENDOR_TYPE = "vendorHeader.vendorTypeCode";
+    public static final String CONFIRM_STATUS = "confirmStatusCode";
+    public static final String EXCLUSION_STATUS = "vendorExclusionStatus";
+    public static final String DEBARRED_VENDOR_ID = "debarredVendorId";
+    
+    private int debarredVendorId;
+    private Date loadDate;
+    private String name;
+    private String address1;
+    private String address2;
+    private String city;
+    private String state;
+    private String province;
+    private String zip;
+    private String aliases;
+    private String description;
+    private String confirmStatusCode;
+    private Date lastUpdatedTimeStamp;
+    private String lastUpdatedPrincipalName;
+    private Integer vendorHeaderGeneratedIdentifier;
+    private Integer vendorDetailAssignedIdentifier;
+    private long addressGeneratedId;
+    
+    private VendorDetail vendorDetail;
+    private VendorAddress vendorAddress;
+    private VendorHeader vendorHeader;
+    
+    private String vendorExclusionStatus; // not persisted in the db 
+    private String concatenatedId; // not persisted in the db
+    private String concatenatedAliases; // not persisted in the db
+    
+    /**
+     * Gets the debarredVendorId attribute. 
+     * @return Returns the debarredVendorId.
+     */
+    public int getDebarredVendorId() {
+        return debarredVendorId;
+    }
+
+    /**
+     * Sets the debarredVendorId attribute value.
+     * @param debarredVendorId The debarredVendorId to set.
+     */
+    public void setDebarredVendorId(int debarredVendorId) {
+        this.debarredVendorId = debarredVendorId;
+    }
+
+    /**
+     * Gets the loadDate attribute. 
+     * @return Returns the loadDate.
+     */
+    public Date getLoadDate() {
+        return loadDate;
+    }
+
+    /**
+     * Sets the loadDate attribute value.
+     * @param loadDate The loadDate to set.
+     */
+    public void setLoadDate(Date loadDate) {
+        this.loadDate = loadDate;
+    }
+
+    /**
+     * Gets the name attribute. 
+     * @return Returns the name.
+     */
+    public String getName() {
+        return name;
+    }
+
+    /**
+     * Sets the name attribute value.
+     * @param name The name to set.
+     */
+    public void setName(String name) {
+        this.name = name;
+    }
+
+    /**
+     * Gets the address1 attribute. 
+     * @return Returns the address1.
+     */
+    public String getAddress1() {
+        return address1;
+    }
+
+    /**
+     * Sets the address1 attribute value.
+     * @param address1 The address1 to set.
+     */
+    public void setAddress1(String address1) {
+        this.address1 = address1;
+    }
+
+    /**
+     * Gets the address2 attribute. 
+     * @return Returns the address2.
+     */
+    public String getAddress2() {
+        return address2;
+    }
+
+    /**
+     * Sets the address2 attribute value.
+     * @param address2 The address2 to set.
+     */
+    public void setAddress2(String address2) {
+        this.address2 = address2;
+    }
+
+    /**
+     * Gets the city attribute. 
+     * @return Returns the city.
+     */
+    public String getCity() {
+        return city;
+    }
+
+    /**
+     * Sets the city attribute value.
+     * @param city The city to set.
+     */
+    public void setCity(String city) {
+        this.city = city;
+    }
+
+    /**
+     * Gets the state attribute. 
+     * @return Returns the state.
+     */
+    public String getState() {
+        return state;
+    }
+
+    /**
+     * Sets the state attribute value.
+     * @param state The state to set.
+     */
+    public void setState(String state) {
+        this.state = state;
+    }
+
+    /**
+     * Gets the province attribute. 
+     * @return Returns the province.
+     */
+    public String getProvince() {
+        return province;
+    }
+
+    /**
+     * Sets the province attribute value.
+     * @param country The province to set.
+     */
+    public void setProvince(String province) {
+        this.province = province;
+    }
+
+    /**
+     * Gets the zip attribute. 
+     * @return Returns the zip.
+     */
+    public String getZip() {
+        return zip;
+    }
+
+    /**
+     * Sets the zip attribute value.
+     * @param zip The zip to set.
+     */
+    public void setZip(String zip) {
+        this.zip = zip;
+    }
+
+    /**
+     * Gets the aliases attribute. 
+     * @return Returns the aliases.
+     */
+    public String getAliases() {
+        return aliases;
+    }
+
+    /**
+     * Sets the aliases attribute value.
+     * @param aliases The aliases to set.
+     */
+    public void setAliases(String aliases) {
+        this.aliases = aliases;
+    }
+
+    /**
+     * Gets the description attribute. 
+     * @return Returns the description.
+     */
+    public String getDescription() {
+        return description;
+    }
+
+    /**
+     * Sets the description attribute value.
+     * @param description The description to set.
+     */
+    public void setDescription(String description) {
+        this.description = description;
+    }
+
+    /**
+     * Gets the confirmStatusCode attribute. 
+     * @return Returns the confirmStatusCode.
+     */
+    public String getConfirmStatusCode() {
+        return confirmStatusCode;
+    }
+
+    /**
+     * Sets the confirmStatusCode attribute value.
+     * @param confirmStatusCode The confirmStatusCode to set.
+     */
+    public void setConfirmStatusCode(String confirmStatusCode) {
+        this.confirmStatusCode = confirmStatusCode;
+    }
+
+    /**
+     * Gets the lastUpdatedTimeStamp attribute. 
+     * @return Returns the lastUpdatedTimeStamp.
+     */
+    public Date getLastUpdatedTimeStamp() {
+        return lastUpdatedTimeStamp;
+    }
+
+    /**
+     * Sets the lastUpdatedTimeStamp attribute value.
+     * @param lastUpdatedTimeStamp The lastUpdatedTimeStamp to set.
+     */
+    public void setLastUpdatedTimeStamp(Date lastUpdatedTimeStamp) {
+        this.lastUpdatedTimeStamp = lastUpdatedTimeStamp;
+    }
+
+    /**
+     * Gets the lastUpdatedPrincipalName attribute. 
+     * @return Returns the lastUpdatedPrincipalName.
+     */
+    public String getLastUpdatedPrincipalName() {
+        return lastUpdatedPrincipalName;
+    }
+
+    /**
+     * Sets the lastUpdatedPrincipalName attribute value.
+     * @param lastUpdatedPrincipalName The lastUpdatedPrincipalName to set.
+     */
+    public void setLastUpdatedPrincipalName(String lastUpdatedPrincipalName) {
+        this.lastUpdatedPrincipalName = lastUpdatedPrincipalName;
+    }
+
+    /**
+     * Gets the vendorHeaderGeneratedIdentifier attribute. 
+     * @return Returns the vendorHeaderGeneratedIdentifier.
+     */
+    public Integer getVendorHeaderGeneratedIdentifier() {
+        return vendorHeaderGeneratedIdentifier;
+    }
+
+    /**
+     * Sets the vendorHeaderGeneratedIdentifier attribute value.
+     * @param vendorHeaderGeneratedIdentifier The headerGeneratedId to set.
+     */
+    public void setVendorHeaderGeneratedIdentifier(Integer vendorHeaderGeneratedIdentifier) {
+        this.vendorHeaderGeneratedIdentifier = vendorHeaderGeneratedIdentifier;
+    }
+
+    /**
+     * Gets the vendorDetailAssignedIdentifier attribute. 
+     * @return Returns the vendorDetailAssignedIdentifier.
+     */
+    public Integer getVendorDetailAssignedIdentifier() {
+        return vendorDetailAssignedIdentifier;
+    }
+
+    /**
+     * Sets the vendorDetailAssignedIdentifier attribute value.
+     * @param vendorDetailAssignedIdentifier The detailAssignedId to set.
+     */
+    public void setVendorDetailAssignedIdentifier(Integer vendorDetailAssignedIdentifier) {
+        this.vendorDetailAssignedIdentifier = vendorDetailAssignedIdentifier;
+    }
+
+    /**
+     * Gets the addressGeneratedId attribute. 
+     * @return Returns the addressGeneratedId.
+     */
+    public long getAddressGeneratedId() {
+        return addressGeneratedId;
+    }
+
+    /**
+     * Sets the addressGeneratedId attribute value.
+     * @param addressGeneratedId The addressGeneratedId to set.
+     */
+    public void setAddressGeneratedId(long addressGeneratedId) {
+        this.addressGeneratedId = addressGeneratedId;
+    }
+
+    /**
+     * Gets the vendorDetail attribute. 
+     * @return Returns the vendorDetail.
+     */
+    public VendorDetail getVendorDetail() {
+        return vendorDetail;
+    }
+
+    /**
+     * Sets the vendorDetail attribute value.
+     * @param vendorDetail The vendorDetail to set.
+     */
+    public void setVendorDetail(VendorDetail vendorDetail) {
+        this.vendorDetail = vendorDetail;
+    }
+
+    /**
+     * Gets the vendorAddress attribute. 
+     * @return Returns the vendorAddress.
+     */
+    public VendorAddress getVendorAddress() {
+        return vendorAddress;
+    }
+
+    /**
+     * Sets the vendorAddress attribute value.
+     * @param vendorAddress The vendorAddress to set.
+     */
+    public void setVendorAddress(VendorAddress vendorAddress) {
+        this.vendorAddress = vendorAddress;
+    }
+
+    /**
+     * Gets the vendorHeader attribute. 
+     * @return Returns the vendorHeader.
+     */
+    public VendorHeader getVendorHeader() {
+        return vendorHeader;
+    }
+
+    /**
+     * Sets the vendorHeader attribute value.
+     * @param vendorHeader The vendorHeader to set.
+     */
+    public void setVendorHeader(VendorHeader vendorHeader) {
+        this.vendorHeader = vendorHeader;
+    }
+
+    /**
+     * Gets the vendorExclusionStatus attribute. 
+     * @return Returns the vendorExclusionStatus.
+     */
+    public String getVendorExclusionStatus() {
+        return vendorExclusionStatus;
+    }
+
+    /**
+     * Sets the vendorExclusionStatus attribute value.
+     * @param vendorExclusionStatus The vendorExclusionStatus to set.
+     */
+    public void setVendorExclusionStatus(String vendorExclusionStatus) {
+        this.vendorExclusionStatus = vendorExclusionStatus;
+    }
+
+    /**
+     * Gets the concatenatedId attribute. 
+     * @return Returns the concatenatedId.
+     */
+    public String getConcatenatedId() {
+        return concatenatedId;
+    }
+
+    /**
+     * Sets the concatenatedId attribute value.
+     * @param concatenatedId The concatenatedId to set.
+     */
+    public void setConcatenatedId(String concatenatedId) {
+        this.concatenatedId = concatenatedId;
+    }
+
+    /**
+     * Gets the concatenatedAliases attribute. 
+     * @return Returns the concatenatedAliases.
+     */
+    public String getConcatenatedAliases() {
+        return concatenatedAliases;
+    }
+
+    /**
+     * Sets the concatenatedAliases attribute value.
+     * @param concatenatedAliases The concatenatedAliases to set.
+     */
+    public void setConcatenatedAliases(String concatenatedAliases) {
+        this.concatenatedAliases = concatenatedAliases;
+    }
+
+    @Override
+    protected LinkedHashMap toStringMapper() {
+        LinkedHashMap toString = new LinkedHashMap();
+        toString.put("debarredVendorId", debarredVendorId);
+        return toString;
+    }
+    
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/format/DebarredVendorConfirmStatusFormatter.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/format/DebarredVendorConfirmStatusFormatter.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/format/DebarredVendorConfirmStatusFormatter.java	(revision 37225)
@@ -0,0 +1,37 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject.format;
+
+import org.kuali.kfs.vnd.VendorConstants;
+import org.kuali.rice.kew.util.KEWConstants;
+import org.kuali.rice.kns.web.format.Formatter;
+
+public class DebarredVendorConfirmStatusFormatter extends Formatter {
+    public Object format(Object target) {
+        if (target == null) {
+            return null;
+        } 
+        String status = (String)target; 
+        if (status.equals(VendorConstants.DEBARRED_VENDOR_UNPROCESSED)) {
+            status = VendorConstants.DEBARRED_VENDOR_UNPROCESSED_LABEL;
+        } else if (status.equals(VendorConstants.DEBARRED_VENDOR_CONFIRMED)){
+            status = VendorConstants.DEBARRED_VENDOR_CONFIRMED_LABEL;
+        } else if (status.equals(VendorConstants.DEBARRED_VENDOR_DENIED)) {
+            status = VendorConstants.DEBARRED_VENDOR_DENIED_LABEL;
+        }
+        return status;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/options/ExclusionVendorTypeValuesFinder.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/options/ExclusionVendorTypeValuesFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/options/ExclusionVendorTypeValuesFinder.java	(revision 37225)
@@ -0,0 +1,56 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject.options;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.List;
+
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.vnd.VendorParameterConstants;
+import org.kuali.kfs.vnd.businessobject.VendorType;
+import org.kuali.rice.core.util.KeyLabelPair;
+import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
+import org.kuali.rice.kns.service.KeyValuesService;
+import org.kuali.rice.kns.service.ParameterService;
+
+public class ExclusionVendorTypeValuesFinder extends KeyValuesBase{
+    
+    private static List<KeyLabelPair> labels = null;
+
+    /*
+     * @see org.kuali.keyvalues.KeyValuesFinder#getKeyValues()
+     */
+    public List<KeyLabelPair> getKeyValues() {
+        if (labels == null) {
+            synchronized (this.getClass()) {
+                    KeyValuesService boService = SpringContext.getBean(KeyValuesService.class);
+                    Collection<VendorType> codes = boService.findAll(VendorType.class);
+                    List<String> exclusionCodes = SpringContext.getBean(ParameterService.class).getParameterValues(
+                            KFSConstants.ParameterNamespaces.VENDOR ,"Lookup", VendorParameterConstants.EXCLUSION_AND_DEBARRED_VENDOR_TYPES);
+                    List<KeyLabelPair> tempLabels = new ArrayList<KeyLabelPair>();
+                    for (VendorType vt : codes) {
+                        if (vt.isActive() && exclusionCodes.contains(vt.getVendorTypeCode())) {
+                            tempLabels.add(new KeyLabelPair(vt.getVendorTypeCode(), vt.getVendorTypeDescription()));
+                        }
+                    }
+                    labels = tempLabels;
+            }
+        }
+        return labels;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/options/VendorExclusionStatusValuesFinder.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/options/VendorExclusionStatusValuesFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/options/VendorExclusionStatusValuesFinder.java	(revision 37225)
@@ -0,0 +1,37 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject.options;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import org.kuali.kfs.vnd.VendorConstants;
+import org.kuali.rice.core.util.KeyLabelPair;
+import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
+
+public class VendorExclusionStatusValuesFinder extends KeyValuesBase {
+    
+    /**
+     * @see org.kuali.keyvalues.KeyValuesFinder#getKeyValues()
+     */
+    public List getKeyValues() {
+        List keyValues = new ArrayList();
+        keyValues.add(new KeyLabelPair(VendorConstants.EXCLUDED_MATCHED_VENDOR_STATUS, "Excluded vendors matched with EPLS vendors"));
+        keyValues.add(new KeyLabelPair(VendorConstants.NON_EXCLUDED_MATCHED_VENDOR_STATUS, "Non-Excluded vendors matched with EPLS vendors"));
+
+        return keyValues;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/options/VendorExclusionConfirmStatusValuesFinder.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/options/VendorExclusionConfirmStatusValuesFinder.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/options/VendorExclusionConfirmStatusValuesFinder.java	(revision 37225)
@@ -0,0 +1,38 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject.options;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import org.kuali.kfs.vnd.VendorConstants;
+import org.kuali.rice.core.util.KeyLabelPair;
+import org.kuali.rice.kns.lookup.keyvalues.KeyValuesBase;
+
+public class VendorExclusionConfirmStatusValuesFinder extends KeyValuesBase {
+
+    /**
+     * @see org.kuali.keyvalues.KeyValuesFinder#getKeyValues()
+     */
+    public List getKeyValues() {
+        List keyValues = new ArrayList();
+        keyValues.add(new KeyLabelPair(VendorConstants.DEBARRED_VENDOR_UNPROCESSED, VendorConstants.DEBARRED_VENDOR_UNPROCESSED_LABEL));
+        keyValues.add(new KeyLabelPair(VendorConstants.DEBARRED_VENDOR_CONFIRMED, VendorConstants.DEBARRED_VENDOR_CONFIRMED_LABEL));
+        keyValues.add(new KeyLabelPair(VendorConstants.DEBARRED_VENDOR_DENIED, VendorConstants.DEBARRED_VENDOR_DENIED_LABEL));
+
+        return keyValues;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/DebarredUnmatchedVendor.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/DebarredUnmatchedVendor.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/DebarredUnmatchedVendor.java	(revision 37225)
@@ -0,0 +1,37 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject;
+
+public class DebarredUnmatchedVendor extends VendorDetail{
+    private String vendorTypeCode;
+
+    /**
+     * Gets the vendorTypeCode attribute. 
+     * @return Returns the vendorTypeCode.
+     */
+    public String getVendorTypeCode() {
+        return vendorTypeCode;
+    }
+
+    /**
+     * Sets the vendorTypeCode attribute value.
+     * @param vendorTypeCode The vendorTypeCode to set.
+     */
+    public void setVendorTypeCode(String vendorTypeCode) {
+        this.vendorTypeCode = vendorTypeCode;
+    }
+    
+}
Index: work/src/org/kuali/kfs/vnd/businessobject/inquiry/VendorExclusionInquirable.java
===================================================================
--- work/src/org/kuali/kfs/vnd/businessobject/inquiry/VendorExclusionInquirable.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/businessobject/inquiry/VendorExclusionInquirable.java	(revision 37225)
@@ -0,0 +1,44 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.businessobject.inquiry;
+
+import java.util.List;
+import java.util.Map;
+
+import org.kuali.kfs.sys.businessobject.inquiry.KfsInquirableImpl;
+import org.kuali.kfs.vnd.businessobject.DebarredVendorMatch;
+import org.kuali.kfs.vnd.businessobject.VendorAlias;
+import org.kuali.rice.kns.bo.BusinessObject;
+
+public class VendorExclusionInquirable extends KfsInquirableImpl {
+
+    /**
+     * @see org.kuali.rice.kns.inquiry.KualiInquirableImpl#getBusinessObject(java.util.Map)
+     */
+    @SuppressWarnings("unchecked")
+    @Override
+    public BusinessObject getBusinessObject(Map fieldValues) {
+        DebarredVendorMatch match = (DebarredVendorMatch)super.getBusinessObject(fieldValues);
+        List<VendorAlias> vendorAliases = match.getVendorDetail().getVendorAliases();
+        StringBuffer concatenatedAliases = new StringBuffer();
+        for(VendorAlias alias : vendorAliases) {
+            concatenatedAliases.append(alias.getVendorAliasName());
+            concatenatedAliases.append("/n");
+        }
+        match.setConcatenatedAliases(concatenatedAliases.toString());
+        return match;
+    }
+}
Index: work/src/org/kuali/kfs/vnd/VendorKeyConstants.java
===================================================================
--- work/src/org/kuali/kfs/vnd/VendorKeyConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/VendorKeyConstants.java	(revision 37225)
@@ -77,5 +77,8 @@
     // Vendor Maintenance Commodity Code
     public static final String ERROR_VENDOR_COMMODITY_CODE_REQUIRE_ONE_DEFAULT_IND = "error.vendorCommodityCode.require.one.defaultIndicator";
     public static final String ERROR_VENDOR_COMMODITY_CODE_IS_REQUIRED_FOR_THIS_VENDOR_TYPE = "error.vendorCommodityCode.is.required.for.vendorType";
+
+    // Vendor Exclude
+    public static final String MESSAGE_BATCH_UPLOAD_VENDOR_EXCLUDE = "message.batchUpload.title.vendor.exclude";
     
 }
Index: work/src/org/kuali/kfs/vnd/spring-vnd.xml
===================================================================
--- work/src/org/kuali/kfs/vnd/spring-vnd.xml	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/spring-vnd.xml	(revision 37225)
@@ -55,9 +55,14 @@
         <property name="batchFileDirectories">
           	<list>
             	<value>${reports.directory}/vnd</value>
+            	<value>${staging.directory}/vnd</value>
           	</list>
         </property>
-
+        <property name="jobNames">
+        	<list>
+				<value>vendorExcludeJob</value>
+			</list>
+		</property>
 	</bean>
 
     <bean id="vndModuleService" parent="vndModuleService-parentBean"/>
@@ -307,7 +312,111 @@
 	      p:service-ref="vendorTypeRoleTypeService"
 	      p:localServiceName="vendorTypeRoleTypeService" />
 	  </property>
-	</bean>    
+	</bean>
+	
+	<bean id="debarredVendorMatchDao" parent="platformAwareDao"
+		class="org.kuali.kfs.vnd.batch.dataaccess.DebarredVendorMatchDaoOjb" />
+		
+	<bean id="debarredVendorDao" parent="platformAwareDaoJdbc"
+		class="org.kuali.kfs.vnd.batch.dataaccess.DebarredVendorDaoJdbc">
+		<property name="debarredVendorMatchDao">
+			<ref bean="debarredVendorMatchDao" />
+		</property>
+		<property name="vendorService">
+			<ref bean="vendorService" />
+		</property>
+	</bean>
+		
+	<bean id="vendorExcludeService" parent="vendorExcludeService-parentBean"/>
+	<bean id="vendorExcludeService-parentBean" abstract="true" class="org.kuali.kfs.vnd.batch.service.impl.VendorExcludeServiceImpl">
+		<property name="batchInputFileService">
+			<ref bean="batchInputFileService" />
+		</property>
+		<property name="businessObjectService">
+			<ref bean="businessObjectService" />
+		</property>
+		<property name="batchInputFileType">
+			<ref bean="vendorExcludeInputFileType" />
+		</property>
+		<property name="debarredVendorDao">
+			<ref bean="debarredVendorDao" />
+		</property>
+		<property name="debarredVendorMatchDao">
+			<ref bean="debarredVendorMatchDao" />
+		</property>
+		<property name="dateTimeService">
+			<ref bean="dateTimeService" />
+		</property>
+	</bean>  
+	
+	<bean id="vendorExcludeInputFileType" parent="vendorExcludeInputFileType-parentBean"/>
+	<bean id="vendorExcludeInputFileType-parentBean" abstract="true" class="org.kuali.kfs.vnd.batch.VendorExcludeInputFileType">
+    	<property name="directoryPath">
+	       <value>${staging.directory}/vnd/exclusion</value>
+	    </property>
+	    <property name="fileExtension">
+	       <value>csv</value>
+	    </property>
+	    <property name="dateTimeService">
+	       <ref bean="dateTimeService"/>
+	    </property>
+	</bean> 
+	
+	<bean id="vendorExcludeJob" parent="unscheduledJobDescriptor">
+	<property name="steps">
+			<list>
+				<ref bean="loadEplsFileStep" />
+				<ref bean="vendorMatchStep" />
+			</list>
+		</property>
+	</bean>
+	
+	<bean id="loadEplsFileStep" class="org.kuali.kfs.vnd.batch.LoadEplsFileStep"
+		parent="step">
+		<property name="vendorExcludeService">
+			<ref bean="vendorExcludeService" />
+		</property>
+	</bean>
+	
+	<bean id="vendorMatchStep" class="org.kuali.kfs.vnd.batch.VendorMatchStep"
+		parent="step">
+		<property name="vendorExcludeService">
+			<ref bean="vendorExcludeService" />
+		</property>
+	</bean>
+	
+	<bean id="vendorExclusionLookupable" class="org.kuali.rice.kns.lookup.KualiLookupableImpl" parent="kualiLookupable" scope="prototype">
+        <property name="lookupableHelperService">
+         	<ref bean="vendorExclusionLookupableHelperServiceImpl" />   
+        </property>
+    </bean>
     
+    <bean id="debarredVendorUnmatchedLookupable" class="org.kuali.rice.kns.lookup.KualiLookupableImpl" parent="kualiLookupable" scope="prototype">
+        <property name="lookupableHelperService">
+         	<ref bean="debarredVendorUnmatchedLookupableHelperServiceImpl" />   
+        </property>
+    </bean>
+    
+    <bean id="vendorExclusionLookupableHelperServiceImpl" class="org.kuali.kfs.vnd.businessobject.lookup.VendorExclusionLookupableHelperServiceImpl" parent="lookupableHelperService">
+		<property name="vendorExcludeService">
+			<ref bean="vendorExcludeService" />
+		</property>
+		<property name="vendorService">
+			<ref bean="vendorService" />
+		</property>
+		<property name="kualiConfigurationService">
+			<ref bean="kualiConfigurationService" />
+		</property>
+	</bean>
+	
+	<bean id="debarredVendorUnmatchedLookupableHelperServiceImpl" class="org.kuali.kfs.vnd.businessobject.lookup.DebarredVendorUnmatchedLookupableHelperServiceImpl" parent="lookupableHelperService">
+		<property name="vendorExcludeService">
+			<ref bean="vendorExcludeService" />
+		</property>
+		<property name="vendorService">
+			<ref bean="vendorService" />
+		</property>
+	</bean>
+    
 </beans>
 
Index: work/src/org/kuali/kfs/vnd/ojb-vnd.xml
===================================================================
--- work/src/org/kuali/kfs/vnd/ojb-vnd.xml	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/ojb-vnd.xml	(revision 37225)
@@ -596,4 +596,50 @@
     </reference-descriptor>    
 </class-descriptor>
 
+<class-descriptor class="org.kuali.kfs.vnd.businessobject.DebarredVendorDetail" table="PUR_VNDR_EXCL_MT">
+	<field-descriptor name="debarredVendorId" column="VNDR_EXCL_ID" jdbc-type="INTEGER" primarykey="true" index="true" autoincrement="true" sequence-name="PUR_VNDR_EXCL_MTCH_T_SEQ"/>
+    <field-descriptor name="loadDate" column="VNDR_EXCL_LOAD_DT" jdbc-type="DATE" />
+	<field-descriptor name="name" column="VNDR_EXCL_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="address1" column="VNDR_EXCL_LN1_ADDR" jdbc-type="VARCHAR" />
+	<field-descriptor name="address2" column="VNDR_EXCL_LN2_ADDR" jdbc-type="VARCHAR" />
+	<field-descriptor name="city" column="VNDR_EXCL_CTY_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="state" column="VNDR_EXCL_ST_CD" jdbc-type="VARCHAR" />
+	<field-descriptor name="province" column="VNDR_EXCL_PRVN_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="zip" column="VNDR_EXCL_ZIP_CD" jdbc-type="VARCHAR" />
+	<field-descriptor name="aliases" column="VNDR_EXCL_OTHR_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="description" column="VNDR_EXCL_DESC_TXT" jdbc-type="VARCHAR" />
+</class-descriptor>
+
+<class-descriptor class="org.kuali.kfs.vnd.businessobject.DebarredVendorMatch" table="PUR_VNDR_EXCL_MTCH_T">
+	<field-descriptor name="debarredVendorId" column="VNDR_EXCL_ID" jdbc-type="INTEGER" primarykey="true" autoincrement="true" sequence-name="PUR_VNDR_EXCL_MTCH_T_SEQ"/>
+	<field-descriptor name="objectId" column="OBJ_ID" jdbc-type="VARCHAR" index="true"/>
+	<field-descriptor name="versionNumber" column="VER_NBR" jdbc-type="BIGINT" locking="true"/>
+	<field-descriptor name="vendorHeaderGeneratedIdentifier" column="VNDR_HDR_GNRTD_ID" jdbc-type="INTEGER"/>
+	<field-descriptor name="vendorDetailAssignedIdentifier" column="VNDR_DTL_ASND_ID" jdbc-type="INTEGER"/>
+	<field-descriptor name="addressGeneratedId" column="VNDR_ADDR_GNRTD_ID" jdbc-type="INTEGER"/>
+	<field-descriptor name="confirmStatusCode" column="VNDR_EXCL_CFRM_STAT_CD" jdbc-type="VARCHAR" />
+    <field-descriptor name="loadDate" column="VNDR_EXCL_LOAD_DT" jdbc-type="DATE" />
+	<field-descriptor name="name" column="VNDR_EXCL_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="address1" column="VNDR_EXCL_LN1_ADDR" jdbc-type="VARCHAR" />
+	<field-descriptor name="address2" column="VNDR_EXCL_LN2_ADDR" jdbc-type="VARCHAR" />
+	<field-descriptor name="city" column="VNDR_EXCL_CTY_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="state" column="VNDR_EXCL_ST_CD" jdbc-type="VARCHAR" />
+	<field-descriptor name="province" column="VNDR_EXCL_PRVN_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="zip" column="VNDR_EXCL_ZIP_CD" jdbc-type="VARCHAR" />
+	<field-descriptor name="aliases" column="VNDR_EXCL_OTHR_NM" jdbc-type="VARCHAR" />
+	<field-descriptor name="description" column="VNDR_EXCL_DESC_TXT" jdbc-type="VARCHAR" />
+	<field-descriptor name="lastUpdatedTimeStamp" column="LST_UPDT_TS" jdbc-type="DATE" />
+	<field-descriptor name="lastUpdatedPrincipalName" column="LST_UPDT_PRNCPL_NM" jdbc-type="VARCHAR" />
+	<reference-descriptor auto-delete="false" auto-retrieve="true" auto-update="false" class-ref="org.kuali.kfs.vnd.businessobject.VendorDetail" name="vendorDetail">
+        <foreignkey field-ref="vendorHeaderGeneratedIdentifier"/>
+        <foreignkey field-ref="vendorDetailAssignedIdentifier"/>
+    </reference-descriptor>
+    <reference-descriptor auto-delete="false" auto-retrieve="true" auto-update="false" class-ref="org.kuali.kfs.vnd.businessobject.VendorHeader" name="vendorHeader">
+        <foreignkey field-ref="vendorHeaderGeneratedIdentifier"/>
+    </reference-descriptor>
+    <reference-descriptor auto-delete="false" auto-retrieve="true" auto-update="false" class-ref="org.kuali.kfs.vnd.businessobject.VendorAddress" name="vendorAddress" proxy="true">
+        <foreignkey field-ref="addressGeneratedId"/>
+    </reference-descriptor>
+</class-descriptor>
+
 </descriptor-repository>
Index: work/src/org/kuali/kfs/vnd/VendorConstants.java
===================================================================
--- work/src/org/kuali/kfs/vnd/VendorConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/VendorConstants.java	(revision 37225)
@@ -41,12 +41,21 @@
     public static final String VENDOR_LOOKUPABLE_IMPL = "vendorLookupable";
     public static final String VENDOR_ADDRESS_LOOKUPABLE_IMPL = "vendorAddressLookupable";
     public static final String VENDOR_CONTRACT_LOOKUPABLE_IMPL = "vendorContractLookupable";
+    public static final String VENDOR_EXCLUDE_FILE_TYPE_INDENTIFIER = "vendorExcludeInputFileType";
+    public static final String EXCLUDED_MATCHED_VENDOR_STATUS = "M";
+    public static final String NON_EXCLUDED_MATCHED_VENDOR_STATUS = "N";
+    public static final String DEBARRED_VENDOR_UNPROCESSED = "U";
+    public static final String DEBARRED_VENDOR_CONFIRMED = "C";
+    public static final String DEBARRED_VENDOR_DENIED = "D";
+    public static final String DEBARRED_VENDOR_UNPROCESSED_LABEL = "Unprocessed";
+    public static final String DEBARRED_VENDOR_CONFIRMED_LABEL = "Confirmed";
+    public static final String DEBARRED_VENDOR_DENIED_LABEL = "Denied";
 
     // Vendor Tax Types
     public static final String TAX_TYPE_FEIN = "FEIN";
     public static final String TAX_TYPE_SSN = "SSN";
     public static final String TAX_TYPE_TAX = "TAX";
-
+    
     // VENDOR PHONE TYPES
     public static class PhoneTypes {
         public static final String TOLL_FREE = "TF";
@@ -54,7 +63,7 @@
         public static final String FAX = "FX";
         public static final String PO = "PO";
     }
-
+    
     public static class AddressTypes {
         public static final String QUOTE = "QT";
         public static final String PURCHASE_ORDER = "PO";
Index: work/src/org/kuali/kfs/vnd/VendorParameterConstants.java
===================================================================
--- work/src/org/kuali/kfs/vnd/VendorParameterConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/VendorParameterConstants.java	(revision 37225)
@@ -32,5 +32,6 @@
     public static final String PHONE_NUMBER_FORMATS = "GENERIC_PHONE_NUMBER_FORMATS";
     public static final String DEFAULT_PHONE_NUMBER_DIGITS = "GENERIC_DEFAULT_PHONE_NUMBER_LENGTH";
     public static final String OVERRIDE_VENDOR_DOC_TITLE = "OVERRIDE_DOCUMENT_TITLE_IND";
+    public static final String EXCLUSION_AND_DEBARRED_VENDOR_TYPES = "EXCLUSION_AND_DEBARRED_VENDOR_TYPES";
     
 }
Index: work/src/org/kuali/kfs/vnd/web/struts/VendorExclusionAction.java
===================================================================
--- work/src/org/kuali/kfs/vnd/web/struts/VendorExclusionAction.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/web/struts/VendorExclusionAction.java	(revision 37225)
@@ -0,0 +1,72 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.web.struts;
+
+import java.util.HashMap;
+import java.util.Map;
+import java.util.Properties;
+
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import org.apache.struts.action.ActionForm;
+import org.apache.struts.action.ActionForward;
+import org.apache.struts.action.ActionMapping;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.vnd.batch.service.VendorExcludeService;
+import org.kuali.kfs.vnd.businessobject.lookup.VendorExclusionLookupableHelperServiceImpl;
+import org.kuali.rice.kns.exception.AuthorizationException;
+import org.kuali.rice.kns.service.KNSServiceLocator;
+import org.kuali.rice.kns.util.GlobalVariables;
+import org.kuali.rice.kns.web.struts.action.KualiAction;
+
+public class VendorExclusionAction extends KualiAction {
+    
+    public ActionForward confirmDebarredVendor(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) {
+        VendorExclusionForm vendorExclusionForm = (VendorExclusionForm) form;
+        
+        Map<String, String> fields = new HashMap<String, String>();
+        fields.put("confirmStatusCode", vendorExclusionForm.getConfirmStatusCode());
+        fields.put("vendorExclusionStatus", vendorExclusionForm.getVendorExclusionStatus());
+        fields.put("vendorType", vendorExclusionForm.getVendorType());
+        vendorExclusionForm.setFields(fields);
+        SpringContext.getBean(VendorExcludeService.class).confirmDebarredVendor(Integer.parseInt(vendorExclusionForm.getDebarredVendorId()));
+        return new ActionForward(getBackUrl(vendorExclusionForm), true);
+    }
+    
+    public ActionForward denyDebarredVendor(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) {
+        VendorExclusionForm vendorExclusionForm = (VendorExclusionForm) form;
+        
+        Map<String, String> fields = new HashMap<String, String>();
+        fields.put("confirmStatusCode", vendorExclusionForm.getConfirmStatusCode());
+        fields.put("vendorExclusionStatus", vendorExclusionForm.getVendorExclusionStatus());
+        fields.put("vendorType", vendorExclusionForm.getVendorType());
+        vendorExclusionForm.setFields(fields);
+        SpringContext.getBean(VendorExcludeService.class).denyDebarredVendor(Integer.parseInt(vendorExclusionForm.getDebarredVendorId()));
+        return new ActionForward(getBackUrl(vendorExclusionForm), true);
+    }
+    
+    protected String getBackUrl(VendorExclusionForm form) {
+        return form.getBackLocation() + "?methodToCall=search&docFormKey=88888888&businessObjectClassName=" + form.getBusinessObjectClassName()+ "&confirmStatusCode=" +  form.getConfirmStatusCode() 
+        + "&vendorExclusionStatus=" +  form.getVendorExclusionStatus() + "&vendorType=" +  form.getVendorType() + "&suppressActions=No&showMaintenanceLinks=Yes";
+    }
+    
+    @Override
+    protected void checkAuthorization(ActionForm form, String methodToCall) throws AuthorizationException {
+    }
+
+}
Index: work/src/org/kuali/kfs/vnd/web/struts/VendorExclusionForm.java
===================================================================
--- work/src/org/kuali/kfs/vnd/web/struts/VendorExclusionForm.java	(revision 0)
+++ work/src/org/kuali/kfs/vnd/web/struts/VendorExclusionForm.java	(revision 37225)
@@ -0,0 +1,98 @@
+/*
+ * Copyright 2012 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.vnd.web.struts;
+
+import java.util.HashMap;
+import java.util.Map;
+
+import org.kuali.rice.kns.web.struts.form.LookupForm;
+
+public class VendorExclusionForm extends LookupForm {
+    
+    private String confirmStatusCode;
+    private String debarredVendorId;
+    private String vendorExclusionStatus;
+    private String vendorType;
+    
+    /**
+     * Gets the confirmStatusCode attribute. 
+     * @return Returns the confirmStatusCode.
+     */
+    public String getConfirmStatusCode() {
+        return confirmStatusCode;
+    }
+
+    /**
+     * Sets the confirmStatusCode attribute value.
+     * @param statusCode The statusCode to set.
+     */
+    public void setConfirmStatusCode(String confirmStatusCode) {
+        if (confirmStatusCode == null) {
+            this.confirmStatusCode = "";
+        } else {
+            this.confirmStatusCode = confirmStatusCode;
+        }
+    }
+
+    /**
+     * Gets the debarredVendorId attribute. 
+     * @return Returns the debarredVendorId.
+     */
+    public String getDebarredVendorId() {
+        return debarredVendorId;
+    }
+
+    /**
+     * Sets the debarredVendorId attribute value.
+     * @param debarredVendorId The debarredVendorId to set.
+     */
+    public void setDebarredVendorId(String debarredVendorId) {
+        this.debarredVendorId = debarredVendorId;
+    }
+
+    /**
+     * Gets the vendorExclusionStatus attribute. 
+     * @return Returns the vendorExclusionStatus.
+     */
+    public String getVendorExclusionStatus() {
+        return vendorExclusionStatus;
+    }
+
+    /**
+     * Sets the vendorExclusionStatus attribute value.
+     * @param vendorExclusionStatus The vendorExclusionStatus to set.
+     */
+    public void setVendorExclusionStatus(String vendorExclusionStatus) {
+        this.vendorExclusionStatus = vendorExclusionStatus;
+    }
+
+    /**
+     * Gets the vendorType attribute. 
+     * @return Returns the vendorType.
+     */
+    public String getVendorType() {
+        return vendorType;
+    }
+
+    /**
+     * Sets the vendorType attribute value.
+     * @param vendorType The vendorType to set.
+     */
+    public void setVendorType(String vendorType) {
+        this.vendorType = vendorType;
+    }
+
+}
Index: work/src/org/kuali/kfs/vnd/document/validation/impl/VendorRule.java
===================================================================
--- work/src/org/kuali/kfs/vnd/document/validation/impl/VendorRule.java	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/document/validation/impl/VendorRule.java	(revision 37225)
@@ -850,6 +850,7 @@
     boolean validateDefaultAddressCampus(VendorDetail vendorDetail) {
         List<VendorAddress> vendorAddresses = vendorDetail.getVendorAddresses();
         String addressTypeCode;
+        String addressTypeDesc;
         String campusCode;
         boolean valid = true;
         boolean previousValue = false;
@@ -866,6 +867,7 @@
         int i = 0;
         for (VendorAddress address : vendorAddresses) {
             addressTypeCode = address.getVendorAddressTypeCode();
+            addressTypeDesc = address.getVendorAddressType().getVendorAddressTypeDescription();
             String errorPath = MAINTAINABLE_ERROR_PREFIX + VendorPropertyConstants.VENDOR_ADDRESS + "[" + i + "]";
             GlobalVariables.getMessageMap().addToErrorPath(errorPath);
             String[] parameters = new String[] { addressTypeCode };
@@ -885,7 +887,7 @@
                 }
 
                 if (addressTypeCodeDefaultIndicator.put(addressTypeCode, address.isVendorDefaultAddressIndicator()) != null && previousValue && address.isVendorDefaultAddressIndicator()) {
-                    GlobalVariables.getMessageMap().putError(VendorPropertyConstants.VENDOR_DEFAULT_ADDRESS_INDICATOR, VendorKeyConstants.ERROR_ADDRESS_DEFAULT_INDICATOR, parameters);
+                    GlobalVariables.getMessageMap().putError(VendorPropertyConstants.VENDOR_DEFAULT_ADDRESS_INDICATOR, VendorKeyConstants.ERROR_ADDRESS_DEFAULT_INDICATOR,addressTypeDesc );
                     valid = false;
                 }
 
@@ -925,9 +927,10 @@
 
             for (String addressType : addressTypes) {
                 if (!addressTypesHavingDefaultTrue.contains(addressType)) {
-                    String[] parameters = new String[] { addressType };
+                    
                     int addressIndex = 0;
                     for (VendorAddress address : vendorAddresses) {
+                        String[] parameters = new String[] { address.getVendorAddressType().getVendorAddressTypeDescription() };
                         String propertyName = VendorPropertyConstants.VENDOR_ADDRESS + "[" + addressIndex + "]." + VendorPropertyConstants.VENDOR_DEFAULT_ADDRESS_INDICATOR;
                         if (address.getVendorAddressType().getVendorAddressTypeCode().equalsIgnoreCase(addressType)) {
                             putFieldError(propertyName, VendorKeyConstants.ERROR_ADDRESS_DEFAULT_INDICATOR, parameters);
Index: work/src/org/kuali/kfs/vnd/document/validation/impl/OwnershipTypeRule.java
===================================================================
--- work/src/org/kuali/kfs/vnd/document/validation/impl/OwnershipTypeRule.java	(revision 30259)
+++ work/src/org/kuali/kfs/vnd/document/validation/impl/OwnershipTypeRule.java	(revision 37225)
@@ -22,15 +22,17 @@
 import org.kuali.kfs.vnd.VendorParameterConstants;
 import org.kuali.kfs.vnd.businessobject.OwnershipType;
 import org.kuali.kfs.vnd.businessobject.VendorDetail;
+import org.kuali.rice.kns.datadictionary.BusinessObjectEntry;
 import org.kuali.rice.kns.document.MaintenanceDocument;
 import org.kuali.rice.kns.maintenance.rules.MaintenanceDocumentRuleBase;
 import org.kuali.rice.kns.service.DataDictionaryService;
 import org.kuali.rice.kns.service.ParameterService;
 
-/* 
- * 
+/** 
+ * Rules to validate the Owernship Type maintenance document
 */
 public class OwnershipTypeRule extends MaintenanceDocumentRuleBase {
+    protected static final String DEFAULT_OWNERSHIP_TYPE_LABEL = "Ownership Type"; // we shouldn't need this, but just in case...
 
     protected boolean processCustomApproveDocumentBusinessRules(MaintenanceDocument document) {
         LOG.info("processCustomApproveDocumentBusinessRules called");
@@ -63,7 +65,8 @@
 
         if ((feinParameterValues.contains(newBo.getVendorOwnershipCode()) || ssnParameterValues.contains(newBo.getVendorOwnershipCode())) && ! newBo.isActive() && oldBo.isActive()) {
             success = false;
-            String documentLabel = SpringContext.getBean(DataDictionaryService.class).getDocumentLabelByClass(newBo.getClass());
+            final BusinessObjectEntry ownershipTypeEntry = SpringContext.getBean(DataDictionaryService.class).getDataDictionary().getBusinessObjectEntry(OwnershipType.class.getName());
+            final String documentLabel = ownershipTypeEntry == null ? DEFAULT_OWNERSHIP_TYPE_LABEL : ownershipTypeEntry.getObjectLabel();
             putGlobalError(KFSKeyConstants.ERROR_CANNOT_INACTIVATE_USED_IN_SYSTEM_PARAMETERS, documentLabel);
         }
         return success;
Index: work/src/org/kuali/kfs/sys/batch/SemaphoreInputFileType.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/SemaphoreInputFileType.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/SemaphoreInputFileType.java	(revision 37225)
@@ -0,0 +1,175 @@
+package org.kuali.kfs.sys.batch;
+
+import java.io.BufferedReader;
+import java.io.ByteArrayInputStream;
+import java.io.File;
+import java.io.InputStreamReader;
+import java.util.ArrayList;
+import java.util.List;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.log4j.Logger;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.KFSKeyConstants;
+import org.kuali.kfs.sys.context.BatchStepFileDescriptor;
+import org.kuali.kfs.sys.exception.ParseException;
+import org.kuali.rice.kns.util.GlobalVariables;
+import org.kuali.rice.kns.util.MessageMap;
+
+/**
+ * This class allows the batch process semaphore files to be uploaded. Only the .error files are currently configured for uploading. 
+ * To enable the other file types to be uploaded configure a spring bean for each type supplying the 
+ * directoryPath, the fileExtension, and fileTypeIdentifier properties
+ */
+public class SemaphoreInputFileType extends BatchInputFileTypeBase {
+	
+	private static Logger LOG = Logger.getLogger(SemaphoreInputFileType.class);
+
+	private String fileTypeIdentifier;
+	
+	/**
+	 * @param principalName - unused
+	 * @param parsedFileContents List<String> in which the first line is the name of the Job and the Step (JobName~StepName)
+	 * @param fileUserIdentifier is not used
+	 * @return first line of the parsedFileContents which should be in the form jobName~stepName
+	 * 
+	 * @see org.kuali.kfs.sys.batch.BatchInputFileType#getFileName(String, Object, String)
+	 */
+	public String getFileName(String principalName, Object parsedFileContents, String fileUserIdentifier) {				
+		String fileName = "";
+
+		if (!validate(parsedFileContents)) {
+			fileName += "invalidJob"+ BatchStepFileDescriptor.STEP_FILE_NAME_SEPARATOR +"invalidStep";		    	
+		}		    
+		else {
+			List<String> content = getParsedFileContent(parsedFileContents);
+
+			String firstLine = content.get(0);
+			fileName = firstLine;		    	
+		}
+
+		return fileName;
+	}
+
+	/**
+	 * @see org.kuali.kfs.sys.batch.BatchInputFileType#getFileTypeIdentifer()
+	 */
+	public String getFileTypeIdentifer() {
+		return fileTypeIdentifier;
+	}
+	
+	public void setFileTypeIdentifier(String fileTypeIdentifier) {
+		this.fileTypeIdentifier = fileTypeIdentifier;
+	}
+	
+	/**
+     * @see org.kuali.kfs.sys.batch.BatchInputType#getTitleKey()
+     */
+    public String getTitleKey() {
+    	return KFSKeyConstants.Semaphore.MESSAGE_BATCH_UPLOAD_TITLE_PREFIX +"."+ getFileExtension();
+    }
+	
+	/**
+	 * Returns a List<String> in which the first line is the Step and all subsequent lines are considered part of the error message.
+	 * 
+	 * @see org.kuali.kfs.sys.batch.BatchInputFileType#parse(byte[])
+	 */
+    public Object parse(byte[] fileByteContent) throws ParseException {
+    	BufferedReader bufferedFileReader = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(fileByteContent)));
+    	List<String> content = new ArrayList<String>();
+    	try {    		
+    		String fileLine = "";
+    		while ((fileLine = bufferedFileReader.readLine()) != null) {
+    			content.add(fileLine);
+    		}
+    	}catch (Exception e) {
+    		LOG.error("An unexpected error occurred while parsing the file: ", e);
+    		throw new ParseException("An unexpected error occurred while parsing the file: "+ e.getMessage(), e);
+    	}
+       
+    	return content;
+    }    
+
+    /**
+     * Remove the done file from the file system if it exists. The done file is not used by the batch process.
+     * 
+     * @param fileName the absolute path, file name, and extension of the file
+     * @param parsedFileContents
+     * 
+     * @see org.kuali.kfs.sys.batch.BatchInputFileType#process(String, Object)
+     */
+	public void process(String fileName, Object parsedFileContents) {
+		//remove done file
+		File doneFile = generateDoneFileObject(fileName);
+		if (doneFile.exists()) {
+			LOG.info("Removing the .done file for "+ fileName);
+			if (!doneFile.delete()) {
+		    	LOG.error("Unable to delete the .done file for "+ fileName);		    	
+		    	MessageMap errors = new MessageMap();		    	
+		    	errors.putError(KFSConstants.GLOBAL_ERRORS, KFSKeyConstants.Semaphore.ERROR_BATCH_UPLOAD_DELETE_DONE_FILE);		    	
+		    	GlobalVariables.mergeErrorMap(errors);		
+			}
+		}
+	}
+
+	/**
+	 * Validate that the first line of the file contains a job name and a valid Step (the bean id)
+	 * in the format jobName.stepName
+	 * 
+	 * @see org.kuali.kfs.sys.batch.BatchInputFileType#validate(Object)
+	 */
+	public boolean validate(Object parsedFileContents) {
+		List<String> content = getParsedFileContent(parsedFileContents);
+		
+		if (content.size() <= 0) {
+	    	MessageMap errors = new MessageMap();		    	
+	    	errors.putError(KFSConstants.GLOBAL_ERRORS, KFSKeyConstants.Semaphore.ERROR_BATCH_UPLOAD_INVALID_STEP);		    	
+	    	GlobalVariables.mergeErrorMap(errors);				
+	    	return false;
+		}
+		
+		String firstLine = content.get(0);
+		String stepName = StringUtils.substring(firstLine, StringUtils.lastIndexOf(firstLine, BatchStepFileDescriptor.STEP_FILE_NAME_SEPARATOR)+1);
+		
+		Step step = BatchSpringContext.getStep(stepName);
+		if (step == null) {
+			LOG.error("Unable to find bean for step: "+ stepName);	
+			MessageMap errors = new MessageMap();		    	
+			errors.putError(KFSConstants.GLOBAL_ERRORS, KFSKeyConstants.Semaphore.ERROR_BATCH_UPLOAD_INVALID_STEP);
+			GlobalVariables.mergeErrorMap(errors);		
+			return false;
+		}
+		
+		return true;
+	}
+
+	/**
+	 * The author principal name is not added to the name of the file or in the file contents
+	 * @return an empty String
+	 * 
+	 * @see org.kuali.kfs.sys.batch.BatchInputFileType#getAuthorPrincipalName(File)
+	 */
+	public String getAuthorPrincipalName(File file) {
+		return "";
+	}	
+	
+    /**
+     * This method is responsible for creating a File object that represents the done file. The real file represented on disk may
+     * not exist
+     * 
+     * @param batchInputFileName
+     * @return a File object representing the done file. The real file may not exist on disk, but the return value can be used to
+     *         create that file.
+     */
+    private File generateDoneFileObject(String batchInputFileName) {
+        String doneFileName = StringUtils.substringBeforeLast(batchInputFileName, ".") + ".done";
+        File doneFile = new File(doneFileName);
+        return doneFile;
+    }
+    
+    @SuppressWarnings("unchecked")
+    private List<String> getParsedFileContent(Object parsedFileContent) {
+    	List<String> content = (List<String>)parsedFileContent;    	
+    	return content;
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFileSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFileSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFileSpecification.java	(revision 37225)
@@ -0,0 +1,26 @@
+package org.kuali.kfs.sys.batch;
+
+/**
+ * Concrete extension of AbstractFlatFilePrefixSpecificationBase which can handle the parsing of lines where substrings
+ * are parsed by knowing the beginning and ending position of the substring
+ */
+public class FixedWidthFlatFileSpecification extends AbstractFlatFilePrefixSpecificationBase {
+    /**
+     * Parses a line by pulling out substrings given by the FlatFilePropertySpecification configuration objects passed in
+     * @see org.kuali.kfs.sys.batch.FlatFileSpecification#parseLineIntoObject(FlatFilePrefixObjectSpecification, String, Object)
+     */
+    public void parseLineIntoObject(FlatFileObjectSpecification parseSpecification, String lineToParse, Object parseIntoObject, int lineNumber) {
+        // loop through the properties to format and set the property values
+        // from the input line
+        for (FlatFilePropertySpecification propertySpecification : parseSpecification.getParseProperties()) {
+            int start = ((FixedWidthFlatFilePropertySpecification) propertySpecification).getStart();
+            int end = ((FixedWidthFlatFilePropertySpecification) propertySpecification).getEnd();
+            // if end is not specified, read to the end of line
+            if (end == 0) {
+                end = lineToParse.length();
+            }
+            String subString = lineToParse.substring(start, end);
+            propertySpecification.setProperty(subString, parseIntoObject, lineNumber);
+        }
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/DelimitedFlatFileSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/DelimitedFlatFileSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/DelimitedFlatFileSpecification.java	(revision 37225)
@@ -0,0 +1,36 @@
+package org.kuali.kfs.sys.batch;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.log4j.Logger;
+
+/**
+ * The specification for lines which are split by delimiters before being populated into objects
+ */
+public class DelimitedFlatFileSpecification extends AbstractFlatFilePrefixSpecificationBase {
+    private static final Logger LOG = Logger.getLogger(DelimitedFlatFileSpecification.class);
+    private String delimiter;
+
+    /**
+     * Splits the line based on the given delimiter and parses into properties
+     * @see org.kuali.kfs.sys.batch.FlatFileSpecification#parseLineIntoObject(FlatFilePrefixObjectSpecification, String, Object)
+     */
+    public void parseLineIntoObject(FlatFileObjectSpecification parseSpecification, String lineToParse, Object parseIntoObject, int lineNumber) {
+        String[] lineSegments = StringUtils.splitPreserveAllTokens(lineToParse, delimiter);
+        for (FlatFilePropertySpecification propertySpecification : parseSpecification.getParseProperties()) {
+            try {
+                propertySpecification.setProperty(lineSegments[((DelimitedFlatFilePropertySpecification) propertySpecification).getLineSegmentIndex()], parseIntoObject, lineNumber);
+            }
+            catch (ArrayIndexOutOfBoundsException e) {
+                LOG.debug("Unable to set property " + propertySpecification.getPropertyName() + " since lineSegmentIndex does not exist for line");
+            }
+        }
+    }
+
+    /**
+     * Sets the delimiter to split on
+     * @param delimiter the delimiter to split the substring on
+     */
+    public void setDelimiter(String delimiter) {
+        this.delimiter = delimiter;
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileParseTrackerImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileParseTrackerImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileParseTrackerImpl.java	(revision 37225)
@@ -0,0 +1,164 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.Stack;
+
+import org.apache.commons.beanutils.PropertyUtils;
+import org.apache.log4j.Logger;
+
+/**
+ * Class which tracks the current state of parsing - particularly which object should currently be parsed into
+ */
+public class FlatFileParseTrackerImpl implements FlatFileParseTracker {
+	static Logger LOG = Logger.getLogger(FlatFileParseTrackerImpl.class);
+	protected FlatFileSpecification classIdentifier;
+	protected Stack<Object> parseStack;
+	protected List<Object> parsedParentObjects;
+	protected Map<Class<?>, FlatFileChildMapEntry> childrenMap;
+	protected int completedLineCount = 0;
+	
+	/**
+	 * Initializes a new FlatFileParseTracker
+	 * @param flatFileSpecification the FlatFileSpecificationBase instance which will determine which object should be instantiated for a given line
+	 * @param specifications the specifications for all objects that will be parsed into, to build a parent/child map out of
+	 */
+	public void initialize(FlatFileSpecification flatFileClassIdentifier) {
+		this.classIdentifier = flatFileClassIdentifier;
+		this.parseStack = new Stack<Object>();
+		this.parsedParentObjects = new ArrayList<Object>();
+		constructChildrenMap();
+	}
+	
+	/**
+	 * Builds a parent/child map out of the given specifications
+	 * @param specifications the specifications for the parse
+	 */
+	protected void constructChildrenMap() {
+		childrenMap = new HashMap<Class<?>, FlatFileChildMapEntry>();
+		
+		for (FlatFileObjectSpecification specification : classIdentifier.getObjectSpecifications()) {
+			if (specification.getParentBusinessObjectClass() != null) {
+				final FlatFileChildMapEntry entry = new FlatFileChildMapEntry(specification.getParentBusinessObjectClass(), specification.getParentTargetProperty());
+				childrenMap.put(specification.getBusinessObjectClass(), entry);
+			}
+		}
+	}
+	
+	/**
+	 * Determines which class should be parsed into and returns an instance of that
+	 * @param lineToParse the line which is going to be parsed
+	 * @return the object to parse into
+	 */
+	public Object getObjectToParseInto(String lineToParse) {
+		final Class<?> lineClass = classIdentifier.determineClassForLine(lineToParse);
+		
+		if (lineClass == null) {
+			// the prefix was insignificant; skip it
+			return null;
+		}
+		
+		try {
+			Object parseIntoObject = lineClass.newInstance();
+			parseStack.push(parseIntoObject);			
+			return parseIntoObject;
+		} catch (InstantiationException ie) {
+			throw new RuntimeException("Could not instantiate object of class "+lineClass.getName()+" in FlatFileParse", ie);
+		} catch (IllegalAccessException iae) {
+			throw new RuntimeException("Illegal access attempting to instantiate object of class "+lineClass.getName()+" in FlatFileParse", iae);
+		}
+	}
+	
+	/**
+	 * Called when a line has completed parsing. Throws an exception if a proper parent 
+	 * is not found for the line being parsed
+	 */
+	@SuppressWarnings("unchecked")
+	public void completeLineParse() {
+		completedLineCount += 1;
+		if (LOG.isDebugEnabled()) {
+			LOG.debug("Completing parse of line: "+completedLineCount);
+		}
+		
+		Object currentObject = parseStack.pop();
+		final FlatFileChildMapEntry entry = getEntryForParsedIntoObject(currentObject);
+		
+		final Class<?> parentClass = (entry == null) ? null : entry.getParentBeanClass();
+		final String propertyName = (entry == null) ? null : entry.getPropertyName();
+		
+		while (!parseStack.isEmpty()) {
+			Object checkingObject = parseStack.pop();
+			if (parentClass != null && parentClass.isAssignableFrom(checkingObject.getClass())) {
+				try {
+					if (Collection.class.isAssignableFrom(PropertyUtils.getPropertyType(
+							checkingObject, propertyName))) {
+						Collection childrenList = ((Collection) PropertyUtils.getProperty(
+								checkingObject, propertyName));
+						childrenList.add(currentObject);
+					} else {
+						PropertyUtils.setProperty(checkingObject, propertyName,currentObject);
+					}
+					parseStack.push(checkingObject);
+					parseStack.push(currentObject);
+					return;
+				} catch (Exception e) {
+					LOG.error(e.getMessage() + "occured when completing line parse; attempting to set object of type "+currentObject.getClass().getName()+" to the following parent: "+parentClass.getName()+"#"+propertyName, e);
+					throw new RuntimeException(e.getMessage() + "occured when completing line parse; attempting to set object of type "+currentObject.getClass().getName()+" to the following parent: "+parentClass.getName()+"#"+propertyName,e);
+				}
+			}		
+		}
+		if (parentClass == null) {
+			parseStack.push(currentObject);	
+			parsedParentObjects.add(currentObject);
+		} else {
+			throw new IllegalStateException("A line of class "+currentObject.getClass().getName()+" cannot exist without a proper parent");      			
+		}
+	}
+	
+	/**
+	 * Looks up the FlatFileChildMapEntry for the given object
+	 * @param parsedIntoObject the object which has just completed being parsed into
+	 * @return the FlatFileChildMapEntry which has the given object as a child object, or null if the object is a base object
+	 */
+    public FlatFileChildMapEntry getEntryForParsedIntoObject(Object parsedIntoObject) {
+    	final FlatFileChildMapEntry entry = childrenMap.get(parsedIntoObject.getClass());
+    	return entry;
+    }
+
+	/**
+	 * @return the List of parsed parent objects
+	 */
+	public List<Object> getParsedObjects() {
+		return parsedParentObjects;
+	}
+	
+	/**
+	 * Inner class to make holding parent/child relationships easier
+	 *
+	 */
+	private class FlatFileChildMapEntry {
+		 protected Class<?> parentBeanClass;
+		 protected String propertyName;
+		
+		 public FlatFileChildMapEntry() {
+			 super();
+		 }
+		
+		 public FlatFileChildMapEntry(Class<?> parentBeanClass, String propertyName) {
+			 this();
+			 this.parentBeanClass = parentBeanClass;
+			 this.propertyName = propertyName;
+		 }
+		 
+		 public Class<?> getParentBeanClass() {
+			 return parentBeanClass;
+		 }
+
+		 public String getPropertyName() {
+			 return propertyName;
+		 }
+	}
+}
Index: work/src/org/kuali/kfs/sys/batch/JobListener.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/JobListener.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/batch/JobListener.java	(revision 37225)
@@ -108,7 +108,7 @@
 
     protected void notify(JobExecutionContext jobExecutionContext, String jobStatus) {
         try {
-            StringBuffer mailMessageSubject = new StringBuffer(configurationService.getPropertyString(KFSConstants.ENVIRONMENT_KEY)).append(": ").append(jobExecutionContext.getJobDetail().getGroup()).append(": ").append(jobExecutionContext.getJobDetail().getName());
+            StringBuffer mailMessageSubject = new StringBuffer(jobExecutionContext.getJobDetail().getGroup()).append(": ").append(jobExecutionContext.getJobDetail().getName());
             MailMessage mailMessage = new MailMessage();
             mailMessage.setFromAddress(mailService.getBatchMailingList());
             if (jobExecutionContext.getMergedJobDataMap().containsKey(REQUESTOR_EMAIL_ADDRESS_KEY) && !StringUtils.isBlank(jobExecutionContext.getMergedJobDataMap().getString(REQUESTOR_EMAIL_ADDRESS_KEY))) {
Index: work/src/org/kuali/kfs/sys/batch/StopBatchContainerStep.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/StopBatchContainerStep.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/StopBatchContainerStep.java	(revision 37225)
@@ -0,0 +1,21 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.Date;
+
+
+/**
+ * StopBatchContainerStep triggers the BatchContainerStep to shut itself down.
+ *
+ */
+public class StopBatchContainerStep extends AbstractStep {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(StopBatchContainerStep.class);
+
+    /**
+     * The BatchContainerStep recognizes the name of this Step and exits without executing this method.
+     */
+	public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
+		
+		LOG.info("Stopping Job: "+ jobName +", Date: "+ jobRunDate);
+		return true;
+	}
+}
Index: work/src/org/kuali/kfs/sys/batch/AbstractRegexSpecificationBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/AbstractRegexSpecificationBase.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/AbstractRegexSpecificationBase.java	(revision 37225)
@@ -0,0 +1,130 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.batch;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
+
+import org.apache.commons.lang.StringUtils;
+
+/**
+ * The abstract parent of flat file specifications which use regexes to determine what line is parsed into what object
+ */
+public abstract class AbstractRegexSpecificationBase extends AbstractFlatFileSpecificationBase {
+    protected List<String> insignificantRegexPatterns;
+    protected List<Pattern> insignificantPatterns;
+    protected boolean trimLineBeforeMatch;
+    protected boolean fullMatch = true;
+
+    /**
+     * Matches the given line with an object to parse into, or null if no object could be found
+     * @see org.kuali.kfs.sys.batch.FlatFileSpecification#determineClassForLine(java.lang.String)
+     */
+    public Class<?> determineClassForLine(String line) {
+        final String matchLine = trimLine(line);
+        for (FlatFileObjectSpecification objectSpecification : getObjectSpecifications()) {
+            final FlatFileRegexObjectSpecification regexObjectSpecification = (FlatFileRegexObjectSpecification)objectSpecification;
+            final Pattern pattern = regexObjectSpecification.getPattern();
+            if (matches(pattern, matchLine)) {
+                return regexObjectSpecification.getBusinessObjectClass();
+            }
+        }
+        for (Pattern insignificantPattern : getInsignificantPatterns()) {
+            if (matches(insignificantPattern, matchLine)) return null;
+        }
+        return defaultBusinessObjectClass;
+    }
+    
+    /**
+     * Trims the trailing space only from the given line, though only if trimLineBeforeMatch is true
+     * @param line the line to perhaps trim trailing spaces from
+     * @return the maybe trimmed line
+     */
+    protected String trimLine(String line) {
+        if (isTrimLineBeforeMatch()) {
+            return StringUtils.stripEnd(line, " \t\n\f\r");
+        }
+        return line;
+    }
+
+    /**
+     * Sets the insignificant regex patterns
+     * @param insignificantRegexPatterns the regex patterns for lines to ignore
+     */
+    public void setInsignificantRegexPatterns(List<String> insignificantRegexPatterns) {
+        this.insignificantRegexPatterns = insignificantRegexPatterns;
+        
+        this.insignificantPatterns = new ArrayList<Pattern>();
+        for (String regexPattern : insignificantRegexPatterns) {
+            final Pattern pattern = Pattern.compile(regexPattern);
+            insignificantPatterns.add(pattern);
+        }
+    }
+    
+    /**
+     * Determines if the given line matches the given pattern, following the full match rule
+     * @param pattern the pattern to match against
+     * @param line the parsed line to match
+     * @return true if the line matches and the line should be parsed by this object specification; false if this line should be given to the next object specification
+     */
+    protected boolean matches(Pattern pattern, String line) {
+        Matcher matcher = pattern.matcher(line);
+        if (fullMatch) {
+            return matcher.matches();
+        } else {
+            return matcher.find();
+        }
+    }
+
+    /**
+     * @return the List of compiled insignificant patterns
+     */
+    public List<Pattern> getInsignificantPatterns() {
+        return this.insignificantPatterns;
+    }
+
+    /**
+     * @return whether a parsed line will have trailing spaces removed (and trailing spaces only!)
+     */
+    public boolean isTrimLineBeforeMatch() {
+        return trimLineBeforeMatch;
+    }
+
+    /**
+     * Sets whether this will strip trailing spaces before parsing the line.  Defaults to false.
+     * @param trimLineBeforeMatch true if trailing spaces should be stripped, false otherwise
+     */
+    public void setTrimLineBeforeMatch(boolean trimLineBeforeMatch) {
+        this.trimLineBeforeMatch = trimLineBeforeMatch;
+    }
+
+    /**
+     * @return whether the regular expression associated with this object specification will attempt to match the full line or (if false) simply find the pattern somewhere within the line
+     */
+    public boolean isFullMatch() {
+        return fullMatch;
+    }
+
+    /**
+     * Sets whether the regular expression associated with this object specification will attempt to match against the whole line or search for the pattern within the line.  If true, it will match the full line, and this is the default.
+     * @param fullMatch true if match against the full line should be carried out, false otherwise
+     */
+    public void setFullMatch(boolean fullMatch) {
+        this.fullMatch = fullMatch;
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileInformation.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileInformation.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileInformation.java	(revision 37225)
@@ -0,0 +1,107 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+/**
+ * A holder of error messages and informative messages associated with a single logical file within a larger physical file
+ */
+public class FlatFileInformation {
+    private String fileName;
+    private List<String[]> messages;
+    private Map<String, FlatFileTransactionInformation> flatFileIdentifierToTransactionInfomationMap;
+ 
+    /**
+     * Constructs a new FlatFileInformation
+     */
+    public FlatFileInformation() {
+        messages = new ArrayList<String[]>();
+        flatFileIdentifierToTransactionInfomationMap = new HashMap<String, FlatFileTransactionInformation>();
+    }
+    
+    /**
+     * Constructs a new FlatFileInformation
+     * @param fileName the file name of the physical file with the encapsulated logical file therein
+     */
+    public FlatFileInformation(String fileName) {
+        this.fileName = fileName;
+        messages = new ArrayList<String[]>();
+        flatFileIdentifierToTransactionInfomationMap = new HashMap<String, FlatFileTransactionInformation>();
+    }
+
+    /**
+     * Adds the given messages about a transaction to the map of transaction messages if necessary and returns the first set of messages about a transaction put into the map
+     * @param flatFileDataIdentifier the identifier of the transaction
+     * @param flatFileTransactionInformation the messages about that transaction
+     * @return the messages about the transaction, either just added or previously added
+     */
+    public FlatFileTransactionInformation getOrAddFlatFileData(String flatFileDataIdentifier, FlatFileTransactionInformation flatFileTransactionInformation) {
+        if (!flatFileIdentifierToTransactionInfomationMap.containsKey(flatFileDataIdentifier)) {
+            flatFileIdentifierToTransactionInfomationMap.put(flatFileDataIdentifier, flatFileTransactionInformation);
+        }
+        return (FlatFileTransactionInformation) flatFileIdentifierToTransactionInfomationMap.get(flatFileDataIdentifier);
+    }
+
+    /**
+     * Adds an error message for this logical file
+     * @param message the error message
+     */
+    public void addFileErrorMessage(String message) {
+        this.messages.add(new String[] { FlatFileTransactionInformation.getEntryTypeString(FlatFileTransactionInformation.EntryType.ERROR), message });
+    }
+
+    /**
+     * Adds an informative message for this logical file
+     * @param message the informative message
+     */
+    public void addFileInfoMessage(String message) {
+        this.messages.add(new String[] { FlatFileTransactionInformation.getEntryTypeString(FlatFileTransactionInformation.EntryType.INFO), message });
+    }
+
+    /**
+     * @return the name of the physical file the logical file this holds messages for is associated with
+     */
+    public String getFileName() {
+        return fileName;
+    }
+
+    /**
+     * Sets the name of the physical file the logical file this holds messages for is associated with
+     * @param fileName the name of the physical file the logical file this holds messages for is associated with
+     */
+    public void setFileName(String fileName) {
+        this.fileName = fileName;
+    }
+
+    /**
+     * @return the full List of messages associated with this logical file
+     */
+    public List<String[]> getMessages() {
+        return messages;
+    }
+
+    /**
+     * Sets the full List of messages associated with this logical file
+     * @param messages the List of messages
+     */
+    public void setMessages(List<String[]> messages) {
+        this.messages = messages;
+    }
+
+    /**
+     * @return the map that associates the transaction identifier to its associated messages
+     */
+    public Map<String, FlatFileTransactionInformation> getFlatFileIdentifierToTransactionInfomationMap() {
+        return flatFileIdentifierToTransactionInfomationMap;
+    }
+
+    /**
+     * Sets the map that associates the transaction identifier to its associated messages
+     * @param flatFileIdentifierToTransactionInfomationMap the map that associates the transaction identifier to its associated messages
+     */
+    public void setFlatFileIdentifierToTransactionInfomationMap(Map<String, FlatFileTransactionInformation> flatFileIdentifierToTransactionInfomationMap) {
+        this.flatFileIdentifierToTransactionInfomationMap = flatFileIdentifierToTransactionInfomationMap;
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFilePropertySpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFilePropertySpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFilePropertySpecification.java	(revision 37225)
@@ -0,0 +1,20 @@
+package org.kuali.kfs.sys.batch;
+
+/**
+ * A contract of methods which must be implemented by configuration elements which associate setting a substring
+ * of a parsed line as a property on a business object
+ */
+public interface FlatFilePropertySpecification {
+    /**
+     * Sets the property on the business object
+     * @param value the substring of the parsed line to set
+     * @param businessObject the business object to set the parsed line on
+     * @param lineNumber the current line number 
+     */
+	public void setProperty(String value, Object businessObject, int lineNumber);
+	
+	/**
+	 * @return the name of the property that should be set
+	 */
+	public String getPropertyName();
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileParseTracker.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileParseTracker.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileParseTracker.java	(revision 37225)
@@ -0,0 +1,33 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.List;
+
+/**
+ * Contract of methods required by the flat file parser to track the parent/child tree while parsing
+ */
+public interface FlatFileParseTracker {
+	/**
+	 * Initializes a new FlatFileParseTracker
+	 * @param flatFileSpecification the FlatFileSpecificationBase instance which will determine which object should be instantiated for a given line
+	 * @param specifications the specifications for all objects that will be parsed into, to build a parent/child map out of
+	 */
+	public void initialize(FlatFileSpecification flatFileClassIdentifier);
+	
+	/**
+	 * Determines which class should be parsed into and returns an instance of that
+	 * @param lineToParse the line which is going to be parsed
+	 * @return the object to parse into
+	 */
+	public abstract Object getObjectToParseInto(String lineToParse);
+	
+	/**
+	 * Called when a line has completed parsing. Throws an exception if a proper parent 
+	 * is not found for the line being parsed
+	 */
+	public abstract void completeLineParse();
+	
+	/**
+	 * @return the List of parsed parent objects
+	 */
+	public abstract List<Object> getParsedObjects();
+}
Index: work/src/org/kuali/kfs/sys/batch/AbstractFlatFileObjectSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/AbstractFlatFileObjectSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/AbstractFlatFileObjectSpecification.java	(revision 37225)
@@ -0,0 +1,67 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.batch;
+
+import java.util.List;
+
+/**
+ * Abstract class representing a FlatFilePrefixObjectSpecification - something that helps parse a line into an
+ * object.
+ */
+public abstract class AbstractFlatFileObjectSpecification implements FlatFileObjectSpecification {
+
+    protected Class<?> businessObjectClass;
+    protected List <FlatFilePropertySpecification> parseProperties;
+    protected Class<?> parentBusinessObjectClass;
+    protected String parentTargetProperty;
+
+    public AbstractFlatFileObjectSpecification() {
+        super();
+    }
+
+    public Class<?> getBusinessObjectClass() {
+        return businessObjectClass;
+    }
+
+    public void setBusinessObjectClass(Class<?> businessObjectClass) {
+        this.businessObjectClass = businessObjectClass;
+    }
+
+    public List<FlatFilePropertySpecification> getParseProperties() {
+        return parseProperties;
+    }
+
+    public void setParseProperties(List<FlatFilePropertySpecification> parseProperties) {
+        this.parseProperties = parseProperties;
+    }
+
+    public Class<?> getParentBusinessObjectClass() {
+    	return parentBusinessObjectClass;
+    }
+
+    public void setParentBusinessObjectClass(Class<?> parentBusinessObjectClass) {
+    	this.parentBusinessObjectClass = parentBusinessObjectClass;
+    }
+
+    public String getParentTargetProperty() {
+    	return parentTargetProperty;
+    }
+
+    public void setParentTargetProperty(String parentProperty) {
+    	this.parentTargetProperty = parentProperty;
+    }
+
+}
\ No newline at end of file
Index: work/src/org/kuali/kfs/sys/batch/BatchSpringContext.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/BatchSpringContext.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/batch/BatchSpringContext.java	(revision 37225)
@@ -15,14 +15,18 @@
  */
 package org.kuali.kfs.sys.batch;
 
+import org.apache.log4j.Logger;
 import org.kuali.kfs.sys.context.SpringContext;
 
 public class BatchSpringContext {
+    private static final Logger LOG = Logger.getLogger(BatchSpringContext.class);
+    
     public static Step getStep(String beanId) {
         return SpringContext.getBeansOfType(Step.class).get(beanId);
     }
 
     public static JobDescriptor getJobDescriptor(String beanId) {
+        LOG.info("getJobDescriptor:::::" + beanId);
         return SpringContext.getBeansOfType(JobDescriptor.class).get(beanId);
     }
 
Index: work/src/org/kuali/kfs/sys/batch/AbstractFlatFilePropertySpecificationBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/AbstractFlatFilePropertySpecificationBase.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/AbstractFlatFilePropertySpecificationBase.java	(revision 37225)
@@ -0,0 +1,160 @@
+package org.kuali.kfs.sys.batch;
+
+import org.apache.commons.beanutils.PropertyUtils;
+import org.kuali.kfs.sys.businessobject.format.BatchDateFormatter;
+import org.kuali.rice.kns.service.KNSServiceLocator;
+import org.kuali.rice.kns.web.format.Formatter;
+import org.springframework.util.StringUtils;
+
+
+/**
+ * Base abstract class for configuration element which represents a substring of a given line
+ * to be formatted and set on a business object
+ */
+public abstract class AbstractFlatFilePropertySpecificationBase implements FlatFilePropertySpecification {
+    protected String propertyName;
+    protected boolean rightTrim;
+    protected boolean leftTrim;
+    protected Class<? extends Formatter> formatterClass = org.kuali.rice.kns.web.format.Formatter.class;
+    protected String dateFormat;
+    protected boolean formatToTimestamp = false;
+
+    /**
+     * @return the name of the property that should be set
+     */
+    public String getPropertyName() {
+        return propertyName;
+    }
+
+    /**
+     * Sets the property on the business object
+     * @param value the substring of the parsed line to set
+     * @param businessObject the business object to set the parsed line on
+     * @param lineNumber the parsed line number     
+     */
+    
+    public void setProperty(String value, Object businessObject, int lineNumber) {
+        if (leftTrim) {
+            value = StringUtils.trimLeadingWhitespace(value);
+        }
+
+        if (rightTrim) {
+            value = StringUtils.trimTrailingWhitespace(value);
+        }
+        try {
+            PropertyUtils.setProperty(businessObject, propertyName, getFormattedObject(value, businessObject));
+        }
+        catch (Exception e) {
+            throw new RuntimeException("Exception occurred on line " + lineNumber + " while setting value " + value + " for property " + propertyName + "."  , e);
+        }
+    }
+
+    /**
+     * Returns the formatter class to format the substring before it is set on the business object
+     * @param parsedObject the object that is being parsed into
+     * @return the class for the formatter
+     */
+    protected Class<?> getFormatterClass(Object parsedObject) {
+        if (formatterClass == org.kuali.rice.kns.web.format.Formatter.class) {
+            Class<? extends Formatter> attributeFormatter = KNSServiceLocator.getDataDictionaryService().getAttributeFormatter(parsedObject.getClass(), this.propertyName);
+            if (attributeFormatter != null) {
+                this.formatterClass = attributeFormatter;
+            }
+        }
+
+        if (!Formatter.class.isAssignableFrom(this.formatterClass)) {
+            throw new RuntimeException("formatterClass is not a valid instance of " + Formatter.class.getName() + " instead was: " + formatterClass.getName());
+        }
+        return formatterClass;
+    }
+
+    /**
+     * Builds a formatter to format the parsed substring before it is set as a property on the business object
+     * @param parsedObject the business object to parse into
+     * @return the formatter
+     */
+    protected Formatter getFormatter(Object parsedObject) {
+        Formatter formatter = null;
+        try {
+            formatter = (Formatter) getFormatterClass(parsedObject).newInstance();
+        }
+        catch (InstantiationException ie) {
+            throw new RuntimeException("Could not instantiate object of class " + formatterClass.getName(), ie);
+        }
+        catch (IllegalAccessException iae) {
+            throw new RuntimeException("Illegal access attempting to instantiate object of class " + formatterClass.getName(), iae);
+        }
+        return formatter;
+    }
+
+    /**
+     * Sets the formatter class to use in this proprety specification
+     * @param formatterClass the class of the formatter to use
+     */
+    public void setFormatterClass(Class<? extends Formatter> formatterClass) {
+        if (!Formatter.class.isAssignableFrom(formatterClass)) {
+            throw new RuntimeException("formatterClass is not a valid instance of " + Formatter.class.getName() + " instead was: " + formatterClass.getName());
+        }
+        this.formatterClass = formatterClass;
+    }
+
+    /**
+     * This method returns the formatted object for the given string. It uses the formatter class define for specification property
+     * if exists, otherwise look to the Data Dictionary of the parsedObject , otherwise use the default formatter class.
+     * @param subString the parsed subString
+     * @param the object to parse into
+     */
+    protected Object getFormattedObject(String subString, Object parsedObject) {
+        Formatter formatter = getFormatter(parsedObject);
+        if (formatter instanceof BatchDateFormatter) {
+            ((BatchDateFormatter) formatter).setDateFormat(dateFormat);
+            if (formatToTimestamp) {
+                ((BatchDateFormatter) formatter).setFormatToTimestamp(true);
+            }
+        }
+        return formatter.convertFromPresentationFormat(subString);
+    }
+
+    /**
+     * Sets the name of the property this property specification will target for filling in the business object to parse into
+     * @param propertyName the name of the target property
+     */
+    public void setPropertyName(String propertyName) {
+        this.propertyName = propertyName;
+    }
+
+    /**
+     * Determines if the substring should have all whitespace on the right removed before setting
+     * @param rightTrim true if all whitespace on the right should be removed, false otherwise
+     */
+    public void setRightTrim(boolean rightTrim) {
+        this.rightTrim = rightTrim;
+    }
+
+    /**
+     * Determines if the substring should have all whitepsace on the left removed before setting
+     * @param leftTrim true if all whitespace on the left should be removed, false otherwise
+     */
+    public void setLeftTrim(boolean leftTrim) {
+        this.leftTrim = leftTrim;
+    }
+
+    /**
+     * If the substring represents a date, then this is the format used to parse that date; it should be 
+     * compatible with java.text.SimpleDateFormat
+     * @param dateFormat the date format to utilized
+     */
+    public void setDateFormat(String dateFormat) {
+        this.dateFormat = dateFormat;
+    }
+
+    /**
+     * If the formatter for this class is a BatchDateFormatter, then the formatted Date should be in the form of a timestamp
+     * 
+     * @param formatToTimestamp true if we should format to timestamp, false (the default) if we should not
+     */
+    public void setFormatToTimestamp(boolean formatToTimestamp) {
+        this.formatToTimestamp = formatToTimestamp;
+    }
+
+}
Index: work/src/org/kuali/kfs/sys/batch/BatchContainerStep.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/BatchContainerStep.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/BatchContainerStep.java	(revision 37225)
@@ -0,0 +1,332 @@
+package org.kuali.kfs.sys.batch;
+
+
+
+import java.io.File;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.context.BatchContainerDirectory;
+import org.kuali.kfs.sys.context.BatchLogger;
+import org.kuali.kfs.sys.context.BatchStepExecutor;
+import org.kuali.kfs.sys.context.BatchStepFileDescriptor;
+import org.kuali.kfs.sys.context.ContainerStepListener;
+import org.kuali.rice.kns.service.DateTimeService;
+import org.kuali.rice.kns.service.ParameterService;
+
+/**
+ * BatchContainerStep looks for .run files. 
+ * When one is found it deletes the file and creates a new thread (BatchStepExecutor) which executes the Step indicated by the .run file. 
+ * BatchContainerStep continues looking for .run files until it finds a stopBatchContainerStep.run file. 
+ * When BatchContainerStep begins it writes a .runlock file to indicate that the batch container is running, but will first look for an existing .runlock file
+ * and if one is found it will exit immediately.
+ *
+ * BatchContainerStep adds a ConsoleAppender to its Logger if one hasn't been configured.
+ *
+ */
+public class BatchContainerStep extends AbstractStep implements ContainerStepListener {
+    static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(BatchContainerStep.class);    
+    
+    protected String batchContainerDirectory;
+    protected Step batchContainerStopStep;
+    
+    protected BatchContainerDirectory directory;
+    
+    protected StringBuffer containerResults;
+    protected Map<String, BatchStepFileDescriptor> startedSteps;
+    protected List<BatchStepFileDescriptor[]> completedSteps;
+
+    /**
+     * This method begins an infinite loop in order to process semaphore files written by BatchStepTrigger (called via the brte scripts). 
+     * BatchStepTrigger writes .run files, BatchContainerStep reads .run files and calls BatchStepExecutor (its own thread) which will execute the 
+     * Step and write either a .success or .error result file which is then read by BatchStepTrigger. 
+     * 
+     * This method exits gracefully when it receives a .run file for the batchContainerStopStep. 
+     * 
+     */
+	public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
+	    BatchLogger.addConsoleAppender(LOG);
+	    
+		LOG.info("Starting the batch container in Job: "+ jobName +" on "+ jobRunDate);
+	    
+		if (batchContainerDirectory == null) {
+			throw new RuntimeException("The batchContainerDirectory has not been specified.");
+		}
+		if (batchContainerStopStep == null) {
+			throw new RuntimeException("The batchContainerStopStep has not been specified.");
+		}
+		
+		directory = new BatchContainerDirectory(batchContainerDirectory);		
+		
+		if (directory.isBatchContainerRunning()) {
+			//an instance of the batch container is already running - exit w/out trying to remove the batch container semaphore file
+			LOG.error("The BatchContainer is already running");
+			throw new RuntimeException("The BatchContainer is already running.");
+		}
+		
+		initContainerResults();
+		
+		try {			
+			//write batch container run lock file to indicate the batch container is running
+			directory.writeBatchContainerSemaphore(jobName, getName());
+			directory.addShutdownHook();
+			LOG.info("The BatchContainer is running");
+			
+	        ParameterService parameterService = getParameterService();
+	        DateTimeService dateTimeService = getDateTimeService();			
+	        
+			Executor executor = Executors.newCachedThreadPool();
+	        while(true) {        	
+	
+	            if (LOG.isDebugEnabled()) {
+	                LOG.debug("Looking for steps...");
+	            }
+	        	File[] stepRunFiles = directory.getStepRunFiles();
+	        	
+	        	while (stepRunFiles != null && stepRunFiles.length > 0) {       	
+	        		LOG.info("Found "+ stepRunFiles.length +" steps to execute");
+	
+	        		for(File stepRunFile : stepRunFiles) {
+	        			BatchStepFileDescriptor batchStepFile = new BatchStepFileDescriptor(stepRunFile);
+	        			
+	        			Step step = getStep(batchStepFile);
+	        			if (step == null) {
+	        				directory.removeBatchStepFileFromSystem(batchStepFile);
+	        				directory.writeBatchStepErrorResultFile(batchStepFile, new IllegalArgumentException("Unable to find bean for step: "+ batchStepFile.getStepName()));
+	        			}
+	        			else {
+	
+	        				if (isStopBatchContainerTriggered(step)) {
+	        					directory.removeBatchStepFileFromSystem(batchStepFile);
+	        					directory.writeBatchStepSuccessfulResultFile(batchStepFile);
+	
+	        					//Stop BatchContainer
+	        					LOG.info("shutting down container");
+	        					return true;
+	        				}
+	        				
+	        				//retrieve the stepIndex before the file is removed
+	        				int stepIndex = directory.getStepIndexFromFile(batchStepFile);
+	        				
+	        				directory.removeBatchStepFileFromSystem(batchStepFile);
+	        				
+	        				if (LOG.isDebugEnabled()) {
+	        				    LOG.debug("Creating new thread to run "+ batchStepFile);
+	        				}
+	        				BatchStepExecutor batchStepExecutor = new BatchStepExecutor(parameterService, dateTimeService, directory, batchStepFile, step, stepIndex);
+                            batchStepExecutor.addContainerStepListener(this);
+	        				executor.execute(batchStepExecutor);
+	        				
+	        			}
+	        		}
+	        		
+	        		if (LOG.isDebugEnabled()) {
+	        		    LOG.debug("Looking for steps...");
+	        		}
+	            	stepRunFiles = directory.getStepRunFiles();        	
+	            	
+	        	} 
+	        	
+	        	sleep();        	        							
+	    		if (!directory.isBatchContainerRunning()) {
+	    			//the batch container's runlock file no longer exists - exit
+	    			LOG.error("The BatchContainer runlock file no longer exists - exiting");
+	    			return false;
+	    		}
+	        } 				
+        
+		} finally {
+			//remove batch container run lock file
+			directory.removeBatchContainerSemaphore();
+			LOG.info("The BatchContainer has stopped running");
+
+			logContainerResultsSummary();
+		}
+	}
+	
+	/**
+	 * Notification that the Step started. Log the Step's information
+	 */
+	public void stepStarted(BatchStepFileDescriptor runFile, String logFileName) {
+	    logStepStarted(runFile, logFileName);
+	}
+	
+	/**
+	 * Notification that the Step finished. Log the Step's information
+	 */
+	public void stepFinished(BatchStepFileDescriptor resultFile, String logFileName) {
+	    logStepFinished(resultFile, logFileName);
+	}
+	
+	/**
+	 * Retrieves the Step bean from the SpringContext
+	 * 
+	 * @param batchStepFile the file descriptor for the step to run
+	 * @return the Step bean from the SpringContext
+	 */
+	protected Step getStep(BatchStepFileDescriptor batchStepFile) {
+	  if (LOG.isDebugEnabled()) {
+	      LOG.debug("Converting step named in .run file into a Step class...");
+	  }
+      
+      Step step = BatchSpringContext.getStep(batchStepFile.getStepName());
+      if (step == null) {
+      	LOG.error("Unable to find bean for step: "+ batchStepFile.getStepName());
+      	return null;
+      }
+      
+      LOG.info("Found valid step: "+ step.getName());
+      return step;
+	}
+    
+	/**
+	 * @param step the Step specified by the .run file
+	 * @return true if the Step received is the step to stop the batch container, false otherwise
+	 */
+    protected boolean isStopBatchContainerTriggered(Step step) {
+    	if (step.getName().equals(batchContainerStopStep.getName())) {
+    		LOG.info("Received Step: "+ batchContainerStopStep.getName() +". Stop listening for steps.");
+    		return true;
+    	}
+    	return false;
+ 	}
+            
+    /**
+     * Sleep for a specified amount of time before looking for more semaphore files to process
+     */
+    protected void sleep() {
+        try {  
+            if (LOG.isDebugEnabled()) {
+                LOG.debug("Sleeping...");
+            }
+            Thread.sleep(getSemaphoreProcessingInterval());
+        }
+        catch (InterruptedException e) {
+            throw new RuntimeException("BatchContainerStep encountered interrupt exception while trying to wait for the specified semaphore processing interval", e);
+        }
+    }
+        
+    /**
+     * @return (in milliseconds) the amount of time to wait before looking for more semaphore files to process
+     */
+	protected long getSemaphoreProcessingInterval() {
+		return Long.parseLong(getParameterService().getParameterValue(BatchContainerStep.class, KFSConstants.SystemGroupParameterNames.BATCH_CONTAINER_SEMAPHORE_PROCESSING_INTERVAL));
+	}
+    
+	/**
+	 * Initialize the structures necessary for logging the Steps' statistics
+	 */
+    protected void initContainerResults() {        
+        containerResults = new StringBuffer("Container Results:\n");
+        startedSteps = new HashMap<String, BatchStepFileDescriptor>();
+        completedSteps = new ArrayList<BatchStepFileDescriptor[]>();
+    }    
+    
+    /**
+     * Log the notification that the Step started to an internal buffer. Add the descriptor to the list of started steps.
+     * The logFileName is used as a unique identifier in the list of started steps in order to identify it in the list of started steps on completion.
+     * 
+     * @param runFile the step's run file descriptor
+     * @param logFileName the name of the log created by the Step's executor.
+     */
+    protected void logStepStarted(BatchStepFileDescriptor runFile, String logFileName) {
+        if (LOG.isDebugEnabled()) {
+            LOG.debug("stepStarted: "+ runFile);
+        }
+
+        startedSteps.put(logFileName, runFile);             
+
+        containerResults.append("STARTED "+ runFile
+                +" "+ runFile.getStartedDate() 
+                +" LOGFILE="+ logFileName
+                +"\n");
+    }
+    
+    /**
+     * Log the notification that the Step finished to an internal buffer. Remove the run descriptor from the list of started steps and add the run descriptor
+     * and the result descriptor to the list of completed steps. The logFileName is used to locate the run descriptor from the list of started steps.
+     * 
+     * @param resultFile the step's result file descriptor
+     * @param logFileName the name of the log created by the Step's executor
+     */
+    protected void logStepFinished(BatchStepFileDescriptor resultFile, String logFileName) {
+        if (LOG.isDebugEnabled()) {
+            LOG.debug("stepFinished: "+ resultFile);
+        }
+        
+        BatchStepFileDescriptor runFile = startedSteps.remove(logFileName);
+        
+        containerResults.append("COMPLETED "+ resultFile
+                                +" "+ resultFile.getCompletedDate()
+                                +" LOGFILE="+ logFileName
+                                +" STATUS="+ resultFile.getExtension()
+                                +(resultFile.isStepFileAnErrorResultFile() ? " EXCEPTION:\n"+ directory.getExceptionFromFile(resultFile) : "")
+                                +"\n");        
+        
+        BatchStepFileDescriptor[] files = {runFile, resultFile};
+        completedSteps.add(files);
+    }
+	
+    /**
+     * Print a summary of the steps that ran and the steps that haven't completed yet.
+     */
+	protected void logContainerResultsSummary() {
+	    LOG.info("Printing container results...");	    
+	    
+	    containerResults.append("\n\nCompleted Steps: \n");	    
+	    if (completedSteps.isEmpty()) { containerResults.append("None"); }
+	    
+	    for(BatchStepFileDescriptor[] batchStepFile : completedSteps) {
+	        String status = batchStepFile[1].getExtension();
+	        Date startedDate = batchStepFile[0].getStartedDate();
+	        Date completedDate = batchStepFile[1].getCompletedDate();
+	        
+            containerResults.append(batchStepFile[0] +"=" +status +"; S:"+ startedDate +" F:"+ completedDate +"\n");
+	    }
+	    
+	    containerResults.append("\n\nIncomplete Steps: \n");
+	    if (startedSteps.isEmpty()) { containerResults.append("None"); }
+	    
+	    for(Iterator<BatchStepFileDescriptor> iter = startedSteps.values().iterator(); iter.hasNext();) {
+	        BatchStepFileDescriptor batchStepFile = iter.next();	        
+	        
+            Date startedDate = batchStepFile.getStartedDate();
+            
+            containerResults.append(batchStepFile +"; S:"+ startedDate +"\n");
+	    }
+	    
+	    LOG.info(containerResults);
+	}
+
+	/**
+	 * The path to the directory in which BatchContainerStep, BatchStepExecutor, and BatchStepTrigger will read and write the step semaphore files.
+	 * 
+	 * @param batchContainerDirectory
+	 */
+	public void setBatchContainerDirectory(String batchContainerDirectory) {
+		this.batchContainerDirectory = batchContainerDirectory;
+	}
+	
+	/**
+	 * The Step which indicates to the Batch Container to shut itself down.
+	 * 
+	 * @param batchContainerStopStep
+	 */
+	public void setBatchContainerStopStep(Step batchContainerStopStep) {
+		this.batchContainerStopStep = batchContainerStopStep;
+	}
+	
+	/**
+	 * @return the batchContainerStopStep
+	 */
+	public Step getBatchContainerStopStep() {
+	    return this.batchContainerStopStep;
+	}
+}
Index: work/src/org/kuali/kfs/sys/batch/service/impl/SchedulerServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/service/impl/SchedulerServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/batch/service/impl/SchedulerServiceImpl.java	(revision 37225)
@@ -22,6 +22,8 @@
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
+import java.util.Map.Entry;
+import java.util.Set;
 
 import org.apache.commons.lang.StringUtils;
 import org.apache.log4j.Logger;
@@ -101,6 +103,8 @@
             initializeJobsForModule(moduleService);
             initializeTriggersForModule(moduleService);
         }
+        
+        dropDependenciesNotScheduled();
     }
     /**
      * Initializes all of the jobs into Quartz for the given ModuleService
@@ -162,7 +166,37 @@
             addJob(jobDetail);
         }
     }
+    
+    /**
+     * Remove dependencies that are not scheduled. Important for modularization if some
+     * modules arn't loaded or if institutions don't schedule some dependencies
+     */
+    protected void dropDependenciesNotScheduled() {
+        try {
+            List<String> scheduledGroupJobNames = Arrays.asList(scheduler.getJobNames(SCHEDULED_GROUP));
+            
+            for (String jobName : scheduledGroupJobNames) {
+                JobDescriptor jobDescriptor = BatchSpringContext.getJobDescriptor(jobName);
 
+                if (jobDescriptor != null && jobDescriptor.getDependencies() != null) {
+                    // dependenciesToBeRemoved so to avoid ConcurrentModificationException
+                    ArrayList<Entry<String, String>> dependenciesToBeRemoved = new ArrayList<Entry<String, String>>();
+                    Set<Entry<String, String>> dependenciesSet = jobDescriptor.getDependencies().entrySet();
+                    for (Entry<String, String> dependency : dependenciesSet) {
+                        String dependencyJobName = dependency.getKey();
+                        if (!scheduledGroupJobNames.contains(dependencyJobName)) {
+                            LOG.warn("Removing dependency " + dependencyJobName + " from " + jobName + " because it is not scheduled.");
+                            dependenciesToBeRemoved.add(dependency);
+                        }
+                    }
+                    dependenciesSet.removeAll(dependenciesToBeRemoved);
+                }
+            }
+        } catch (SchedulerException e) {
+            throw new RuntimeException("Caught exception while trying to drop dependencies that are not scheduled", e);
+        }
+    }
+
     /**
      * @see org.kuali.kfs.sys.batch.service.SchedulerService#initializeJob(java.lang.String,org.kuali.kfs.sys.batch.Job)
      */
@@ -271,6 +305,7 @@
      * @see org.kuali.kfs.sys.batch.service.SchedulerService#processWaitingJobs()
      */
     public void processWaitingJobs() {
+        LOG.info("Inside processWaitingJobs ");
         try {
             for (String scheduledJobName : scheduler.getJobNames(SCHEDULED_GROUP)) {
                 JobDetail jobDetail = getScheduledJobDetail(scheduledJobName);
@@ -476,10 +511,12 @@
     }
 
     protected boolean shouldCancelJob(JobDetail jobDetail) {
+        LOG.info("shouldCancelJob:::::: " + jobDetail.getFullName());
         if ( jobDetail == null ) {
             return true;
         }
         for (String dependencyJobName : getJobDependencies(jobDetail.getName()).keySet()) {
+            LOG.info("dependencyJobName:::::" + dependencyJobName);
             JobDetail dependencyJobDetail = getScheduledJobDetail(dependencyJobName);
             if (isDependencySatisfiedNegatively(jobDetail, dependencyJobDetail)) {
                 return true;
@@ -496,6 +533,7 @@
     }
 
     protected boolean isDependencySatisfiedNegatively(JobDetail dependentJobDetail, JobDetail dependencyJobDetail) {
+       LOG.info("isDependencySatisfiedNegatively::::  dependentJobDetail::: " + dependencyJobDetail.getFullName() + " dependencyJobDetail    " + dependencyJobDetail.getFullName() );
         if ( dependentJobDetail == null || dependencyJobDetail == null ) {
             return true;
         }
@@ -507,6 +545,7 @@
     }
 
     protected Map<String, String> getJobDependencies(String jobName) {
+        LOG.info("getJobDependencies:::: for job " + jobName);
         return BatchSpringContext.getJobDescriptor(jobName).getDependencies();
     }
 
@@ -544,6 +583,7 @@
     }
 
     protected JobDetail getScheduledJobDetail(String jobName) {
+        LOG.info("getScheduledJobDetail ::::::: " + jobName);
         try {
             JobDetail jobDetail = scheduler.getJobDetail(jobName, SCHEDULED_GROUP);
             if ( jobDetail == null ) {
Index: work/src/org/kuali/kfs/sys/batch/service/impl/BatchInputFileServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/service/impl/BatchInputFileServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/batch/service/impl/BatchInputFileServiceImpl.java	(revision 37225)
@@ -18,7 +18,7 @@
 import java.io.ByteArrayInputStream;
 import java.io.File;
 import java.io.FileNotFoundException;
-import java.io.FileWriter;
+import java.io.FileOutputStream;
 import java.io.FilenameFilter;
 import java.io.IOException;
 import java.io.InputStream;
@@ -111,7 +111,9 @@
 
         // defer to batch input type to add any security or other needed information to the file name
         String saveFileName = batchInputFileType.getDirectoryPath() + "/" + batchInputFileType.getFileName(user.getPrincipalName(), parsedObject, fileUserIdentifier);
-        saveFileName += "." + batchInputFileType.getFileExtension();
+        if (!StringUtils.isBlank(batchInputFileType.getFileExtension())) {
+            saveFileName += "." + batchInputFileType.getFileExtension();
+        }
 
         // consruct the file object and check for existence
         File fileToSave = new File(saveFileName);
@@ -121,15 +123,15 @@
         }
 
         try {
-            FileWriter fileWriter = new FileWriter(fileToSave);
-            while (fileContents.available() > 0) {
-                fileWriter.write(fileContents.read());
+            FileOutputStream fos = new FileOutputStream(fileToSave);
+            while(fileContents.available() > 0) {
+                fos.write(fileContents.read());
             }
-            fileWriter.flush();
-            fileWriter.close();
-
-            createDoneFile(fileToSave);
+            fos.flush();
+            fos.close();
             
+            createDoneFile(fileToSave, batchInputFileType);
+            
             batchInputFileType.process(saveFileName, parsedObject);
         }
         catch (IOException e) {
@@ -143,8 +145,9 @@
     /**
      * Creates a '.done' file with the name of the batch file.
      */
-    protected void createDoneFile(File batchFile) {
-        File doneFile = generateDoneFileObject(batchFile);
+    protected void createDoneFile(File batchFile ,BatchInputFileType batchInputFileType ) {
+        String fileExtension = batchInputFileType.getFileExtension();
+        File doneFile = generateDoneFileObject(batchFile, fileExtension);
         String doneFileName = doneFile.getName();
 
         if (!doneFile.exists()) {
@@ -172,8 +175,9 @@
      * @return a File object representing the done file. The real file may not exist on disk, but the return value can be used to
      *         create that file.
      */
-    protected File generateDoneFileObject(File batchInputFile) {
-        String doneFileName = StringUtils.substringBeforeLast(batchInputFile.getPath(), ".") + ".done";
+    protected File generateDoneFileObject(File batchInputFile, String fileExtension) {
+        String doneFileName = fileExtension != null  ? StringUtils.substringBeforeLast(batchInputFile.getPath(), ".") + ".done" :
+                                batchInputFile.getPath() + ".done" ;
         File doneFile = new File(doneFileName);
         return doneFile;
     }
@@ -231,7 +235,7 @@
             for (int i = 0; i < filesInBatchDirectory.length; i++) {
                 File batchFile = filesInBatchDirectory[i];
                 String fileExtension = StringUtils.substringAfterLast(batchFile.getName(), ".");
-                if (batchInputFileType.getFileExtension().equals(fileExtension)) {
+                if (StringUtils.isBlank(batchInputFileType.getFileExtension()) || batchInputFileType.getFileExtension().equals(fileExtension)) {
                     if (user.getPrincipalName().equals(batchInputFileType.getAuthorPrincipalName(batchFile))) {
                         userFileList.add(batchFile);
                     }
@@ -264,7 +268,13 @@
         List<String> batchInputFiles = new ArrayList<String>();
         for (int i = 0; i < doneFiles.length; i++) {
             File doneFile = doneFiles[i];
-            File dataFile = new File(StringUtils.substringBeforeLast(doneFile.getPath(), ".") + "." + batchInputFileType.getFileExtension());
+            
+            String dataFileName = StringUtils.substringBeforeLast(doneFile.getPath(), ".");
+            if (!StringUtils.isBlank(batchInputFileType.getFileExtension())) {
+                dataFileName += "." + batchInputFileType.getFileExtension();
+            }
+            
+            File dataFile = new File(dataFileName);
             if (dataFile.exists()) {
                 batchInputFiles.add(dataFile.getPath());
             }
Index: work/src/org/kuali/kfs/sys/batch/service/impl/FiscalYearMakerServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/service/impl/FiscalYearMakerServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/batch/service/impl/FiscalYearMakerServiceImpl.java	(revision 37225)
@@ -45,9 +45,9 @@
 public class FiscalYearMakerServiceImpl implements FiscalYearMakerService {
     private static Logger LOG = org.apache.log4j.Logger.getLogger(FiscalYearMakerServiceImpl.class);
 
-    private FiscalYearMakersDao fiscalYearMakersDao;
-    private ParameterService parameterService;
-    private KualiModuleService kualiModuleService;
+    protected FiscalYearMakersDao fiscalYearMakersDao;
+    protected ParameterService parameterService;
+    protected KualiModuleService kualiModuleService;
 
     private List<FiscalYearMaker> fiscalYearMakers;
 
Index: work/src/org/kuali/kfs/sys/batch/service/impl/BatchFileAdminAuthorizationServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/service/impl/BatchFileAdminAuthorizationServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/batch/service/impl/BatchFileAdminAuthorizationServiceImpl.java	(revision 37225)
@@ -24,6 +24,7 @@
 import org.kuali.kfs.sys.batch.BatchFileUtils;
 import org.kuali.kfs.sys.batch.service.BatchFileAdminAuthorizationService;
 import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.sys.identity.KfsKimAttributes;
 import org.kuali.rice.kim.bo.Person;
 import org.kuali.rice.kim.bo.impl.KimAttributes;
 import org.kuali.rice.kim.bo.types.dto.AttributeSet;
@@ -86,10 +87,26 @@
     protected AttributeSet generatePermissionDetails(BatchFile batchFile, Person user) {
         AttributeSet permissionDetails = new AttributeSet();
         permissionDetails.put(KimAttributes.NAMESPACE_CODE, determineNamespaceCode(batchFile));
-        permissionDetails.put("filePath", batchFile.retrieveFile().getAbsolutePath());
+        permissionDetails.put(KfsKimAttributes.FILE_PATH, replaceSlashes(batchFile.getPath() + File.separator + batchFile.getFileName()));
         return permissionDetails;
     }
     
+    /**
+     * The permissions for the filePath will be added using '/' directory separators. 
+     * This method will replace any '\\' directory separators with '/' 
+     * 
+     * @param filePath
+     * @return 
+     */
+    private String replaceSlashes(String filePath) {
+        
+        if (File.separatorChar == '\\') {
+            filePath = filePath.replace(File.separatorChar, '/');
+        }
+        
+        return filePath;
+    }
+    
     protected AttributeSet generateRoleQualifiers(BatchFile batchFile, Person user) {
         return new AttributeSet();
     }
Index: work/src/org/kuali/kfs/sys/batch/FlatFileSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileSpecification.java	(revision 37225)
@@ -0,0 +1,39 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.List;
+
+/**
+ * Contract of methods for the configuration element which specifies how to parse a flat file
+ */
+public interface FlatFileSpecification {
+    /**
+     * @return a List of the specifications for all objects which will be parsed into during the course of
+     * this flat file parse
+     */
+	public List<FlatFileObjectSpecification> getObjectSpecifications();
+
+	/**
+	 * Retrieves the FlatFilePrefixObjectSpecification specifically associated with a given class
+	 * @param businessObjectClass the class of a business object which will be parsed into
+	 * @return the corresponding FlatFilePrefixObjectSpecification configuration object
+	 */
+	public FlatFileObjectSpecification getObjectSpecification(Class<?> businessObjectClass);
+
+	/**
+	 * Determines the Class of the business object that the given line should be parsed into
+	 * @param line the current line of the flat file parser being parsed
+	 * @return the Class of the business object that the given line will be parsed into
+	 */
+	public Class<?> determineClassForLine(String line);
+
+	/**
+	 * Parses the current line of the flat file into a business object
+	 * @param parseSpecification the specification explaining how to parse the line into the business object
+	 * @param lineToParse the current line being parsed
+	 * @param parseIntoObject the target object to parse into
+	 * @param lineNumber the current line number
+	 */
+	public void parseLineIntoObject(
+			FlatFileObjectSpecification parseSpecification, String lineToParse,
+			Object parseIntoObject, int lineNumber);
+}
Index: work/src/org/kuali/kfs/sys/batch/PhysicalFlatFileInformation.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/PhysicalFlatFileInformation.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/PhysicalFlatFileInformation.java	(revision 37225)
@@ -0,0 +1,110 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+/**
+ * This class represents a full file which can be separated into a number of logical files, each logical file
+ * holding its own set of errors, warnings, and informative messages for post-processing 
+ */
+public class PhysicalFlatFileInformation {
+    private String fileName;
+    private List<String[]> messages;
+    private List<FlatFileInformation> flatFileInfomationList;
+    
+    /**
+     * Constructs a PhysicalFlatFileInformation
+     * @param fileName the name of the file this encapsulates
+     */
+    public PhysicalFlatFileInformation(String fileName) {
+        this.fileName = fileName;
+        messages = new ArrayList<String[]>();
+        flatFileInfomationList = new ArrayList<FlatFileInformation>();
+    }
+    
+    public void addFileErrorMessages(List<String> messages) {
+        for(String message : messages) {
+            this.messages.add(new String[] { FlatFileTransactionInformation.getEntryTypeString(FlatFileTransactionInformation.EntryType.ERROR), message });
+        }
+    }
+    
+    /**
+     * Adds an error message applicable to the entire file
+     * @param message
+     */
+    public void addFileErrorMessage(String message) {
+        this.messages.add(new String[] { FlatFileTransactionInformation.getEntryTypeString(FlatFileTransactionInformation.EntryType.ERROR), message });
+    }
+    
+    public void addFileInfoMessage(List<String> messages) {
+        for(String message : messages) {
+            this.messages.add(new String[] { FlatFileTransactionInformation.getEntryTypeString(FlatFileTransactionInformation.EntryType.INFO), message });
+        }
+    }
+
+    /**
+     * Adds an informative message applicable to the entire file
+     * @param message
+     */
+    public void addFileInfoMessage(String message) {
+        this.messages.add(new String[] { FlatFileTransactionInformation.getEntryTypeString(FlatFileTransactionInformation.EntryType.INFO), message });
+    }
+
+    /**
+     * @return the file name of the physical file encapsulated in this PhysicalFlatFileInformation object
+     */
+    public String getFileName() {
+        return fileName;
+    }
+
+    /**
+     * Sets the file name of the physical file encapsulated in this PhysicalFlatFileInformation object
+     * @param fileName the file name of the physical file encapsulated in this PhysicalFlatFileInformation object
+     */
+    public void setFileName(String fileName) {
+        this.fileName = fileName;
+    }
+
+    /**
+     * @return a List of all messages associated with the physical file as a whole
+     */
+    public List<String[]> getMessages() {
+        return messages;
+    }
+    
+    public String getAllMessages() {
+        StringBuffer message = new StringBuffer();
+        for(String[] resultMessage : getMessages()) {
+            message.append(resultMessage[1]);
+            message.append("\n");
+        }
+        return message.toString();
+    }
+    
+    /**
+     * Sets a List of messages associated with the physical file as a whole
+     * @param messages a List of messages
+     */
+    public void setMessages(List<String[]> messages) {
+        this.messages = messages;
+    }
+
+
+    /**
+     * @return a List of the FlatFileInformation objects, each representing a logical file within this physical file
+     */
+    public List<FlatFileInformation> getFlatFileInfomationList() {
+        return flatFileInfomationList;
+    }
+
+
+    /**
+     * Sets the List of FlatFileInformation objects, each representing a logical file within the encapsulated physical file
+     * @param flatFileInfomationList
+     */
+    public void setFlatFileInfomationList(List<FlatFileInformation> flatFileInfomationList) {
+        this.flatFileInfomationList = flatFileInfomationList;
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileTransactionInformation.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileTransactionInformation.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileTransactionInformation.java	(revision 37225)
@@ -0,0 +1,151 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * An encapsulator for validation information associated with a logical file/top level header
+ */
+public final class FlatFileTransactionInformation {
+    public enum ResultCode { SUCCESS, FAILURE, ERROR, INCOMPLETE }
+    public enum EntryType { INFO,WARN, ERROR  } 
+
+    private String flatFileDataIdentifier;
+    private ResultCode result;
+    private List<String[]> messages;
+
+    /**
+     * Constructs a FlatFileTransactionInformation
+     */
+    public FlatFileTransactionInformation() {
+        this.messages = new ArrayList<String[]>();
+    }
+    
+    /**
+     * Constructs a FlatFileTransactionInformation
+     * @param flatFileDataIdentifier the identifier for the file the business object this object holds messages for was parsed from
+     */
+    public FlatFileTransactionInformation(String flatFileDataIdentifier) {
+        this.flatFileDataIdentifier = flatFileDataIdentifier;
+        this.result = ResultCode.INCOMPLETE;
+        this.messages = new ArrayList<String[]>();
+    }
+    
+    /**
+     * Creates a String representation for the given entry type
+     * @param type the entry type to get a String representation for
+     * @return the String representation
+     */
+    public static String getEntryTypeString(EntryType type) {
+        if (type == null) return "UNKNOWN";
+        return type.name();
+    }
+    
+    /**
+     * Creates a String representation for the given result code
+     * @param type the resultCode to get a String representation for
+     * @return the String representation
+     */
+    public static String getResultCodeString(ResultCode resultCode) {
+        if (resultCode == null) return "UNKNOWN";
+        return resultCode.name();
+    }
+    
+    /**
+     * @return returns the resultCode for this transaction information object
+     */
+    public ResultCode getResult() {
+        return result;
+    }
+    
+    /**
+     * @return returns a String representation of the resultCode for this transaction information object
+     */
+    public String getResultString() {
+        return getResultCodeString(result);
+    }
+    
+    /**
+     * Sets the resultCode for this transaction information object
+     * @param result the result code to set
+     */
+    private void setResult(ResultCode result) {
+        this.result = result;
+    }
+    
+    /**
+     * Declares the logical file a success!
+     */
+    public void setSuccessResult() {
+        this.result = ResultCode.SUCCESS;
+    }
+    
+    /**
+     * Sets the result code to failure for the transaction
+     */
+    public void setFailureResult() {
+        this.result = ResultCode.FAILURE;
+    }
+    
+    /**
+     * Sets the result code to error for the transaction
+     */
+    public void setErrorResult() {
+        this.result = ResultCode.ERROR;
+    }
+        
+    /**
+     * @return the identifier for the flat file this is associated with
+     */
+    public String getFlatFileDataIdentifier() {
+        return flatFileDataIdentifier;
+    }
+
+    /**
+     * Sets the identifier for the flat file this is associated with
+     * @param flatFileDataIdentifier the identifier for the flat file this is associated with
+     */
+    public void setFlatFileDataIdentifier(String flatFileDataIdentifier) {
+        this.flatFileDataIdentifier = flatFileDataIdentifier;
+    }
+
+    /**
+     * @return the full List of messages associated with the transaction this is associated with
+     */
+    public List<String[]> getMessages() {
+        return messages;
+    }
+    
+    /**
+     * Adds a message to the List of messages for this transaction
+     * @param entryType the kind of message being held
+     * @param message the message to hold
+     */
+    private void addMessage(EntryType entryType, String message) {
+        this.messages.add(new String[] { getEntryTypeString(entryType), message });
+    }
+    
+    /**
+     * Adds an error message for this transaction
+     * @param message the message to explain the error
+     */
+    public void addErrorMessage(String message) {
+        addMessage(EntryType.ERROR, message);
+    }
+    
+    /**
+     * Adds an informative message for this transaction
+     * @param message the informative message, hopefully something more explanatory than this javadoc
+     */
+    public void addInfoMessage(String message) {
+        addMessage(EntryType.INFO, message);
+    }
+    
+    /**
+     * Adds a warning message for this transaction
+     * @param message the warning message
+     */
+    public void addWarnMessage(String message) {
+        addMessage(EntryType.WARN, message);
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/AbstractFlatFileSpecificationBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/AbstractFlatFileSpecificationBase.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/AbstractFlatFileSpecificationBase.java	(revision 37225)
@@ -0,0 +1,79 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.batch;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import org.springframework.beans.factory.InitializingBean;
+
+
+/**
+ * Abstract class which is the parent of all FlatFileSpecification implementations
+ */
+public abstract class AbstractFlatFileSpecificationBase implements FlatFileSpecification, InitializingBean {
+    protected Class<?> defaultBusinessObjectClass;
+    protected List<FlatFileObjectSpecification> objectSpecifications;
+    private List<Class<?>> childrenList = new ArrayList<Class<?>>();
+    
+    /**
+     * @see org.kuali.kfs.sys.batch.FlatFileSpecification#getObjectSpecification(Class)
+     */
+    public FlatFileObjectSpecification getObjectSpecification(Class<?> businessObjectClass) {
+        for (FlatFileObjectSpecification objectSpecification : objectSpecifications) {
+            if (objectSpecification.getBusinessObjectClass().equals(businessObjectClass)) {
+                return objectSpecification;
+            }
+        }
+        return null;
+    }
+
+    /**
+     * @see org.kuali.kfs.sys.batch.FlatFileSpecification#getObjectSpecifications()
+     */
+    public List<FlatFileObjectSpecification> getObjectSpecifications() {
+        return objectSpecifications;
+    }
+    
+
+    /**
+     * Sets the list of FlatFileObjectSpecifications which instruct the FlatFileSpecification how to parse
+     * @param objectSpecifications
+     */
+    public void setObjectSpecifications(List<FlatFileObjectSpecification> objectSpecifications) {
+        this.objectSpecifications = objectSpecifications;
+    }
+
+    public void setDefaultBusinessObjectClass(Class<?> businessObjectClass) {
+        this.defaultBusinessObjectClass = businessObjectClass;
+    }
+    
+    public void afterPropertiesSet() throws Exception{
+        Class<?> child;
+        for(FlatFileObjectSpecification specification: objectSpecifications) {
+            if(specification.getParentBusinessObjectClass() != null) {
+                child = specification.getBusinessObjectClass();
+                if(childrenList.contains(child)) {
+                    //A child can't appear twice within the same configuration, without having two parents
+                    throw new Exception("The child " + child + " can't have more than one parent");
+                } else {
+                    childrenList.add(child);
+                }
+            }
+        }
+    }
+
+}
\ No newline at end of file
Index: work/src/org/kuali/kfs/sys/batch/FlatFileObjectSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileObjectSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileObjectSpecification.java	(revision 37225)
@@ -0,0 +1,31 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.batch;
+
+import java.util.List;
+
+
+public interface FlatFileObjectSpecification {
+
+    public abstract Class<?> getBusinessObjectClass();
+
+    public abstract List<FlatFilePropertySpecification> getParseProperties();
+
+    public abstract Class<?> getParentBusinessObjectClass();
+
+    public abstract String getParentTargetProperty();
+
+}
\ No newline at end of file
Index: work/src/org/kuali/kfs/sys/batch/FlatFileData.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileData.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileData.java	(revision 37225)
@@ -0,0 +1,12 @@
+package org.kuali.kfs.sys.batch;
+
+/**
+ * Interface for flat file parsed into objects which generates error messages per top-level business object 
+ */
+public interface  FlatFileData  {
+    /**
+     * @return the FlatFileTransactionInformation for this parsed into business object
+     */
+    public FlatFileTransactionInformation getFlatFileTransactionInformation() ;
+    
+}
Index: work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFileRegexSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFileRegexSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFileRegexSpecification.java	(revision 37225)
@@ -0,0 +1,44 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.batch;
+
+/**
+ * A flat file specification which matches lines via regular expressions and parses them via flat files
+ */
+public class FixedWidthFlatFileRegexSpecification extends AbstractRegexSpecificationBase {
+
+    /**
+     * Parses the given line into the given object to parse into
+     * @param parseSpecification the specification of the parsing
+     * @param lineToParse the line to parse into the object
+     * @param parseIntoObject the object to parse into
+     */
+    public void parseLineIntoObject(FlatFileObjectSpecification parseSpecification, String lineToParse, Object parseIntoObject, int lineNumber) {
+        // loop through the properties to format and set the property values
+        // from the input line
+        for (FlatFilePropertySpecification propertySpecification : parseSpecification.getParseProperties()) {
+            int start = ((FixedWidthFlatFilePropertySpecification) propertySpecification).getStart();
+            int end = ((FixedWidthFlatFilePropertySpecification) propertySpecification).getEnd();
+            // if end is not specified, read to the end of line
+            if (end == 0) {
+                end = lineToParse.length();
+            }
+            String subString = lineToParse.substring(start, end);
+            propertySpecification.setProperty(subString, parseIntoObject, lineNumber);
+        }
+    }
+
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileRegexObjectSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileRegexObjectSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileRegexObjectSpecification.java	(revision 37225)
@@ -0,0 +1,53 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.batch;
+
+import java.util.regex.Pattern;
+
+import org.apache.commons.lang.StringUtils;
+
+/**
+ * FlatFileObjectSpecification for files which match lines to objects via regular expression patterns
+ */
+public class FlatFileRegexObjectSpecification extends AbstractFlatFileObjectSpecification {
+    protected String regexPattern;
+    protected Pattern pattern;
+    
+    /**
+     * @return the regular expression pattern to match lines with
+     */
+    public String getRegexPattern() {
+        return regexPattern;
+    }
+    /**
+     * Sets a regex pattern to match lines with
+     * @param regexPattern the regular expression pattern to match lines with
+     */
+    public void setRegexPattern(String regexPattern) {
+        this.regexPattern = regexPattern;
+    }
+    /**
+     * @return the Pattern to match lines for this object specification
+     */
+    public Pattern getPattern() {
+        if (pattern == null && !StringUtils.isBlank(regexPattern)) {
+            pattern = Pattern.compile(regexPattern);
+        }
+        return pattern;
+    }
+    
+    
+}
Index: work/src/org/kuali/kfs/sys/batch/Job.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/Job.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/batch/Job.java	(revision 37225)
@@ -21,6 +21,7 @@
 import java.text.DateFormat;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
+import java.util.Calendar;
 import java.util.Date;
 import java.util.Iterator;
 import java.util.List;
@@ -60,6 +61,7 @@
     public static final String STEP_RUN_PARM_NM = "RUN_IND";    
     public static final String STEP_RUN_ON_DATE_PARM_NM = "RUN_DATE";
     public static final String STEP_USER_PARM_NM = "USER";
+    public static final String RUN_DATE_CUTOFF_PARM_NM = "RUN_DATE_CUTOFF_TIME";
     
     private static final Logger LOG = Logger.getLogger(Job.class);
     private SchedulerService schedulerService;
@@ -220,23 +222,27 @@
         
         boolean runDateExists = parameterService.parameterExists(stepClass, STEP_RUN_ON_DATE_PARM_NM);
         boolean runDateIsEmpty = (runDateExists ? StringUtils.isEmpty(parameterService.getParameterValue(stepClass, STEP_RUN_ON_DATE_PARM_NM)) : true);
-        boolean runDateContainsTodaysDate = (runDateExists ? parameterService.getParameterValues(stepClass, STEP_RUN_ON_DATE_PARM_NM).contains(dTService.toString(jobRunDate, dateFormat)): true);
-
+        List<String> runDates = null;
+        if(runDateExists) {
+            runDates = parameterService.getParameterValues(stepClass, STEP_RUN_ON_DATE_PARM_NM);
+        }
+        boolean runDateContainsTodaysDate = (runDateExists ? runDates.contains(dTService.toString(jobRunDate, dateFormat)): true);
+        
         if (!runInd && !runDateExists) {
             if (LOG.isInfoEnabled()) {
                 LOG.info("Skipping step due to system parameter: " + STEP_RUN_PARM_NM +" for "+ stepClass.getName());
             }            
             return true;
         }
-        else if (!runInd && !runDateIsEmpty && !runDateContainsTodaysDate) {
+        else if (!runInd && !runDateIsEmpty && !runDateContainsTodaysDate && isPastCutoffWindow(jobRunDate, runDates)) {
             if (LOG.isInfoEnabled()) {
-                LOG.info("Skipping step due to system parameters: " + STEP_RUN_PARM_NM + " and " + STEP_RUN_ON_DATE_PARM_NM +" for "+ stepClass.getName());
+                LOG.info("Skipping step due to system parameters: " + STEP_RUN_PARM_NM + ", " + STEP_RUN_ON_DATE_PARM_NM + " and " + RUN_DATE_CUTOFF_PARM_NM + " for "+ stepClass.getName());
             }
             return true;
         }
-        else if (!runIndExists && !runDateIsEmpty && !runDateContainsTodaysDate) {
+        else if (!runIndExists && !runDateIsEmpty && !runDateContainsTodaysDate && isPastCutoffWindow(jobRunDate, runDates)) {
             if (LOG.isInfoEnabled()) {
-                LOG.info("Skipping step due to system parameter: " + STEP_RUN_ON_DATE_PARM_NM +" for "+ stepClass.getName());
+                LOG.info("Skipping step due to system parameter: " + STEP_RUN_ON_DATE_PARM_NM +  " and " + RUN_DATE_CUTOFF_PARM_NM +" for "+ stepClass.getName());
             }
             return true;
         }
@@ -244,6 +250,32 @@
             return false;
         }
     }
+    
+    public static boolean isPastCutoffWindow(Date date, List<String> runDates) {
+        DateTimeService dTService = SpringContext.getBean(DateTimeService.class);
+        ParameterService parameterService = SpringContext.getBean(ParameterService.class);
+        Calendar jobRunDate = dTService.getCalendar(date);
+        if (parameterService.parameterExists(KfsParameterConstants.FINANCIAL_SYSTEM_BATCH.class, RUN_DATE_CUTOFF_PARM_NM)) {
+            String[] cutOffTime = StringUtils.split(parameterService.getParameterValue(KfsParameterConstants.FINANCIAL_SYSTEM_BATCH.class, RUN_DATE_CUTOFF_PARM_NM), ':');
+            Calendar runDate = null;
+            for (String runDateStr : runDates) {
+                try {
+                    runDate = dTService.getCalendar(dTService.convertToDate(runDateStr));
+                    runDate.add(Calendar.DAY_OF_YEAR, 1);
+                    runDate.set(Calendar.HOUR_OF_DAY, Integer.parseInt(cutOffTime[0]));
+                    runDate.set(Calendar.MINUTE, Integer.parseInt(cutOffTime[1]));
+                    runDate.set(Calendar.SECOND, Integer.parseInt(cutOffTime[2]));
+                }
+                catch (ParseException e) {
+                    LOG.error("ParseException occured parsing " + runDateStr, e);
+                }
+                if (jobRunDate.before(runDate)) {
+                    return false;
+                }
+            }
+        }
+        return true;
+    }
 
     /**
      * @throws UnableToInterruptJobException
Index: work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFilePropertySpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFilePropertySpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FixedWidthFlatFilePropertySpecification.java	(revision 37225)
@@ -0,0 +1,42 @@
+package org.kuali.kfs.sys.batch;
+
+import org.kuali.rice.kns.service.KNSServiceLocator;
+
+/**
+ * The FixedWidthFlatFilePropertySpecification is used to
+ * specify details relating to record in the given line of the input file.
+ */
+public class FixedWidthFlatFilePropertySpecification extends AbstractFlatFilePropertySpecificationBase {
+    protected int start;
+    protected int end;
+
+    /**
+     * @return the beginning index of the substring to parse
+     */
+    public int getStart() {
+        return start;
+    }
+
+    /**
+     * Sets the beginning index of the substring to parse
+     * @param start the beginning index of the substring to parse
+     */
+    public void setStart(int start) {
+        this.start = start;
+    }
+
+    /**
+     * @return the ending index of the substring to parse; if empty, line will be parsed to end of String
+     */
+    public int getEnd() {
+        return end;
+    }
+
+    /**
+     * Sets the ending index of the substring to parse; if not set, line will be parsed to end of String
+     * @param end the ending index of the substring to parse
+     */
+    public void setEnd(int end) {
+        this.end = end;
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/DelimitedFlatFilePropertySpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/DelimitedFlatFilePropertySpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/DelimitedFlatFilePropertySpecification.java	(revision 37225)
@@ -0,0 +1,14 @@
+package org.kuali.kfs.sys.batch;
+
+
+public class DelimitedFlatFilePropertySpecification extends AbstractFlatFilePropertySpecificationBase {
+	private int lineSegmentIndex;
+
+	public int getLineSegmentIndex() {
+		return lineSegmentIndex;
+	}
+	
+	public void setLineSegmentIndex(int lineSegmentIndex) {
+		this.lineSegmentIndex = lineSegmentIndex;
+	}
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileDataHandler.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileDataHandler.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileDataHandler.java	(revision 37225)
@@ -0,0 +1,30 @@
+package org.kuali.kfs.sys.batch;
+
+/**
+ * The interface for a FlatFileDataValidator.  Implementations will have code which validates the parsed contents of the flat file.
+ */
+public interface FlatFileDataHandler {
+	
+	/**
+     * Performs specific validation on the parsed file contents. If errors were found, method will return false and
+     * GlobalVariables.errorMap will contain the error message. If no errors were encountered the method will return true.
+     * 
+     * @param parsedFileContents - object populated with the uploaded file contents
+     */
+	public abstract boolean validate(Object parsedFileContents);
+	
+	 /**
+     * Invokes optional processing of file after validation
+     * 
+     * @param fileName name of the file
+     * @param parsedFileContents objects populated with file contents
+     */
+    public abstract void process(String fileName, Object parsedFileContents);
+    
+    /**
+     * Returns the name of an uploaded file. 
+     */
+    public  String getFileName(String principalName, Object parsedFileContents, String fileUserIdentifier) ;
+        
+   
+}
Index: work/src/org/kuali/kfs/sys/batch/AbstractFlatFilePrefixSpecificationBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/AbstractFlatFilePrefixSpecificationBase.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/AbstractFlatFilePrefixSpecificationBase.java	(revision 37225)
@@ -0,0 +1,62 @@
+package org.kuali.kfs.sys.batch;
+
+import java.util.List;
+
+import org.springframework.util.StringUtils;
+
+/**
+ * The abstract base class of the configuration element which specifies how to parse flat files
+ */
+public abstract class AbstractFlatFilePrefixSpecificationBase extends AbstractFlatFileSpecificationBase {
+    protected List<String> insignificantPrefixes;
+    protected int prefixStartingPosition = 0;
+
+    /**
+     * This method determine the class of the given line. It checks the prefix list to see if the line started with what ever the
+     * prefix of the line and returns the class; if not , it returns the default class.
+     * @param line the line to determine the class of
+     * @see org.kuali.kfs.sys.batch.FlatFileSpecification#determineClassForLine(String)
+     */
+    public Class<?> determineClassForLine(String line) {
+        if (line != null) {
+            if (objectSpecifications != null && !objectSpecifications.isEmpty()) {
+                for (FlatFileObjectSpecification objectSpecification : objectSpecifications) {
+                    final FlatFilePrefixObjectSpecification prefixObjectSpecification = (FlatFilePrefixObjectSpecification)objectSpecification;
+                    String prefix = prefixObjectSpecification.getLinePrefix();
+                    if ((prefix != null) && (line.length() >= (prefixStartingPosition + prefix.length())) && 
+                            (line.substring(prefixStartingPosition, prefixStartingPosition + prefix.length()).equals(prefix))) {
+                        return objectSpecification.getBusinessObjectClass();
+                    }
+                }
+            }
+            if (insignificantPrefixes != null && !insignificantPrefixes.isEmpty()) {
+                for (String insignificantPrefix : insignificantPrefixes) {
+                    if ((line.length() >= (prefixStartingPosition + insignificantPrefix.length())) && 
+                            line.substring(prefixStartingPosition, prefixStartingPosition + insignificantPrefix.length()).
+                            equals(insignificantPrefix)) {
+                        return null; // don't return any class for an insignificant prefix
+                    }
+                }
+            }
+            return defaultBusinessObjectClass;
+        }
+
+        return null;
+    }
+
+    /**
+     * Sets the list of prefixes which mean that the line is not to be parsed
+     * @param insignificantPrefixes
+     */
+    public void setInsignificantPrefixes(List<String> insignificantPrefixes) {
+        this.insignificantPrefixes = insignificantPrefixes;
+    }
+
+    /**
+     * Determines where the starting position in the String to look for the prefix substring is; if not set, defaults to 0, the beginning of the String
+     * @param prefixStartingPosition the starting position in the String of the prefix substring
+     */
+    public void setPrefixStartingPosition(int prefixStartingPosition) {
+        this.prefixStartingPosition = prefixStartingPosition;
+    }
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileSortStep.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileSortStep.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileSortStep.java	(revision 37225)
@@ -0,0 +1,48 @@
+/*
+ * Copyright 2011 The Regents of the University of California.
+ */
+package org.kuali.kfs.sys.batch;
+
+import java.io.File;
+import java.util.Comparator;
+import java.util.Date;
+
+import org.kuali.kfs.gl.batch.BatchSortUtil;
+import org.kuali.kfs.sys.batch.AbstractStep;
+
+/**
+ * General purpose sort step which can be configured with any Comparator class.
+ * 
+ * @author jonathan
+ */
+public class FlatFileSortStep extends AbstractStep {
+	private static final org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(FlatFileSortStep.class);
+	protected String inputFileName;
+	protected String outputFileName;
+	protected Class<? extends Comparator<String>> lineComparatorClass;
+	
+	public boolean execute(String jobName, Date jobRunDate) throws InterruptedException {
+        try {
+        	if ( new File(inputFileName).canRead() ) {
+        		BatchSortUtil.sortTextFileWithFields(inputFileName, outputFileName, lineComparatorClass.newInstance());
+        	} else {
+        		LOG.warn( "Input file: " + inputFileName + " does not exist.");
+        	}
+		} catch (Exception ex) {
+			throw new RuntimeException( "Unable to instantiate comparator class for sort: " + lineComparatorClass, ex );
+		}
+		return true;
+	}
+
+	public void setInputFileName(String inputFileName) {
+		this.inputFileName = inputFileName;
+	}
+
+	public void setOutputFileName(String outputFileName) {
+		this.outputFileName = outputFileName;
+	}
+
+	public void setLineComparatorClass( Class<? extends Comparator<String>> lineComparatorClass) {
+		this.lineComparatorClass = lineComparatorClass;
+	}
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFilePrefixObjectSpecification.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFilePrefixObjectSpecification.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFilePrefixObjectSpecification.java	(revision 37225)
@@ -0,0 +1,26 @@
+package org.kuali.kfs.sys.batch;
+
+
+import org.apache.commons.beanutils.PropertyUtils;
+
+/**
+ * The specification for a business object which should be parsed into during the parsing of a flat file
+ */
+public class FlatFilePrefixObjectSpecification extends AbstractFlatFileObjectSpecification {
+
+	protected String linePrefix;
+    /**
+     * @return the prefix of the line which determines if the given line should be associated with this object specification
+     */
+    public String getLinePrefix() {
+		return linePrefix;
+	}
+
+    /**
+     * Sets the prefix that configures which lines this object specification will be associated with
+     * @param linePrefix the prefix
+     */
+	public void setLinePrefix(String linePrefix) {
+		this.linePrefix = linePrefix;
+	}
+}
Index: work/src/org/kuali/kfs/sys/batch/FlatFileParserBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/batch/FlatFileParserBase.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/batch/FlatFileParserBase.java	(revision 37225)
@@ -0,0 +1,197 @@
+package org.kuali.kfs.sys.batch;
+
+import java.io.BufferedReader;
+import java.io.ByteArrayInputStream;
+import java.io.File;
+import java.io.InputStreamReader;
+import java.util.HashMap;
+import java.util.Map;
+
+import org.apache.log4j.Logger;
+import org.kuali.kfs.gl.service.impl.StringHelper;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.sys.exception.ParseException;
+import org.kuali.rice.kns.service.DateTimeService;
+
+/**
+ * Implementation of BatchInputFileType which parses flat files 
+ */
+public class FlatFileParserBase extends BatchInputFileTypeBase {
+    protected static Logger LOG = Logger.getLogger(FlatFileParserBase.class);
+    protected FlatFileSpecification flatFileSpecification;
+    protected String fileNamePrefix;
+    protected DateTimeService dateTimeService;
+    protected String fileTypeIdentifier;
+    protected String titleKey;
+    protected FlatFileDataHandler processor;
+
+    /**
+     * Returns the name of an uploaded file
+     */
+    public String getFileName(String principalName, Object parsedFileContents, String fileUserIdentifier) {
+        String fileName = processor.getFileName(principalName, parsedFileContents, fileUserIdentifier);
+        if(StringHelper.isNullOrEmpty(fileName)) {
+            fileName = getFileNamePrefix();
+            fileName += principalName;
+            if (org.apache.commons.lang.StringUtils.isNotBlank(fileUserIdentifier)) {
+                fileName += "_" + fileUserIdentifier;
+            }
+            fileName += "_" + dateTimeService.toDateTimeStringForFilename(dateTimeService.getCurrentDate());
+    
+            // remove spaces in filename
+            fileName = org.apache.commons.lang.StringUtils.remove(fileName, " ");
+        }
+        return fileName;
+    }
+
+    /**
+     * All foundation developers are brilliant at spelling!
+     * 
+     * @param fileTypeIdentifier the file identifier to set
+     */
+    public void setFileTypeIdentifer(String fileTypeIdentifier) {
+        this.fileTypeIdentifier = fileTypeIdentifier;
+    }
+
+    /**
+     * The correctly spelled setter name - just to avoid injection confusion
+     * 
+     * @param fileTypeIdentifier the file type identifier
+     */
+    public void setFileTypeIdentifier(String fileTypeIdentifier) {
+        this.fileTypeIdentifier = fileTypeIdentifier;
+    }
+
+    /**
+     * Sets the key of the message to show in the title bar of the upload page for this file
+     * @param titleKey
+     */
+    public void setTitleKey(String titleKey) {
+        this.titleKey = titleKey;
+    }
+
+    /**
+     * @return a FlatFileDataValidator associated with this instance of the FixedWidthFlatFileParserBase
+     */
+    public FlatFileDataHandler getProcessor() {
+        return processor;
+    }
+
+    /**
+     * Sets the processor which will validate and process the file once all flat file data has been parsed
+     * @param processor the implementation of FlatFileDataHandler to utilize
+     */
+    public void setProcessor(FlatFileDataHandler processor) {
+        this.processor = processor;
+    }
+
+    /**
+     * Reads each line of the flat file and uses the injected FlatFileSpecification to parse into an object graph
+     * @param fileByteContent the contents file to parse
+     * @return an object graph of parsed objects
+     * @see org.kuali.kfs.sys.batch.BatchInputFileType#parse(byte[])
+     */
+    public Object parse(byte[] fileByteContent) throws ParseException {
+        BufferedReader bufferedFileReader = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(fileByteContent)));
+        String lineToParse;
+        Object returnObject = null;
+        FlatFileParseTracker tracker = SpringContext.getBean(FlatFileParseTracker.class);
+        tracker.initialize(flatFileSpecification);
+        int  lineNumber = 1; 
+        try {
+            while ((lineToParse = bufferedFileReader.readLine()) != null) {
+                Object parseIntoObject = tracker.getObjectToParseInto(lineToParse);
+
+                if (parseIntoObject != null) {
+                    FlatFileObjectSpecification parseSpecification = flatFileSpecification.getObjectSpecification(parseIntoObject.getClass());
+    
+                    if (parseSpecification.getParseProperties() != null && !parseSpecification.getParseProperties().isEmpty()) {
+                        flatFileSpecification.parseLineIntoObject(parseSpecification, lineToParse, parseIntoObject, lineNumber);
+                        tracker.completeLineParse();
+                    }
+                }
+               lineNumber++;
+            }
+            returnObject = tracker.getParsedObjects();
+          
+
+        }
+        catch (Exception e) {
+            LOG.error(e.getMessage() + " happend in parsing file content ", e);
+            throw new ParseException(e.getMessage());
+        }
+
+        return returnObject;
+    }
+
+    /**
+     * Calls the processor if it is available
+     */
+    public void process(String fileName, Object parsedFileContents) {
+        if (getProcessor() != null)
+            getProcessor().process(fileName, parsedFileContents);
+    }
+
+    /**
+     * @return currently always returns true; do we want to extend that sometime?
+     */
+    public boolean validate(Object parsedFileContents) {
+        if (getProcessor() == null)
+            return true;
+        return getProcessor().validate(parsedFileContents);
+    }
+
+    /**
+     * Sets the FlatFileSpecification that instructs how to carry out the parse
+     * @param flatFileClassIdentifier the FlatFileSpecification that instructs how to carry out the parse
+     */
+    public void setFlatFileSpecification(AbstractFlatFileSpecificationBase flatFileClassIdentifier) {
+        this.flatFileSpecification = flatFileClassIdentifier;
+    }
+
+    /**
+     * Sets the prefix of the file name which this parser reads
+     * @param fileNamePrefix
+     */
+    public void setFileNamePrefix(String fileNamePrefix) {
+        this.fileNamePrefix = fileNamePrefix;
+    }
+
+    /**
+     * Sets an implementation of the DateTimeService for use in parsing
+     * @param dateTimeService
+     */
+    public void setDateTimeService(DateTimeService dateTimeService) {
+        this.dateTimeService = dateTimeService;
+    }
+
+    /**
+     * Determines the principal name of the author of a file from the file name
+     * @param file the file to determine the author of
+     * @return the principal name of the author
+     */
+    public String getAuthorPrincipalName(File file) {
+        return org.apache.commons.lang.StringUtils.substringBetween(file.getName(), getFileNamePrefix(), "_");
+    }
+
+    /**
+     * @return the identifier for flat files of this type
+     */
+    public String getFileTypeIdentifer() {
+        return fileTypeIdentifier;
+    }
+
+    /**
+     * @return the prefix of the name of flat files of this type
+     */
+    public String getFileNamePrefix() {
+        return fileNamePrefix;
+    }
+
+    /**
+     * @return the key of the message to be used as the title of the upload screen of this file type 
+     */
+    public String getTitleKey() {
+        return titleKey;
+    }
+}
Index: work/src/org/kuali/kfs/sys/KfsAuthorizationConstants.java
===================================================================
--- work/src/org/kuali/kfs/sys/KfsAuthorizationConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/KfsAuthorizationConstants.java	(revision 37225)
@@ -34,12 +34,18 @@
         public static final String PAYMENT_HANDLING_ENTRY = "paymentHandlingEntry";
         public static final String VOUCHER_DEADLINE_ENTRY = "voucherDeadlineEntry";
         public static final String SPECIAL_HANDLING_CHANGING_ENTRY = "specialHandlingChangingEntry";
+        public static final String IMMEDIATE_DISBURSEMENT_ENTRY = "immediateDisbursementEntryMode";
     }
 
     public static class DistributionOfIncomeAndExpenseEditMode extends EditMode {
         public static final String SOURCE_LINE_READ_ONLY_MODE = "sourceLinesReadOnlyMode";
     }
     
+    public static class CashReceiptEditMode extends EditMode {
+        public static final String CASH_MANAGER_CONFIRM_MODE = "cmConfirm";
+        public static final String CHANGE_REQUEST_MODE = "changeRequestOn";
+    }
+    
     public static class CashManagementEditMode extends EditMode {
         public static final String ALLOW_ADDITIONAL_DEPOSITS = "allowAdditionalDeposits";
         public static final String ALLOW_CANCEL_DEPOSITS = "allowCancelDeposits";
@@ -48,5 +54,8 @@
     public static class BudgetAdjustmentEditMode extends EditMode {
         public static final String BASE_AMT_ENTRY = "baseAmtEntry";
     }
-
+    
+    public static class CustomerInvoiceEditMode extends TransactionalEditMode {
+        public static final String PROCESSING_ORGANIZATION_MODE = "processingOrganizationMode";
+    }
 }
Index: work/src/org/kuali/kfs/sys/businessobject/datadictionary/GeneralLedgerPendingEntry.xml
===================================================================
--- work/src/org/kuali/kfs/sys/businessobject/datadictionary/GeneralLedgerPendingEntry.xml	(revision 30259)
+++ work/src/org/kuali/kfs/sys/businessobject/datadictionary/GeneralLedgerPendingEntry.xml	(revision 37225)
@@ -1,469 +1,586 @@
-<?xml version="1.0" encoding="UTF-8"?><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
-<!--
- Copyright 2007-2009 The Kuali Foundation
- 
- Licensed under the Educational Community License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
- 
- http://www.opensource.org/licenses/ecl2.php
- 
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
+<?xml version="1.0" encoding="UTF-8"?>
+<beans xmlns="http://www.springframework.org/schema/beans"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
+	xsi:schemaLocation="http://www.springframework.org/schema/beans         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
+	<!--
+		Copyright 2007-2009 The Kuali Foundation Licensed under the
+		Educational Community License, Version 2.0 (the "License"); you may
+		not use this file except in compliance with the License. You may
+		obtain a copy of the License at
 
-  <bean id="GeneralLedgerPendingEntry" parent="GeneralLedgerPendingEntry-parentBean"/>
+		http://www.opensource.org/licenses/ecl2.php Unless required by
+		applicable law or agreed to in writing, software distributed under the
+		License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+		CONDITIONS OF ANY KIND, either express or implied. See the License for
+		the specific language governing permissions and limitations under the
+		License.
+	-->
 
-  <bean id="GeneralLedgerPendingEntry-parentBean" abstract="true" parent="BusinessObjectEntry">
-    <property name="businessObjectClass" value="org.kuali.kfs.sys.businessobject.GeneralLedgerPendingEntry"/>
-    <property name="inquiryDefinition">
-      <ref bean="GeneralLedgerPendingEntry-inquiryDefinition"/>
-    </property>
-    <property name="lookupDefinition">
-      <ref bean="GeneralLedgerPendingEntry-lookupDefinition"/>
-    </property>
-    <property name="objectLabel" value="General Ledger Pending Entry"/>
-    <property name="attributes">
-      <list>
-        <ref bean="GeneralLedgerPendingEntry-universityFiscalYear"/>
-        <ref bean="GeneralLedgerPendingEntry-chartOfAccountsCode"/>
-        <ref bean="GeneralLedgerPendingEntry-accountNumber"/>
-        <ref bean="GeneralLedgerPendingEntry-subAccountNumber"/>
-        <ref bean="GeneralLedgerPendingEntry-financialObjectCode"/>
-        <ref bean="GeneralLedgerPendingEntry-financialSubObjectCode"/>
-        <ref bean="GeneralLedgerPendingEntry-documentNumber"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber"/>
-        <ref bean="GeneralLedgerPendingEntry-financialBalanceTypeCode"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionDate"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionLedgerEntryDescription"/>
-        <ref bean="GeneralLedgerPendingEntry-organizationReferenceId"/>
-        <ref bean="GeneralLedgerPendingEntry-financialObjectTypeCode"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionLedgerEntryAmount"/>
-        <ref bean="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode"/>
-        <ref bean="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode"/>
-        <ref bean="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode"/>
-        <ref bean="GeneralLedgerPendingEntry-financialDocumentReversalDate"/>
-        <ref bean="GeneralLedgerPendingEntry-universityFiscalPeriodCode"/>
-        <ref bean="GeneralLedgerPendingEntry-organizationDocumentNumber"/>
-        <ref bean="GeneralLedgerPendingEntry-financialSystemOriginationCode"/>
-        <ref bean="GeneralLedgerPendingEntry-financialDocumentTypeCode"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionDebitCreditCode"/>
-        <ref bean="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd"/>
-        <ref bean="GeneralLedgerPendingEntry-projectCode"/>
-        <ref bean="GeneralLedgerPendingEntry-transactionEntryProcessedTs"/>
-        <ref bean="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode"/>
-      </list>
-    </property>
-    <property name="relationships">
-    	<list>
-    		<bean parent="RelationshipDefinition">
-    			<property name="objectAttributeName" value="financialSystemDocumentTypeCode"/>
-		        <property name="primitiveAttributes">
-		        	<list>
-		            	<bean parent="PrimitiveAttributeDefinition" p:sourceName="financialDocumentTypeCode" p:targetName="name"/>
-		            </list>
-		        </property>
-    		</bean>
-    		<bean parent="RelationshipDefinition">
-    			<property name="objectAttributeName" value="referenceFinancialSystemDocumentTypeCode"/>
-		        <property name="primitiveAttributes">
-		        	<list>
-		            	<bean parent="PrimitiveAttributeDefinition" p:sourceName="referenceFinancialDocumentTypeCode" p:targetName="name"/>
-		            </list>
-		        </property>
-    		</bean>
-    	</list>
-    </property>
-  </bean>
+	<bean id="GeneralLedgerPendingEntry" parent="GeneralLedgerPendingEntry-parentBean" />
 
-<!-- Attribute Definitions -->
+	<bean id="GeneralLedgerPendingEntry-parentBean" abstract="true"
+		parent="BusinessObjectEntry">
+		<property name="businessObjectClass"
+			value="org.kuali.kfs.sys.businessobject.GeneralLedgerPendingEntry" />
+		<property name="inquiryDefinition">
+			<ref bean="GeneralLedgerPendingEntry-inquiryDefinition" />
+		</property>
+		<property name="lookupDefinition">
+			<ref bean="GeneralLedgerPendingEntry-lookupDefinition" />
+		</property>
+		<property name="objectLabel" value="General Ledger Pending Entry" />
+		<property name="attributes">
+			<list>
+				<ref bean="GeneralLedgerPendingEntry-universityFiscalYear" />
+				<ref bean="GeneralLedgerPendingEntry-chartOfAccountsCode" />
+				<ref bean="GeneralLedgerPendingEntry-accountNumber" />
+				<ref bean="GeneralLedgerPendingEntry-subAccountNumber" />
+				<ref bean="GeneralLedgerPendingEntry-financialObjectCode" />
+				<ref bean="GeneralLedgerPendingEntry-financialSubObjectCode" />
+				<ref bean="GeneralLedgerPendingEntry-documentNumber" />
+				<ref
+					bean="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber" />
+				<ref bean="GeneralLedgerPendingEntry-financialBalanceTypeCode" />
+				<ref bean="GeneralLedgerPendingEntry-transactionDate" />
+				<ref bean="GeneralLedgerPendingEntry-transactionLedgerEntryDescription" />
+				<ref bean="GeneralLedgerPendingEntry-organizationReferenceId" />
+				<ref bean="GeneralLedgerPendingEntry-financialObjectTypeCode" />
+				<ref bean="GeneralLedgerPendingEntry-transactionLedgerEntryAmount" />
+				<ref
+					bean="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode" />
+				<ref bean="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode" />
+				<ref bean="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber" />
+				<ref bean="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator" />
+				<ref bean="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode" />
+				<ref bean="GeneralLedgerPendingEntry-financialDocumentReversalDate" />
+				<ref bean="GeneralLedgerPendingEntry-universityFiscalPeriodCode" />
+				<ref bean="GeneralLedgerPendingEntry-organizationDocumentNumber" />
+				<ref bean="GeneralLedgerPendingEntry-financialSystemOriginationCode" />
+				<ref bean="GeneralLedgerPendingEntry-financialDocumentTypeCode" />
+				<ref bean="GeneralLedgerPendingEntry-transactionDebitCreditCode" />
+				<ref bean="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd" />
+				<ref bean="GeneralLedgerPendingEntry-projectCode" />
+				<ref bean="GeneralLedgerPendingEntry-transactionEntryProcessedTs" />
+				<ref
+					bean="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode" />
+				<ref
+					bean="GeneralLedgerPendingEntry-dummyBusinessObject.debitCreditOption" />
+			</list>
+		</property>
+		<property name="relationships">
+			<list>
+				<bean parent="RelationshipDefinition">
+					<property name="objectAttributeName" value="financialSystemDocumentTypeCode" />
+					<property name="primitiveAttributes">
+						<list>
+							<bean parent="PrimitiveAttributeDefinition" p:sourceName="financialDocumentTypeCode"
+								p:targetName="name" />
+						</list>
+					</property>
+				</bean>
+				<bean parent="RelationshipDefinition">
+					<property name="objectAttributeName" value="referenceFinancialSystemDocumentTypeCode" />
+					<property name="primitiveAttributes">
+						<list>
+							<bean parent="PrimitiveAttributeDefinition" p:sourceName="referenceFinancialDocumentTypeCode"
+								p:targetName="name" />
+						</list>
+					</property>
+				</bean>
+			</list>
+		</property>
+	</bean>
 
+	<!-- Attribute Definitions -->
 
-  <bean id="GeneralLedgerPendingEntry-universityFiscalYear" parent="GeneralLedgerPendingEntry-universityFiscalYear-parentBean"/>
 
-  <bean id="GeneralLedgerPendingEntry-universityFiscalYear-parentBean" abstract="true" parent="GenericAttributes-genericFiscalYear">
-    <property name="name" value="universityFiscalYear"/>
-    <property name="label" value="Fiscal Year"/>
-    <property name="shortLabel" value="Fiscal Year"/>
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-chartOfAccountsCode" parent="GeneralLedgerPendingEntry-chartOfAccountsCode-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-universityFiscalYear"
+		parent="GeneralLedgerPendingEntry-universityFiscalYear-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-chartOfAccountsCode-parentBean" abstract="true" parent="Chart-chartOfAccountsCode">
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-accountNumber" parent="GeneralLedgerPendingEntry-accountNumber-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-universityFiscalYear-parentBean"
+		abstract="true" parent="GenericAttributes-genericFiscalYear">
+		<property name="name" value="universityFiscalYear" />
+		<property name="label" value="Fiscal Year" />
+		<property name="shortLabel" value="Fiscal Year" />
 
-  <bean id="GeneralLedgerPendingEntry-accountNumber-parentBean" abstract="true" parent="Account-accountNumber">
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-subAccountNumber" parent="GeneralLedgerPendingEntry-subAccountNumber-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-chartOfAccountsCode"
+		parent="GeneralLedgerPendingEntry-chartOfAccountsCode-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-subAccountNumber-parentBean" abstract="true" parent="SubAccount-subAccountNumber">
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-financialObjectCode" parent="GeneralLedgerPendingEntry-financialObjectCode-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-chartOfAccountsCode-parentBean"
+		abstract="true" parent="Chart-chartOfAccountsCode">
 
-  <bean id="GeneralLedgerPendingEntry-financialObjectCode-parentBean" abstract="true" parent="ObjectCode-financialObjectCode">
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-financialSubObjectCode" parent="GeneralLedgerPendingEntry-financialSubObjectCode-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-accountNumber" parent="GeneralLedgerPendingEntry-accountNumber-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-financialSubObjectCode-parentBean" abstract="true" parent="SubObjectCode-financialSubObjectCode">
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-documentNumber" parent="GeneralLedgerPendingEntry-documentNumber-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-accountNumber-parentBean"
+		abstract="true" parent="Account-accountNumber">
 
-  <bean id="GeneralLedgerPendingEntry-documentNumber-parentBean" abstract="true" parent="DocumentHeader-documentNumber">
-  	<property name="forceUppercase" value="true"/>
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber" parent="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-subAccountNumber" parent="GeneralLedgerPendingEntry-subAccountNumber-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber-parentBean" abstract="true" parent="GenericAttributes-transactionEntrySequenceNumber">
-    <property name="forceUppercase" value="true"/>
-    <property name="name" value="transactionLedgerEntrySequenceNumber"/>
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-financialBalanceTypeCode" parent="GeneralLedgerPendingEntry-financialBalanceTypeCode-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-subAccountNumber-parentBean"
+		abstract="true" parent="SubAccount-subAccountNumber">
 
-  <bean id="GeneralLedgerPendingEntry-financialBalanceTypeCode-parentBean" abstract="true" parent="BalanceType-code">
-    <property name="name" value="financialBalanceTypeCode"/>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionDate" parent="GeneralLedgerPendingEntry-transactionDate-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-financialObjectCode"
+		parent="GeneralLedgerPendingEntry-financialObjectCode-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-transactionDate-parentBean" abstract="true" parent="GenericAttributes-genericTimestamp">
-    <property name="name" value="transactionDate"/>
-    <property name="label" value="Transaction Date"/>
-    <property name="shortLabel" value="Date"/>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionLedgerEntryDescription" parent="GeneralLedgerPendingEntry-transactionLedgerEntryDescription-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-financialObjectCode-parentBean"
+		abstract="true" parent="ObjectCode-financialObjectCode">
 
-  <bean id="GeneralLedgerPendingEntry-transactionLedgerEntryDescription-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="transactionLedgerEntryDescription"/>
-    <property name="label" value="Transaction Ledger Entry Description"/>
-    <property name="shortLabel" value="Description"/>
-    <property name="maxLength" value="40"/>
-    <property name="control">
-      <ref bean="StandardNameTextControl" />
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-organizationReferenceId" parent="GeneralLedgerPendingEntry-organizationReferenceId-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-financialSubObjectCode"
+		parent="GeneralLedgerPendingEntry-financialSubObjectCode-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-organizationReferenceId-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="organizationReferenceId"/>
-    <property name="label" value="Organization Reference Id"/>
-    <property name="shortLabel" value="Org. Ref. Id"/>
-    <property name="maxLength" value="8"/>
-    <property name="control">
-      <ref bean="TenCharacterTextControl" />
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-financialObjectTypeCode" parent="GeneralLedgerPendingEntry-financialObjectTypeCode-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-financialSubObjectCode-parentBean"
+		abstract="true" parent="SubObjectCode-financialSubObjectCode">
 
-  <bean id="GeneralLedgerPendingEntry-financialObjectTypeCode-parentBean" abstract="true" parent="ObjectType-code">
-    <property name="name" value="financialObjectTypeCode"/>
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionLedgerEntryAmount" parent="GeneralLedgerPendingEntry-transactionLedgerEntryAmount-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-documentNumber" parent="GeneralLedgerPendingEntry-documentNumber-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-transactionLedgerEntryAmount-parentBean" abstract="true" parent="GenericAttributes-genericAmount">
-    <property name="name" value="transactionLedgerEntryAmount"/>
-    <property name="label" value="Transaction Ledger Entry Amount"/>
-    <property name="shortLabel" value="Amount"/>
-    
-    
-    <property name="formatterClass" value="org.kuali.rice.kns.web.format.CurrencyFormatter"/>
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode" parent="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-documentNumber-parentBean"
+		abstract="true" parent="DocumentHeader-documentNumber">
+		<property name="forceUppercase" value="true" />
 
-  <bean id="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="referenceFinancialSystemOriginationCode"/>
-    <property name="label" value="Reference Origin Code"/>
-    <property name="shortLabel" value="Ref. Origin Code"/>
-    <property name="maxLength" value="2"/>
-    <property name="control">
-      <bean parent="TextControlDefinition" p:size="3"/>
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode" parent="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber"
+		parent="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode-parentBean" abstract="true" parent="GenericAttributes-referenceTypeCode">
-    <property name="name" value="referenceFinancialDocumentTypeCode"/>
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber" parent="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber-parentBean"/>
+	<bean
+		id="GeneralLedgerPendingEntry-transactionLedgerEntrySequenceNumber-parentBean"
+		abstract="true" parent="GenericAttributes-transactionEntrySequenceNumber">
+		<property name="forceUppercase" value="true" />
+		<property name="name" value="transactionLedgerEntrySequenceNumber" />
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-financialBalanceTypeCode"
+		parent="GeneralLedgerPendingEntry-financialBalanceTypeCode-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="referenceFinancialDocumentNumber"/>
-    <property name="label" value="Reference Document Number"/>
-    <property name="shortLabel" value="Number"/>
-    <property name="maxLength" value="9"/>
-    <property name="control">
-      <bean parent="TextControlDefinition" p:size="11"/>
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator" parent="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-financialBalanceTypeCode-parentBean"
+		abstract="true" parent="BalanceType-code">
+		<property name="name" value="financialBalanceTypeCode" />
 
-  <bean id="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator-parentBean" abstract="true" parent="GenericAttributes-genericBoolean">
-    <property name="name" value="transactionEntryOffsetIndicator"/>
-    <property name="label" value="Transaction Entry Offset Code"/>
-    <property name="shortLabel" value="Entry Offset Ind."/>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode" parent="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode-parentBean"/>
 
-  <bean id="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="transactionEncumbranceUpdateCode"/>
-    <property name="label" value="Encumbrance Update Code"/>
-    <property name="shortLabel" value="Encmbr. Updt. Code"/>
-    <property name="maxLength" value="1"/>
-    <property name="control">
-      <bean parent="TextControlDefinition" p:size="3"/>
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-financialDocumentReversalDate" parent="GeneralLedgerPendingEntry-financialDocumentReversalDate-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionDate" parent="GeneralLedgerPendingEntry-transactionDate-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-financialDocumentReversalDate-parentBean" abstract="true" parent="GenericAttributes-genericTimestamp">
-    <property name="name" value="financialDocumentReversalDate"/>
-    <property name="label" value="Document Reversal Date"/>
-    <property name="shortLabel" value="Doc. Reversal Date"/>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-universityFiscalPeriodCode" parent="GeneralLedgerPendingEntry-universityFiscalPeriodCode-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-transactionDate-parentBean"
+		abstract="true" parent="GenericAttributes-genericTimestamp">
+		<property name="name" value="transactionDate" />
+		<property name="label" value="Transaction Date" />
+		<property name="shortLabel" value="Date" />
 
-  <bean id="GeneralLedgerPendingEntry-universityFiscalPeriodCode-parentBean" abstract="true" parent="GenericAttributes-universityFiscalAccountingPeriod">
-    <property name="name" value="universityFiscalPeriodCode"/>
-    <property name="label" value="Fiscal Period"/>
-    <property name="shortLabel" value="Fiscal Period"/>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-organizationDocumentNumber" parent="GeneralLedgerPendingEntry-organizationDocumentNumber-parentBean"/>
 
-  <bean id="GeneralLedgerPendingEntry-organizationDocumentNumber-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="organizationDocumentNumber"/>
-    <property name="label" value="Organization Document Number"/>
-    <property name="shortLabel" value="Org. Doc. Nbr."/>
-    <property name="maxLength" value="10"/>
-    <property name="control">
-      <ref bean="StandardShortNameTextControl" />
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-financialSystemOriginationCode" parent="GeneralLedgerPendingEntry-financialSystemOriginationCode-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionLedgerEntryDescription"
+		parent="GeneralLedgerPendingEntry-transactionLedgerEntryDescription-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-financialSystemOriginationCode-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="financialSystemOriginationCode"/>
-    <property name="forceUppercase" value="true"/>
-    <property name="label" value="Origin Code"/>
-    <property name="shortLabel" value="Origin Code"/>
-    <property name="maxLength" value="2"/>
-    <property name="control">
-      <bean parent="TextControlDefinition" p:size="3"/>
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-financialDocumentTypeCode" parent="GeneralLedgerPendingEntry-financialDocumentTypeCode-parentBean"/>
+	<bean
+		id="GeneralLedgerPendingEntry-transactionLedgerEntryDescription-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="transactionLedgerEntryDescription" />
+		<property name="label" value="Transaction Ledger Entry Description" />
+		<property name="shortLabel" value="Description" />
+		<property name="maxLength" value="40" />
+		<property name="control">
+			<ref bean="StandardNameTextControl" />
+		</property>
 
-  <bean id="GeneralLedgerPendingEntry-financialDocumentTypeCode-parentBean" abstract="true" parent="GenericAttributes-financialSystemDocumentTypeCode">
-    <property name="name" value="financialDocumentTypeCode"/>
-    <property name="label" value="Ledger Document Type"/>
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionDebitCreditCode" parent="GeneralLedgerPendingEntry-transactionDebitCreditCode-parentBean"/>
 
-  <bean id="GeneralLedgerPendingEntry-transactionDebitCreditCode-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="transactionDebitCreditCode"/>
-    <property name="label" value="Debit Credit Code"/>
-    <property name="shortLabel" value="D/C"/>
-    <property name="maxLength" value="1"/>
-    <property name="control">
-      <ref bean="TwoCharacterTextControl" />
-    </property>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd" parent="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-organizationReferenceId"
+		parent="GeneralLedgerPendingEntry-organizationReferenceId-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="acctSufficientFundsFinObjCd"/>
-    <property name="label" value="Account Sufficient Funds Object Code"/>
-    <property name="shortLabel" value="acctSufficientFundsFinObjCd"/>
-    <property name="maxLength" value="4"/>
-    <property name="required" value="false"/>
-    <property name="control">
-      <ref bean="FourCharacterTextControl" />
-    </property>
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-projectCode" parent="GeneralLedgerPendingEntry-projectCode-parentBean"/>
+	<bean id="GeneralLedgerPendingEntry-organizationReferenceId-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="organizationReferenceId" />
+		<property name="label" value="Organization Reference Id" />
+		<property name="shortLabel" value="Org. Ref. Id" />
+		<property name="maxLength" value="8" />
+		<property name="control">
+			<ref bean="TenCharacterTextControl" />
+		</property>
 
-  <bean id="GeneralLedgerPendingEntry-projectCode-parentBean" abstract="true" parent="ProjectCode-code">
-    <property name="name" value="projectCode"/>
-    <property name="required" value="false"/>
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-transactionEntryProcessedTs" parent="GeneralLedgerPendingEntry-transactionEntryProcessedTs-parentBean"/>
 
-  <bean id="GeneralLedgerPendingEntry-transactionEntryProcessedTs-parentBean" abstract="true" parent="GenericAttributes-genericTimestamp">
-    <property name="name" value="transactionEntryProcessedTs"/>
-    <property name="label" value="Transaction Entry Processed"/>
-    <property name="shortLabel" value="Entry Processed"/>
-    
-    
-  </bean>
-  <bean id="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode" parent="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-financialObjectTypeCode"
+		parent="GeneralLedgerPendingEntry-financialObjectTypeCode-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode-parentBean" abstract="true" parent="AttributeDefinition">
-    <property name="name" value="documentHeader.financialDocumentStatusCode"/>
-    <property name="label" value="Pending Entry Approved Indicator"/>
-    <property name="shortLabel" value="Pending Entry Approved Indicator"/>
-    <property name="maxLength" value="2"/>
-    <property name="control">
-      <bean parent="RadioControlDefinition" p:valuesFinderClass="org.kuali.rice.kns.lookup.keyvalues.ApprovedDocumentIndicatorValuesFinder" p:includeKeyInLabel="false"/>
-    </property>
-    
-    
-    <property name="formatterClass" value="org.kuali.rice.kns.web.format.BooleanFormatter"/>
-  </bean>
+	<bean id="GeneralLedgerPendingEntry-financialObjectTypeCode-parentBean"
+		abstract="true" parent="ObjectType-code">
+		<property name="name" value="financialObjectTypeCode" />
 
-<!-- Business Object Inquiry Definition -->
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionLedgerEntryAmount"
+		parent="GeneralLedgerPendingEntry-transactionLedgerEntryAmount-parentBean" />
 
+	<bean
+		id="GeneralLedgerPendingEntry-transactionLedgerEntryAmount-parentBean"
+		abstract="true" parent="GenericAttributes-genericAmount">
+		<property name="name" value="transactionLedgerEntryAmount" />
+		<property name="label" value="Transaction Ledger Entry Amount" />
+		<property name="shortLabel" value="Amount" />
 
-  <bean id="GeneralLedgerPendingEntry-inquiryDefinition" parent="GeneralLedgerPendingEntry-inquiryDefinition-parentBean"/>
 
-  <bean id="GeneralLedgerPendingEntry-inquiryDefinition-parentBean" abstract="true" parent="InquiryDefinition">
-    <property name="title" value="General Ledger Pending Entry"/>
-    <property name="inquirySections">
-      <list>
-        <bean parent="InquirySectionDefinition">
-          <property name="title" value=""/>
-          <property name="numberOfColumns" value="1"/>
-          <property name="inquiryFields">
-            <list>
-              <bean parent="FieldDefinition" p:attributeName="universityFiscalYear"/>
-              <bean parent="FieldDefinition" p:attributeName="chartOfAccountsCode"/>
-              <bean parent="FieldDefinition" p:attributeName="accountNumber"/>
-              <bean parent="FieldDefinition" p:attributeName="subAccountNumber"/>
-              <bean parent="FieldDefinition" p:attributeName="financialObjectCode"/>
-              <bean parent="FieldDefinition" p:attributeName="financialSubObjectCode"/>
-              <bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode"/>
-              <bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode"/>
-              <bean parent="FieldDefinition" p:attributeName="universityFiscalPeriodCode"/>
-              <bean parent="FieldDefinition" p:attributeName="financialSystemOriginationCode"/>
-              <bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode"/>
-              <bean parent="FieldDefinition" p:attributeName="documentNumber"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionLedgerEntrySequenceNumber"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryDescription"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryAmount"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionDebitCreditCode"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionDate"/>
-              <bean parent="FieldDefinition" p:attributeName="organizationDocumentNumber"/>
-              <bean parent="FieldDefinition" p:attributeName="projectCode"/>
-              <bean parent="FieldDefinition" p:attributeName="organizationReferenceId"/>
-              <bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentTypeCode"/>
-              <bean parent="FieldDefinition" p:attributeName="referenceFinancialSystemOriginationCode"/>
-              <bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentNumber"/>
-              <bean parent="FieldDefinition" p:attributeName="financialDocumentReversalDate"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionEncumbranceUpdateCode"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionEntryOffsetIndicator"/>
-              <bean parent="FieldDefinition" p:attributeName="financialDocumentApprovedCode"/>
-              <bean parent="FieldDefinition" p:attributeName="acctSufficientFundsFinObjCd"/>
-              <bean parent="FieldDefinition" p:attributeName="transactionEntryProcessedTs"/>
-              <bean parent="FieldDefinition" p:attributeName="documentHeader.financialDocumentStatusCode"/>
-            </list>
-          </property>
-        </bean>
-      </list>
-    </property>
-  </bean>
+		<property name="formatterClass"
+			value="org.kuali.rice.kns.web.format.CurrencyFormatter" />
+	</bean>
+	<bean
+		id="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode"
+		parent="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode-parentBean" />
 
-<!-- Business Object Lookup Definition -->
+	<bean
+		id="GeneralLedgerPendingEntry-referenceFinancialSystemOriginationCode-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="referenceFinancialSystemOriginationCode" />
+		<property name="label" value="Reference Origin Code" />
+		<property name="shortLabel" value="Ref. Origin Code" />
+		<property name="maxLength" value="2" />
+		<property name="control">
+			<bean parent="TextControlDefinition" p:size="3" />
+		</property>
 
 
-  <bean id="GeneralLedgerPendingEntry-lookupDefinition" parent="GeneralLedgerPendingEntry-lookupDefinition-parentBean"/>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode"
+		parent="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode-parentBean" />
 
-  <bean id="GeneralLedgerPendingEntry-lookupDefinition-parentBean" abstract="true" parent="LookupDefinition">
-    <property name="title" value="General Ledger Pending Entry Lookup"/>
-    <property name="lookupableID" value="glPendingEntryLookupable"/>
-    <property name="numOfColumns" value="2"/>
-    
-    <property name="defaultSort">
-      <bean parent="SortDefinition">
-        <property name="attributeNames">
-          <list>
-            <value>transactionLedgerEntrySequenceNumber</value>
-          </list>
-        </property>
-      </bean>
-    </property>
-    <property name="lookupFields">
-      <list>
-        <bean parent="FieldDefinition" p:attributeName="universityFiscalYear"  p:treatWildcardsAndOperatorsAsLiteral="true" p:defaultValueFinderClass="org.kuali.kfs.sys.businessobject.defaultvalue.FiscalYearFinder"/>
-        <bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="chartOfAccountsCode" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="financialSystemOriginationCode" p:treatWildcardsAndOperatorsAsLiteral="true" />        
-        <bean parent="FieldDefinition" p:attributeName="accountNumber" p:treatWildcardsAndOperatorsAsLiteral="false" />
-        <bean parent="FieldDefinition" p:attributeName="documentNumber" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="subAccountNumber"/>
-        <bean parent="FieldDefinition" p:attributeName="organizationDocumentNumber" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="financialObjectCode" p:treatWildcardsAndOperatorsAsLiteral="false" />
-        <bean parent="FieldDefinition" p:attributeName="projectCode" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="financialSubObjectCode" p:treatWildcardsAndOperatorsAsLiteral="false" />
-        <bean parent="FieldDefinition" p:attributeName="organizationReferenceId" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode"  p:treatWildcardsAndOperatorsAsLiteral="true" p:defaultValueFinderClass="org.kuali.kfs.gl.businessobject.options.ActualBalanceTypeOptionFinder"/>
-        <bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentTypeCode" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="referenceFinancialSystemOriginationCode" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="universityFiscalPeriodCode"  p:treatWildcardsAndOperatorsAsLiteral="true" p:defaultValueFinderClass="org.kuali.kfs.gl.businessobject.options.PeriodCodeOptionFinder"/>
-        <bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentNumber" p:treatWildcardsAndOperatorsAsLiteral="true" />
-        <bean parent="FieldDefinition" p:attributeName="documentHeader.financialDocumentStatusCode"/>
-      </list>
-    </property>
-    <property name="resultFields">
-      <list>
-        <bean parent="FieldDefinition" p:attributeName="universityFiscalYear"/>
-        <bean parent="FieldDefinition" p:attributeName="chartOfAccountsCode"/>
-        <bean parent="FieldDefinition" p:attributeName="accountNumber"/>
-        <bean parent="FieldDefinition" p:attributeName="subAccountNumber"/>
-        <bean parent="FieldDefinition" p:attributeName="financialObjectCode"/>
-        <bean parent="FieldDefinition" p:attributeName="financialSubObjectCode"/>
-        <bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode"/>
-        <bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode"/>
-        <bean parent="FieldDefinition" p:attributeName="universityFiscalPeriodCode"/>
-        <bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode"/>
-        <bean parent="FieldDefinition" p:attributeName="financialSystemOriginationCode"/>
-        <bean parent="FieldDefinition" p:attributeName="documentNumber"/>
-        <bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryDescription"/>
-        <bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryAmount"/>
-        <bean parent="FieldDefinition" p:attributeName="transactionDebitCreditCode"/>
-        <bean parent="FieldDefinition" p:attributeName="transactionDate"/>
-        <bean parent="FieldDefinition" p:attributeName="organizationDocumentNumber"/>
-        <bean parent="FieldDefinition" p:attributeName="projectCode"/>
-        <bean parent="FieldDefinition" p:attributeName="organizationReferenceId"/>
-        <bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentTypeCode"/>
-        <bean parent="FieldDefinition" p:attributeName="referenceFinancialSystemOriginationCode"/>
-        <bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentNumber"/>
-      </list>
-    </property>
-  </bean>
+	<bean
+		id="GeneralLedgerPendingEntry-referenceFinancialDocumentTypeCode-parentBean"
+		abstract="true" parent="GenericAttributes-referenceTypeCode">
+		<property name="name" value="referenceFinancialDocumentTypeCode" />
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber"
+		parent="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-referenceFinancialDocumentNumber-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="referenceFinancialDocumentNumber" />
+		<property name="label" value="Reference Document Number" />
+		<property name="shortLabel" value="Number" />
+		<property name="maxLength" value="9" />
+		<property name="control">
+			<bean parent="TextControlDefinition" p:size="11" />
+		</property>
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator"
+		parent="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-transactionEntryOffsetIndicator-parentBean"
+		abstract="true" parent="GenericAttributes-genericBoolean">
+		<property name="name" value="transactionEntryOffsetIndicator" />
+		<property name="label" value="Transaction Entry Offset Code" />
+		<property name="shortLabel" value="Entry Offset Ind." />
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode"
+		parent="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-transactionEncumbranceUpdateCode-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="transactionEncumbranceUpdateCode" />
+		<property name="label" value="Encumbrance Update Code" />
+		<property name="shortLabel" value="Encmbr. Updt. Code" />
+		<property name="maxLength" value="1" />
+		<property name="control">
+			<bean parent="TextControlDefinition" p:size="3" />
+		</property>
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-financialDocumentReversalDate"
+		parent="GeneralLedgerPendingEntry-financialDocumentReversalDate-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-financialDocumentReversalDate-parentBean"
+		abstract="true" parent="GenericAttributes-genericTimestamp">
+		<property name="name" value="financialDocumentReversalDate" />
+		<property name="label" value="Document Reversal Date" />
+		<property name="shortLabel" value="Doc. Reversal Date" />
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-universityFiscalPeriodCode"
+		parent="GeneralLedgerPendingEntry-universityFiscalPeriodCode-parentBean" />
+
+	<bean id="GeneralLedgerPendingEntry-universityFiscalPeriodCode-parentBean"
+		abstract="true" parent="GenericAttributes-universityFiscalAccountingPeriod">
+		<property name="name" value="universityFiscalPeriodCode" />
+		<property name="label" value="Fiscal Period" />
+		<property name="shortLabel" value="Fiscal Period" />
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-organizationDocumentNumber"
+		parent="GeneralLedgerPendingEntry-organizationDocumentNumber-parentBean" />
+
+	<bean id="GeneralLedgerPendingEntry-organizationDocumentNumber-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="organizationDocumentNumber" />
+		<property name="label" value="Organization Document Number" />
+		<property name="shortLabel" value="Org. Doc. Nbr." />
+		<property name="maxLength" value="10" />
+		<property name="control">
+			<ref bean="StandardShortNameTextControl" />
+		</property>
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-financialSystemOriginationCode"
+		parent="GeneralLedgerPendingEntry-financialSystemOriginationCode-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-financialSystemOriginationCode-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="financialSystemOriginationCode" />
+		<property name="forceUppercase" value="true" />
+		<property name="label" value="Origin Code" />
+		<property name="shortLabel" value="Origin Code" />
+		<property name="maxLength" value="2" />
+		<property name="control">
+			<bean parent="TextControlDefinition" p:size="3" />
+		</property>
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-financialDocumentTypeCode"
+		parent="GeneralLedgerPendingEntry-financialDocumentTypeCode-parentBean" />
+
+	<bean id="GeneralLedgerPendingEntry-financialDocumentTypeCode-parentBean"
+		abstract="true" parent="GenericAttributes-financialSystemDocumentTypeCode">
+		<property name="name" value="financialDocumentTypeCode" />
+		<property name="label" value="Ledger Document Type" />
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionDebitCreditCode"
+		parent="GeneralLedgerPendingEntry-transactionDebitCreditCode-parentBean" />
+
+	<bean id="GeneralLedgerPendingEntry-transactionDebitCreditCode-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="transactionDebitCreditCode" />
+		<property name="label" value="Debit Credit Code" />
+		<property name="shortLabel" value="D/C" />
+		<property name="maxLength" value="1" />
+		<property name="control">
+			<ref bean="TwoCharacterTextControl" />
+		</property>
+
+
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd"
+		parent="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-acctSufficientFundsFinObjCd-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="acctSufficientFundsFinObjCd" />
+		<property name="label" value="Account Sufficient Funds Object Code" />
+		<property name="shortLabel" value="acctSufficientFundsFinObjCd" />
+		<property name="maxLength" value="4" />
+		<property name="required" value="false" />
+		<property name="control">
+			<ref bean="FourCharacterTextControl" />
+		</property>
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-projectCode" parent="GeneralLedgerPendingEntry-projectCode-parentBean" />
+
+	<bean id="GeneralLedgerPendingEntry-projectCode-parentBean"
+		abstract="true" parent="ProjectCode-code">
+		<property name="name" value="projectCode" />
+		<property name="required" value="false" />
+	</bean>
+	<bean id="GeneralLedgerPendingEntry-transactionEntryProcessedTs"
+		parent="GeneralLedgerPendingEntry-transactionEntryProcessedTs-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-transactionEntryProcessedTs-parentBean"
+		abstract="true" parent="GenericAttributes-genericTimestamp">
+		<property name="name" value="transactionEntryProcessedTs" />
+		<property name="label" value="Transaction Entry Processed" />
+		<property name="shortLabel" value="Entry Processed" />
+
+
+	</bean>
+	<bean
+		id="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode"
+		parent="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-documentHeader.financialDocumentStatusCode-parentBean"
+		abstract="true" parent="AttributeDefinition">
+		<property name="name" value="documentHeader.financialDocumentStatusCode" />
+		<property name="label" value="Pending Entry Approved Indicator" />
+		<property name="shortLabel" value="Pending Entry Approved Indicator" />
+		<property name="maxLength" value="2" />
+		<property name="control">
+			<bean parent="RadioControlDefinition"
+				p:valuesFinderClass="org.kuali.rice.kns.lookup.keyvalues.ApprovedDocumentIndicatorValuesFinder"
+				p:includeKeyInLabel="false" />
+		</property>
+
+
+		<property name="formatterClass"
+			value="org.kuali.rice.kns.web.format.BooleanFormatter" />
+	</bean>
+
+	<bean id="GeneralLedgerPendingEntry-dummyBusinessObject.debitCreditOption"
+		parent="GeneralLedgerPendingEntry-dummyBusinessObject.debitCreditOption-parentBean" />
+
+	<bean
+		id="GeneralLedgerPendingEntry-dummyBusinessObject.debitCreditOption-parentBean"
+		abstract="true" parent="TransientBalanceInquiryAttributes-debitCreditOption">
+		<property name="name" value="dummyBusinessObject.debitCreditOption" />
+		<property name="label" value="Debit/Credit View" />
+		<property name="shortLabel" value="Debit/Credit" />
+	</bean>
+
+	<!-- Business Object Inquiry Definition -->
+
+
+	<bean id="GeneralLedgerPendingEntry-inquiryDefinition" parent="GeneralLedgerPendingEntry-inquiryDefinition-parentBean" />
+
+	<bean id="GeneralLedgerPendingEntry-inquiryDefinition-parentBean"
+		abstract="true" parent="InquiryDefinition">
+		<property name="title" value="General Ledger Pending Entry" />
+		<property name="inquirySections">
+			<list>
+				<bean parent="InquirySectionDefinition">
+					<property name="title" value="" />
+					<property name="numberOfColumns" value="1" />
+					<property name="inquiryFields">
+						<list>
+							<bean parent="FieldDefinition" p:attributeName="universityFiscalYear" />
+							<bean parent="FieldDefinition" p:attributeName="chartOfAccountsCode" />
+							<bean parent="FieldDefinition" p:attributeName="accountNumber" />
+							<bean parent="FieldDefinition" p:attributeName="subAccountNumber" />
+							<bean parent="FieldDefinition" p:attributeName="financialObjectCode" />
+							<bean parent="FieldDefinition" p:attributeName="financialSubObjectCode" />
+							<bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode" />
+							<bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode" />
+							<bean parent="FieldDefinition" p:attributeName="universityFiscalPeriodCode" />
+							<bean parent="FieldDefinition" p:attributeName="financialSystemOriginationCode" />
+							<bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode" />
+							<bean parent="FieldDefinition" p:attributeName="documentNumber" />
+							<bean parent="FieldDefinition" p:attributeName="transactionLedgerEntrySequenceNumber" />
+							<bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryDescription" />
+							<bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryAmount" />
+							<bean parent="FieldDefinition" p:attributeName="transactionDebitCreditCode" />
+							<bean parent="FieldDefinition" p:attributeName="transactionDate" />
+							<bean parent="FieldDefinition" p:attributeName="organizationDocumentNumber" />
+							<bean parent="FieldDefinition" p:attributeName="projectCode" />
+							<bean parent="FieldDefinition" p:attributeName="organizationReferenceId" />
+							<bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentTypeCode" />
+							<bean parent="FieldDefinition" p:attributeName="referenceFinancialSystemOriginationCode" />
+							<bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentNumber" />
+							<bean parent="FieldDefinition" p:attributeName="financialDocumentReversalDate" />
+							<bean parent="FieldDefinition" p:attributeName="transactionEncumbranceUpdateCode" />
+							<bean parent="FieldDefinition" p:attributeName="transactionEntryOffsetIndicator" />
+							<bean parent="FieldDefinition" p:attributeName="financialDocumentApprovedCode" />
+							<bean parent="FieldDefinition" p:attributeName="acctSufficientFundsFinObjCd" />
+							<bean parent="FieldDefinition" p:attributeName="transactionEntryProcessedTs" />
+							<bean parent="FieldDefinition" p:attributeName="documentHeader.financialDocumentStatusCode" />
+						</list>
+					</property>
+				</bean>
+			</list>
+		</property>
+	</bean>
+
+	<!-- Business Object Lookup Definition -->
+
+
+	<bean id="GeneralLedgerPendingEntry-lookupDefinition" parent="GeneralLedgerPendingEntry-lookupDefinition-parentBean" />
+
+	<bean id="GeneralLedgerPendingEntry-lookupDefinition-parentBean"
+		abstract="true" parent="LookupDefinition">
+		<property name="title" value="General Ledger Pending Entry Lookup" />
+		<property name="lookupableID" value="glPendingEntryLookupable" />
+		<property name="numOfColumns" value="2" />
+
+		<property name="defaultSort">
+			<bean parent="SortDefinition">
+				<property name="attributeNames">
+					<list>
+						<value>transactionLedgerEntrySequenceNumber</value>
+					</list>
+				</property>
+			</bean>
+		</property>
+		<property name="lookupFields">
+			<list>
+				<bean parent="FieldDefinition" p:attributeName="universityFiscalYear"
+					p:treatWildcardsAndOperatorsAsLiteral="true"
+					p:defaultValueFinderClass="org.kuali.kfs.sys.businessobject.defaultvalue.FiscalYearFinder" />
+				<bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="chartOfAccountsCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="financialSystemOriginationCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="accountNumber"
+					p:treatWildcardsAndOperatorsAsLiteral="false" />
+				<bean parent="FieldDefinition" p:attributeName="documentNumber"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="subAccountNumber" />
+				<bean parent="FieldDefinition" p:attributeName="organizationDocumentNumber"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="financialObjectCode"
+					p:treatWildcardsAndOperatorsAsLiteral="false" />
+				<bean parent="FieldDefinition" p:attributeName="projectCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="financialSubObjectCode"
+					p:treatWildcardsAndOperatorsAsLiteral="false" />
+				<bean parent="FieldDefinition" p:attributeName="organizationReferenceId"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true"
+					p:defaultValueFinderClass="org.kuali.kfs.gl.businessobject.options.ActualBalanceTypeOptionFinder" />
+				<bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentTypeCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="referenceFinancialSystemOriginationCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="universityFiscalPeriodCode"
+					p:treatWildcardsAndOperatorsAsLiteral="true"
+					p:defaultValueFinderClass="org.kuali.kfs.gl.businessobject.options.PeriodCodeOptionFinder" />
+				<bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentNumber"
+					p:treatWildcardsAndOperatorsAsLiteral="true" />
+				<bean parent="FieldDefinition" p:attributeName="documentHeader.financialDocumentStatusCode" />
+				<bean parent="FieldDefinition" p:attributeName="dummyBusinessObject.debitCreditOption"
+					p:defaultValueFinderClass="org.kuali.kfs.gl.businessobject.options.DebitCreditOptionFinder" />
+			</list>
+		</property>
+		<property name="resultFields">
+			<list>
+				<bean parent="FieldDefinition" p:attributeName="universityFiscalYear" />
+				<bean parent="FieldDefinition" p:attributeName="chartOfAccountsCode" />
+				<bean parent="FieldDefinition" p:attributeName="accountNumber" />
+				<bean parent="FieldDefinition" p:attributeName="subAccountNumber" />
+				<bean parent="FieldDefinition" p:attributeName="financialObjectCode" />
+				<bean parent="FieldDefinition" p:attributeName="financialSubObjectCode" />
+				<bean parent="FieldDefinition" p:attributeName="financialBalanceTypeCode" />
+				<bean parent="FieldDefinition" p:attributeName="financialObjectTypeCode" />
+				<bean parent="FieldDefinition" p:attributeName="universityFiscalPeriodCode" />
+				<bean parent="FieldDefinition" p:attributeName="financialDocumentTypeCode" />
+				<bean parent="FieldDefinition" p:attributeName="financialSystemOriginationCode" />
+				<bean parent="FieldDefinition" p:attributeName="documentNumber" />
+				<bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryDescription" />
+				<bean parent="FieldDefinition" p:attributeName="transactionLedgerEntryAmount" />
+				<bean parent="FieldDefinition" p:attributeName="transactionDebitCreditCode" />
+				<bean parent="FieldDefinition" p:attributeName="transactionDate" />
+				<bean parent="FieldDefinition" p:attributeName="organizationDocumentNumber" />
+				<bean parent="FieldDefinition" p:attributeName="projectCode" />
+				<bean parent="FieldDefinition" p:attributeName="organizationReferenceId" />
+				<bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentTypeCode" />
+				<bean parent="FieldDefinition" p:attributeName="referenceFinancialSystemOriginationCode" />
+				<bean parent="FieldDefinition" p:attributeName="referenceFinancialDocumentNumber" />
+			</list>
+		</property>
+	</bean>
 </beans>
Index: work/src/org/kuali/kfs/sys/businessobject/datadictionary/KfsKimAttributes.xml
===================================================================
--- work/src/org/kuali/kfs/sys/businessobject/datadictionary/KfsKimAttributes.xml	(revision 30259)
+++ work/src/org/kuali/kfs/sys/businessobject/datadictionary/KfsKimAttributes.xml	(revision 37225)
@@ -39,10 +39,12 @@
         <ref bean="KfsKimAttributes-purchasingCommodityCode" />
         <ref bean="KfsKimAttributes-contractManagerCode" />
         <ref bean="KfsKimAttributes-customerProfileId" />
+        <ref bean="KfsKimAttributes-achTransactionTypeCode" />
         <ref bean="KfsKimAttributes-vendorTypeCode" />
         <ref bean="KfsKimAttributes-contractsAndGrantsAccountResponsibilityId" />
         <ref bean="KfsKimAttributes-disbursementVoucherPaymentMethodCode" />
         <ref bean="KfsKimAttributes-subAccountNumber" />
+        <ref bean="KfsKimAttributes-filePath" />
       </list>
     </property>
     <property name="relationships">
@@ -113,6 +115,15 @@
     p:shortLabel="Id" 
     p:required = "false" />
 
+  <bean id="KfsKimAttributes-achTransactionTypeCode" parent="KfsKimAttributes-achTransactionTypeCode-parentBean" />
+  <bean id="KfsKimAttributes-achTransactionTypeCode-parentBean" abstract="true" parent="PayeeACHAccount-achTransactionType"
+  	p:name="achTransactionTypeCode" 
+    p:required = "false" >
+    <property name="control">
+      <bean parent="SelectControlDefinition" p:valuesFinderClass="org.kuali.kfs.pdp.businessobject.options.AchTransactionTypeCodeValuesFinder"
+            p:includeKeyInLabel="true" />
+    </property>
+  </bean>
 
   <bean id="KfsKimAttributes-vendorTypeCode" parent="VendorType-vendorTypeCode">
     <property name="control">
@@ -150,5 +161,10 @@
     p:label="Descends Hierarchy"
     p:shortLabel="Descends Hierarchy"
     p:required="true" />
+    
+  <bean id="KfsKimAttributes-filePath" parent="BatchFile-path" 
+  	p:name="filePath" 
+	p:label="File Path"
+    p:shortLabel="File Path" />
 
 </beans>
Index: work/src/org/kuali/kfs/sys/businessobject/AccountingLineOverride.java
===================================================================
--- work/src/org/kuali/kfs/sys/businessobject/AccountingLineOverride.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/businessobject/AccountingLineOverride.java	(revision 37225)
@@ -15,6 +15,7 @@
  */
 package org.kuali.kfs.sys.businessobject;
 
+import java.sql.Date;
 import java.util.Arrays;
 import java.util.Collections;
 import java.util.HashMap;
@@ -23,18 +24,28 @@
 import java.util.Map;
 import java.util.Set;
 
+import javax.sound.sampled.Line;
+
 import org.kuali.kfs.coa.businessobject.Account;
 import org.kuali.kfs.coa.businessobject.ObjectCode;
 import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.kfs.sys.document.AccountingDocument;
+import org.kuali.kfs.sys.document.AccountingDocumentBase;
 import org.kuali.kfs.sys.document.service.AccountPresenceService;
+import org.kuali.rice.kew.exception.WorkflowException;
+import org.kuali.rice.kns.document.Document;
+import org.kuali.rice.kns.document.TransactionalDocument;
+import org.kuali.rice.kns.service.DateTimeService;
+import org.kuali.rice.kns.service.DocumentService;
 import org.kuali.rice.kns.util.ObjectUtils;
+import org.kuali.rice.kns.workflow.service.WorkflowDocumentService;
 
 /**
  * This class helps implement AccountingLine overrides. It is not persisted itself, but it simplifies working with the persisted
  * codes. Instances break the code into components. Static methods help with the AccountingLine.
  */
 public class AccountingLineOverride {
-
+    protected static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(AccountingLineOverride.class);
     /**
      * These codes are the way the override is persisted in the AccountingLine.
      */
@@ -274,9 +285,9 @@
      * 
      * @param line
      */
-    public static void processForOutput(AccountingLine line) {
+    public static void processForOutput(AccountingDocument document ,AccountingLine line) {
         AccountingLineOverride fromCurrentCode = valueOf(line.getOverrideCode());
-        AccountingLineOverride needed = determineNeededOverrides(line);
+        AccountingLineOverride needed = determineNeededOverrides(document,line);
         line.setAccountExpiredOverride(fromCurrentCode.hasComponent(COMPONENT.EXPIRED_ACCOUNT));
         line.setAccountExpiredOverrideNeeded(needed.hasComponent(COMPONENT.EXPIRED_ACCOUNT));
         line.setObjectBudgetOverride(fromCurrentCode.hasComponent(COMPONENT.NON_BUDGETED_OBJECT));
@@ -289,9 +300,15 @@
      * @param line
      * @return what overrides the given line needs.
      */
-    public static AccountingLineOverride determineNeededOverrides(AccountingLine line) {
+    public static AccountingLineOverride determineNeededOverrides(AccountingDocument document ,AccountingLine line) {
+       Date date = SpringContext.getBean(DateTimeService.class).getCurrentSqlDate();
+       if(ObjectUtils.isNotNull(document)) {
+           AccountingDocument accountingDocument = (AccountingDocument) document;
+          date = accountingDocument.getAccountExpirationDocumentDate();
+       }
+       
         Set neededOverrideComponents = new HashSet();
-        if (needsExpiredAccountOverride(line.getAccount())) {
+        if (needsExpiredAccountOverride(line.getAccount(), date)) {
             neededOverrideComponents.add(COMPONENT.EXPIRED_ACCOUNT);
         }
         if (needsObjectBudgetOverride(line.getAccount(), line.getObjectCode())) {
@@ -303,6 +320,22 @@
         }
         return valueOf(neededOverrideComponents);
     }
+    
+    /**
+     * Returns whether the given account needs an expired account override.
+     * 
+     * @param account
+     * @return whether the given account needs an expired account override.
+     */
+    public static boolean needsExpiredAccountOverride(Account account, Date date) {
+        
+        if(ObjectUtils.isNotNull(account) && account.isActive()) {
+            if(account.getAccountExpirationDate() != null ) {
+                return  account.isExpired(date);
+            }
+        }
+        return false;
+    }
 
     /**
      * Returns whether the given account needs an expired account override.
@@ -333,4 +366,16 @@
     public static boolean needsObjectBudgetOverride(Account account, ObjectCode objectCode) {
         return !ObjectUtils.isNull(account) && !ObjectUtils.isNull(objectCode) && account.isActive() && !SpringContext.getBean(AccountPresenceService.class).isObjectCodeBudgetedForAccountPresence(account, objectCode);
     }
+    
+    public static Document getDocument(AccountingLine line) {
+        Document document = null;
+        try {
+            document = SpringContext.getBean(DocumentService.class).getByDocumentHeaderId(line.getDocumentNumber());
+           
+       }catch(WorkflowException exception) {
+           LOG.error("Unable to locate document for documentId :: " + line.getDocumentNumber() );
+       }
+       
+       return document;
+    }
 }
Index: work/src/org/kuali/kfs/sys/businessobject/format/BatchDateFormatter.java
===================================================================
--- work/src/org/kuali/kfs/sys/businessobject/format/BatchDateFormatter.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/businessobject/format/BatchDateFormatter.java	(revision 37225)
@@ -0,0 +1,71 @@
+package org.kuali.kfs.sys.businessobject.format;
+
+import java.text.ParseException;
+import java.text.SimpleDateFormat;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kns.service.KualiConfigurationService;
+import org.kuali.rice.kns.web.format.FormatException;
+import org.kuali.rice.kns.web.format.Formatter;
+
+/**
+ * Formatter which specializes in reading dates from flat files
+ */
+public class BatchDateFormatter extends Formatter {
+    private static final String DEFAULT_FLAT_FILE_DATE_FORMAT = "default.flatFile.dateFormat";
+    private static String defaultDateFormat;
+    
+    private String dateFormat;
+    private boolean formatToTimestamp = false;
+
+    /**
+     * Sets the date format to use for parsing
+     * @param dateFormat
+     */
+    public void setDateFormat(String dateFormat) {
+        this.dateFormat = dateFormat;
+    }
+    
+    /**
+     * @return the date format associated with this batch date format - if not specified, then the default
+     */
+    public String getDateFormat() {
+        return StringUtils.isBlank(dateFormat) ? getDefaultDateFormat() : dateFormat;
+    }
+    
+    /**
+     * @return the default date format, pulled from the application resource messages
+     */
+    public String getDefaultDateFormat() {
+        if (defaultDateFormat == null) {
+            defaultDateFormat = SpringContext.getBean(KualiConfigurationService.class).getPropertyString(BatchDateFormatter.DEFAULT_FLAT_FILE_DATE_FORMAT);
+        }
+        return defaultDateFormat;
+    }
+    
+    /**
+     * Determines if the date should be parsed to a java.sql.Timestamp rather than the default java.sql.Date
+     * @param formatToTimestamp true if result should be parsed as timestamp, false otherwise
+     */
+    public void setFormatToTimestamp(boolean formatToTimestamp) {
+        this.formatToTimestamp = formatToTimestamp;
+    }
+
+    /**
+     * Parses the given String to a date
+     */
+    @Override
+    protected Object convertToObject(String string) {
+        try {
+            long time = new SimpleDateFormat(getDateFormat()).parse(string).getTime();
+            if (formatToTimestamp) {
+                return new java.sql.Timestamp(time);
+            }
+            return new java.sql.Date(time);
+        }
+        catch (ParseException e) {
+            throw new FormatException("Date must be of the format " + dateFormat, e);
+        }
+    }
+}
Index: work/src/org/kuali/kfs/sys/businessobject/format/KualiDecimalFormatter.java
===================================================================
--- work/src/org/kuali/kfs/sys/businessobject/format/KualiDecimalFormatter.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/businessobject/format/KualiDecimalFormatter.java	(revision 37225)
@@ -0,0 +1,20 @@
+package org.kuali.kfs.sys.businessobject.format;
+
+import java.math.BigDecimal;
+
+import org.kuali.rice.kns.util.KualiDecimal;
+import org.kuali.rice.kns.web.format.BigDecimalFormatter;
+
+/**
+ * This class is used to format value to Kuali Decimal objects.
+ */
+public class KualiDecimalFormatter extends BigDecimalFormatter {
+    
+    /**
+     * Converts the given String to a KualiDecimal
+     */
+    protected Object convertToObject(String target) {
+        BigDecimal value = (BigDecimal)super.convertToObject(target);
+        return new KualiDecimal(value);
+    }  
+}
Index: work/src/org/kuali/kfs/sys/businessobject/format/ExplicitKualiDecimalFormatter.java
===================================================================
--- work/src/org/kuali/kfs/sys/businessobject/format/ExplicitKualiDecimalFormatter.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/businessobject/format/ExplicitKualiDecimalFormatter.java	(revision 37225)
@@ -0,0 +1,36 @@
+package org.kuali.kfs.sys.businessobject.format;
+
+import java.math.BigDecimal;
+
+import org.apache.log4j.Logger;
+import org.kuali.rice.kns.util.KualiDecimal;
+import org.kuali.rice.kns.web.format.BigDecimalFormatter;
+
+
+/**
+ * This class is used to format explicit decimal value to BigDecimal objects.
+ */
+public class ExplicitKualiDecimalFormatter extends BigDecimalFormatter {
+	private static Logger LOG = Logger.getLogger(ExplicitKualiDecimalFormatter.class);
+
+	/**
+	 * Converts the given String into a KualiDecimal with the final two characters being behind the decimal place
+	 */
+	protected Object convertToObject(String target) {
+		BigDecimal value = (BigDecimal)super.convertToObject(addDecimalPoint(target));
+		return new KualiDecimal(value);
+	}    
+	
+	/**
+	 * Adds the decimal point to the String
+	 * @param amount the String representing the amount
+	 * @return a new String, with a decimal inserted in the third to last place
+	 */
+	private String addDecimalPoint (String amount) {
+        if (!amount.contains(".")) {  //have to add decimal point if it's missing
+            int length = amount.length();
+            amount = amount.substring(0, length - 2) + "." + amount.substring(length - 2, length);
+        }
+        return amount;
+    }
+}
Index: work/src/org/kuali/kfs/sys/context/BatchStepLauncher.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/BatchStepLauncher.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/BatchStepLauncher.java	(revision 37225)
@@ -0,0 +1,137 @@
+package org.kuali.kfs.sys.context;
+
+
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import org.kuali.kfs.sys.batch.BatchSpringContext;
+
+import org.kuali.kfs.sys.batch.BatchContainerStep;
+
+/**
+ * This class should be used in the development environment to run the batch container, execute one or more steps, then shut down the batch container.
+ */
+public class BatchStepLauncher implements Runnable {
+    private static final String LOG_PREFIX = BatchStepLauncher.class.getName() +": ";
+    private static final String batchContainerStep = "batchContainerStep";
+    
+    private static BatchStepTriggerParameters batchStepTriggerParms;
+
+    /**
+     * This class validates the arguments, adds a shutdown hook to Runtime to clean up BatchContainer's semaphore, starts the batch container,
+     * and executes steps using the BatchStepTrigger.  
+     * 
+     * The BatchStepTrigger will exit the system using calls to System.exit(). This will cause this Launcher class to exit immediately without executing any further
+     * methods. Therefore the batch container cannot be shut down using the iu.stopBatchContainerStep which nicely cleans up its own semaphore. The shutdown hook has been
+     * added in order for this cleanup to occur. 
+     * 
+     * @param args the String[] arguments normally passed to BatchStepTrigger
+     */
+    public static void main(String[] args) {                
+        
+        //check arguments for the trigger
+        checkArguments(args);
+        
+        //run the Batch Container in its own thread
+        startBatchContainer();
+        
+        //confirm that the container started up before executing the steps 
+        //-uses batch container directory specified in args
+        confirmStartUp();
+            
+        //execute one or more steps
+        executeSteps(args);
+        
+        //the batch container will be shut down by the thread hook added to the Runtime in setUp()
+    }
+
+    /**
+     * Run the Batch Container in its own thread
+     */
+    public void run() {        
+        String[] args = new String[2];
+        args[0] = batchContainerStep;
+        args[1] = (batchStepTriggerParms != null ? batchStepTriggerParms.getJobName(): "unknown");
+        
+        BatchStepRunner.main(args);
+    }    
+    
+    /**
+     * Uses the BatchStepTriggerParameters class to validate the arguments passed to the launcher.
+     * 
+     * @param args String[] of arguments that would normally passed to BatchStepTrigger
+     */
+    private static void checkArguments(String[] args) {
+        logToOut("checking arguments");
+        
+        batchStepTriggerParms = new BatchStepTriggerParameters(args);
+        
+        logToOut("received valid arguments");
+    }
+    
+    /**
+     * Start the batch container in its own Thread
+     */
+    private static void startBatchContainer() {
+        logToOut("starting the batch container");
+        Executor executor = Executors.newCachedThreadPool();        
+        
+        BatchStepLauncher batchStepLauncher = new BatchStepLauncher();
+        executor.execute(batchStepLauncher);        
+    }
+    
+    /**
+     * Loops and polls for the batch container start up (looks for the .runlock) 
+     */
+    private static void confirmStartUp() {
+        logToOut("confirming batch container start up");
+        
+        while (!batchStepTriggerParms.getBatchContainerDirectory().isBatchContainerRunning()) {
+            logToOut("waiting for the batch container to start up");
+            try {                
+                Thread.sleep(batchStepTriggerParms.getSleepInterval());
+            }
+            catch (InterruptedException e) {
+                throw new RuntimeException("BatchStepLauncher encountered interrupt exception while trying to wait for the batch container to start up", e);
+            }
+        }
+        
+        logToOut("batch container is running");
+    }
+    
+    /**
+     * Calls BatchStepTrigger to execute steps
+     * 
+     * @param args String[] arguments normally passed to the BatchStepTrigger
+     */
+    private static void executeSteps(String[] args) {
+        logToOut("executing step(s)");
+        
+        BatchStepTrigger.main(args);
+        
+        logToOut("finished executing step(s)");
+    }
+    
+    /**
+     * Removes the batch container semaphore (used by the shutdown hook added to Runtime)
+     * This is necessary because the Launcher exits immediately when the Trigger exits. Shutdown hook cleans up the semaphore.
+     */
+    private static void removeBatchContainerSemaphore() {
+        logToOut("removing batch container semaphore file");
+        
+        if (batchStepTriggerParms.getBatchContainerDirectory().isBatchContainerRunning()) {
+            batchStepTriggerParms.getBatchContainerDirectory().removeBatchContainerSemaphore();
+        }
+        
+        logToOut("batch container semaphore file has been removed");
+    }
+    
+    /**
+     * Logs statement to System.out with a prefix.
+     * 
+     * @param statement the statement to log
+     */
+    private static void logToOut(String statement) {
+        System.out.println(LOG_PREFIX + statement);
+    }    
+}
Index: work/src/org/kuali/kfs/sys/context/BatchStepTrigger.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/BatchStepTrigger.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/BatchStepTrigger.java	(revision 37225)
@@ -0,0 +1,224 @@
+/*
+ * Copyright 2007 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.context;
+
+
+import java.util.Arrays;
+
+
+/**
+ * BatchStepTrigger writes .run files containing a job name and step name for BatchContainerStep to read. 
+ * It loops and sleeps until either a .success or an .error file is written for the Step. Once a result file is found tt logs the results and exits. 
+ * 
+ * BatchStepTrigger also checks for BatchContainerStep's .runlock file. If it doesn't find one (indicating the batch container is not running) it exits.
+ * BatchStepTrigger adds a ConsoleAppender to its Logger if one hasn't been configured.
+ * 
+ * Note that this class runs without starting the SpringContext. KFS Services and Beans are not available for use.
+ *
+ */
+public class BatchStepTrigger {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(BatchStepTrigger.class);
+    
+    private static BatchStepTriggerParameters batchStepTriggerParameters;
+    
+    /**
+     * BatchStepTrigger is instantiated for each step in a brte script. 
+     * The value used when exiting the system tells the brte script how to handle failures.
+     * 0: okay, 4: the step returned false, 8: an exception occurred in the execution of the step or the trigger
+     *
+     * - verify that the batch container is running, exit with an 8 if not
+     * - for each step
+     *   - write a RUN semaphore file
+     *   - wait and listen for a result file (either SUCCESS or ERROR)
+     *   - if the result file is null the batch container is not running so remove the run file and exit with an 8
+     *   - if the result file is an ERROR
+     *     - if the file is EMPTY remove the result file and exit with a 4
+     *     - otherwise log the error contained in the result file, remove the result file, and exit with an 8
+     *   - otherwise remove the result file and exit with a 0  
+     * 
+     * @param args - refer to BatchStepTriggerParameters for details
+     */
+    public static void main(String[] args) {
+        try {            
+            Log4jConfigurer.configureLogging(false);
+            BatchLogger.addConsoleAppender(LOG);
+            
+        	batchStepTriggerParameters = new BatchStepTriggerParameters(args);
+        	
+        	String[] stepNames = getStepNames();            
+            String jobName = getJobName();            
+            int stepIndex = getStepIndex();
+            long sleepInterval = getSleepInterval();            
+            BatchContainerDirectory batchContainerDirectory = getBatchContainerDirectory();
+            
+            LOG.info("Executing Job: " + jobName + ", STEP"+ stepIndex +", Step(s): " + Arrays.toString(stepNames));
+            
+			if (!batchContainerDirectory.isBatchContainerRunning()) {
+				//an instance of the batch container is not running - exit. Exit status: 8
+				LOG.error("The BatchContainer is not running - exiting without executing the steps: "+ Arrays.toString(stepNames));
+	            LOG.info("Exit status: 8");
+				System.exit(8);
+			}
+            
+			//Need to humanize 'i'; the index 
+            for (int i = (stepIndex-1); i < stepNames.length; i++) {
+                String stepName = stepNames[i];
+            	BatchStepFileDescriptor batchStepFile = new BatchStepFileDescriptor(jobName, stepName, BatchStepFileDescriptor.getFileExtensionRun());
+            	
+            	//write step start file
+            	batchContainerDirectory.writeBatchStepRunFile(batchStepFile, i);
+
+            	//wait for a result file from BatchContainer
+            	BatchStepFileDescriptor resultFile = listenForResultFile(batchContainerDirectory, batchStepFile, sleepInterval);
+            	
+            	if (resultFile == null) {
+            		//result file is null - something unexpected happened. Exit status: 8             		
+            		batchContainerDirectory.removeBatchStepFileFromSystem(batchStepFile);            		
+            		
+            		LOG.error("No result files were returned- exiting without knowing whether the Step was executed");
+                    LOG.info("Exit status: 8");
+        			System.exit(8);
+            	}
+            	
+            	if (resultFile.isStepFileAnErrorResultFile()) {            		
+            		
+            		if (batchContainerDirectory.isFileEmpty(resultFile)) {
+                		//do not execute any more steps, but job should succeed. Exit status: 4                		
+            			LOG.error(batchStepFile +" failed");
+            			batchContainerDirectory.removeBatchStepFileFromSystem(resultFile);
+            			
+                        LOG.info("Exit status: 4");
+                		System.exit(4);
+            		}
+            		else {
+            			
+                		//if file is not empty do not execute any more steps and fail job (write exception to log). Exit status: 8
+            			LOG.error(batchStepFile +" failed with the following error message: ");
+            			batchContainerDirectory.logFileContents(resultFile, LOG);
+            			batchContainerDirectory.removeBatchStepFileFromSystem(resultFile);
+
+                        LOG.info("Exit status: 8");
+                    	System.exit(8);            		            			
+            		}
+            	}
+            	
+    			batchContainerDirectory.removeBatchStepFileFromSystem(resultFile);
+                LOG.info("Exiting "+ batchStepFile);
+                
+            }
+            
+            //continue executing steps in the job. Exit status: 0
+            LOG.info("Exit status: 0");
+            
+            System.exit(0);
+        }
+        catch (Throwable t) {
+            System.err.println("ERROR: Exception caught: ");
+            t.printStackTrace(System.err);
+            LOG.error(t);
+            
+            System.exit(8);
+        }
+    }
+    
+    /**
+     * Loop - look for a result file in the directory, if none is found then sleep. 
+     * If the batch container is not running then write an error result file and return it.
+     * 
+     * @param batchContainerDirectory the directory in which the semaphore files are located
+     * @param batchStepFile the step descriptor for the current step
+     * @param sleepInterval the amount of time to sleep while waiting for a result file
+     * @return the step descriptor of the result file
+     */
+    private static BatchStepFileDescriptor listenForResultFile(BatchContainerDirectory batchContainerDirectory, BatchStepFileDescriptor batchStepFile, long sleepInterval) {
+        if (LOG.isDebugEnabled()) {
+            LOG.debug("Waiting for result file for "+ batchStepFile);
+        }
+    	
+    	while (true) {    		
+	    	//look for a result file in file-system
+	    	BatchStepFileDescriptor resultFile = batchContainerDirectory.getResultFile(batchStepFile);
+	    	if (resultFile != null) {
+    	        LOG.info("Found result file: "+ resultFile.getName());
+	    		
+	    		return resultFile;
+	    	}
+	    	
+	    	if (batchContainerDirectory.isBatchContainerRunning()) {	    	
+		    	sleep(sleepInterval);    		    		
+	    	}
+	    	else {
+	    		//the batch container is not running - return an error file with an exception
+	    		batchContainerDirectory.writeBatchStepErrorResultFile(batchStepFile, new RuntimeException("The BatchContainer is not running - exiting without knowing whether the Step executed"));
+	    		
+	    		resultFile = batchContainerDirectory.getResultFile(batchStepFile);
+    			return resultFile;
+	    	}
+    	}     	
+    }    
+    
+    /**
+     * Sleep for the specified amount of time
+     * 
+     * @param sleepInterval the amount of time (in milliseconds) to wait before looking for a result file
+     */
+    private static void sleep(long sleepInterval) {
+        if (LOG.isDebugEnabled()) {
+            LOG.debug("Sleeping...");
+        }
+        try {
+            Thread.sleep(sleepInterval);
+        }
+        catch (InterruptedException e) {
+            throw new RuntimeException("BatchStepTrigger encountered interrupt exception while trying to wait for the specified batch step semaphore processing interval", e);
+        }
+    }
+    
+    /**
+     * @return the names of the steps to be executed
+     */
+    private static String[] getStepNames() {
+    	return batchStepTriggerParameters.getStepNames();
+    }
+    
+    /**
+     * @return the name of the job in which the steps are running
+     */
+    private static String getJobName() {
+    	return batchStepTriggerParameters.getJobName();
+    }
+    
+    /**
+     * @return the index of the step in the job
+     */
+    private static int getStepIndex() {
+        return batchStepTriggerParameters.getStepIndex();
+    }
+    
+    /**
+     * @return the amount of time to sleep (in milliseconds) while waiting for a result file
+     */
+    private static long getSleepInterval() {
+    	return batchStepTriggerParameters.getSleepInterval();
+    }
+    
+    /**
+     * @return the directory in which the semaphore files are located
+     */
+    private static BatchContainerDirectory getBatchContainerDirectory() {
+    	return batchStepTriggerParameters.getBatchContainerDirectory();
+    }
+}
\ No newline at end of file
Index: work/src/org/kuali/kfs/sys/context/SpringContext.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/SpringContext.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/context/SpringContext.java	(revision 37225)
@@ -78,7 +78,7 @@
      * NOT the service implementation. 1. there is only one bean of the specified type in our spring context 2. there is only one
      * bean of the specified type in our spring context, but you want the one whose bean id is the same as type.getSimpleName() with
      * the exception of the first letter being lower case in the former and upper case in the latter, For example, there are two
-     * beans of type DateTimeService in our context ï¿½ dateTimeService and testDateTimeService. To retrieve the former, you should
+     * beans of type DateTimeService in our context dateTimeService and testDateTimeService. To retrieve the former, you should
      * specific DateTimeService.class as the type. To retrieve the latter, you should specify ConfigurableDateService.class as the
      * type. Unless you are writing a unit test and need to down cast to an implementation, you do not need to cast the result of
      * this method.
@@ -470,4 +470,12 @@
             processWatchThread.start();
         }        
     }
+    
+    public static void registerSingletonBean(String beanId, Object bean) {
+        applicationContext.getBeanFactory().registerSingleton(beanId, bean);
+        //Cleaning caches
+        SINGLETON_BEANS_BY_NAME_CACHE.clear();
+        SINGLETON_BEANS_BY_TYPE_CACHE.clear();
+        SINGLETON_BEANS_OF_TYPE_CACHE.clear();
+    }
 }
Index: work/src/org/kuali/kfs/sys/context/BatchContainerDirectory.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/BatchContainerDirectory.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/BatchContainerDirectory.java	(revision 37225)
@@ -0,0 +1,458 @@
+package org.kuali.kfs.sys.context;
+
+import java.io.BufferedReader;
+import java.io.File;
+import java.io.FileNotFoundException;
+import java.io.FileReader;
+import java.io.FilenameFilter;
+import java.io.IOException;
+import java.io.PrintStream;
+import java.util.ArrayList;
+import java.util.List;
+
+import org.apache.log4j.Logger;
+
+/**
+ * BatchContainerDirectory knows the path to the directory for the BatchContainerStep and BatchStepTrigger semaphore files.
+ * It also handles much of the logic for writing, reading, and removing those files.  
+ * 
+ * BatchContainerDirectory adds a ConsoleAppender to its Logger if one hasn't been configured.
+ *
+ */
+public class BatchContainerDirectory {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(BatchContainerDirectory.class);
+
+	private static final String BATCH_CONTAINER_SEMAPHORE_EXTENSION = "runlock";
+	
+	private File directory;
+	
+	/**
+	 * Creates a reference for the path to the batch container. Verifies that the directory exists and throws an error if it does not.
+	 * 
+	 * @param batchContainerPath the path to the directory that contains the semaphore files
+	 */
+	public BatchContainerDirectory(String batchContainerPath) {
+	    BatchLogger.addConsoleAppender(LOG);
+	    
+		directory = new File(batchContainerPath);
+		
+		if(!directory.exists()) {
+		    throw new RuntimeException(batchContainerPath + " does not exist. Please verify and run again");
+		}
+		else {			
+			LOG.info("batchContainerDirectory=" + batchContainerPath);
+		}
+	}
+	
+	/**
+	 * Writes the semaphore file which indicates that the batch container is running
+	 * 
+	 * @param jobName the name of the job that is starting the batch container
+	 * @param stepName the name of the step which starts the batch container
+	 */
+	public void writeBatchContainerSemaphore(String jobName, String stepName) {
+		if (!isExistsBatchContainerSemaphore()) {			
+			BatchStepFileDescriptor batchStepFile = new BatchStepFileDescriptor(jobName, stepName, BATCH_CONTAINER_SEMAPHORE_EXTENSION);				
+			writeBatchStepFileToSystem(batchStepFile, null);
+		}
+	}	
+	
+	/**
+	 * Removes the semaphore file which indicates that the batch container is running
+	 */
+	public void removeBatchContainerSemaphore() {
+		FilenameFilter semaphoreExtensionFilter = new FileExtensionFileFilter(BATCH_CONTAINER_SEMAPHORE_EXTENSION);		
+		File[] filteredFiles = directory.listFiles(semaphoreExtensionFilter);
+
+		for(File semaphore: filteredFiles) {			
+			semaphore.delete();
+		}
+	}
+	
+	/**
+	 * Checks whether the batch container is currently running (by checking for the presence of the batch container semaphore file)
+	 * 
+	 * @return true if the batch container is running (if the semaphore file exists), false otherwise
+	 */
+	public boolean isBatchContainerRunning() {
+		return isExistsBatchContainerSemaphore();
+	}
+	
+	/** 
+	 * @return true if the batch container semaphore file exists in the batch container, false otherwise
+	 */
+	private boolean isExistsBatchContainerSemaphore() {
+		FilenameFilter semaphoreExtensionFilter = new FileExtensionFileFilter(BATCH_CONTAINER_SEMAPHORE_EXTENSION);		
+		File[] filteredFiles = directory.listFiles(semaphoreExtensionFilter);
+		
+		if (filteredFiles != null && filteredFiles.length > 0) {
+			return true;
+		}
+		else {
+			return false;
+		}
+	}
+	
+	/**
+	 * Returns a list of files in the batch container with the run extension
+	 * 
+	 * @return a list of step .run files
+	 */
+	public File[] getStepRunFiles() { 
+		// Find all the step .run files for all the jobs. 
+		FilenameFilter stepStartFilter = new FileExtensionFileFilter(BatchStepFileDescriptor.getFileExtensionRun());		
+		File[] stepStartFiles = directory.listFiles(stepStartFilter);
+		
+		// No .run files found 
+		if (stepStartFiles == null || stepStartFiles.length == 0) {
+			return null;
+		}
+		
+		return stepStartFiles;
+	}	
+	
+	/**
+	 * Writes the run file for the Step specified in the descriptor
+	 * 
+	 * @param batchStepFile the step for which a .run file will be written
+	 * @param stepIndex the index of the step in the job
+	 */
+    public void writeBatchStepRunFile(BatchStepFileDescriptor batchStepFile, int stepIndex) {
+    	BatchStepFileDescriptor runFile = getCopyWithNewExtension(batchStepFile, BatchStepFileDescriptor.getFileExtensionRun());
+    	writeBatchStepFileToSystem(runFile, new Integer(stepIndex));
+    }        
+    	
+    /**
+     * Writes the success file for the Step specified in the descriptor
+     * 
+     * @param batchStepFile the step for which a .success file will be written
+     */
+    public void writeBatchStepSuccessfulResultFile(BatchStepFileDescriptor batchStepFile) {
+    	BatchStepFileDescriptor successFile = getCopyWithNewExtension(batchStepFile, BatchStepFileDescriptor.getFileExtensionSuccess());
+    	writeBatchStepFileToSystem(successFile, null);
+    }
+    
+    /**
+     * Writes the error file for the Step specified in the descriptor
+     * 
+     * @param batchStepFile the step for which a .error file will be written
+     */
+    public void writeBatchStepErrorResultFile(BatchStepFileDescriptor batchStepFile) {
+    	BatchStepFileDescriptor errorFile = getCopyWithNewExtension(batchStepFile, BatchStepFileDescriptor.getFileExtensionError());
+    	writeBatchStepFileToSystem(errorFile, null);
+    }
+    
+    /**
+     * Writes the error file for the Step specified in the descriptor. The stack trace in the Throwable will be written to the file.
+     * 
+     * @param batchStepFile the step for which a .error file will be written
+     * @param error the error to write in the error file
+     */
+    public void writeBatchStepErrorResultFile(BatchStepFileDescriptor batchStepFile, Throwable error) {
+    	BatchStepFileDescriptor errorFile = getCopyWithNewExtension(batchStepFile, BatchStepFileDescriptor.getFileExtensionError());
+    	writeBatchStepFileToSystem(errorFile, error);
+    }
+	
+    /**
+     * Returns a copy of the descriptor passed into the method, but with the extension specified. 
+     * 
+     * @param batchStepFile the Step for which a new descriptor is needed
+     * @param extension the extension to use for the new descriptor
+     * @return a copy of the descriptor passed in, but with the specified extension
+     */
+	private BatchStepFileDescriptor getCopyWithNewExtension(BatchStepFileDescriptor batchStepFile, String extension) {
+		return new BatchStepFileDescriptor(batchStepFile.getJobName(), batchStepFile.getStepName(), extension);
+	}
+	
+	/**
+	 * Writes a batch step semaphore file to the directory; Writes the details to the file. 
+	 * Throws a RuntimeException if the file already exists. 
+	 * 
+	 * @param batchStepFile the step for which a semaphore file will be written
+	 * @param details additional details to add to the semaphore file 
+	 */
+    private void writeBatchStepFileToSystem(BatchStepFileDescriptor batchStepFile, Object details) {
+    	LOG.debug("Writing "+ batchStepFile.getExtension() +" file for "+ batchStepFile);
+    	
+        String fileName = getDirectoryPath() + batchStepFile.getName();
+        File file = new File(fileName);
+        if (!file.exists()) {
+            try {
+            	LOG.info("Creating new "+ batchStepFile.getExtension() +" file: "+ file.getName());
+                file.createNewFile();
+                
+                //if further details exist write them to the file
+                if (details != null) {
+                    if (details instanceof Throwable) {
+                        writeErrorMessageToFile(file, (Throwable)details);
+                    }
+                    else if (details instanceof Integer) {
+                        writeStepIndexToFile(file, (Integer)details);
+                    }
+                }
+                
+            } catch (IOException e) {
+                throw new RuntimeException(e);
+            }
+        }
+        else {
+        	throw new RuntimeException("Step "+ batchStepFile.getExtension() +" file: "+ fileName +" already exists"); 
+        }    	        
+    }    
+    
+    /**
+     * Removes the semaphore file for the specified step
+     * 
+     * @param batchStepFile the step for which the semaphore file should be removed
+     */
+    public void removeBatchStepFileFromSystem(BatchStepFileDescriptor batchStepFile) {
+    	LOG.info("Removing "+ batchStepFile.getExtension() +" file for "+ batchStepFile);
+    	
+        String fileName = getDirectoryPath() + batchStepFile.getName();
+        File file = new File(fileName);
+        if (file != null && file.exists()) {
+        	boolean successfulDelete = file.delete();
+        	if (!successfulDelete) {
+        		LOG.error("Failed to delete "+ fileName +" from the system.");
+        	}
+        }
+        else {
+        	//don't need to throw an exception if the file doesn't exist- but note it in the logs
+        	LOG.warn("Step "+ batchStepFile.getExtension() +" file: "+ fileName +" doesn't exist");
+        }    	        
+    }
+    
+    /**
+     * Returns the result file (either a success file or an error file) if one exists for the specified step. Otherwise null is returned.
+     * 
+     * @param batchStepFile the step for which a result file is requested
+     * @return the descriptor of the result file if one exists, null otherwise
+     */
+    public BatchStepFileDescriptor getResultFile(BatchStepFileDescriptor batchStepFile) {
+        LOG.debug("Looking for a result file for "+ batchStepFile);
+        
+        String successFileName = getDirectoryPath() + batchStepFile.getNameNoExtension() +"."+ BatchStepFileDescriptor.getFileExtensionSuccess();
+        File successFile = new File(successFileName);
+        if (successFile != null && successFile.exists()) {
+    		LOG.info("Found .success result file for "+ batchStepFile);
+    		
+        	return new BatchStepFileDescriptor(successFile);
+        }
+        
+        String errorFileName = getDirectoryPath() + batchStepFile.getNameNoExtension() +"."+ BatchStepFileDescriptor.getFileExtensionError();
+        File errorFile = new File(errorFileName);
+        if (errorFile != null && errorFile.exists()) {
+    		LOG.info("Found .error result file for "+ batchStepFile);
+    		
+            return new BatchStepFileDescriptor(errorFile);        	
+        }
+        
+        return null;
+    }    
+    
+    /**
+     * Checks whether the step's semaphore file in the descriptor is null and if not whether the step's semaphore file in the directory is empty
+     * 
+     * @param batchStepFile the descriptor for which a semaphore file existence check is requested
+     * @return true if the step's semaphore file is empty, false otherwise. Throws a RuntimeException if the file does not exist.
+     */
+    public boolean isFileEmpty(BatchStepFileDescriptor batchStepFile) {
+    	File resultFile = batchStepFile.getStepFile();
+    	if (resultFile == null) {
+    		throw new RuntimeException(batchStepFile + BatchStepFileDescriptor.STEP_FILE_EXTENSION_SEPARATOR + batchStepFile.getExtension() +" does not exist");
+    	}
+    	
+    	return isFileEmpty(resultFile);
+    }
+    
+    /**
+     * Returns the index of the step contained in the file
+     * 
+     * @param batchStepFile the file from which to retrieve the step index
+     * @return the step index, or -1 if there was no content in the file
+     */
+    public int getStepIndexFromFile(BatchStepFileDescriptor batchStepFile) {
+        File runFile = batchStepFile.getStepFile();
+        if (runFile != null) {
+            List<String> contents = getFileContents(runFile);
+            if (contents.size() > 0) {
+                return Integer.parseInt(contents.get(0));
+            }
+        }        
+        
+        return -1;
+    }
+    
+    /**
+     * Reads the contents of the semaphore file (normally the error file), and writes the contents to the requested Logger.
+     * 
+     * @param batchStepFile the descriptor whose semaphore file's contents should be written to the Logger
+     * @param log the log to write the file contents to
+     */
+    public void logFileContents(BatchStepFileDescriptor batchStepFile, Logger log) {
+    	File resultFile = batchStepFile.getStepFile();
+    	if (resultFile != null) {
+    	    List<String> contents = getFileContents(resultFile);
+            String toLog = "";
+            
+    	    for (String line : contents) {
+                toLog += line + "\n";                    	        
+    	    }
+    	    
+            log.error("Exception found in "+ resultFile.getName() +"\n"+ toLog);
+    	}
+    }
+    
+    /**
+     * Returns the Exception contained in an error result file
+     * 
+     * @param errorResultFile
+     * @return the exception
+     */
+    public String getExceptionFromFile(BatchStepFileDescriptor errorResultFile) {
+        if (errorResultFile.isStepFileAnErrorResultFile()) {
+            File resultFile = errorResultFile.getStepFile();
+            if (resultFile != null) {
+                List<String> contents = getFileContents(resultFile);
+                String toLog = "";
+                
+                for (String line : contents) {
+                    toLog += line + "\n";                               
+                }
+                
+                return toLog;
+            }
+        }
+        
+        return "";
+    }
+    
+    /**
+     * Creates a shutdown hook and adds it to the local Runtime so that if the container's VM is shut down,
+     * the semaphore files will be removed
+     */
+    public void addShutdownHook() {
+        Runtime.getRuntime().addShutdownHook(new Thread() {
+            
+            public void run() {
+                removeBatchContainerSemaphore();
+                if (isBatchContainerRunning()) {
+                    LOG.info("the batch container was not shut down successfully; .runlock still exists.");
+                }
+            }
+            
+        });
+    }
+    
+    /** 
+     * Returns a List<String> containing each line in the file
+     * 
+     * @param file the file whose contents we want to retrieve
+     * @return a String array containing each line in the file
+     */
+    private List<String> getFileContents(File file) {
+        ArrayList<String> results = new ArrayList<String>();
+        try {
+            FileReader fileReader = new FileReader(file.getAbsolutePath());
+                
+            String line = "";
+            BufferedReader inputBufferedReader = new BufferedReader(fileReader);
+        
+            String currentLine = inputBufferedReader.readLine();
+            while (currentLine != null) {
+                results.add(currentLine);
+                currentLine = inputBufferedReader.readLine();
+            }
+            inputBufferedReader.close();    
+            
+            return results;
+            
+        } catch (IOException e) {
+            throw new RuntimeException("getFileContents() : " + e.getMessage(), e);
+        }
+    }
+	
+    /**
+     * Returns the absolute path to the directory
+     * 
+     * @return the absolute path to the batch container directory
+     */
+	private String getDirectoryPath() {
+		return directory.getAbsolutePath() + File.separator;
+	}
+    
+	/**
+	 * Checks whether the specified File is empty.
+	 * 
+	 * @param file the file to check
+	 * @return true if the file is empty, false otherwise
+	 */
+    private boolean isFileEmpty(File file) {    	
+    	return file.length() == 0;
+    }
+    
+    /**
+     * Writes the index of the step to the File
+     * 
+     * @param runFile the file to write to
+     * @param stepIndex the step index to write
+     */
+    private void writeStepIndexToFile(File runFile, Integer stepIndex) {
+        PrintStream printStream = initializePrintStream(runFile);
+        
+        //write index
+        printStream.print(stepIndex.intValue());
+        printStream.flush();
+        
+        destroyPrintStream(printStream);
+    }
+    
+    /**
+     * Writes the stack trace of Throwable to the File
+     * 
+     * @param errorFile the file to write to
+     * @param error the error to write
+     */
+    private void writeErrorMessageToFile(File errorFile, Throwable error) {
+    	PrintStream printStream = initializePrintStream(errorFile);
+
+    	//write error    	
+    	error.printStackTrace(printStream);
+    	printStream.flush();
+
+    	destroyPrintStream(printStream);
+    }    
+    
+    /**
+     * Initializes a PrintStream to use for writing to.
+     * 
+     * @param errorFile the file to write to
+     * @return a new PrintStream to use to write to the file
+     */
+    private PrintStream initializePrintStream(File errorFile) {
+    	//initialize PrintStream
+        PrintStream printStream;
+    	try {
+    		printStream = new PrintStream(errorFile);
+    	}
+    	catch (FileNotFoundException e) {
+    		LOG.error(e);
+    		throw new RuntimeException(e);
+    	}
+    	
+    	return printStream;
+    }
+    
+    /**
+     * Closes the PrintStream
+     * 
+     * @param printStream the print stream to close
+     */
+    private void destroyPrintStream(PrintStream printStream) {
+    	//close PrintStream
+        if(printStream != null) {        
+            printStream.close();
+            printStream = null;
+        }    	    	    	
+    }    	
+}
Index: work/src/org/kuali/kfs/sys/context/BatchStepFileDescriptor.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/BatchStepFileDescriptor.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/BatchStepFileDescriptor.java	(revision 37225)
@@ -0,0 +1,221 @@
+package org.kuali.kfs.sys.context;
+
+
+import java.io.File;
+import java.util.Date;
+
+import org.apache.commons.lang.StringUtils;
+
+/**
+ * BatchStepFileDescriptor contains the properties of a batch step file (name of the job, name of the step, and the file type extension). 
+ * The index of the step, the start time/date, and the completion time/date of the step can also be stored.
+ *
+ */
+public class BatchStepFileDescriptor {
+
+	private static final String STEP_FILE_SUFFIX_RUN = "run";
+	private static final String STEP_FILE_SUFFIX_RESULT_SUCCESS = "success";
+	private static final String STEP_FILE_SUFFIX_RESULT_ERROR = "error";
+	
+	public static final String STEP_FILE_EXTENSION_SEPARATOR = ".";
+	public static final String STEP_FILE_NAME_SEPARATOR = "~";
+    
+	private String jobName;
+	private String stepName;
+	private String extension;
+	
+	private File stepFile;
+	
+	private Integer stepIndex;
+	private Date startedDate;
+	private Date completedDate;
+	
+	/** 
+	 * Create a descriptor using the properties provided. getStepFile() will return null when this constructor is used.  
+	 * This constructor is used to provide the details about a semaphore file to look for in the directory. 
+	 * 
+	 * @param jobName the name of the job in which the step is running
+	 * @param stepName the name of the step to be executed
+	 * @param extension the type of file to work with (RUN, SUCCESS, or ERROR)
+	 */
+	public BatchStepFileDescriptor(String jobName, String stepName, String extension) {
+		this.jobName = jobName;
+		this.stepName = stepName;
+		this.extension = extension;
+	}
+	
+	/** 
+	 * @param stepFile the semaphore file in the directory. The jobName, stepName, and extension are retrieved from the semaphore file name.
+	 */
+	public BatchStepFileDescriptor(File stepFile) {
+		this.stepFile = stepFile;
+		
+		this.jobName = getJobNameFromFile(stepFile);		
+		this.stepName = getStepNameFromFile(stepFile);						
+		this.extension = getExtensionFromFile(stepFile);
+	}
+	
+	/**
+	 * @return the name of the job in which the step is running
+	 */
+	public String getJobName() {
+		return jobName;
+	}
+	
+	/**
+	 * @return the name of the step being executed
+	 */
+	public String getStepName() {
+		return stepName;
+	}
+	
+	/**
+	 * @return the extension of the semaphore file 
+	 */
+	public String getExtension() {
+		return extension;
+	}
+	
+	/**
+	 * @return the semaphore file in the directory
+	 */
+	public File getStepFile() {
+		return stepFile;
+	}			
+	
+	/**
+	 * @return the name of the file with the extension (jobName~stepName.extension)
+	 */
+	public String getName() {
+		return jobName + STEP_FILE_NAME_SEPARATOR + stepName + STEP_FILE_EXTENSION_SEPARATOR + extension;
+	}
+	
+	/**
+	 * @return the name of the file without an extension (jobName~stepName)
+	 */
+	public String getNameNoExtension() {
+		return jobName + STEP_FILE_NAME_SEPARATOR + stepName;
+	}
+    
+	/**
+	 * Return a representation of the step file descriptor. STEP and the stepIndex are only printed if the stepIndex is not null.
+	 * 
+	 * @return [jobName] STEP[stepIndex]-[stepName]  or [jobName] [stepName]
+	 */
+    public String toString() {
+        return getJobName() +" "+ (stepIndex != null ? "STEP"+ stepIndex +"-":"") + getStepName();
+    }
+    
+    /**
+     * @return true if the semaphore file is an ERROR file, false otherwise
+     */
+    public boolean isStepFileAnErrorResultFile() {
+    	return getName().endsWith(BatchStepFileDescriptor.getFileExtensionError());
+    }
+    
+    /**
+     * @return the index of the step in its job
+     */
+    public Integer getStepIndex() {
+        return stepIndex;
+    }
+    
+    /**
+     * @param stepIndex the index of the step in its job
+     */
+    public void setStepIndex(Integer stepIndex) {
+        this.stepIndex = stepIndex;
+    }
+    
+    /**
+     * @return the time the step started
+     */
+    public Date getStartedDate() {
+        return startedDate;
+    }
+    
+    /**
+     * @param startedDate the time the step started
+     */
+    public void setStartedDate(Date startedDate) {
+        this.startedDate = startedDate;
+    }
+    
+    /**
+     * @return the time the step completed
+     */
+    public Date getCompletedDate() {
+        return completedDate;
+    }
+    
+    /**
+     * @param completedDate the time the step completed
+     */
+    public void setCompletedDate(Date completedDate) {
+        this.completedDate = completedDate;
+    }
+    
+    /**
+     * Retrieves the name of the job from the File
+     * 
+     * @param runFile the semaphore file
+     * @return the job name
+     */
+    private String getJobNameFromFile(File runFile) {
+    	String runFileName = runFile.getName();
+		int indexOfExtension = runFileName.lastIndexOf(STEP_FILE_EXTENSION_SEPARATOR);
+		String fileNameNoExtension = StringUtils.substring(runFileName, 0, indexOfExtension);
+		int indexOfStep = fileNameNoExtension.lastIndexOf(STEP_FILE_NAME_SEPARATOR);
+		String jobName = StringUtils.substring(fileNameNoExtension, 0, indexOfStep);
+		return jobName;
+    }
+    
+    /**
+     * Retrieves the name of the step from the File
+     * 
+     * @param runFile the semaphore file
+     * @return the step name
+     */
+    private String getStepNameFromFile(File runFile) {
+    	String runFileName = runFile.getName();
+		int indexOfExtension = runFileName.lastIndexOf(STEP_FILE_EXTENSION_SEPARATOR);
+		String fileNameNoExtension = StringUtils.substring(runFileName, 0, indexOfExtension);
+		int indexOfStep = fileNameNoExtension.lastIndexOf(STEP_FILE_NAME_SEPARATOR);
+		String stepName = StringUtils.substring(fileNameNoExtension, indexOfStep+1);
+		return stepName;
+    }            
+    
+    /**
+     * Retrieves the extension from the File
+     * 
+     * @param runFile the semaphore file
+     * @return the extension
+     */
+    private String getExtensionFromFile(File runFile) {
+    	String runFileName = runFile.getName();
+		int indexOfExtension = runFileName.lastIndexOf(STEP_FILE_EXTENSION_SEPARATOR);
+		String extension = StringUtils.substring(runFileName, indexOfExtension+1);
+		return extension;
+    }            
+        
+    /**
+     * @return the extension for the RUN file
+     */
+    public static String getFileExtensionRun() {
+    	return BatchStepFileDescriptor.STEP_FILE_SUFFIX_RUN;
+    }
+    
+    /**
+     * @return the extension for the SUCCESS file
+     */
+    public static String getFileExtensionSuccess() {
+    	return BatchStepFileDescriptor.STEP_FILE_SUFFIX_RESULT_SUCCESS;
+    }
+    
+    /**
+     * @return the extension for the ERROR file
+     */
+    public static String getFileExtensionError() {
+    	return BatchStepFileDescriptor.STEP_FILE_SUFFIX_RESULT_ERROR;
+    }    
+}
Index: work/src/org/kuali/kfs/sys/context/BatchLogger.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/BatchLogger.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/BatchLogger.java	(revision 37225)
@@ -0,0 +1,98 @@
+package org.kuali.kfs.sys.context;
+
+import java.util.Enumeration;
+
+import org.apache.log4j.Appender;
+import org.apache.log4j.ConsoleAppender;
+import org.apache.log4j.Layout;
+import org.apache.log4j.Logger;
+import org.apache.log4j.PatternLayout;
+
+/**
+ * Provides a method to add a ConsoleAppender to a Logger if one has not already been configured.
+ */
+public class BatchLogger {
+    public static final String DEFAULT_CONVERSION_PATTERN = "%d [%t] u:%X{user}/d:%X{docId} %-5p %c :: %m%n";
+    public static final Layout DEFAULT_PATTERN_LAYOUT = new PatternLayout(DEFAULT_CONVERSION_PATTERN);
+    public static final String LOG_FILE_APPENDER_NAME = "LogFile";
+    
+    /**
+     * Adds a ConsoleAppender to the Logger if one doesn't already exist. 
+     * Attempts to use the layout from the 'LogFile' appender if it exists, otherwise it uses the DEFAULT_CONVERSION_PATTERN
+     * 
+     * @param logger the Logger to which to add a ConsoleAppender
+     */
+    public static void addConsoleAppender(Logger logger) {
+        if (!isConsoleAppenderExists(logger)) {       
+            
+            Appender console = new ConsoleAppender(getLogFileAppenderLayout(logger));
+
+            logger.addAppender(console);
+        }
+    }
+    
+    /**
+     * Returns the layout for the 'LogFile' appender. Returns the DEFAULT_PATTERN_LAYOUT if the 'LogFile' doesn't exist.
+     * 
+     * @return the layout for the 'LogFile' appender
+     */
+    public static Layout getLogFileAppenderLayout() {
+        return getLogFileAppenderLayout(null);
+    }
+    
+    /**
+     * Checks whether a ConsoleAppender has already been added to either the RootLogger or to the requested Logger
+     * 
+     * @param logger the Logger to check
+     * @return true if a ConsoleAppender has already been added to the RootLogger or to the requested Logger, false otherwise
+     */
+    private static boolean isConsoleAppenderExists(Logger logger) {        
+        Enumeration<Appender> rootAppenders = Logger.getRootLogger().getAllAppenders();
+        while(rootAppenders.hasMoreElements()) {
+            Appender appender = rootAppenders.nextElement();
+            if (appender instanceof ConsoleAppender) {
+                return true;
+            }
+        }
+        
+        Enumeration<Appender> appenders = logger.getAllAppenders();        
+        while(appenders.hasMoreElements()) {
+            Appender appender = appenders.nextElement();
+            if (appender instanceof ConsoleAppender) {
+                return true;
+            }
+        }
+        return false;
+    }
+    
+    /**
+     * @return the appender for 'LogFile' if it exists on the RootLogger or the requested Logger, null otherwise
+     */
+    private static Appender getLogFileAppender(Logger logger) {
+        if (Logger.getRootLogger() != null) {
+            return Logger.getRootLogger().getAppender(LOG_FILE_APPENDER_NAME);
+        }
+        else if (logger != null ) {
+            return logger.getAppender(LOG_FILE_APPENDER_NAME);
+        }
+        return null;
+    }
+    
+    /**
+     * Returns the layout for the 'LogFile' appender.
+     * 
+     * @param logger the Logger to check
+     * @return the Layout for the 'LogFile' appender, the DEFAULT_PATTERN_LAYOUT if 'LogFile' doesn't exist
+     */
+    private static Layout getLogFileAppenderLayout(Logger logger) {
+        Appender logFileAppender = getLogFileAppender(logger);
+        
+        if (logFileAppender != null) {
+            return logFileAppender.getLayout();
+        }
+        else {
+            System.out.println(BatchLogger.class.getName() +": Could not find '"+ LOG_FILE_APPENDER_NAME +"' appender on RootLogger. Using DEFAULT_CONVERSION_PATTERN for layout to console");
+            return DEFAULT_PATTERN_LAYOUT;
+        }
+    }
+}
Index: work/src/org/kuali/kfs/sys/context/FileExtensionFileFilter.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/FileExtensionFileFilter.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/FileExtensionFileFilter.java	(revision 37225)
@@ -0,0 +1,55 @@
+/*
+ * Copyright 2009 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.context;
+
+
+import java.io.File;
+
+import org.apache.commons.io.filefilter.IOFileFilter;
+
+/**
+ * A file filter which only returns any directory or any files with the given extension
+ */
+public class FileExtensionFileFilter implements IOFileFilter {
+    private String suffix;
+    
+    /**
+     * Constructs a FileExtensionFileFilter, using the extension to filter the files
+     */
+    public FileExtensionFileFilter(String extension) {
+    	this.suffix = extension;
+    }
+    
+    /**
+     * Accepts any directory and any file with the given extension
+     * @see org.apache.commons.io.filefilter.IOFileFilter#accept(java.io.File)
+     */
+    public boolean accept(File file) {
+        if (file.isDirectory()) return true;
+        return (file.getName().endsWith(suffix));
+    }
+
+    /**
+     * Accepts any directory, and any file with the given extension
+     * @see org.apache.commons.io.filefilter.IOFileFilter#accept(java.io.File, java.lang.String)
+     */
+    public boolean accept(File directory, String fileName) {
+        final File file = new File(directory.getName()+File.separator+fileName);
+        if (file.isDirectory()) return true;
+        return (file.getName().endsWith(suffix));
+    }
+
+}
Index: work/src/org/kuali/kfs/sys/context/ContainerStepListener.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/ContainerStepListener.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/ContainerStepListener.java	(revision 37225)
@@ -0,0 +1,24 @@
+package org.kuali.kfs.sys.context;
+
+/**
+ * Any class adding this listener class can broadcast when a step starts and finishes.
+ * Any class implementing this listener can be notified when a step starts and finishes.
+ */
+public interface ContainerStepListener {
+
+    /**
+     * Notify the listener that the Step has started. 
+     * 
+     * @param runFile The Step's .run file descriptor
+     * @param logFile The Step's log file created by its executor. The logFile is used to provide a unique identifier for this run of the Step
+     */
+    public void stepStarted(BatchStepFileDescriptor runFile, String logFile);
+    
+    /**
+     * Notify the listener that the Step has finished.
+     * 
+     * @param resultFile the Step's .success or .error file descriptor
+     * @param logFile The Step's log file created by its executor when the step started. The logFile is used to provide a unique identifier for this run of the Step
+     */
+    public void stepFinished(BatchStepFileDescriptor resultFile, String logFile);    
+}
Index: work/src/org/kuali/kfs/sys/context/BatchStepTriggerParameters.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/BatchStepTriggerParameters.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/BatchStepTriggerParameters.java	(revision 37225)
@@ -0,0 +1,99 @@
+package org.kuali.kfs.sys.context;
+
+import org.apache.commons.lang.StringUtils;
+
+/**
+ * BatchStepTriggerParameters provides parsing and error checking for the arguments needed by the BatchStepTrigger. 
+ * 
+ *  stepName:                args[0]:  String- a comma delimited list of step names (no spaces)
+ *  jobName:                 args[1]:  String- the name of the job in which the steps are being executed
+ *  stepIndex:               args[2]:  String- the index of the step in the job
+ *  batchContainerDirectory: args[3]:  String- the path to the directory in which the semaphore files are created. 
+ *                                             This value needs to match 'staging.directory.sys.batchContainer' in iu/build/configuration.properties
+ *  sleepInterval:           args[4]:  String- the amount of time (in seconds) to wait before looking for the result file from BatchContainerStep  
+ */
+public class BatchStepTriggerParameters {
+	
+	private String[] stepNames;
+	private String jobName;
+	private int stepIndex;
+	private long sleepInterval;
+	
+	private BatchContainerDirectory batchContainerDirectory;
+	
+	/**
+	 * @param args
+	 *  stepName:                args[0]:  String- a comma delimited list of step names (no spaces)
+	 *  jobName:                 args[1]:  String- the name of the job in which the steps are being executed
+	 *  stepIndex:               args[2]:  String- the index of the step in the job
+	 *  batchContainerDirectory: args[2]:  String- the path to the directory in which the semaphore files are created. 
+	 *                                             This value needs to match 'staging.directory.sys.batchContainer' in iu/build/configuration.properties
+	 *  sleepInterval:           args[3]:  String- the amount of time (in seconds) to wait before looking for the result file from BatchContainerStep 
+	 */
+	protected BatchStepTriggerParameters(String[] args) {
+        if (args.length < 1) {
+            System.err.println("ERROR: You must pass the name of the step to run on the command line.");
+            System.exit(8);
+        } else if (args.length < 2) {
+        	System.err.println("ERROR: You must pass the name of the job to run on the command line.");
+        	System.exit(8);
+        } else if (args.length < 3) {
+            System.err.println("ERROR: You must pass the index of the step in the job on the command line.");
+            System.exit(8);
+        } else if (args.length < 4) {
+            System.err.println("ERROR: You must pass the path of the directory in which to write and read result files on the command line.");
+            System.exit(8);        	
+        } else if (args.length < 5) {
+            System.err.println("ERROR: You must pass the amount of time (in seconds) to sleep while waiting for the step to run on the command line.");
+            System.exit(8);        	
+        }
+    	
+        if (args[0].indexOf(",") > 0) {
+            stepNames = StringUtils.split(args[0], ",");
+        }
+        else {
+            stepNames = new String[] { args[0] };
+        }
+        
+        jobName = args[1];            
+        stepIndex = Integer.parseInt(args[2]);
+        String directory = args[3];           
+        sleepInterval = Long.parseLong(args[4]) * 1000;        
+        batchContainerDirectory = new BatchContainerDirectory(directory);
+	}
+	
+	/**
+	 * @return a comma delimited list of step names (no spaces)
+	 */
+	protected String[] getStepNames() {
+		return stepNames;
+	}
+	
+	/**
+	 * @return the name of the job in which the step(s) are being executed
+	 */
+	protected String getJobName() {
+		return jobName;
+	}
+	
+	/**
+	 * @return the index of the step in the job
+	 */
+	protected int getStepIndex() {
+	    return stepIndex;
+	}
+	
+	/**
+	 * @return the amount of time to sleep (in seconds) while waiting for a result file from the BatchContainerStep
+	 */
+	protected long getSleepInterval() {
+		return sleepInterval;
+	}
+	
+	/**
+	 * @return the directory in which the semaphore files are located
+	 */
+	protected BatchContainerDirectory getBatchContainerDirectory() {
+		return batchContainerDirectory;
+	}
+}
Index: work/src/org/kuali/kfs/sys/context/BatchStepExecutor.java
===================================================================
--- work/src/org/kuali/kfs/sys/context/BatchStepExecutor.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/context/BatchStepExecutor.java	(revision 37225)
@@ -0,0 +1,217 @@
+package org.kuali.kfs.sys.context;
+
+
+import java.io.File;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.List;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.log4j.Appender;
+import org.apache.log4j.FileAppender;
+import org.apache.log4j.Logger;
+import org.apache.log4j.NDC;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.batch.Job;
+import org.kuali.kfs.sys.batch.Step;
+import org.kuali.rice.kns.service.DateTimeService;
+import org.kuali.rice.kns.service.KualiConfigurationService;
+import org.kuali.rice.kns.service.KualiModuleService;
+import org.kuali.rice.kns.service.ModuleService;
+import org.kuali.rice.kns.service.ParameterService;
+
+
+/**
+ * BatchStepExecutor executes a Step in its own Thread and writes either a .success or .error file after execution. 
+ * This class notifies the ContainerStepListener when a Step has started and when it has completed. 
+ * 
+ * BatchStepExecutor adds a ConsoleAppender to its Logger if one hasn't been configured.
+ *
+ */
+public class BatchStepExecutor implements Runnable {
+    private static org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(BatchStepExecutor.class);
+	
+	private ParameterService parameterService;
+	private DateTimeService dateTimeService;
+	private BatchContainerDirectory batchContainerDirectory;
+	private BatchStepFileDescriptor batchStepFile;
+	private Step step;
+	private int stepIndex;
+	
+	private Appender ndcAppender;
+	private boolean ndcSet;
+	private String logFileName;
+	
+	private List<ContainerStepListener> containerStepListeners;
+		
+	/**
+	 * @param parameterService the ParameterService used by Job
+	 * @param dateTimeService the DateTimeService used by Job
+	 * @param batchContainerDirectory the batch container directory
+	 * @param batchStepFile the descriptor containing information about the step to execute
+	 * @param step the Step to execute
+	 * @param stepIndex the index of the step in the job
+	 */
+	public BatchStepExecutor(ParameterService parameterService, DateTimeService dateTimeService, BatchContainerDirectory batchContainerDirectory, BatchStepFileDescriptor batchStepFile, Step step, int stepIndex) {
+	    BatchLogger.addConsoleAppender(LOG);
+	    
+		this.parameterService = parameterService;
+		this.dateTimeService = dateTimeService;
+		
+		this.batchContainerDirectory = batchContainerDirectory;
+		this.batchStepFile = batchStepFile;
+		this.step = step;
+		this.stepIndex = stepIndex;
+		
+		this.containerStepListeners = new ArrayList<ContainerStepListener>();
+		
+		LOG.info("Initialized thread executor for "+ batchStepFile);
+	}
+	
+	/**
+	 * Execute the Step via Job.runStep(). Setup NDC logging so the Step has its own log file. Remove the NDC logging once the step is finished executing.
+	 * Notify the ContainerStepListeners when the step starts and finishes.
+	 */
+	public void run() {
+	    Date stepRunDate = dateTimeService.getCurrentDate();
+	    batchStepFile.setStartedDate(stepRunDate);
+	    batchStepFile.setStepIndex(new Integer(stepIndex));
+	    
+		setupNDCLogging();		
+		notifyStepStarted();
+		
+		try {        	            
+			LOG.info("Running "+ batchStepFile);
+			
+			boolean result = Job.runStep(parameterService, batchStepFile.getJobName(), stepIndex, step, stepRunDate);
+
+			if (result) {
+				LOG.info("Step returned true");
+				batchContainerDirectory.writeBatchStepSuccessfulResultFile(batchStepFile);
+			}
+			else {
+				LOG.info("Step returned false");
+				batchContainerDirectory.writeBatchStepErrorResultFile(batchStepFile);        					
+			}
+
+		} catch (Throwable throwable) {
+			LOG.info("Step threw an error: ", throwable);
+			batchContainerDirectory.writeBatchStepErrorResultFile(batchStepFile, throwable);        					
+			
+		} finally {
+		    
+		    notifyStepFinished();		    
+			resetNDCLogging();
+		}		
+	}
+	
+	/**
+	 * Adds a ContainerStepListener for step start and completion notifications
+	 * 
+	 * @param listener the ContainerStepListener 
+	 */
+	public void addContainerStepListener(ContainerStepListener listener) {
+	    this.containerStepListeners.add(listener);
+	}
+	
+	/**
+	 * Add a new appender and context to the NDC for this execution of the step
+	 */
+	private void setupNDCLogging() {        
+        String nestedDiagnosticContext = getNestedDiagnosticContext();
+        logFileName = getLogFileName(nestedDiagnosticContext);
+        
+        ndcAppender = null; 
+        ndcSet = false;
+        try {
+            ndcAppender = new FileAppender(BatchLogger.getLogFileAppenderLayout(), logFileName);
+            ndcAppender.addFilter(new NDCFilter(nestedDiagnosticContext));
+            Logger.getRootLogger().addAppender(ndcAppender);
+            NDC.push(nestedDiagnosticContext);
+            ndcSet = true;
+        } catch (Exception ex) {
+            LOG.warn("Could not initialize custom logging for step: " + step.getName(), ex);
+        }
+	}
+	
+	/**
+	 * Remove the appender and context from the NDC
+	 */
+	private void resetNDCLogging() {
+        if ( ndcSet ) {
+            ndcAppender.close();
+            Logger.getRootLogger().removeAppender(ndcAppender);
+            NDC.pop();
+        }		
+	}
+	
+	/**
+	 * Constructs the name of the log file to write to for this execution of the step
+	 * 
+	 * @param nestedDiagnosticContext the context returned by getNestedDiagnosticContext() for this step
+	 * @return the name of the log file
+	 */
+    private String getLogFileName(String nestedDiagnosticContext) {
+        return SpringContext.getBean( KualiConfigurationService.class ).getPropertyString(KFSConstants.REPORTS_DIRECTORY_KEY) 
+                + File.separator 
+                + nestedDiagnosticContext + ".log";
+    }
+    
+    /**
+     * @return the nested diagnostic context string for this step's log file
+     */
+	@SuppressWarnings("unchecked")
+    private String getNestedDiagnosticContext() {
+        Step unProxiedStep = (Step) ProxyUtils.getTargetIfProxied(step);
+        Class stepClass = unProxiedStep.getClass();        
+        ModuleService module = SpringContext.getBean(KualiModuleService.class).getResponsibleModuleService( stepClass );                    
+        
+        String nestedDiagnosticContext = 
+                StringUtils.substringAfter( module.getModuleConfiguration().getNamespaceCode(), "-").toLowerCase()
+                + File.separator + step.getName()
+                + "-" + dateTimeService.toDateTimeStringForFilename(dateTimeService.getCurrentDate());
+        
+        return nestedDiagnosticContext;
+    }
+	
+	/**
+	 * Notify the ContainerStepListeners that the Step has started
+	 */
+	private void notifyStepStarted() {	    
+	    String shortLogFileName = getShortLogFileName();
+	    
+	    for(ContainerStepListener listener : this.containerStepListeners) {
+	        listener.stepStarted(batchStepFile, shortLogFileName);
+	    }
+	}
+	
+	/**
+	 * Notify the ContainerStepListeners that the Step has completed
+	 */
+	private void notifyStepFinished() {
+	    BatchStepFileDescriptor resultFile = batchContainerDirectory.getResultFile(batchStepFile);
+	    resultFile.setCompletedDate(dateTimeService.getCurrentDate());
+	    resultFile.setStepIndex(new Integer(stepIndex));
+	    
+        String shortLogFileName = getShortLogFileName();
+	    
+	    for(ContainerStepListener listener : this.containerStepListeners) {
+	        listener.stepFinished(resultFile, shortLogFileName);
+	    }
+	}
+	
+	/**
+	 * Returns just the name of the log file without the absolute path
+	 * 
+	 * @return just the name of the log file (not the entire path)
+	 */
+	private String getShortLogFileName() {
+        String shortLogFileName = logFileName;
+        
+        File logFile = new File(logFileName);
+        if (logFile.exists()) {
+            shortLogFileName = logFile.getName();
+        }	    
+        return shortLogFileName;
+	}
+}
Index: work/src/org/kuali/kfs/sys/identity/ExcludeSingleActorSeparationOfDutiesRoleTypeService.java
===================================================================
--- work/src/org/kuali/kfs/sys/identity/ExcludeSingleActorSeparationOfDutiesRoleTypeService.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/identity/ExcludeSingleActorSeparationOfDutiesRoleTypeService.java	(revision 37225)
@@ -0,0 +1,102 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.identity;
+
+import java.util.ArrayList;
+
+import java.util.Collections;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Set;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.log4j.Logger;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kew.actiontaken.dao.ActionTakenDAO;
+import org.kuali.rice.kew.doctype.service.DocumentTypeService;
+import org.kuali.rice.kew.dto.ActionTakenDTO;
+import org.kuali.rice.kew.exception.WorkflowException;
+import org.kuali.rice.kew.service.WorkflowInfo;
+import org.kuali.rice.kim.bo.group.dto.GroupMembershipInfo;
+import org.kuali.rice.kim.bo.impl.KimAttributes;
+import org.kuali.rice.kim.bo.role.dto.RoleMembershipInfo;
+import org.kuali.rice.kim.bo.role.impl.RoleMemberImpl;
+import org.kuali.rice.kim.bo.types.dto.AttributeSet;
+import org.kuali.rice.kim.dao.KimRoleDao;
+import org.kuali.rice.kim.service.GroupService;
+import org.kuali.rice.kim.service.RoleManagementService;
+import org.kuali.rice.kim.service.impl.GroupServiceImpl;
+import org.kuali.rice.kim.service.support.impl.KimRoleTypeServiceBase;
+import org.kuali.rice.kim.util.KimConstants;
+import org.kuali.rice.kim.util.KimConstants.KimUIConstants;
+import org.kuali.rice.kns.document.Document;
+import org.kuali.rice.kns.service.DocumentService;
+import org.kuali.rice.kns.util.ObjectUtils;
+
+/**
+ * KFSMI-4553
+ * This class is look for the members of the defined role and remove the single actor if one exists 
+ * so that document will not route to the initiator or single approver. 
+ */
+public class ExcludeSingleActorSeparationOfDutiesRoleTypeService  extends ExclusionRoleTypeServiceBase {
+    private static final Logger LOG = Logger.getLogger( ExcludeSingleActorSeparationOfDutiesRoleTypeService .class );
+    protected DocumentService documentService;
+    protected WorkflowInfo workflowInfo = new WorkflowInfo();
+
+    @Override
+    public List<RoleMembershipInfo> doRoleQualifiersMatchQualification(AttributeSet qualification, List<RoleMembershipInfo> roleMemberList) {
+        List<RoleMembershipInfo> membershipInfos = super.doRoleQualifiersMatchQualification(qualification, roleMemberList);
+        String documentId = new String(qualification.get(KimAttributes.DOCUMENT_NUMBER));
+        String approverOrInitiator = getApproverOrInitiator(documentId);
+        if(ObjectUtils.isNotNull(approverOrInitiator )) {
+            return excludePrincipalAsNeeded(approverOrInitiator, qualification, membershipInfos);
+        }
+        
+        return membershipInfos;
+    }
+
+    /**
+     * 
+     * This method return initiator or approver principal Id 
+     * @param documentId
+     * @return
+     */
+    private String getApproverOrInitiator(String documentId) {
+        String approverOrInitiatorPrincipalId = null;
+        try {
+           String principalId = workflowInfo.getDocumentInitiatorPrincipalId(Long.valueOf(documentId));
+           ActionTakenDTO[] actionTakenDTOs = workflowInfo.getActionsTaken(Long.valueOf(documentId));
+           for (ActionTakenDTO  actionTaken : actionTakenDTOs ) {
+               if(principalId.equals(actionTaken.getPrincipalId())) {
+                   approverOrInitiatorPrincipalId = principalId;
+               }
+           }
+
+        } catch (WorkflowException wex) {
+            throw new RuntimeException("Error in determining approver or initiator principal Id" + 
+                    "for document number: "+documentId+" :"+wex.getLocalizedMessage(),wex);
+        } 
+
+        return approverOrInitiatorPrincipalId;
+    }
+
+    protected DocumentService getDocumentService() {
+        if (documentService == null) {
+            documentService = SpringContext.getBean(DocumentService.class);
+        }
+        return documentService;
+    }
+}
Index: work/src/org/kuali/kfs/sys/identity/ExclusionRoleTypeServiceBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/identity/ExclusionRoleTypeServiceBase.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/identity/ExclusionRoleTypeServiceBase.java	(revision 37225)
@@ -0,0 +1,163 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.identity;
+
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Set;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.kfs.sys.context.SpringContext;
+import org.kuali.rice.kim.bo.group.dto.GroupMembershipInfo;
+import org.kuali.rice.kim.bo.impl.KimAttributes;
+import org.kuali.rice.kim.bo.role.dto.RoleMembershipInfo;
+import org.kuali.rice.kim.bo.types.dto.AttributeSet;
+import org.kuali.rice.kim.service.GroupService;
+import org.kuali.rice.kim.service.RoleManagementService;
+import org.kuali.rice.kim.service.support.impl.KimRoleTypeServiceBase;
+import org.kuali.rice.kim.util.KimConstants;
+
+/**
+ * Base role type for roles which will exclude their members based on certain criteria.  This base provides methods to
+ * remove a single approver for any members
+ */
+public class ExclusionRoleTypeServiceBase extends KimRoleTypeServiceBase {
+    protected RoleManagementService roleManagementService;
+    protected GroupService groupService;
+    
+    /**
+     * Remove the excluded principal from any matching memberships in the role
+     * @param excludedPrincipalId the principal id to exclude
+     * @param qualification the qualification for the role
+     * @param membershipInfos the role members
+     * @return the filtered role memberships
+     */
+    protected List<RoleMembershipInfo> excludePrincipalAsNeeded(String excludedPrincipalId, AttributeSet qualification, List<RoleMembershipInfo> membershipInfos) {
+        if (StringUtils.isBlank(excludedPrincipalId)) {
+            return membershipInfos;
+        }
+        
+        String topLevelRoleId = null;
+        if (!membershipInfos.isEmpty()) {
+            topLevelRoleId = membershipInfos.get(0).getRoleId();
+        }
+        
+        Set<String> checkedMembers = new HashSet<String>();
+        final String documentId = new String(qualification.get(KimAttributes.DOCUMENT_NUMBER));
+
+        List<RoleMembershipInfo> qualifiedRoleMembers = new ArrayList<RoleMembershipInfo>();
+        for (RoleMembershipInfo member : membershipInfos) {
+            String topLevelRoleMemberId = member.getRoleMemberId();
+            if(KimConstants.KimUIConstants.MEMBER_TYPE_PRINCIPAL_CODE.equals(member.getMemberTypeCode())) {
+                if(!excludedPrincipalId.equals(member.getMemberId())) {
+                    qualifiedRoleMembers.add(member);
+                }
+            }
+            else if (KimConstants.KimUIConstants.MEMBER_TYPE_ROLE_CODE.equals(member.getMemberTypeCode())) {
+                // get members of role
+                checkRoleMemberShip(excludedPrincipalId,member, qualification, qualifiedRoleMembers, checkedMembers,  documentId, topLevelRoleId, topLevelRoleMemberId ); 
+           
+            }
+            else if (KimConstants.KimUIConstants.MEMBER_TYPE_GROUP_CODE.equals(member.getMemberTypeCode())) {
+                checkGroupMemberShip(excludedPrincipalId, member, qualification, qualifiedRoleMembers, checkedMembers,  documentId, topLevelRoleId, topLevelRoleMemberId ); 
+            }
+        }
+        return qualifiedRoleMembers;
+    }
+    
+    /**
+     * 
+     * This method is to check role members of given role and skip the single approver if exists from the role.
+     * @param approverOrInitiator
+     * @param member
+     * @param qualification
+     * @param qualifiedRoleMembers
+     * @param checkedRoletypeMember
+     * @param documentId
+     * @param topLevelRoleId
+     * @param topLevelRoleMemberId
+     */
+    protected void checkRoleMemberShip(String excludedPrincipalId ,RoleMembershipInfo member, AttributeSet qualification,List<RoleMembershipInfo> qualifiedRoleMembers, Set<String> checkedRoletypeMember, String documentId, String topLevelRoleId, String topLevelRoleMemberId ) {
+       String key = member.getMemberTypeCode()+ "~" + member.getMemberId();
+       if(!checkedRoletypeMember.contains(key)) {
+           checkedRoletypeMember.add(key);
+           List<RoleMembershipInfo> roleMembershipInfos = getRoleManagementService().getRoleMembers(Collections.singletonList(member.getMemberId()), qualification);
+           for(RoleMembershipInfo membershipInfo : roleMembershipInfos) {
+               if(KimConstants.KimUIConstants.MEMBER_TYPE_PRINCIPAL_CODE.equals(membershipInfo.getMemberTypeCode())) {
+                   if(!excludedPrincipalId.equals(membershipInfo.getMemberId())) {
+                       membershipInfo.setRoleId(topLevelRoleId);
+                       membershipInfo.setRoleMemberId(topLevelRoleMemberId);
+                       qualifiedRoleMembers.add(membershipInfo);
+                   }
+               }
+               else if (KimConstants.KimUIConstants.MEMBER_TYPE_ROLE_CODE.equals(membershipInfo.getMemberTypeCode())) {
+                   checkRoleMemberShip(excludedPrincipalId,membershipInfo, qualification, qualifiedRoleMembers, checkedRoletypeMember,  documentId, topLevelRoleId, topLevelRoleMemberId );
+               }
+               else if (KimConstants.KimUIConstants.MEMBER_TYPE_GROUP_CODE.equals(membershipInfo.getMemberTypeCode())) {
+                   checkGroupMemberShip(excludedPrincipalId ,membershipInfo, qualification, qualifiedRoleMembers, checkedRoletypeMember,  documentId, topLevelRoleId, topLevelRoleMemberId ); 
+               }
+           }
+       }
+    }
+     
+    /**
+     * 
+     * This method is to check group members of given group and skip the single approver 
+     * member from the group.
+     * 
+     * @param approverOrInitiator
+     * @param member
+     * @param qualification
+     * @param qualifiedRoleMembers
+     * @param checkedMembers
+     * @param documentId
+     * @param topLevelRoleId
+     * @param topLevelRoleMemberId
+     */
+    protected void checkGroupMemberShip(String excludedPrincipalId,RoleMembershipInfo member, AttributeSet qualification,List<RoleMembershipInfo> qualifiedRoleMembers, Set<String> checkedMembers, String documentId, String topLevelRoleId, String topLevelRoleMemberId ) {
+        String key = member.getMemberTypeCode()+ "~" + member.getMemberId();
+        if(!checkedMembers.contains(key)) {
+            checkedMembers.add(key);
+             List<GroupMembershipInfo> groupMembershipInfos = (List<GroupMembershipInfo>)getGroupService().getGroupMembers(Collections.singletonList(member.getMemberId()));
+             for(GroupMembershipInfo membershipInfo : groupMembershipInfos) {
+                 if(KimConstants.KimUIConstants.MEMBER_TYPE_PRINCIPAL_CODE.equals(membershipInfo.getMemberTypeCode())) {
+                     if(!excludedPrincipalId.equals(membershipInfo.getMemberId())) {
+                         qualifiedRoleMembers.add( new RoleMembershipInfo(topLevelRoleId, topLevelRoleMemberId, membershipInfo.getMemberId(), KimConstants.KimUIConstants.MEMBER_TYPE_PRINCIPAL_CODE, qualification));
+                     }
+                 }
+                 else if (KimConstants.KimUIConstants.MEMBER_TYPE_GROUP_CODE.equals(membershipInfo.getMemberTypeCode())) {
+                    checkGroupMemberShip(excludedPrincipalId, member, qualification, qualifiedRoleMembers, checkedMembers, documentId, topLevelRoleId, topLevelRoleMemberId);
+                 }
+             }   
+        }
+    }
+    
+    protected RoleManagementService getRoleManagementService() {
+        if (roleManagementService == null) {
+            roleManagementService = SpringContext.getBean(RoleManagementService.class);
+        }
+        return roleManagementService;
+    }
+    
+    protected GroupService getGroupService(){
+        if (groupService == null) {
+            groupService = SpringContext.getBean(GroupService.class);
+        }
+        return groupService;
+    }
+}
Index: work/src/org/kuali/kfs/sys/identity/NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/identity/NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceImpl.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/identity/NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceImpl.java	(revision 37225)
@@ -0,0 +1,258 @@
+/*
+ * Copyright 2007-2009 The Kuali Foundation
+ *
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.opensource.org/licenses/ecl2.php
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.identity;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Collections;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+import org.apache.commons.lang.StringUtils;
+import org.kuali.rice.kim.bo.impl.KimAttributes;
+import org.kuali.rice.kim.bo.role.dto.KimPermissionInfo;
+import org.kuali.rice.kim.bo.types.dto.AttributeSet;
+import org.kuali.rice.kim.bo.types.dto.KimTypeInfo;
+import org.kuali.rice.kns.bo.Namespace;
+import org.kuali.rice.kns.service.KNSServiceLocator;
+import org.kuali.rice.kns.service.impl.NamespacePermissionTypeServiceImpl;
+
+/**
+ * This is a permission type service with attributes for wildcard matching on the namespace and/or 
+ * wildcard matching on another attribute (set in the spring config).
+ * 
+ * The permissions returned are the most exact matches found and namespace exact matching takes 
+ * priority over string attribute exact matching. There is no difference in priority between two attributes 
+ * which both match partially (i.e. staging/* and staging/sys/*)
+ * 
+ * Priority Namespace   String attribute
+ * 1.       Exact       Exact
+ * 2.       Exact       Partial
+ * 3.       Exact       Blank
+ * 4.       Partial     Exact
+ * 5.       Partial     Partial
+ * 6.       Partial     Blank
+ * 7.       Blank       Exact
+ * 8.       Blank       Partial
+ */
+public class NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceImpl
+		extends NamespacePermissionTypeServiceImpl {
+	protected static final String NAMESPACE_CODE = KimAttributes.NAMESPACE_CODE;
+	
+	protected String wildcardMatchStringAttributeName;
+	protected boolean namespaceRequiredOnStoredAttributeSet;
+
+    /**
+     * Check for entries that match the namespace or the string attribute identified in 'wildcardMatchStringAttributeName'.  
+     * Return the ones which are the most specific. 
+     * 
+     * I.e., matches best. KFS-SYS will have priority over KFS-*
+     * 
+     * @see org.kuali.rice.kim.service.support.impl.KimPermissionTypeServiceBase#performPermissionMatches(org.kuali.rice.kim.bo.types.dto.AttributeSet, java.util.List)
+     */
+	@Override
+	protected List<KimPermissionInfo> performPermissionMatches(AttributeSet requestedDetails, List<KimPermissionInfo> permissionsList) {
+		List<KimPermissionInfo> matchingPermissions = new ArrayList<KimPermissionInfo>();
+		
+		List<KimPermissionInfo> exactNamespacePermissions = new ArrayList<KimPermissionInfo>();
+		List<KimPermissionInfo> partialNamespacePermissions = new ArrayList<KimPermissionInfo>();
+        List<KimPermissionInfo> blankNamespacePermissions = new ArrayList<KimPermissionInfo>();
+        
+	    String requestedNamespaceAttributeValue = requestedDetails.get(NAMESPACE_CODE);
+	    
+	    
+	    for ( KimPermissionInfo kpi : permissionsList ) {
+	        String permissionNamespaceAttributeValue = kpi.getDetails().get(NAMESPACE_CODE);
+	        if ( matchExact(requestedNamespaceAttributeValue, permissionNamespaceAttributeValue) ) {
+	            exactNamespacePermissions.add(kpi);	            
+	        } 
+	        else if ( matchPartial(requestedNamespaceAttributeValue, permissionNamespaceAttributeValue) ) {
+	        	partialNamespacePermissions.add(kpi);	        	
+	        } 
+	        else if ( matchBlank(permissionNamespaceAttributeValue) ) {
+	            blankNamespacePermissions.add(kpi);
+	        }
+	    }
+	    
+	    // if the exact match worked, use those when checking the string attribute
+	    if ( !exactNamespacePermissions.isEmpty() ) {
+	    	matchingPermissions = performStringAttributeMatching(requestedDetails, getWildcardMatchStringAttributeName(), exactNamespacePermissions);
+	    	
+	    	//found exact namespace match and exact, partial, or blank string attribute match
+		    if (!matchingPermissions.isEmpty()) {
+		    	return matchingPermissions;
+		    }
+	    }
+	    
+	    // if the partial match worked, use those when checking the string attribute
+	    if ( !partialNamespacePermissions.isEmpty() ) {
+	    	matchingPermissions = performStringAttributeMatching(requestedDetails, getWildcardMatchStringAttributeName(), partialNamespacePermissions);
+	    	
+	    	//found partial namespace match and exact, partial, or blank string attribute match
+		    if (!matchingPermissions.isEmpty()) {
+		    	return matchingPermissions;
+		    }
+	    }
+	    
+	    //don't match on a null namespace when it is required
+	    if (!getNamespaceRequiredOnStoredAttributeSet()) {
+		    // if the blank match worked, use those when checking the string attribute
+		    if ( !blankNamespacePermissions.isEmpty() ) {
+		    	matchingPermissions = performStringAttributeMatching(requestedDetails, getWildcardMatchStringAttributeName(), blankNamespacePermissions);
+		    	
+		    	//found blank namespace match and exact, partial, or blank string attribute match
+			    if (!matchingPermissions.isEmpty()) {
+			    	return matchingPermissions;
+			    }
+		    }
+	    }
+
+	    return matchingPermissions; // empty list
+	}
+
+    /**
+     * Determines which existing permissions apply in the case which best matches the requested details
+     * @param requestedDetails the details to find the best permission matches for
+     * @param attributeNameForMatching the attribute name of the wildcard string to match against
+     * @param permissionsList the list of permissions for this permission type
+     * @return the list of matching permissions
+     */
+	private List<KimPermissionInfo> performStringAttributeMatching(AttributeSet requestedDetails, String attributeNameForMatching, List<KimPermissionInfo> permissionsList) {
+		String requestedAttributeValue = requestedDetails.get(attributeNameForMatching);
+		
+		List<KimPermissionInfo> exactMatchingPermissions = new ArrayList<KimPermissionInfo>();
+		List<KimPermissionInfo> partialMatchingPermissions = new ArrayList<KimPermissionInfo>();
+		List<KimPermissionInfo> blankMatchingPermissions = new ArrayList<KimPermissionInfo>();		
+		
+		//check attribute matching
+    	for ( KimPermissionInfo kpi : permissionsList ) {    		
+    		String permissionAttributeValue = kpi.getDetails().get(attributeNameForMatching);
+    		
+    		if ( matchExact(requestedAttributeValue, permissionAttributeValue) ) {
+    			exactMatchingPermissions.add(kpi);
+    		}
+    		else if ( matchPartial(requestedAttributeValue, permissionAttributeValue) ) {
+    			partialMatchingPermissions.add(kpi);
+    		}
+    		else if ( matchBlank(permissionAttributeValue) ) {
+    			blankMatchingPermissions.add(kpi);
+    		}
+    	}
+	    
+	    if (!exactMatchingPermissions.isEmpty()) {
+	    	return exactMatchingPermissions;
+	    }
+	    if (!partialMatchingPermissions.isEmpty()) {
+	    	return partialMatchingPermissions;
+	    }
+	    if (!blankMatchingPermissions.isEmpty()) {
+	    	return blankMatchingPermissions;
+	    }
+	    
+	    return exactMatchingPermissions; // empty list
+	}
+
+	
+	/**
+	 * Returns true if the attributes match exactly
+	 * 
+	 * @param requestedAttributeValue
+	 * @param permissionAttributeValue
+	 * @return
+	 */
+	protected boolean matchExact(String requestedAttributeValue, String permissionAttributeValue) {
+		return StringUtils.equals(requestedAttributeValue, permissionAttributeValue);
+	}
+	
+	/**
+	 * Returns true if the permissionAttribute matches part of the requestedAttribute
+	 * 
+	 * @param requestedAttributeValue
+	 * @param permissionAttributeValue
+	 * @return
+	 */
+	protected boolean matchPartial(String requestedAttributeValue, String permissionAttributeValue) {
+		if (requestedAttributeValue != null && permissionAttributeValue != null) {
+			//replace any '*' with '.*' for regex matching
+			permissionAttributeValue = permissionAttributeValue.replaceAll("\\*", ".*");
+	        return requestedAttributeValue.matches(permissionAttributeValue);			
+		}
+		return false;
+	}
+	
+	/**
+	 * Returns true if the permissionAttribute is blank
+	 * 
+	 * @param permissionAttributeValue
+	 * @return
+	 */
+	protected boolean matchBlank(String permissionAttributeValue) {
+		return StringUtils.isBlank(permissionAttributeValue);
+	}
+	
+    /**
+     * @return the attribute to match wildcards against
+     */
+    protected String getWildcardMatchStringAttributeName() {
+        return this.wildcardMatchStringAttributeName;
+    }
+    
+    /**
+     * @return true if the namespace is required in saved attribute sets using this permission type, false otherwise
+     */
+	protected boolean getNamespaceRequiredOnStoredAttributeSet() {
+		return this.namespaceRequiredOnStoredAttributeSet;
+	}
+	
+	public void setWildcardMatchStringAttributeName(String wildcardMatchStringAttributeName) {
+		this.wildcardMatchStringAttributeName = wildcardMatchStringAttributeName;
+		requiredAttributes.add(wildcardMatchStringAttributeName);
+	}
+
+	public void setNamespaceRequiredOnStoredAttributeSet(boolean namespaceRequiredOnStoredAttributeSet) {
+		this.namespaceRequiredOnStoredAttributeSet = namespaceRequiredOnStoredAttributeSet;
+	}
+
+	/**
+	 * Overrides the superclass's version of this method in order to account for "namespaceCode" permission detail values containing wildcards.
+	 */
+	@Override
+	protected Map<String, List<String>> validateReferencesExistAndActive(KimTypeInfo kimType, AttributeSet attributes, Map<String, String> previousValidationErrors) {
+		Map<String,List<String>> errors = new HashMap<String,List<String>>();
+		AttributeSet nonNamespaceCodeAttributes = new AttributeSet(attributes);		
+		
+		// Check if "namespaceCode" is one of the permission detail values.
+		if (attributes.containsKey(NAMESPACE_CODE)) {
+			nonNamespaceCodeAttributes.remove(NAMESPACE_CODE);
+			Collection<Namespace> namespaces = KNSServiceLocator.getLookupService().findCollectionBySearchUnbounded(
+					Namespace.class, Collections.singletonMap("code", attributes.get(NAMESPACE_CODE)));
+			// If the lookup service found at least one namespace, perform exists-and-active checks on each one.
+			if (namespaces != null && !namespaces.isEmpty()) {
+				for (Namespace namespace : namespaces) {
+					errors.putAll(super.validateReferencesExistAndActive(kimType, new AttributeSet(NAMESPACE_CODE, namespace.getNamespaceCode()), previousValidationErrors));
+				}
+			} else {
+				// If no namespaces were found, let the superclass generate an appropriate error.
+				errors.putAll(super.validateReferencesExistAndActive(kimType, new AttributeSet(NAMESPACE_CODE, attributes.get(NAMESPACE_CODE)), previousValidationErrors));
+			}
+		}
+				
+		// Validate all non-namespaceCode attributes.
+		errors.putAll(super.validateReferencesExistAndActive(kimType, nonNamespaceCodeAttributes, previousValidationErrors));
+		return errors;
+	}
+}
Index: work/src/org/kuali/kfs/sys/identity/KfsKimAttributes.java
===================================================================
--- work/src/org/kuali/kfs/sys/identity/KfsKimAttributes.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/identity/KfsKimAttributes.java	(revision 37225)
@@ -43,10 +43,12 @@
     public static final String PURCHASING_COMMODITY_CODE = "purchasingCommodityCode";
     public static final String CONTRACT_MANAGER_CODE = "contractManagerCode";
     public static final String CUSTOMER_PROFILE_ID = "customerProfileId";
+    public static final String ACH_TRANSACTION_TYPE_CODE = "achTransactionTypeCode";
     public static final String VENDOR_TYPE_CODE = "vendorTypeCode";
     public static final String CONTRACTS_AND_GRANTS_ACCOUNT_RESPONSIBILITY_ID = "contractsAndGrantsAccountResponsibilityId";
     public static final String DISBURSEMENT_VOUCHER_PAYMENT_METHOD_CODE = "disbursementVoucherPaymentMethodCode";
     public static final String SUB_ACCOUNT_NUMBER = "subAccountNumber";
+    public static final String FILE_PATH = "filePath";
     
     protected String chartOfAccountsCode;
     protected String accountNumber;
@@ -59,10 +61,12 @@
     protected String purchasingCommodityCode;
     protected Integer contractManagerCode;
     protected KualiInteger customerProfileId;
+    protected String achTransactionTypeCode;
     protected String vendorTypeCode;
     protected String contractsAndGrantsAccountResponsibilityId;
     protected String disbursementVoucherPaymentMethodCode;
     protected String subAccountNumber;
+    protected String filePath;
         
     protected Chart chart;
     protected Organization organization;
@@ -279,7 +283,15 @@
     public void setCustomerProfileId(KualiInteger customerProfileId) {
         this.customerProfileId = customerProfileId;
     }
+    
+    public String getAchTransactionTypeCode() {
+        return achTransactionTypeCode;
+    }
 
+    public void setAchTransactionTypeCode(String achTransactionTypeCode) {
+        this.achTransactionTypeCode = achTransactionTypeCode;
+    }
+
     /**
      * Gets the vendorTypeCode attribute.
      * 
@@ -422,4 +434,22 @@
     public void setVendorType(VendorType vendorType) {
         this.vendorType = vendorType;
     }
+    
+    /**
+     * Gets the filePath attribute.
+     * 
+     * @return Returns the filePath.
+     */
+    public String getFilePath() {
+        return filePath;
+    }
+
+    /**
+     * Sets the filePath attribute value.
+     * 
+     * @param filePath The filePath to set.
+     */
+    public void setFilePath(String filePath) {
+        this.filePath = filePath;
+    }
 }
Index: work/src/org/kuali/kfs/sys/service/impl/BankServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/service/impl/BankServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/service/impl/BankServiceImpl.java	(revision 37225)
@@ -19,6 +19,7 @@
 import java.util.List;
 import java.util.Map;
 
+import org.apache.commons.lang.ArrayUtils;
 import org.apache.commons.lang.StringUtils;
 import org.kuali.kfs.sys.KFSParameterKeyConstants;
 import org.kuali.kfs.sys.KFSPropertyConstants;
@@ -26,6 +27,7 @@
 import org.kuali.kfs.sys.service.BankService;
 import org.kuali.rice.kns.service.BusinessObjectService;
 import org.kuali.rice.kns.service.DataDictionaryService;
+import org.kuali.rice.kns.service.ParameterEvaluator;
 import org.kuali.rice.kns.service.ParameterService;
 
 /**
@@ -75,7 +77,7 @@
     /**
      * @see org.kuali.kfs.sys.service.BankService#getDefaultBankByDocType(java.lang.Class)
      */
-    public Bank getDefaultBankByDocType(Class documentClass) {
+    public Bank getDefaultBankByDocType(Class<?> documentClass) {
         final String documentTypeCode = getDataDictionaryService().getDocumentTypeNameByClass(documentClass);
         
         if (StringUtils.isBlank(documentTypeCode)) {
@@ -92,6 +94,18 @@
     }
 
     /**
+     * @see org.kuali.kfs.sys.service.BankService#isBankSpecificationEnabledForDocument(java.lang.Class)
+     */
+    public boolean isBankSpecificationEnabledForDocument(Class<?> documentClass) {
+        final String documentTypeCode = getDataDictionaryService().getDocumentTypeNameByClass(documentClass);
+        if (ArrayUtils.contains(PERMANENT_BANK_SPECIFICATION_ENABLED_DOCUMENT_TYPES, documentTypeCode)) {
+            return true;
+        }
+        final ParameterEvaluator evaluator = parameterService.getParameterEvaluator(Bank.class, KFSParameterKeyConstants.BANK_CODE_DOCUMENT_TYPES, documentTypeCode);
+        return evaluator.evaluationSucceeds();
+    }
+
+    /**
      * Sets the businessObjectService attribute value.
      * 
      * @param businessObjectService The businessObjectService to set.
Index: work/src/org/kuali/kfs/sys/service/impl/KfsParameterConstants.java
===================================================================
--- work/src/org/kuali/kfs/sys/service/impl/KfsParameterConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/service/impl/KfsParameterConstants.java	(revision 37225)
@@ -36,6 +36,8 @@
     public static final String PURCHASING_NAMESPACE = FINANCIAL_NAMESPACE_PREFIX + "PURAP";
     public static final String VENDOR_NAMESPACE = FINANCIAL_NAMESPACE_PREFIX + "VND";
     public static final String ENDOWMENT_NAMESPACE = FINANCIAL_NAMESPACE_PREFIX + "ENDOW";
+    public static final String PARAMETER_CONFIG_TYPE_CODE = "CONFG";
+    public static final String PARAMETER_ALL_DETAIL_TYPE = "All";
 
     @NAMESPACE(namespace = FINANCIAL_SYSTEM_NAMESPACE)
     @COMPONENT(component = ALL_COMPONENT)
Index: work/src/org/kuali/kfs/sys/service/BankService.java
===================================================================
--- work/src/org/kuali/kfs/sys/service/BankService.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/service/BankService.java	(revision 37225)
@@ -15,12 +15,15 @@
  */
 package org.kuali.kfs.sys.service;
 
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.kfs.sys.businessobject.Bank;
+import org.kuali.rice.kns.document.Document;
 
 /**
  * This service interface defines methods that a BankService implementation must provide.
  */
 public interface BankService {
+    public static final String[] PERMANENT_BANK_SPECIFICATION_ENABLED_DOCUMENT_TYPES = {KFSConstants.FinancialDocumentTypeCodes.ADVANCE_DEPOSIT, KFSConstants.FinancialDocumentTypeCodes.CASH_MANAGEMENT, KFSConstants.FinancialDocumentTypeCodes.NON_CHECK_DISBURSEMENT};
 
     /**
      * Retrieves a bank object who's primary id matches the values provided.
@@ -36,7 +39,7 @@
      * @param documentClass <code>Class</code> for the document type
      * @return <code>Bank</code> object retrieved by default bank code
      */
-    public Bank getDefaultBankByDocType(Class documentClass);
+    public Bank getDefaultBankByDocType(Class<?> documentClass);
     
     /**
      * Retrieves the default bank code for the given document type from system parameter. 
@@ -52,4 +55,12 @@
      * @return true if specification is enabled
      */
     public boolean isBankSpecificationEnabled();
+    
+    /**
+     * Determines if the bank specification is enabled for the given document by a) the document being one of the permanent
+     * bank code documents (AD's, CMD's, and ND's) or by the document being listed in the KFS-SYS / Bank / BANK_CODE_DOCUMENT_TYPES parameter
+     * @param documentClass the class of the document to determine if it has bank specifications enabled
+     * @return true if specification is enabled, false if specification is disabled
+     */
+    public boolean isBankSpecificationEnabledForDocument(Class<?> documentClass);
 }
Index: work/src/org/kuali/kfs/sys/KFSConstants.java
===================================================================
--- work/src/org/kuali/kfs/sys/KFSConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/KFSConstants.java	(revision 37225)
@@ -579,6 +579,8 @@
         public static final String CASH_RECEIPTS = "C"; // money coming in through cash receipts
         public static final String CASH_MANAGEMENT_OUT = "O"; // money going out through cashiering activity
         public static final String CASH_MANAGEMENT_MASTER = "M"; // an amalgamation of a cashiering transaction
+        public static final String CASH_CHANGE_REQUEST = "Q"; // requesting some change money back
+        public static final String CASH_CHANGE_GRANTED = "G"; // verified change request
     }
 
     // Constants for check sources
@@ -586,8 +588,8 @@
     // Why, I ask you in return, is the sky blue? That's right, because of
     // the effect of Rayleigh scattering on atmospheric particles. That's why.
     public static class CheckSources {
-        public static final String CASH_RECEIPTS = "R";
-        public static final String CASH_MANAGEMENT = "I";
+        public static final String CASH_RECEIPTS = "C";
+        public static final String CASH_MANAGEMENT = "R";
     }
 
     public static final String CASHIERING_TRANSACTION_OPEN_ITEM_IN_PROCESS_PROPERTY = "document.currentTransaction.openItemInProcess";
@@ -637,10 +639,6 @@
         }
     }
 
-    public static class AdvanceDepositConstants {
-        public static final String CASH_RECEIPT_ADVANCE_DEPOSIT_COLUMN_TYPE_CODE = "R";
-    }
-
     public static class AuxiliaryVoucher {
         public static final String ADJUSTMENT_DOC_TYPE = "AVAD";
         public static final String ADJUSTMENT_DOC_TYPE_NAME = "Adjustment";
@@ -680,10 +678,6 @@
         public static final String DEPOSIT_WIZARD_DEPOSITHEADER_ERROR = "depositHeaderErrors";
     }
 
-    public static class CreditCardReceiptConstants {
-        public static final String CASH_RECEIPT_CREDIT_CARD_RECEIPT_COLUMN_TYPE_CODE = "R";
-    }
-
     public static class BudgetAdjustmentDocumentConstants {
         public static final String SOURCE_BA = "From/Decrease";
         public static final String TARGET_BA = "To/Increase";
@@ -772,6 +766,7 @@
         public static final String ACTIVE_INPUT_TYPES_PARAMETER_NAME = "ACTIVE_FILE_TYPES";
 
         public static final String COLLECTOR_VALIDATOR_EMAIL_SUBJECT_PARAMETER_NAME = "VALIDATION_EMAIL_SUBJECT_LINE";
+        public static final String COLLECTOR_VALIDATOR_ERROR_EMAIL_SUBJECT_PARAMETER_NAME = "VALIDATION_ERROR_EMAIL_SUBJECT_LINE";
         public static final String COLLECTOR_DEMERGER_EMAIL_SUBJECT_PARAMETER_NAME = "ERROR_EMAIL_SUBJECT_LINE";
         public static final String COLLECTOR_EQUAL_DC_TOTAL_DOCUMENT_TYPES = "EQUAL_DEBIT_CREDIT_TOTAL_DOCUMENT_TYPES";
         public static final String COLLECTOR_PERFORM_DUPLICATE_HEADER_CHECK = "PERFORM_DUPLICATE_HEADER_CHECK_IND";
@@ -794,6 +789,8 @@
         public static final String NUMBER_OF_DAYS_SINCE_LAST_UPDATE  = "NUMBER_OF_DAYS_SINCE_LAST_UPDATE";
         
         public static final String ACCOUNTS_CAN_CROSS_CHARTS_IND = "ACCOUNTS_CAN_CROSS_CHARTS_IND";
+        
+        public static final String BATCH_CONTAINER_SEMAPHORE_PROCESSING_INTERVAL = "SEMAPHORE_PROCESSING_INTERVAL";
     }
 
     public static class GeneralLedgerApplicationParameterKeys {
@@ -1055,6 +1052,7 @@
         public static final String ADVANCE_DEPOSIT = "AD";
         public static final String CASH_MANAGEMENT = "CMD";
         public static final String CREDIT_CARD_RECEIPT = "CCR";
+        public static final String NON_CHECK_DISBURSEMENT = "ND";
         
         // accounts receivable
         public static final String PAYMENT_APPLICATION = "APP";
@@ -1084,6 +1082,7 @@
         public static final String CORRECTION_RECEIVING = "RCVC";
         public static final String VENDOR_CREDIT_MEMO = "CM";
         public static final String BULK_RECEIVING = "RCVB";
+        public static final String ELECTRONIC_INVOICE_REJECT = "EIRT";
     }
     
     // financial document type names
@@ -1304,5 +1303,21 @@
         public static final String KC_BUDGET_CATEGORY_SERVICE = "budgetCategorytServiceSOAP";
         public static final String KC_UNIT_SERVICE = "institutionalUnitSoapService";
     }
+    
+    public static final String REQUIRES_WORKSTUDY_REVIEW = "RequiresWorkstudyReview";
+    public static final String WORKSTUDY_ROUTE_OBJECT_CODES_PARM_NM = "WORKSTUDY_ROUTE_OBJECT_CODES";
+    public static final String DOCUMENT_LOCKOUT_PARM_NM = "LOCKOUT_IND";
+    public static final String DOCUMENT_LOCKOUT_PARM_DESC = "This parameter is to lock document during the lockout time.";
+    public static final String DOCUMENT_LOCKOUT_DEFAULT_MESSAGE = "DOCUMENT_LOCKOUT_DEFAULT_MESSAGE";
+    public static final String DOCUMENT_LOCKED_MAPPING = "moduleLocked";
+    public static final String FROM_EMAIL_ADDRESS_PARM_NM = "FROM_EMAIL_ADDRESS";
+    
+ 
+    // System Parameters
+    public static final String RESULT_SUMMARY_TO_EMAIL_ADDRESSES = "RESULT_SUMMARY_TO_EMAIL_ADDRESSES";
+    public static final String SOURCE_URL_PARAMETER = "SOURCE_URL";
+
+    
+   
 }
 
Index: work/src/org/kuali/kfs/sys/KFSPropertyConstants.java
===================================================================
--- work/src/org/kuali/kfs/sys/KFSPropertyConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/KFSPropertyConstants.java	(revision 37225)
@@ -22,6 +22,7 @@
 import org.kuali.kfs.coa.businessobject.SubObjectCode;
 import org.kuali.rice.kim.util.KIMPropertyConstants;
 import org.kuali.rice.kns.util.KNSPropertyConstants;
+import org.kuali.rice.kns.util.KualiDecimal;
 
 
 /**
@@ -1007,6 +1008,17 @@
     public static final String CONTACT_DEPARTMENT_NAME = "contactDepartmentName";
     public static final String CONTACT_MAILING_ADDRESS= "contactMailingAddress";
     public static final String CONTACT_PERSON_PHONE_NUMBER = "contactPersonPhoneNumber";
+    public static final String PROCUREMENT_CARD_HOLDER_LINE1_ADDRESS = "cardHolderLine1Address";
+    public static final String PROCUREMENT_CARD_HOLDER_LINE2_ADDRESS = "cardHolderLine2Address";
+    public static final String PROCUREMENT_CARD_HOLDER_CITY_NAME = "cardHolderCityName";
+    public static final String PROCUREMENT_CARD_HOLDER_STATE = "cardHolderStateCode";
+    public static final String PROCUREMENT_CARD_HOLDER_ZIP_CODE = "cardHolderZipCode";
+    public static final String PROCUREMENT_CARD_HOLDER_WORK_PHONE_NUMBER = "cardHolderWorkPhoneNumber";
+    public static final String PROCUREMENT_CARD_LIMIT = "cardLimit";
+    public static final String PROCUREMENT_CARD_CYCLE_AMOUNT_LIMIT = "cardCycleAmountLimit";    
+    public static final String PROCUREMENT_CARD_CYCLE_VOLUME_LIMIT = "cardCycleVolumeLimit";
+    public static final String PROCUREMENT_CARD_STATUS_CODE = "cardStatusCode";
+    public static final String PROCUREMENT_CARD_NOTE_TEXT = "cardNoteText";
     public static final String PROJECT = "project";
     public static final String PROJECT_CODE = "projectCode";
     public static final String PROJECT_DESCRIPTION = "projectDescription";
@@ -1150,6 +1162,7 @@
     public static final String TRANSACTION_POSTING_DATE = "transactionPostingDate";
     public static final String TRANSACTION_TOTAL_HOURS = "transactionTotalHours";
     public static final String TRANSMISSION_DATE = "transmissionDate";
+    public static final String CREDIT_CARD_NUMBER = "creditCardNumber";
     public static final String TRN_ENTRY_LEDGER_SEQUENCE_NUMBER = "transactionLedgerEntrySequenceNumber";
     public static final String TWO_DIGIT_TEXT_CODE = KNSPropertyConstants.TWO_DIGIT_TEXT_CODE;
     public static final String TYPE = KNSPropertyConstants.TYPE;
Index: work/src/org/kuali/kfs/sys/KFSKeyConstants.java
===================================================================
--- work/src/org/kuali/kfs/sys/KFSKeyConstants.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/KFSKeyConstants.java	(revision 37225)
@@ -300,6 +300,7 @@
     public static final String ERROR_CUSTOM = "error.custom";
     public static final String ERROR_MAINTENANCE_LOCKED = "error.maintenance.locked";
     public static final String ERROR_ZERO_AMOUNT = "error.zeroAmount";
+    public static final String ERROR_BLANK_AMOUNT = "error.blankAmount";
     public static final String ERROR_ZERO_OR_NEGATIVE_AMOUNT = "error.zeroOrNegativeAmount";
     public static final String ERROR_NEGATIVE_AMOUNT = "error.negativeAmount";
     public static final String ERROR_INVALID_NEGATIVE_AMOUNT_NON_CORRECTION = "error.invalidNegativeAmountForNonCorrection";
@@ -373,6 +374,8 @@
     public static final String ERROR_DV_REVOLVING_PAYMENT_REASON = "error.dv.revolvingPaymentReason";
     public static final String ERROR_DV_CHECK_TOTAL_CHANGE = "error.dv.checkTotalChange";    
     public static final String ERROR_DV_CAMPUS_TURNED_OFF_SPECIAL_HANDLING_WITHOUT_EXPLANATORY_NOTE = "error.dv.campusTurnedOffSpecialHandlingWithoutExplanatoryNote";
+    public static final String MESSAGE_DV_IMMEDIATE_EXTRACT_EMAIL_SUBJECT = "message.dv.immediateExtractEmail.subject";
+    public static final String MESSAGE_DV_IMMEDIATE_EXTRACT_EMAIL_BODY = "message.dv.immediateExtractEmail.body";
 
     public static final String ERROR_BA_AMOUNT_ZERO = "error.document.ba.amount.zero";
     public static final String ERROR_BA_AMOUNT_NEGATIVE = "error.document.ba.amount.negative";
@@ -632,6 +635,8 @@
         public static final String ERROR_EXCESSIVE_TOTAL = "error.document.cashReceipt.invalidTotal";
         public static final String ERROR_NEGATIVE_TOTAL = "error.document.cashReceipt.negativeTotal";
         public static final String ERROR_ZERO_TOTAL = "error.document.cashReceipt.zeroTotal";
+        public static final String ERROR_CONFIRMED_TOTAL = "error.document.cashReceipt.incorrectConfirmedTotal";
+        public static final String ERROR_CHANGE_REQUEST = "error.document.cashReceipt.invalidChangeRequest";
     }
 
     public static final class CreditCardReceipt {
@@ -869,6 +874,7 @@
         public static final String MESSAGE_BATCH_BALANCING_RECORD_BEFORE_FISCAL_YEAR = "message.batch.balancing.record.before.fiscal.year";
         public static final String MESSAGE_BATCH_BALANCING_RECORD_FAILED_BALANCING = "message.batch.balancing.record.failed.balancing";
         public static final String MESSAGE_BATCH_BALANCING_HISTORY_PURGED = "message.batch.balancing.history.purged";
+        public static final String MESSAGE_BATCH_BALANCING_FILE_LISTING = "message.batch.balancing.file.listing";
         
         public static final String REPORT_UNKNOWN_LABEL = "message.batch.balancing.report.unknown.label";
         
@@ -939,6 +945,7 @@
     public static final String MESSAGE_BATCH_FILE_ADMIN_DELETE_CANCELLED = "message.batch.file.admin.delete.cancelled";
     
     public static final String MESSAGE_BATCH_FILE_LOG_EMAIL_BODY = "message.batch.log.email.body";
+    public static final String SALARY_TRANSFER_FRINGE_BENEFIT_INQUIRY_LABEL =  "salary.transfer.fringe.benefit.inquiry.label";
     
     public static final String ERROR_ACCOUNTING_DOCUMENT_ACCOUNTING_LINE_IMPORT_GENERAL = "error.accountingdocument.accountinglineimport.general";
     
@@ -953,4 +960,13 @@
     
     public static final String ERROR_COLLECTOR_EMAILSEND_NOTIFICATION_SUBJECT = "error.collector.emailSend.notification.subject";
     public static final String ERROR_COLLECTOR_EMAILSEND_NOTIFICATION_BODY = "error.collector.emailSend.notification.body";
+    
+    /**
+     * This class stores message keys for the SemaphoreInputFileType upload page
+     */
+    public static final class Semaphore {
+        public static final String MESSAGE_BATCH_UPLOAD_TITLE_PREFIX = "message.sys.batch.semaphore.upload.title";
+        public static final String ERROR_BATCH_UPLOAD_INVALID_STEP = "error.sys.batch.semaphore.upload.invalidStep";
+        public static final String ERROR_BATCH_UPLOAD_DELETE_DONE_FILE = "error.sys.batch.semaphore.upload.deleteDoneFile";
+    }
 }
Index: work/src/org/kuali/kfs/sys/report/BusinessObjectReportHelper.java
===================================================================
--- work/src/org/kuali/kfs/sys/report/BusinessObjectReportHelper.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/report/BusinessObjectReportHelper.java	(revision 37225)
@@ -294,7 +294,8 @@
                 int width = cellWidthList.get(index);
                 String alignment = (allowRightAlignment && cellAlignmentList.get(index).equals(RIGHT_ALIGNMENT)) ? StringUtils.EMPTY : "-";
                 if(width > 0) {
-                    singleRowFormat = singleRowFormat.append("%").append(alignment).append(width).append("s ");
+                    // following translates to %<alignment><width>.<precision>s where the precision for Strings forces a maxLength
+                    singleRowFormat = singleRowFormat.append("%").append(alignment).append(width).append("." + width).append("s ");
                 }
             }
             
Index: work/src/org/kuali/kfs/sys/spring-sys.xml
===================================================================
--- work/src/org/kuali/kfs/sys/spring-sys.xml	(revision 30259)
+++ work/src/org/kuali/kfs/sys/spring-sys.xml	(revision 37225)
@@ -159,6 +159,8 @@
 	<bean id="wrappedStep" parent="step" abstract="true">
 		<property name="wrappedBatchExecutorService" ref="wrappedBatchExecutorService" />
 	</bean>
+	
+	<bean id="flatFileSortStep" parent="step" class="org.kuali.kfs.sys.batch.FlatFileSortStep" abstract="true"/>
 
 	<bean id="scheduleJob" parent="scheduledJobDescriptor">
 		<property name="steps">
@@ -270,6 +272,7 @@
 		</property>
 	</bean>
 	
+	
 	<bean id="fiscalYearMakerStep" class="org.kuali.kfs.sys.batch.FiscalYearMakerStep" parent="step">
 		<property name="fiscalYearMakerService">
 			<ref bean="fiscalYearMakerService" />
@@ -412,7 +415,9 @@
 		</property>
 	</bean>
 	
-	<bean id="fiscalYearMakerService" class="org.kuali.kfs.sys.batch.service.impl.FiscalYearMakerServiceImpl">
+	<bean id="fiscalYearMakerService" parent="fiscalYearMakerService-parentBean"/>
+	
+	<bean id="fiscalYearMakerService-parentBean" class="org.kuali.kfs.sys.batch.service.impl.FiscalYearMakerServiceImpl">
 		<property name="fiscalYearMakersDao">
 			<ref bean="fiscalYearMakersDao" />
 		</property>
@@ -855,4 +860,53 @@
     </bean>
 
     <bean id="weeklyEmailStep" class="org.kuali.kfs.sys.batch.WeeklyEmailStep" parent="step" />
+    
+    <bean id="FlatFileParser" abstract="true" class="org.kuali.kfs.sys.batch.FlatFileParserBase">    
+		<property name="dateTimeService" ref="dateTimeService" />
+	</bean>
+
+    <bean id="FlatFileParseTracker" class="org.kuali.kfs.sys.batch.FlatFileParseTrackerImpl" scope="prototype" />
+    
+    <bean id="FlatFilePrefixObjectSpecification" abstract="true" class="org.kuali.kfs.sys.batch.FlatFilePrefixObjectSpecification" />
+    
+    <bean id="FlatFileRegexObjectSpecification" abstract="true" class="org.kuali.kfs.sys.batch.FlatFileRegexObjectSpecification" />
+    
+	<bean id="FixedWidthFlatFileSpecification" abstract="true" class="org.kuali.kfs.sys.batch.FixedWidthFlatFileSpecification" />
+    
+    <bean id="FixedWidthFlatFilePropertySpecification" abstract="true" class="org.kuali.kfs.sys.batch.FixedWidthFlatFilePropertySpecification" />
+    
+	<bean id="DelimitedFlatFileSpecification" abstract="true" class="org.kuali.kfs.sys.batch.DelimitedFlatFileSpecification" />
+	
+    <bean id="DelimitedFlatFilePropertySpecification" abstract="true" class="org.kuali.kfs.sys.batch.DelimitedFlatFilePropertySpecification" />
+    
+    <bean id="FixedWidthFlatFileRegexSpecification" abstract="true" class="org.kuali.kfs.sys.batch.FixedWidthFlatFileRegexSpecification" />
+    
+    <bean id="batchContainerStep" parent="batchContainerStep-parentBean"/>
+    <bean id="batchContainerStep-parentBean" abstract="true" class="org.kuali.kfs.sys.batch.BatchContainerStep" parent="step">
+        <property name="batchContainerDirectory" value="${staging.directory.sys.batchContainer}"/>
+        <property name="batchContainerStopStep" ref="stopBatchContainerStep" />
+	</bean>
+	
+	<bean id="stopBatchContainerStep" class="org.kuali.kfs.sys.batch.StopBatchContainerStep" parent="step"/>
+	
+	<bean id="semaphoreInputFileTypeError" class="org.kuali.kfs.sys.batch.SemaphoreInputFileType">
+    	<property name="directoryPath" value="${staging.directory.sys.batchContainer}"/>
+	 	<property name="fileExtension" value="error"/>
+	 	<property name="fileTypeIdentifier" value="semaphoreInputFileTypeError" />
+	</bean>
+	
+	<bean id="namespaceOrFilePathPermissionTypeService" class="org.kuali.kfs.sys.identity.NamespaceWildcardAllowedAndOrStringWildcardAllowedPermissionTypeServiceImpl">
+        <property name="wildcardMatchStringAttributeName" value="filePath"/>
+    	<property name="namespaceRequiredOnStoredAttributeSet" value="false" />
+    </bean>
+    
+    <bean id="excludeSingleActorSeparationOfDutiesRoleTypeService" parent="excludeSingleActorSeparationOfDutiesRoleTypeService-parentBean" />
+    <bean id="excludeSingleActorSeparationOfDutiesRoleTypeService-parentBean" abstract="true" class="org.kuali.kfs.sys.identity.ExcludeSingleActorSeparationOfDutiesRoleTypeService" />
+    <bean class="org.kuali.rice.ksb.messaging.KSBExporter">
+		<property name="serviceDefinition">
+			<bean parent="kfsService" p:service-ref="excludeSingleActorSeparationOfDutiesRoleTypeService"
+				p:localServiceName="excludeSingleActorSeparationOfDutiesRoleTypeService" />
+		</property>
+	</bean>
+    
 </beans>
Index: work/src/org/kuali/kfs/sys/web/struts/KualiAccountingDocumentActionBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/web/struts/KualiAccountingDocumentActionBase.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/web/struts/KualiAccountingDocumentActionBase.java	(revision 37225)
@@ -179,8 +179,8 @@
         if (transForm.hasDocumentId()) {
             AccountingDocument financialDocument = (AccountingDocument) transForm.getDocument();
 
-            processAccountingLineOverrides(financialDocument.getSourceAccountingLines());
-            processAccountingLineOverrides(financialDocument.getTargetAccountingLines());
+            processAccountingLineOverrides(financialDocument,financialDocument.getSourceAccountingLines());
+            processAccountingLineOverrides(financialDocument,financialDocument.getTargetAccountingLines());
         }
     }
 
@@ -190,17 +190,22 @@
     protected void processAccountingLineOverrides(AccountingLine line) {
         processAccountingLineOverrides(Arrays.asList(new AccountingLine[] { line }));
     }
-
+    
+    protected void processAccountingLineOverrides(List accountingLines) {
+        processAccountingLineOverrides(null,accountingLines);
+    }
     /**
      * @param accountingLines
      */
-    protected void processAccountingLineOverrides(List accountingLines) {
+    protected void processAccountingLineOverrides(AccountingDocument financialDocument ,List accountingLines) {
         if (!accountingLines.isEmpty()) {
-            SpringContext.getBean(PersistenceService.class).retrieveReferenceObjects(accountingLines, AccountingLineOverride.REFRESH_FIELDS);
+            
 
             for (Iterator i = accountingLines.iterator(); i.hasNext();) {
                 AccountingLine line = (AccountingLine) i.next();
-                AccountingLineOverride.processForOutput(line);
+               // line.refreshReferenceObject("account");
+                SpringContext.getBean(PersistenceService.class).retrieveReferenceObjects(line, AccountingLineOverride.REFRESH_FIELDS);
+                AccountingLineOverride.processForOutput(financialDocument,line);
             }
         }
     }
@@ -237,22 +242,7 @@
         }
     }
 
-    /**
-     * Automatically clears any overrides that have become unneeded. This is for accounting lines that were changed right before
-     * final actions like route. Normally the unneeded overrides are cleared in accountingLineOverrideField.tag instead, but that
-     * requires another form submit. This method shouldn't be called on lines that haven't changed, to avoid automatically changing
-     * read-only lines. This cannot be done in the Rule because Rules cannot change the AccountingLines; they only get a deepCopy.
-     * 
-     * @param formLine
-     */
-    protected void clearOverridesThatBecameUnneeded(AccountingLine formLine) {
-        AccountingLineOverride currentlyNeeded = AccountingLineOverride.determineNeededOverrides(formLine);
-        AccountingLineOverride currentOverride = AccountingLineOverride.valueOf(formLine.getOverrideCode());
-        if (!currentOverride.isValidMask(currentlyNeeded)) {
-            // todo: handle unsupported combinations of overrides (not a problem until we allow certain multiple overrides)
-        }
-        formLine.setOverrideCode(currentOverride.mask(currentlyNeeded).getCode());
-    }
+   
 
     /**
      * This method will remove a TargetAccountingLine from a FinancialDocument. This assumes that the user presses the delete button
Index: work/src/org/kuali/kfs/sys/web/struts/KualiBatchInputFileForm.java
===================================================================
--- work/src/org/kuali/kfs/sys/web/struts/KualiBatchInputFileForm.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/web/struts/KualiBatchInputFileForm.java	(revision 37225)
@@ -18,7 +18,9 @@
 import java.util.List;
 
 import org.apache.struts.upload.FormFile;
+import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.kfs.sys.businessobject.BatchUpload;
+import org.kuali.rice.kns.service.KNSServiceLocator;
 import org.kuali.rice.kns.web.struts.form.KualiForm;
 import org.kuali.rice.core.util.KeyLabelPair;
 
@@ -115,6 +117,10 @@
     public void setUrl(String url) {
         this.url = url;
     }
+    
+    @Override 
+    protected void customInitMaxUploadSizes() {
+        addMaxUploadSize (KNSServiceLocator.getParameterService().getParameterValue(KFSConstants.ParameterNamespaces.KFS, "Batch", "MAX_FILE_SIZE_UPLOAD"));
+    }
 
-
 }
Index: work/src/org/kuali/kfs/sys/web/struts/KualiAccountingDocumentFormBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/web/struts/KualiAccountingDocumentFormBase.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/web/struts/KualiAccountingDocumentFormBase.java	(revision 37225)
@@ -210,7 +210,7 @@
      * @param parameterMap the map of parameters that were sent in with the request
      */
     protected void repopulateOverrides(AccountingLine line, String accountingLinePropertyName, Map parameterMap) {
-        AccountingLineOverride.determineNeededOverrides(line);
+        AccountingLineOverride.determineNeededOverrides(getFinancialDocument() , line);
         if (line.getAccountExpiredOverrideNeeded()) {
             if (LOG.isDebugEnabled()) {
                 StringUtils.join(parameterMap.keySet(), "\n");
Index: work/src/org/kuali/kfs/sys/document/FinancialSystemTransactionalDocumentBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/FinancialSystemTransactionalDocumentBase.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/FinancialSystemTransactionalDocumentBase.java	(revision 37225)
@@ -22,22 +22,31 @@
 import org.kuali.kfs.sys.businessobject.FinancialSystemDocumentHeader;
 import org.kuali.kfs.sys.context.SpringContext;
 import org.kuali.kfs.sys.document.dataaccess.FinancialSystemDocumentHeaderDao;
+import org.kuali.kfs.sys.document.service.FinancialSystemDocumentService;
+import org.kuali.kfs.sys.service.impl.KfsParameterConstants;
+import org.kuali.rice.kew.dto.DocumentRouteLevelChangeDTO;
 import org.kuali.rice.kew.dto.DocumentRouteStatusChangeDTO;
 import org.kuali.rice.kew.exception.WorkflowException;
 import org.kuali.rice.kew.exception.WorkflowRuntimeException;
 import org.kuali.rice.kns.bo.DocumentHeader;
 import org.kuali.rice.kns.document.TransactionalDocumentBase;
-import org.kuali.rice.kns.service.DateTimeService;
+import org.kuali.rice.kns.service.BusinessObjectService;
 import org.kuali.rice.kns.service.DocumentHelperService;
+import org.kuali.rice.kns.service.ParameterService;
 import org.kuali.rice.kns.util.GlobalVariables;
+import org.kuali.rice.kns.util.KualiDecimal;
 
 /**
  * This class is a KFS specific TransactionalDocumentBase class
  */
 public class FinancialSystemTransactionalDocumentBase extends TransactionalDocumentBase implements FinancialSystemTransactionalDocument {
     protected static final Logger LOG = Logger.getLogger(FinancialSystemTransactionalDocumentBase.class);
+    protected static final String UPDATE_TOTAL_AMOUNT_IN_POST_PROCESSING_PARAMETER_NAME = "UPDATE_TOTAL_AMOUNT_IN_POST_PROCESSING_IND";
 
     protected FinancialSystemDocumentHeader documentHeader;
+    private volatile static ParameterService parameterService;
+    private volatile static BusinessObjectService businessObjectService;
+    private volatile static FinancialSystemDocumentService financialSystemDocumentService;
 
     /**
      * Constructs a FinancialSystemTransactionalDocumentBase.java.
@@ -127,6 +136,22 @@
         super.doRouteStatusChange(statusChangeEvent);
     }
     
+    /**
+     * This is the default implementation which, if parameter KFS-SYS / Document / UPDATE_TOTAL_AMOUNT_IN_POST_PROCESSING_IND is on, updates the document
+     * and resaves if needed
+     * @see org.kuali.rice.kns.document.DocumentBase#doRouteLevelChange(org.kuali.rice.kew.dto.DocumentRouteLevelChangeDTO)
+     */
+    @Override
+    public void doRouteLevelChange(DocumentRouteLevelChangeDTO levelChangeEvent) {
+        if (this instanceof AmountTotaling && getDocumentHeader() != null && getParameterService() != null && getBusinessObjectService() != null && getParameterService().parameterExists(KfsParameterConstants.FINANCIAL_SYSTEM_DOCUMENT.class, UPDATE_TOTAL_AMOUNT_IN_POST_PROCESSING_PARAMETER_NAME) && getParameterService().getIndicatorParameter(KfsParameterConstants.FINANCIAL_SYSTEM_DOCUMENT.class, UPDATE_TOTAL_AMOUNT_IN_POST_PROCESSING_PARAMETER_NAME)) {
+            final KualiDecimal currentTotal = ((AmountTotaling)this).getTotalDollarAmount();
+            if (!currentTotal.equals(((FinancialSystemDocumentHeader)getDocumentHeader()).getFinancialDocumentTotalAmount())) {
+                ((FinancialSystemDocumentHeader)getDocumentHeader()).setFinancialDocumentTotalAmount(currentTotal);
+                getBusinessObjectService().save(getDocumentHeader());
+            }
+        }
+        super.doRouteLevelChange(levelChangeEvent);
+    }
 
     /**
      * @see org.kuali.kfs.sys.document.Correctable#toErrorCorrection()
@@ -148,4 +173,38 @@
     public boolean answerSplitNodeQuestion(String nodeName) throws UnsupportedOperationException {
         throw new UnsupportedOperationException("FinancialSystemTransactionalDocumentBase does not implement the answerSplitNodeQuestion method. Node name specified was: " + nodeName); 
     }
+    
+    /**
+     * @return the default implementation of the ParameterService
+     */
+    public ParameterService getParameterService() {
+       if (parameterService == null) {
+           parameterService = SpringContext.getBean(ParameterService.class);
+       }
+       return parameterService;
+    }
+    
+    /**
+     * @return the default implementation of the BusinessObjectService
+     */
+    public BusinessObjectService getBusinessObjectService() {
+        if (businessObjectService == null) {
+            businessObjectService = SpringContext.getBean(BusinessObjectService.class);
+        }
+        return businessObjectService;
+    }
+    
+    public FinancialSystemDocumentService getFinancialSystemDocumentService() {
+        if (financialSystemDocumentService == null) {
+            financialSystemDocumentService = SpringContext.getBean(FinancialSystemDocumentService.class);
+        }
+        return financialSystemDocumentService;
+    }
+    
+    @Override
+    public void toCopy() throws WorkflowException, IllegalStateException {
+        FinancialSystemDocumentHeader oldDocumentHeader = getDocumentHeader();
+        super.toCopy();
+        getFinancialSystemDocumentService().prepareToCopy(oldDocumentHeader, this);
+    }
 }
Index: work/src/org/kuali/kfs/sys/document/validation/RouteNodeValidation.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/validation/RouteNodeValidation.java	(revision 0)
+++ work/src/org/kuali/kfs/sys/document/validation/RouteNodeValidation.java	(revision 37225)
@@ -0,0 +1,84 @@
+/*
+ * Copyright 2011 The Kuali Foundation.
+ * 
+ * Licensed under the Educational Community License, Version 1.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl1.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.kuali.kfs.sys.document.validation;
+
+import java.util.ArrayList;
+
+import java.util.Arrays;
+import java.util.List;
+
+import org.kuali.kfs.sys.document.validation.event.AttributedDocumentEvent;
+import org.kuali.rice.kew.exception.WorkflowException;
+import org.kuali.rice.kns.document.Document;
+import org.kuali.rice.kns.workflow.service.KualiWorkflowDocument;
+
+/**
+ * An abstract class that creates an easy way to do routeNode validations.  Basically,
+ * extenders set a validRouteNodeNames - a list of all valid route nodes to perform the validation.
+ */
+public abstract class RouteNodeValidation extends GenericValidation {
+    private static final org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(RouteNodeValidation.class);
+    
+    protected List<String> validRouteNodeNames;
+    
+    @Override
+    public boolean stageValidation(AttributedDocumentEvent event) {
+        boolean valid = true;
+        if (LOG.isDebugEnabled()) {
+            LOG.debug("Staging validation for: "+getClass().getName()+" for event "+event.getClass().getName());
+        }
+        populateParametersFromEvent(event);
+        
+        List<String> currentRouteLevels = new ArrayList<String>();
+        try {
+            KualiWorkflowDocument workflowDoc = event.getDocument().getDocumentHeader().getWorkflowDocument();
+            currentRouteLevels = Arrays.asList(workflowDoc.getNodeNames());
+            for(String nodeName : validRouteNodeNames) {
+                if (currentRouteLevels.contains(nodeName) && workflowDoc.isApprovalRequested()) {
+                    return validate(event);
+                }
+            }
+            
+        }
+        catch (WorkflowException e) {
+            throw new RuntimeException(e);
+        }
+        
+        return valid;
+        
+        
+    }
+    
+
+    
+    
+    
+    public void setValidRouteNodeNames(List<String> validRouteNodeNames) {
+        this.validRouteNodeNames = validRouteNodeNames;
+    }
+
+    /**
+     * @return list of valid route node names
+     */
+    public List<String> getValidRouteNodeNames() {
+        return validRouteNodeNames;
+    }
+
+   
+    
+    
+
+}
Index: work/src/org/kuali/kfs/sys/document/validation/impl/BankCodeValidation.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/validation/impl/BankCodeValidation.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/validation/impl/BankCodeValidation.java	(revision 37225)
@@ -21,6 +21,7 @@
 import org.kuali.kfs.sys.businessobject.Bank;
 import org.kuali.kfs.sys.context.SpringContext;
 import org.kuali.kfs.sys.service.BankService;
+import org.kuali.rice.kns.document.Document;
 import org.kuali.rice.kns.service.DataDictionaryService;
 import org.kuali.rice.kns.util.GlobalVariables;
 import org.kuali.rice.kns.util.ObjectUtils;
@@ -29,6 +30,8 @@
  * Performs bank code validation.
  */
 public class BankCodeValidation {
+    protected static volatile DataDictionaryService dataDictionaryService;
+    protected static volatile BankService bankService;
 
     /**
      * Performs required, exists, and active validation of bank code. Also validates bank for deposit or disbursement indicator if
@@ -41,10 +44,10 @@
      * @return true if bank code passes all validations, false if any fail
      */
     public static boolean validate(String bankCode, String bankCodeProperty, boolean requireDeposit, boolean requireDisbursement) {
-        String bankCodeLabel = SpringContext.getBean(DataDictionaryService.class).getAttributeLabel(Bank.class, KFSPropertyConstants.BANK_CODE);
+        String bankCodeLabel = getDataDictionaryService().getAttributeLabel(Bank.class, KFSPropertyConstants.BANK_CODE);
 
         // if bank specification is not enabled, no need to validate bank code
-        if (!SpringContext.getBean(BankService.class).isBankSpecificationEnabled()) {
+        if (!getBankService().isBankSpecificationEnabled()) {
             return true;
         }
 
@@ -55,7 +58,7 @@
             return false;
         }
 
-        Bank bank = SpringContext.getBean(BankService.class).getByPrimaryId(bankCode);
+        Bank bank = getBankService().getByPrimaryId(bankCode);
         
         if (ObjectUtils.isNull(bank)) {
             GlobalVariables.getMessageMap().putError(bankCodeProperty, KFSKeyConstants.ERROR_DOCUMENT_BANKACCMAINT_INVALID_BANK);
@@ -79,4 +82,41 @@
         return true;
     }
 
+    /**
+     * Performs required, exists, and active validation of bank code. Also validates bank for deposit or disbursement indicator if
+     * requested.
+     * 
+     * @param document the document that is being validated
+     * @param bankCode value to validate
+     * @param bankCodeProperty property to associate errors with
+     * @param requireDeposit true if the bank code should support deposits
+     * @param requireDisbursement true if the bank code should support disbursements
+     * @return true if bank code passes all validations, false if any fail
+     */
+    public static boolean validate(Document document, String bankCode, String bankCodeProperty, boolean requireDeposit, boolean requireDisbursement) {
+        if (document != null && !getBankService().isBankSpecificationEnabledForDocument(document.getClass())) {
+            return true;
+        }
+        return BankCodeValidation.validate(bankCode, bankCodeProperty, requireDeposit, requireDisbursement);
+    }
+    
+    /**
+     * @return the default implementatino of the DataDictionaryService
+     */
+    protected static DataDictionaryService getDataDictionaryService() {
+        if (dataDictionaryService == null) {
+            dataDictionaryService = SpringContext.getBean(DataDictionaryService.class);
+        }
+        return dataDictionaryService;
+    }
+    
+    /**
+     * @return the default implementation of the BankService
+     */
+    protected static BankService getBankService() {
+        if (bankService == null) {
+            bankService = SpringContext.getBean(BankService.class);
+        }
+        return bankService;
+    }
 }
Index: work/src/org/kuali/kfs/sys/document/FinancialSystemTransactionalDocument.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/FinancialSystemTransactionalDocument.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/FinancialSystemTransactionalDocument.java	(revision 37225)
@@ -19,7 +19,6 @@
 import org.kuali.rice.kns.document.TransactionalDocument;
 
 public interface FinancialSystemTransactionalDocument extends TransactionalDocument {
-
     /**
      * @see org.kuali.rice.kns.document.Document#getDocumentHeader()
      */
Index: work/src/org/kuali/kfs/sys/document/datadictionary/FinancialSystemTransactionalDocument.xml
===================================================================
--- work/src/org/kuali/kfs/sys/document/datadictionary/FinancialSystemTransactionalDocument.xml	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/datadictionary/FinancialSystemTransactionalDocument.xml	(revision 37225)
@@ -5,7 +5,7 @@
   <bean id="FinancialSystemTransactionalDocument-parentBean" abstract="true" parent="AccountingDocumentEntry">
     <property name="documentTypeName" value="KFST"/>
     <property name="documentClass" value="org.kuali.kfs.sys.document.FinancialSystemTransactionalDocumentBase"/>
-  
+    <property name="baseDocumentClass" value="org.kuali.kfs.sys.document.FinancialSystemTransactionalDocumentBase"/>
     <property name="workflowAttributes">
     	<ref bean="FinancialSystemTransactionalDocument-workflowAttributes"/>
     </property>
Index: work/src/org/kuali/kfs/sys/document/service/impl/DebitDeterminerServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/service/impl/DebitDeterminerServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/service/impl/DebitDeterminerServiceImpl.java	(revision 37225)
@@ -15,11 +15,15 @@
  */
 package org.kuali.kfs.sys.document.service.impl;
 
+import java.text.DecimalFormat;
+
 import org.apache.commons.lang.StringUtils;
 import org.apache.log4j.Logger;
+import org.kuali.kfs.gl.service.impl.StringHelper;
 import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.kfs.sys.businessobject.AccountingLine;
 import org.kuali.kfs.sys.businessobject.GeneralLedgerPendingEntrySourceDetail;
+import org.kuali.kfs.sys.businessobject.SystemOptions;
 import org.kuali.kfs.sys.document.AccountingDocument;
 import org.kuali.kfs.sys.document.GeneralLedgerPendingEntrySource;
 import org.kuali.kfs.sys.document.service.AccountingDocumentRuleHelperService;
@@ -35,7 +39,7 @@
     protected static final String isDebitCalculationIllegalStateExceptionMessage = "an invalid debit/credit check state was detected";
     protected static final String isErrorCorrectionIllegalStateExceptionMessage = "invalid (error correction) document not allowed";
     protected static final String isInvalidLineTypeIllegalArgumentExceptionMessage = "invalid accounting line type";
-    
+
     private AccountingDocumentRuleHelperService accountingDocumentRuleUtil;
     private OptionsService optionsService;
 
@@ -304,56 +308,94 @@
         return returnboolean;
     }
 
-    /**
-     * @see org.kuali.kfs.sys.document.service.DebitDeterminerService#isRevenue(org.kuali.kfs.sys.businessobject.GeneralLedgerPendingEntrySourceDetail)
-     */
-    public boolean isRevenue(GeneralLedgerPendingEntrySourceDetail postable) {
-        LOG.debug("isRevenue(AccountingLine) - start");
-
-        boolean returnboolean = !isExpense(postable);
-        LOG.debug("isRevenue(AccountingLine) - end");
-        return returnboolean;
+    public String getConvertedAmount(String objectType , String debitCreditCode , String amount ) {
+        SystemOptions systemOption = optionsService.getCurrentYearOptions();
+        
+        // If entries lack a debit and credit code that means they're budget entries and should already be signed appropriately + or -.
+        // so we should just be able to grab those without having to do any change.
+        if(StringHelper.isNullOrEmpty(debitCreditCode)) {
+            return amount;
+        }
+        
+        if(systemOption.getFinancialObjectTypeAssetsCd().equals(objectType)
+                ||systemOption.getFinObjTypeExpendNotExpCode().equals(objectType)  
+                ||systemOption.getFinObjTypeExpenditureexpCd().equals(objectType)
+                ||systemOption.getFinObjTypeExpendNotExpCode().equals(objectType) 
+                ||systemOption.getFinancialObjectTypeTransferExpenseCd().equals(objectType)) {
+           
+            if  (KFSConstants.GL_CREDIT_CODE.equals(debitCreditCode)) {
+                amount = "-" + amount;
+            }   
+        }
+        else if (systemOption.getFinObjTypeCshNotIncomeCd().equals(objectType)
+                || systemOption.getFinObjectTypeFundBalanceCd().equals(objectType)
+                || systemOption.getFinObjectTypeIncomecashCode().equals(objectType)
+                || systemOption.getFinObjTypeCshNotIncomeCd().equals(objectType)
+                || systemOption.getFinObjectTypeLiabilitiesCode().equals(objectType)
+                || systemOption.getFinancialObjectTypeTransferIncomeCd().equals(objectType)) {
+            if (KFSConstants.GL_DEBIT_CODE.equals(debitCreditCode)) {
+              amount = "-" + amount;
+            }
+          
+        }
+      
+        return amount;
     }
 
-    /**
-     * Sets the accountingDocumentRuleUtils attribute value.
-     * @param accountingDocumentRuleUtils The accountingDocumentRuleUtils to set.
-     */
-    public void setAccountingDocumentRuleUtils(AccountingDocumentRuleHelperService accountingDocumentRuleUtil) {
-        this.accountingDocumentRuleUtil = accountingDocumentRuleUtil;
-    }
 
-    /**
-     * Sets the optionsService attribute value.
-     * @param optionsService The optionsService to set.
-     */
-    public void setOptionsService(OptionsService optionsService) {
-        this.optionsService = optionsService;
-    }
 
-    /**
-     * Gets the isDebitCalculationIllegalStateExceptionMessage attribute. 
-     * @return Returns the isDebitCalculationIllegalStateExceptionMessage.
-     */
-    public String getDebitCalculationIllegalStateExceptionMessage() {
-        return isDebitCalculationIllegalStateExceptionMessage;
-    }
 
-    /**
-     * Gets the isErrorCorrectionIllegalStateExceptionMessage attribute. 
-     * @return Returns the isErrorCorrectionIllegalStateExceptionMessage.
-     */
-    public String getErrorCorrectionIllegalStateExceptionMessage() {
-        return isErrorCorrectionIllegalStateExceptionMessage;
-    }
 
-    /**
-     * Gets the isInvalidLineTypeIllegalArgumentExceptionMessage attribute. 
-     * @return Returns the isInvalidLineTypeIllegalArgumentExceptionMessage.
-     */
-    public String getInvalidLineTypeIllegalArgumentExceptionMessage() {
-        return isInvalidLineTypeIllegalArgumentExceptionMessage;
-    }
+/**
+ * @see org.kuali.kfs.sys.document.service.DebitDeterminerService#isRevenue(org.kuali.kfs.sys.businessobject.GeneralLedgerPendingEntrySourceDetail)
+ */
+public boolean isRevenue(GeneralLedgerPendingEntrySourceDetail postable) {
+    LOG.debug("isRevenue(AccountingLine) - start");
 
-    
+    boolean returnboolean = !isExpense(postable);
+    LOG.debug("isRevenue(AccountingLine) - end");
+    return returnboolean;
 }
+
+/**
+ * Sets the accountingDocumentRuleUtils attribute value.
+ * @param accountingDocumentRuleUtils The accountingDocumentRuleUtils to set.
+ */
+public void setAccountingDocumentRuleUtils(AccountingDocumentRuleHelperService accountingDocumentRuleUtil) {
+    this.accountingDocumentRuleUtil = accountingDocumentRuleUtil;
+}
+
+/**
+ * Sets the optionsService attribute value.
+ * @param optionsService The optionsService to set.
+ */
+public void setOptionsService(OptionsService optionsService) {
+    this.optionsService = optionsService;
+}
+
+/**
+ * Gets the isDebitCalculationIllegalStateExceptionMessage attribute. 
+ * @return Returns the isDebitCalculationIllegalStateExceptionMessage.
+ */
+public String getDebitCalculationIllegalStateExceptionMessage() {
+    return isDebitCalculationIllegalStateExceptionMessage;
+}
+
+/**
+ * Gets the isErrorCorrectionIllegalStateExceptionMessage attribute. 
+ * @return Returns the isErrorCorrectionIllegalStateExceptionMessage.
+ */
+public String getErrorCorrectionIllegalStateExceptionMessage() {
+    return isErrorCorrectionIllegalStateExceptionMessage;
+}
+
+/**
+ * Gets the isInvalidLineTypeIllegalArgumentExceptionMessage attribute. 
+ * @return Returns the isInvalidLineTypeIllegalArgumentExceptionMessage.
+ */
+public String getInvalidLineTypeIllegalArgumentExceptionMessage() {
+    return isInvalidLineTypeIllegalArgumentExceptionMessage;
+}
+
+
+}
Index: work/src/org/kuali/kfs/sys/document/service/impl/FinancialSystemDocumentServiceImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/service/impl/FinancialSystemDocumentServiceImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/service/impl/FinancialSystemDocumentServiceImpl.java	(revision 37225)
@@ -19,6 +19,8 @@
 import java.util.Collection;
 import java.util.Iterator;
 
+import org.kuali.kfs.sys.businessobject.FinancialSystemDocumentHeader;
+import org.kuali.kfs.sys.document.FinancialSystemTransactionalDocument;
 import org.kuali.kfs.sys.document.dataaccess.FinancialSystemDocumentDao;
 import org.kuali.kfs.sys.document.service.FinancialSystemDocumentService;
 import org.kuali.rice.kew.exception.WorkflowException;
@@ -63,5 +65,7 @@
         this.documentService = documentService;
     }
 
-    
+    public void prepareToCopy(FinancialSystemDocumentHeader oldDocumentHeader, FinancialSystemTransactionalDocument document) {
+        // This method serves as a plugin to add logic to the copy functionality, when needed. 
+    }
 }
Index: work/src/org/kuali/kfs/sys/document/service/DebitDeterminerService.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/service/DebitDeterminerService.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/service/DebitDeterminerService.java	(revision 37225)
@@ -19,6 +19,7 @@
 import org.kuali.kfs.sys.businessobject.GeneralLedgerPendingEntrySourceDetail;
 import org.kuali.kfs.sys.document.AccountingDocument;
 import org.kuali.kfs.sys.document.GeneralLedgerPendingEntrySource;
+import org.kuali.rice.kns.util.KualiDecimal;
 
 /**
  * A collection of methods that help accounting docs determine whether an accounting line represents a debit or not
@@ -141,9 +142,18 @@
      * @param accountingLine
      * @return boolean
      */
+    
+    
+    
     public abstract boolean isDebitConsideringSectionAndTypePositiveOnly(AccountingDocument accountingDocument, AccountingLine accountingLine);
     
     /**
+     * This method is to convert amount to positive or negative based on the object type and Debit CreditCode combination.
+     *   
+     */
+    public  String getConvertedAmount(String objectType , String debitCreditCode, String amount) ;
+    
+    /**
      * throws an <code>IllegalStateException</code> if the document is an error correction. otherwise does nothing
      * 
      * @param rule
Index: work/src/org/kuali/kfs/sys/document/service/FinancialSystemDocumentService.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/service/FinancialSystemDocumentService.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/service/FinancialSystemDocumentService.java	(revision 37225)
@@ -17,6 +17,8 @@
 
 import java.util.Collection;
 
+import org.kuali.kfs.sys.businessobject.FinancialSystemDocumentHeader;
+import org.kuali.kfs.sys.document.FinancialSystemTransactionalDocument;
 import org.kuali.rice.kew.exception.WorkflowException;
 import org.kuali.rice.kns.document.Document;
 
@@ -26,5 +28,6 @@
 public interface FinancialSystemDocumentService {
 
     public <T extends Document> Collection<T> findByDocumentHeaderStatusCode(Class<T> clazz, String statusCode) throws WorkflowException;
+    public void prepareToCopy(FinancialSystemDocumentHeader oldDocumentHeader, FinancialSystemTransactionalDocument document);
 
 }
Index: work/src/org/kuali/kfs/sys/document/AccountingDocumentBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/AccountingDocumentBase.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/AccountingDocumentBase.java	(revision 37225)
@@ -14,13 +14,13 @@
  * limitations under the License.
  */
 package org.kuali.kfs.sys.document;
-
+import java.sql.Date;
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
-
+import org.kuali.kfs.coa.businessobject.AccountingPeriod;
 import org.apache.commons.lang.StringUtils;
 import org.kuali.kfs.sys.KFSConstants;
 import org.kuali.kfs.sys.businessobject.AccountingLine;
@@ -47,7 +47,9 @@
 import org.kuali.rice.kns.exception.ValidationException;
 import org.kuali.rice.kns.rule.event.KualiDocumentEvent;
 import org.kuali.rice.kns.service.DataDictionaryService;
+import org.kuali.rice.kns.service.DateTimeService;
 import org.kuali.rice.kns.util.KualiDecimal;
+import org.kuali.rice.kns.util.ObjectUtils;
 
 /**
  * Base implementation class for financial edocs.
@@ -718,4 +720,22 @@
     public Class<? extends AccountingDocument> getDocumentClassForAccountingLineValueAllowedValidation() {
         return this.getClass();
     }
+    
+    /**
+     * 
+     * @see org.kuali.kfs.sys.document.AccountingDocument#getAccountExpirationDocumentDate()
+     */
+    public Date getAccountExpirationDocumentDate() {
+        if(ObjectUtils.isNotNull(getDocumentHeader().getDocumentNumber())) {
+           if(getDocumentHeader().hasWorkflowDocument() && getDocumentHeader().getWorkflowDocument().getRouteHeader().getDateFinalized() != null) {
+               return new java.sql.Date(getDocumentHeader().getWorkflowDocument().getRouteHeader().getDateFinalized().getTime().getTime());
+           }
+           else {
+               return SpringContext.getBean(DateTimeService.class).getCurrentSqlDate();
+           }
+        }
+        
+        return SpringContext.getBean(DateTimeService.class).getCurrentSqlDate();
+     
+    }
 }
Index: work/src/org/kuali/kfs/sys/document/AccountingDocument.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/AccountingDocument.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/AccountingDocument.java	(revision 37225)
@@ -15,11 +15,13 @@
  */
 package org.kuali.kfs.sys.document;
 
+import java.sql.Date;
 import java.util.List;
 
 import org.kuali.kfs.sys.businessobject.AccountingLineParser;
 import org.kuali.kfs.sys.businessobject.SourceAccountingLine;
 import org.kuali.kfs.sys.businessobject.TargetAccountingLine;
+import org.kuali.rice.kns.document.TransactionalDocument;
 import org.kuali.rice.kns.util.KualiDecimal;
 
 /**
@@ -168,5 +170,12 @@
      * This method returns the Class to use for AccountingLingValuesAllowedValidation.
      */
     public Class<? extends AccountingDocument> getDocumentClassForAccountingLineValueAllowedValidation();
-
+       
+    /**
+     * 
+     * This method return document date to use for determineNeededOverrides validation.
+     * It return final date if document is finalized, otherwise current date 
+     * @return
+     */
+    public Date getAccountExpirationDocumentDate();
 }
Index: work/src/org/kuali/kfs/sys/document/workflow/FinancialSystemSearchableAttribute.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/workflow/FinancialSystemSearchableAttribute.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/workflow/FinancialSystemSearchableAttribute.java	(revision 37225)
@@ -114,16 +114,19 @@
             Field chartField = FieldUtils.getPropertyField(alClass, "chartOfAccountsCode", true);
             chartField.setFieldDataType(SearchableAttribute.DATA_TYPE_STRING);
             displayedFieldNames.add("chartOfAccountsCode");
+            chartField.setColumnVisible(false);
             LookupUtils.setFieldQuickfinder(alBusinessObject, "chartOfAccountsCode", chartField, displayedFieldNames);
             
             Field orgField = FieldUtils.getPropertyField(orgClass, "organizationCode", true);
             orgField.setFieldDataType(SearchableAttribute.DATA_TYPE_STRING);
             displayedFieldNames.clear();
+            chartField.setColumnVisible(false);
             displayedFieldNames.add("organizationCode");
             LookupUtils.setFieldQuickfinder(new Account(), "organizationCode", orgField, displayedFieldNames);
             
             Field accountField = FieldUtils.getPropertyField(alClass, "accountNumber", true);
             accountField.setFieldDataType(SearchableAttribute.DATA_TYPE_STRING);
+            accountField.setColumnVisible(false);
             displayedFieldNames.clear();
             displayedFieldNames.add("accountNumber");
             LookupUtils.setFieldQuickfinder(alBusinessObject, "accountNumber", accountField, displayedFieldNames);
Index: work/src/org/kuali/kfs/sys/document/web/AccountingLineTableRow.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/AccountingLineTableRow.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/AccountingLineTableRow.java	(revision 37225)
@@ -130,6 +130,17 @@
     }
     
     /**
+     * @return returns the number of cells which will actually be rendered (ie, colspans are taken into account)
+     */
+    public int getChildRenderableCount() {
+        int count = 0;
+        for (AccountingLineTableCell cell : cells) {
+            count += cell.getColSpan();
+        }
+        return count;
+    }
+    
+    /**
      * Dutifully appends the names of any fields it knows about to the given List of field names
      * @param fieldNames a List of field names to append other names to
      */
Index: work/src/org/kuali/kfs/sys/document/web/AccountingLineRenderingContext.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/AccountingLineRenderingContext.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/AccountingLineRenderingContext.java	(revision 37225)
@@ -25,7 +25,7 @@
 /**
  * A contract for classes which wish to provide information about an accounting line which is being rendered
  */
-public interface AccountingLineRenderingContext {
+public interface AccountingLineRenderingContext extends RenderableElement {
     
     /**
      * @return the accounting line that would be rendered by the rendering of the given accounting line context
@@ -143,4 +143,15 @@
      * Makes the line within this accounting line context deletable
      */
     public void makeDeletable();
+    
+    /**
+     * @return the number of cells that will actually be rendered (ie, colspans are taken into account)
+     */
+    public int getRenderableCellCount();
+    
+    /**
+     * Gets the rows attribute. 
+     * @return Returns the rows.
+     */
+    public List<AccountingLineTableRow> getRows();
 }
Index: work/src/org/kuali/kfs/sys/document/web/DefaultAccountingLineGroupImpl.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/DefaultAccountingLineGroupImpl.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/DefaultAccountingLineGroupImpl.java	(revision 37225)
@@ -43,7 +43,7 @@
     protected AccountingLineGroupDefinition groupDefinition;
     protected JspFragment importLineOverride;
     protected String collectionPropertyName;
-    protected List<RenderableAccountingLineContainer> containers;
+    protected List<? extends AccountingLineRenderingContext> containers;
     protected AccountingDocument accountingDocument;
     protected int cellCount = 0;
     protected int arbitrarilyHighIndex;
@@ -114,9 +114,9 @@
             return cellCount;
 
         int max = 0;
-        for (RenderableAccountingLineContainer line : containers) {
-            if (line.getCellCount() > max) {
-                max = line.getCellCount();
+        for (AccountingLineRenderingContext line : containers) {
+            if (line.getRenderableCellCount() > max) {
+                max = line.getRenderableCellCount();
             }
         }
         cellCount = max;
@@ -202,7 +202,7 @@
      * @throws JspException thrown if rendering goes badly
      */
     protected void renderAccountingLineContainers(PageContext pageContext, Tag parentTag) throws JspException {
-        for (RenderableAccountingLineContainer container : containers) {
+        for (AccountingLineRenderingContext container : containers) {
             container.populateValuesForFields();
             container.populateWithTabIndexIfRequested(arbitrarilyHighIndex);
             container.renderElement(pageContext, parentTag, container);
@@ -226,7 +226,7 @@
 
                 if (nestedFieldTotaling.isNestedProperty()) {
                     int index = groupTotals.indexOf(definition);
-                    RenderableAccountingLineContainer container = this.containers.get(index);
+                    AccountingLineRenderingContext container = this.containers.get(index);
                     String containingObjectPropertyName = container.getAccountingLineContainingObjectPropertyName();
                     nestedFieldTotaling.setContainingPropertyName(containingObjectPropertyName);
                 }
@@ -260,13 +260,15 @@
      * @return the column number of the tabel cell with the given property name in an accounting line table
      */
     protected int getRepresentedColumnNumber(String propertyName) {
-        for (RenderableAccountingLineContainer container : containers) {
+        for (AccountingLineRenderingContext container : containers) {
             List<AccountingLineTableRow> tableRows = container.getRows();
 
             for (AccountingLineTableRow row : tableRows) {
                 List<AccountingLineTableCell> tableCells = row.getCells();
+                int cumulativeDisplayCellCount = 0;
 
                 for (AccountingLineTableCell cell : tableCells) {
+                    cumulativeDisplayCellCount += cell.getColSpan();
                     List<RenderableElement> fields = cell.getRenderableElement();
 
                     for (RenderableElement field : fields) {
@@ -275,7 +277,7 @@
                         }
 
                         if (((ElementNamable) field).getName().equals(propertyName)) {
-                            return tableCells.indexOf(cell) + 1;
+                            return cumulativeDisplayCellCount;
                         }
                     }
                 }
Index: work/src/org/kuali/kfs/sys/document/web/struts/FinancialSystemTransactionalDocumentActionBase.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/struts/FinancialSystemTransactionalDocumentActionBase.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/struts/FinancialSystemTransactionalDocumentActionBase.java	(revision 37225)
@@ -23,9 +23,16 @@
 import org.apache.struts.action.ActionForm;
 import org.apache.struts.action.ActionForward;
 import org.apache.struts.action.ActionMapping;
+import org.kuali.kfs.sys.KFSConstants;
+import org.kuali.kfs.sys.context.SpringContext;
 import org.kuali.kfs.sys.document.Correctable;
+import org.kuali.kfs.sys.service.impl.KfsParameterConstants;
 import org.kuali.rice.core.util.RiceConstants;
 import org.kuali.rice.kns.document.Document;
+import org.kuali.rice.kns.service.KNSServiceLocator;
+import org.kuali.rice.kns.service.ParameterEvaluator;
+import org.kuali.rice.kns.service.ParameterServerService;
+import org.kuali.rice.kns.util.KNSConstants;
 import org.kuali.rice.kns.web.struts.action.KualiTransactionalDocumentActionBase;
 import org.kuali.rice.kns.web.struts.form.KualiTransactionalDocumentFormBase;
 import org.kuali.rice.kns.web.ui.ExtraButton;
@@ -34,6 +41,7 @@
  * This class...
  */
 public class FinancialSystemTransactionalDocumentActionBase extends KualiTransactionalDocumentActionBase {
+    public static final String MODULE_LOCKED_MESSAGE = "moduleLockedMessage";
 
     /**
      * This action method triggers a correct of the transactional document.
@@ -55,5 +63,45 @@
 
         return mapping.findForward(RiceConstants.MAPPING_BASIC);
     }
+    
+    @Override
+    /**
+     * KFSMI-4452
+     */
+    public ActionForward execute(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {
+        
+        
+        ActionForward returnForward =  super.execute(mapping, form, request, response);
+        if( isDocumentLocked(mapping, form, request)) {
+            return mapping.findForward(KFSConstants.DOCUMENT_LOCKED_MAPPING);
+        }
+        
+        return returnForward;
+        
+    }
+    
+    /**
+     * KFSMI-4452
+     */
+    protected boolean isDocumentLocked(ActionMapping mapping , ActionForm form, HttpServletRequest request) {
+        
+        KualiTransactionalDocumentFormBase tmpForm = (KualiTransactionalDocumentFormBase) form;
+        Document document = tmpForm.getDocument();
+        
+        boolean exists = SpringContext.getBean(ParameterServerService.class).parameterExists(document.getClass(),KFSConstants.DOCUMENT_LOCKOUT_PARM_NM );
+        if(exists) {
+            boolean documentLockedOut = SpringContext.getBean(ParameterServerService.class).getIndicatorParameter(document.getClass(),KFSConstants.DOCUMENT_LOCKOUT_PARM_NM );
+            if(documentLockedOut) {
+                if (tmpForm.getDocumentActions().containsKey(KNSConstants.KUALI_ACTION_CAN_EDIT)) {
+                  String message  = SpringContext.getBean(ParameterServerService.class).getParameterValue(KFSConstants.ParameterNamespaces.KFS, KfsParameterConstants.PARAMETER_ALL_DETAIL_TYPE, KFSConstants.DOCUMENT_LOCKOUT_DEFAULT_MESSAGE);
+                    request.setAttribute(MODULE_LOCKED_MESSAGE, message);
+                    return true;
+                }
+            }
+        }
+        
+         
+        return false;
+    }
 }
 
Index: work/src/org/kuali/kfs/sys/document/web/RenderableAccountingLineContainer.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/RenderableAccountingLineContainer.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/RenderableAccountingLineContainer.java	(revision 37225)
@@ -41,7 +41,7 @@
 /**
  * A container which holds a single accounting line and the elements which will render it
  */
-public class RenderableAccountingLineContainer implements RenderableElement, AccountingLineRenderingContext {
+public class RenderableAccountingLineContainer implements AccountingLineRenderingContext {
     private List<AccountingLineTableRow> rows;
     private List<AccountingLineViewAction> actions;
     private AccountingLine accountingLine;
@@ -145,6 +145,21 @@
     }
     
     /**
+     * Determines how many cells this container will say it wants to render
+     * @see org.kuali.kfs.sys.document.web.AccountingLineRenderingContext#getRenderableCellCount()
+     */
+    public int getRenderableCellCount() {
+        int maxCells = 0;
+        for (AccountingLineTableRow row : rows) {
+            final int maxRowCellCount = row.getChildRenderableCount();
+            if (maxCells < maxRowCellCount) {
+                maxCells = maxRowCellCount;
+            }
+        }
+        return maxCells;
+    }
+    
+    /**
      * Adds empty cells to a table row
      * @param cellCount the number of cells we should be rendering
      * @param row the row to pad out
Index: work/src/org/kuali/kfs/sys/document/web/renderers/ReadOnlyRenderer.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/renderers/ReadOnlyRenderer.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/renderers/ReadOnlyRenderer.java	(revision 37225)
@@ -106,9 +106,16 @@
         
         if (getField().getInquiryURL() instanceof AnchorHtmlData) {
             AnchorHtmlData htmlData = (AnchorHtmlData) getField().getInquiryURL();
-            beginInquiryLink.append("<a href=\"");
-            beginInquiryLink.append(SpringContext.getBean(KualiConfigurationService.class).getPropertyString(KFSConstants.APPLICATION_URL_KEY));
-            beginInquiryLink.append("/kr/");
+            
+            if(htmlData.getHref().startsWith("http")) {
+                beginInquiryLink.append("<a href=\"");
+            }
+            else {
+                beginInquiryLink.append("<a href=\"");
+                beginInquiryLink.append(SpringContext.getBean(KualiConfigurationService.class).getPropertyString(KFSConstants.APPLICATION_URL_KEY));
+                beginInquiryLink.append("/kr/");
+            }
+            
             beginInquiryLink.append(htmlData.getHref());
             beginInquiryLink.append("\" title=\"");
             beginInquiryLink.append(htmlData.getTitle());
Index: work/src/org/kuali/kfs/sys/document/web/renderers/TextAreaRenderer.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/renderers/TextAreaRenderer.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/renderers/TextAreaRenderer.java	(revision 37225)
@@ -54,7 +54,7 @@
         tag.setPageContext(pageContext);
         tag.setParent(parentTag);
         tag.setProperty(getFieldName());
-        tag.setValue(HtmlUtils.htmlEscape(getField().getPropertyValue()));
+        tag.setValue(getField().getPropertyValue());
         tag.setTitle(this.getAccessibleTitle());
         tag.setRows(Integer.toString(getField().getRows()));
         tag.setCols(Integer.toString(getField().getCols()));
Index: work/src/org/kuali/kfs/sys/document/web/renderers/DynamicNameLabelRenderer.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/renderers/DynamicNameLabelRenderer.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/renderers/DynamicNameLabelRenderer.java	(revision 37225)
@@ -79,7 +79,7 @@
         valuePersistingTag.setPageContext(pageContext);
         valuePersistingTag.setParent(parentTag);
         valuePersistingTag.setProperty(fieldName);
-        valuePersistingTag.setValue(HtmlUtils.htmlEscape(fieldValue));
+        valuePersistingTag.setValue(fieldValue);
         
         valuePersistingTag.doStartTag();
         valuePersistingTag.doEndTag();
Index: work/src/org/kuali/kfs/sys/document/web/renderers/HiddenRenderer.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/renderers/HiddenRenderer.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/renderers/HiddenRenderer.java	(revision 37225)
@@ -52,7 +52,7 @@
         if (getField().isSecure()) {
             tag.setValue(getField().getEncryptedValue());
         } else {
-            tag.setValue(HtmlUtils.htmlEscape(getField().getPropertyValue()));
+            tag.setValue(getField().getPropertyValue());
         }
         tag.setStyleId(getFieldName());
         tag.setWrite(false);
Index: work/src/org/kuali/kfs/sys/document/web/renderers/OverrideFieldRenderer.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/renderers/OverrideFieldRenderer.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/renderers/OverrideFieldRenderer.java	(revision 37225)
@@ -242,7 +242,7 @@
         if (!readOnly && overrideNeededValue.equals("No")) {
             overrideHiddenTag.setValue("No");
         } else {
-            overrideHiddenTag.setValue(HtmlUtils.htmlEscape(getField().getPropertyValue()));
+            overrideHiddenTag.setValue(getField().getPropertyValue());
         }
         overrideHiddenTag.doStartTag();
         overrideHiddenTag.doEndTag();
@@ -273,7 +273,7 @@
         overrideNeededTag.setPageContext(pageContext);
         overrideNeededTag.setParent(parentTag);
         overrideNeededTag.setProperty(overrideNeededProperty);
-        overrideNeededTag.setValue(HtmlUtils.htmlEscape(overrideNeededValue));
+        overrideNeededTag.setValue(overrideNeededValue);
         overrideNeededTag.doStartTag();
         overrideNeededTag.doEndTag();
     }
Index: work/src/org/kuali/kfs/sys/document/web/renderers/TextRenderer.java
===================================================================
--- work/src/org/kuali/kfs/sys/document/web/renderers/TextRenderer.java	(revision 30259)
+++ work/src/org/kuali/kfs/sys/document/web/renderers/TextRenderer.java	(revision 37225)
@@ -65,7 +65,7 @@
         }
         tag.setStyleClass(getField().getStyleClass());
 
-        tag.setValue(HtmlUtils.htmlEscape(getField().getPropertyValue()));
+        tag.setValue(getField().getPropertyValue());
         tag.setStyleId(getFieldName());
         
         tag.doStartTag();
Index: work/src/ApplicationResources.properties
===================================================================
--- work/src/ApplicationResources.properties	(revision 30259)
+++ work/src/ApplicationResources.properties	(revision 37225)
@@ -38,6 +38,7 @@
 
 # Format Type Messages
 error.zeroAmount="0.00" amounts are not allowed for {0}, and lines with 0.00 have been removed.
+error.blankAmount="The amount field is blank. Please enter valid amount."
 
 error.authorization.contractManagerAssignmentInitiation=Contract Manager Assignment Document cannot be initiated because there are no Requisitions awaiting contract manager assignment. 
 
@@ -347,7 +348,9 @@
 
 # C&G
 message.inquiry.award.title=View Award
+salary.transfer.fringe.benefit.inquiry.label=View
 
+
 # Help Text
 lookupHelpText=<font size\=+1><b>Lookup Help</b></font><br><br> <b>Specifying search criteria\:</b><br> <ol><li>Most fields will be uppercased for search.</li> <li>Dates should be specified as MM/dd/yyyy.</li> <li>Some fields have magnifying glass button for a sub lookup on that field.</li> <li>Wildcards allowed on strings are * and % match any number of characters, while using a ? will match any one character</li> <li>Logical operators allowed include && (And) as well as | (Or) to join multiple search criteria</li> <li>Range operators allowed on numerics and dates are >,<,>\=,<\=, or ..<br> All operators except .. should be before date value. Operator .. should <br> separate date values.</li>  </ol> <b>Result Table\:</b> <ol><li>Each result field has link on header for sorting. Click once to sort ascending, <br> and click again to sort descending.</li> <li>Some row fields have links to inquiry. The inquiry will be presented in a new window. </li> <li>Click the return value link to select a row and return the key value to the previous page.<br> Select 'return with no value' or click the cancel button if you wish to return without returning a value.</li> </ol> <b>Maintenance Links\:</b> <ol> <li>The 'create new' link on the upper left corner of the lookup screen will <br> go to a maintenance document for creating a new record for this lookup type.</li> <li>For each result row the action column displays edit and copy links. The 'edit' link <br> will go to a maintenance document for editing the current record. The 'copy' link <br> will go to a new maintenance document but copy over attributes over the current record.</li>  </ol> <b>Export Functionality\:</b> <ol> <li>At the end of each result set, there are links for exporting the data to a different format.</li> <li>Click 'csv' to export the data as a comma delimited file, 'spreadsheet' to export the data as a spreadsheet,<br> or 'xml' to export the data as xml.</li> </ol> <br> 
 label.document.disbursementVoucher.printCoverSheet=Print Disbursement Voucher Coversheet
@@ -483,6 +486,9 @@
 
 question.dv.clearUnneededTab=The {0} for this disbursement voucher is {1}.  The {2} tab should not contain data if the {0} is not {3}.  Would you like to clear the tab?  Press YES to clear the tab and continue routing.  Press NO to return to the document for further editing.
 
+message.dv.immediateExtractEmail.subject=Immediate print {0} for {1} campus sent to PDP
+message.dv.immediateExtractEmail.body=KFS {0} document {2} for {1} campus has been sent to PDP for immediate print. Please either wait for the next scheduled PDP load, or use the KFS batch schedule lookup if the check is needed more quickly.
+
 #ElectronicPaymentClaims
 error.bo.eft.no.chosen.claiming.doctype=Please select a document type with which to claim the selected Electronic Payment records.
 error.bo.eft.pre.claiming.document.does.not.exist=Document #{0}, which is listed as having claimed electronic payment records, does not exist.  Please choose an existing document as the pre-claiming document.
@@ -637,6 +643,8 @@
 error.check.deleteRule= Unable to delete check line {0}
 error.document.cashReceipt.negativeCheckAmount=Negative check amounts are not allowed.  The Cash Receipt document cannot be used to correct Cash Receipts because corrections do not need to go through the verification unit. To correct a Cash Receipt, complete an Advance Deposit.
 error.document.cashReceipt.zeroCheckAmount=Zero check amounts are not allowed.
+error.document.cashReceipt.incorrectConfirmedTotal = The cash manager confirmed total is not equal to the old document total "{0}". 
+error.document.cashReceipt.invalidChangeRequest = The change request cannot be granted because cash drawer does not contain requested currency/coin count. 
 
 error.document.cashReceipt.invalidTotal={0} must not exceed exceed $99,999,999,999,999,999.99
 error.document.cashReceipt.negativeTotal={0} must be non-negative.
@@ -1030,6 +1038,7 @@
 warning.purchaseOrder.pendingAction=Warning: There is a pending action on this Purchase Order.
 warning.purchaseOrder.allNotes=Warning: This includes all notes on the PO, not just up to this document.
 warning.purchaseOrderTotalLimit=Warning: The Purchase Order Total Amount should not normally be greater than the Purchase Order Total Limit.
+warning.debarred.vendor={0} is currently debarred and may not be eligible for this requisition.  If you choose to continue with this vendor please provide a justification.
 error.invalidContractManagerCode={0} is not a valid contract manager code.
 error.apoContractManagerCodeChosen=The contract manager code used for automatic purchase orders, {0}, cannot be manually assigned to a purchase order.
 error.noContractManagerAssigned=No requisition has been assigned to a valid contract manager, either make an assignment or cancel the document.
@@ -1177,6 +1186,7 @@
 creditMemo.question.hold.text=A note is required to place a Credit Memo on hold.
 creditMemo.question.cancel.text=A note is required to cancel a Credit Memo.
 creditMemo.question.removeHold.text=A note is required to remove hold on a Credit Memo.
+errors.creditMemo.attachmentRequired=An credit memo must be attached to proceed
 
 # Receiving Line
 errors.receivingLine.documentActiveForPo=Cannot create document, an existing Receiving Document (ID {0}) is in process for Purchase Order (ID {1})
@@ -1189,6 +1199,7 @@
 message.duplicate.receivingLine.billOfLadingNumber=Bill of Lading Number already exists[br]
 message.receiving.lineitem.return=quantity(ies) returned for the item at line number  
 message.receiving.lineitem.damage=quantity(ies) damaged for the item at line number 
+warning.receiving.lineitem.add.unordered=This action will add new line items to the Purchase Order. These new line items are in addition to the other items on this Purchase Order. Do you want to continue?
 errors.receivingLine.quantityReturnedGreaterThanQuantityReceived=Cannot specify Quantity Returned that is greater than Quantity Received for line {0}.
 errors.receivingLine.quantityDamagedGreaterThanQuantityReceived=Cannot specify Quantity Damaged that is greater than Quantity Received for line {0}.
 
@@ -1530,6 +1541,7 @@
 message.batchUpload.title.enterprise.feeder=Enterprise Feeder Batch Upload
 message.batchUpload.title.labor.enterprise.feeder=Labor Enterprise Feeder Batch Upload
 message.batchUpload.title.einvoice=Electronic Invoice Batch Upload
+message.batchUpload.title.vendor.exclude=Vendor Exclude Batch Upload
 message.batchUpload.saveSuccessful=File was successfully saved
 error.batchUpload.deleteFailed.fileAlreadyProcessed=File could not be deleted because the file has already been processed.
 error.batchUpload.deleteFailed.fileSetAlreadyProcessed=Files could not be deleted because the file set has already been processed.
@@ -2190,7 +2202,7 @@
 error.asset.payment.account.not.valid = Payment account {0}/{1} is not valid.
 error.document.min.one.asset.required = At least one asset record should be configured.  Click on the Add button to configure asset.
 error.document.min.one.payment.required = At least one asset payment should be entered for capital asset.
-error.capital.asset.manufacturer.name.required = Manufacturer name is a required for capital assets.
+error.capital.asset.manufacturer.name.required = Manufacturer name is a required field for capital assets.
 error.acquisition.code.not.allowed = Current user can not use acquisition type code {0}.
 error.inactive.acquisition.code = The selected acquisition type code {0} is not active and cannot be used on asset.
 #*********************************************
@@ -2309,6 +2321,7 @@
 message.batch.balancing.record.failed.balancing=Failed %s balancing
 message.batch.balancing.report.unknown.label=<Unknown Label>
 message.batch.balancing.history.purged=History tables purged.
+message.batch.balancing.file.listing=Files for history table update:\n%s
 message.ld.balancing.report.entry.label=LLEN
 message.ld.balancing.report.balance.label=LLBL
 message.gl.balancing.report.entry.label=GLEN
@@ -2599,4 +2612,15 @@
 error.kc.document.workflowException.document.actions=WorkflowException: Document workflow actions like save or submit or blanket approve failed because 
 error.kc.document.workflowException.unableToCreateDocument=WorkflowException: Unable to create a new document for CG Account creation because
 error.kc.document.workflowException.unableToSaveDocument=WorkflowException: Unable to save a failed document for CG Account creation because
-error.kc.document.system.parameter.incorrect.document.action.value=The system parameter value for ACCOUNT_AUTO_CREATE_ROUTE should be either Save or Submit or BlanketApprove.
\ No newline at end of file
+error.kc.document.system.parameter.incorrect.document.action.value=The system parameter value for ACCOUNT_AUTO_CREATE_ROUTE should be either Save or Submit or BlanketApprove.
+
+# FlatFileProcessor
+default.flatFile.dateFormat=yyMMdd
+
+# BatchContainer
+message.sys.batch.semaphore.upload.title.error=Batch Error Semaphore File Upload
+message.sys.batch.sempahore.upload.title.success=Batch Success Semaphore File Upload
+message.sys.batch.semaphore.upload.title.run=Batch Run Semaphore File Upload
+message.sys.batch.semaphore.upload.title.runlock=Batch Container Start Semaphore File Upload
+error.sys.batch.semaphore.upload.invalidStep=The first line of the file should contain a job name and a valid Step name in the format [jobName]~[stepName]
+error.sys.batch.semaphore.upload.deleteDoneFile=An error occurred while attempting to remove the done file
\ No newline at end of file
Index: work/web-root/WEB-INF/struts-config.xml
===================================================================
--- work/web-root/WEB-INF/struts-config.xml	(revision 30259)
+++ work/web-root/WEB-INF/struts-config.xml	(revision 37225)
@@ -125,6 +125,10 @@
 			type="org.kuali.kfs.module.ld.document.web.struts.LaborCorrectionForm" />
 		<form-bean name="LaborYearEndBenefitExpenseTransferForm"
 			type="org.kuali.kfs.module.ld.document.web.struts.YearEndBenefitExpenseTransferForm" />
+		<form-bean name="FringeBenefitInquiryForm"
+			type="org.kuali.kfs.module.ld.document.web.struts.FringeBenefitInquiryForm" />
+		<form-bean name="LaborGLLaborEntrySummarizationInquiryForm"
+			type="org.kuali.kfs.module.ld.web.struts.GLLaborEntrySummarizationInquiryForm"/>
 
 		<!-- Budget Construction Bean Definitions -->
 		<form-bean name="BudgetConstructionSelectionForm"
@@ -256,7 +260,11 @@
 		<form-bean name="GLToEndowmentTransferOfFundsDocumentForm"
 			type="org.kuali.kfs.module.endow.document.web.struts.GLToEndowmentTransferOfFundsDocumentForm" />
         <form-bean name="CorporateReorganizationDocumentForm"
-            type="org.kuali.kfs.module.endow.document.web.struts.CorporateReorganizationDocumentForm" />       			
+            type="org.kuali.kfs.module.endow.document.web.struts.CorporateReorganizationDocumentForm" />    
+            
+        <!-- VND Module Bean Definitions -->
+	    <form-bean name="VendorExclusionForm"
+			type="org.kuali.kfs.vnd.web.struts.VendorExclusionForm" />       			
 	</form-beans>
 
 	<global-exceptions>
@@ -551,7 +559,22 @@
 			<forward name="basic"
 				path="/jsp/sys/KualiBatchInputFileSet.jsp" />
 		</action>
-
+		
+		<action path="/fringeBenefitInquiry" name="FringeBenefitInquiryForm"
+			type="org.kuali.kfs.module.ld.document.web.struts.FringeBenefitInquiryAction"
+			scope="session" parameter="methodToCall" validate="true"
+			attribute="KualiForm">
+			<set-property property="cancellable" value="true" />
+			<forward name="basic" path="/jsp/module/ld/FringeBenefitInquiry.jsp" />
+		</action>
+		
+		<action path="/laborGLLaborEntrySummarizationInquiry" name="LaborGLLaborEntrySummarizationInquiryForm"
+			type="org.kuali.kfs.module.ld.web.struts.GLLaborEntrySummarizationInquiryAction"
+			scope="request" attribute="KualiForm" parameter="methodToCall">
+			<set-property property="cancellable" value="true" />
+			<forward name="basic" path="/jsp/module/ld/GLLaborEntrySummarizationInquiry.jsp" />
+		</action>
+	
 		<action path="/budget*" name="{1}Form"
 			input="/jsp/module/bc/{1}.jsp"
 			type="org.kuali.kfs.module.bc.document.web.struts.{1}Action"
@@ -648,8 +671,9 @@
 			type="org.kuali.kfs.module.purap.document.web.struts.PrintAction"
 			scope="request" />
 
-		<action path="/purapElectronicInvoiceTest"
+		<action path="/purapElectronicInvoiceTestFileGeneration"
 			name="ElectronicInvoiceTestForm"
+			attribute="KualiForm" 
 			input="/jsp/module/purap/ElectronicInvoiceTest.jsp"
 			type="org.kuali.kfs.module.purap.document.web.struts.ElectronicInvoiceTestAction"
 			scope="request">
@@ -742,11 +766,19 @@
 			<forward name="continue" path="/jsp/pdp/format/formatContinue.jsp" />
 		</action>
 		
+		<!-- These are VND items -->
+		
+		<action path="/vendorExclusion" 
+			type="org.kuali.kfs.vnd.web.struts.VendorExclusionAction"
+			name="VendorExclusionForm"
+			scope="request" parameter="methodToCall" validate="false"
+			attribute="KualiForm" />
+		
 	</action-mappings>
 
 	<controller
 		processorClass="org.kuali.rice.kns.web.struts.action.KualiRequestProcessor"
-		maxFileSize="5M" />
+		maxFileSize="30M" />
 		
     <message-resources factory="org.kuali.rice.kns.web.struts.action.KualiPropertyMessageResourcesFactory" parameter="" />
 
Index: work/web-root/WEB-INF/tags/portal/administrationTab.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/administrationTab.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/administrationTab.tag	(revision 37225)
@@ -21,7 +21,6 @@
 </td>
 <td class="content" valign="top">
       <admininstrationChannel:configuration />
-      <admininstrationChannel:testing />
 </td>
 <td class="content" valign="top">
       <admininstrationChannel:batch />
Index: work/web-root/WEB-INF/tags/portal/channel/maintenance/chartOfAccounts.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/maintenance/chartOfAccounts.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/maintenance/chartOfAccounts.tag	(revision 37225)
@@ -26,6 +26,7 @@
         <li><portal:portalLink displayTitle="true" title="Budget Aggregation Code" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.coa.businessobject.BudgetAggregationCode&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
         <li><portal:portalLink displayTitle="true" title="Budget Recording Level" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.coa.businessobject.BudgetRecordingLevel&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>        
 		<li><portal:portalLink displayTitle="true" title="CG Account Default" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.module.external.kc.businessobject.AccountAutoCreateDefaults&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
+		<li><portal:portalLink displayTitle="true" title="CFDA"	url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.coa.businessobject.CFDA&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
         <li><portal:portalLink displayTitle="true" title="Chart" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.coa.businessobject.Chart&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>	    
 		<li><portal:portalLink displayTitle="true" title="Federal Function" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.coa.businessobject.FederalFunction&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>				
         <li><portal:portalLink displayTitle="true" title="Federal Funded Code" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.coa.businessobject.FederalFundedCode&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
Index: work/web-root/WEB-INF/tags/portal/channel/maintenance/capitalAsset.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/maintenance/capitalAsset.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/maintenance/capitalAsset.tag	(revision 37225)
@@ -68,6 +68,11 @@
 				title="Asset Type"
 				url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.module.cam.businessobject.AssetType&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" />
 		</li>
+		<li>
+			<portal:portalLink displayTitle="true"
+				title="Asset Payment Document Type"
+				url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.module.cam.businessobject.AssetPaymentDocumentType&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" />
+		</li>
 	</ul>
 </div>
 <channel:portalChannelBottom />
Index: work/web-root/WEB-INF/tags/portal/channel/maintenance/vendor.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/maintenance/vendor.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/maintenance/vendor.tag	(revision 37225)
@@ -33,7 +33,9 @@
         <li><portal:portalLink displayTitle="true" title="Shipping Title" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.vnd.businessobject.ShippingTitle&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
         <li><portal:portalLink displayTitle="true" title="Supplier Diversity" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.vnd.businessobject.SupplierDiversity&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
         <li><portal:portalLink displayTitle="true" title="Vendor Inactive Reason" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.vnd.businessobject.VendorInactiveReason&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>     
-        <li><portal:portalLink displayTitle="true" title="Vendor Type" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.vnd.businessobject.VendorType&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>     
+        <li><portal:portalLink displayTitle="true" title="Vendor Type" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.vnd.businessobject.VendorType&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
+        <li><portal:portalLink displayTitle="true" title="Vendor Exclusion" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.vnd.businessobject.DebarredVendorMatch&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
+        <li><portal:portalLink displayTitle="true" title="Vendor Exclusion Debarred Unmatched" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.vnd.businessobject.DebarredUnmatchedVendor&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>     
     </ul>
 </div>
 <channel:portalChannelBottom />
Index: work/web-root/WEB-INF/tags/portal/channel/maintenance/financialProcessing.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/maintenance/financialProcessing.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/maintenance/financialProcessing.tag	(revision 37225)
@@ -32,6 +32,7 @@
 		<li><portal:portalLink displayTitle="true" title="Fiscal Year Function Control" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.fp.businessobject.FiscalYearFunctionControl&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>				
 		<li><portal:portalLink displayTitle="true" title="Function Control Code" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.fp.businessobject.FunctionControlCode&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>				
         <li><portal:portalLink displayTitle="true" title="Non-Resident Alien Tax Percent" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.fp.businessobject.NonResidentAlienTaxPercent&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
+		<li><portal:portalLink displayTitle="true" title="Procurement Card Defaults" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.fp.businessobject.ProcurementCardDefault&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" />
    </ul>
 </div>
 <channel:portalChannelBottom />
Index: work/web-root/WEB-INF/tags/portal/channel/maintenance/contractsAndGrants.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/maintenance/contractsAndGrants.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/maintenance/contractsAndGrants.tag	(revision 37225)
@@ -31,13 +31,6 @@
 			<portal:portalLink displayTitle="true" title="Award Status"
 				url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.module.cg.businessobject.AwardStatus&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" />
 		</li>
-				
-		<li>
-			<portal:portalLink displayTitle="true" title="CFDA"
-				url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.module.cg.businessobject.CFDA&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" />
-		</li>
-		
-		
 	
 		<li>
 			<portal:portalLink displayTitle="true" title="Grant Description"
Index: work/web-root/WEB-INF/tags/portal/channel/main/lookupAndMaintenance.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/main/lookupAndMaintenance.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/main/lookupAndMaintenance.tag	(revision 37225)
@@ -1,5 +1,5 @@
 <%--
- Copyright 2007 The Kuali Foundation
+ Copyright 2007 The Kuali Foundation
  
  Licensed under the Educational Community License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
Index: work/web-root/WEB-INF/tags/portal/channel/administration/testing.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/administration/testing.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/administration/testing.tag	(revision 37225)
@@ -1,29 +0,0 @@
-<%--
- Copyright 2007-2009 The Kuali Foundation
- 
- Licensed under the Educational Community License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
- 
- http://www.opensource.org/licenses/ecl2.php
- 
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
---%>
-<%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
-
-<channel:portalChannelTop channelTitle="Testing" />
-<div class="body">
-    <c:if test="${!KualiConfigurationService.isProductionEnvironment}">
-        <!-- THIS FUNCTIONALITY SHOULD ONLY BE AVAILABLE IN TEST ENVIRONMENTS -->
-		<strong>Electronic Invoice</strong><br/>
-	    <ul class="chan">
-			<li><portal:portalLink displayTitle="true" title="Generate/Upload eInvoice Files" url="purapElectronicInvoiceTest.do" /></li>				
-		</ul>
-    </c:if>
-</div>
-<channel:portalChannelBottom />
-                
Index: work/web-root/WEB-INF/tags/portal/channel/administration/batch.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/channel/administration/batch.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/channel/administration/batch.tag	(revision 37225)
@@ -1,5 +1,5 @@
 <%--
- Copyright 2007 The Kuali Foundation
+ Copyright 2007 The Kuali Foundation
  
  Licensed under the Educational Community License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
@@ -19,7 +19,7 @@
 <div class="body">
 	<strong>Accounts Receivable</strong><br/>
     <ul class="chan">
-		<li><portal:portalLink displayTitle="true" title="Customer Upload" url="batchUpload.do?methodToCall=start&batchUpload.batchInputTypeName=customerLoadInputFileType" /></li>				
+		<li><portal:portalLink displayTitle="true" title="Customer Upload" url="batchUpload.do?methodToCall=start&batchUpload.batchInputTypeName=customerLoadInputFileType" /></li>
 	</ul>
 	<strong>Financial Processing</strong><br/>
     <ul class="chan">
@@ -32,8 +32,20 @@
 		<li><portal:portalLink displayTitle="true" title="Enterprise Feed Upload" url="batchUploadFileSet.do?methodToCall=start&batchUpload.batchInputTypeName=enterpriseFeederFileSetType" /></li>
 		<li><portal:portalLink displayTitle="true" title="Labor Enterprise Feed Upload" url="laborBatchUploadFileSet.do?methodToCall=start&batchUpload.batchInputTypeName=laborEnterpriseFeederFileSetType" /></li>
 	</ul>
+	<strong>Purchasing/Accounts Payable</strong><br/>
+    <ul class="chan">
+	    <li><portal:portalLink displayTitle="true" title="Electronic Invoice Upload" url="batchUpload.do?methodToCall=start&batchUpload.batchInputTypeName=electronicInvoiceInputFileType" /></li>
+    	<c:if test="${!KualiConfigurationService.isProductionEnvironment}">
+		<li><portal:portalLink displayTitle="true" title="Electronic Invoice Test File Generation" url="purapElectronicInvoiceTestFileGeneration.do" /></li>				
+	    </c:if>
+	</ul>
+	<strong>Vendor</strong><br/>
+	<ul class="chan">
+	    <li><portal:portalLink displayTitle="true" title="Vendor Exclusion Upload" url="batchUpload.do?methodToCall=start&batchUpload.batchInputTypeName=vendorExcludeInputFileType" /></li>
+	</ul>
 	<strong>System</strong><br/>
     <ul class="chan">
+        <li><portal:portalLink displayTitle="true" title="Batch Semaphore File Upload" url="batchUpload.do?methodToCall=start&batchUpload.batchInputTypeName=semaphoreInputFileTypeError" /></li>
     	<li><portal:portalLink displayTitle="true" title="Batch File" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.sys.batch.BatchFile&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true" /></li>
 		<li><portal:portalLink displayTitle="true" title="Schedule" url="kr/lookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.sys.batch.BatchJobStatus&docFormKey=88888888&returnLocation=${ConfigProperties.application.url}/portal.do&hideReturnLink=true&conversionFields=name:name,group:group" /></li>
 		<li><portal:portalLink displayTitle="true" title="Special Batch File Upload" url="batchFileUpload" /></li>
Index: work/web-root/WEB-INF/tags/portal/portalBody.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/portalBody.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/portalBody.tag	(revision 37225)
@@ -24,9 +24,6 @@
 <%-- first try to check if they are focusing in --%>
 <c:choose>
   <c:when test='${!empty channelTitle && !empty channelUrl}'>
-	  <c:if test="${!empty param.backdoorId}">
-	  	<c:set var="channelUrl" value="${channelUrl}?backdoorId=${param.backdoorId}&methodToCall.login=1"/>
-	  </c:if>
 	  <div id="iframe_portlet_container_div">
 	  	<portal:iframePortletContainer channelTitle="${channelTitle}" channelUrl="${channelUrl}" />
 	  </div>
Index: work/web-root/WEB-INF/tags/portal/portalLink.tag
===================================================================
--- work/web-root/WEB-INF/tags/portal/portalLink.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/portal/portalLink.tag	(revision 37225)
@@ -20,9 +20,22 @@
 <%@ attribute name="displayTitle" required="false" %>
 <%@ attribute name="prefix" required="false" %>
 
+<c:set var="backdoorMainUrlAddition" value="" />
+<c:if test="${UserSession.backdoorInUse}">
+	<c:choose>
+	<c:when test="${fn:contains(url,'?')}">
+			<c:set var="backdoorMainUrlAddition" value="&backdoorId=${UserSession.principalName}" />
+		</c:when>
+		<c:otherwise>
+			<c:set var="backdoorMainUrlAddition" value="?backdoorId=${UserSession.principalName}" />
+		</c:otherwise>
+	</c:choose>
+</c:if>
+
+
 <c:if test="${displayTitle}" >
-  <a class="portal_link" href="${prefix}portal.do?channelTitle=${title}&channelUrl=${url}"  title="${title}">${title}</a>
+  <a class="portal_link" href="${prefix}portal.do?channelTitle=${title}&channelUrl=${url}${backdoorMainUrlAddition}"  title="${title}">${title}</a>
 </c:if>
 <c:if test="${! displayTitle}" >
-  <a class="portal_link" href="${prefix}portal.do?channelTitle=${title}&channelUrl=${url}" title="${title}"><jsp:doBody/></a>
+  <a class="portal_link" href="${prefix}portal.do?channelTitle=${title}&channelUrl=${url}${backdoorMainUrlAddition}" title="${title}"><jsp:doBody/></a>
 </c:if>
Index: work/web-root/WEB-INF/tags/fp/dvPayment.tag
===================================================================
--- work/web-root/WEB-INF/tags/fp/dvPayment.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/fp/dvPayment.tag	(revision 37225)
@@ -198,7 +198,18 @@
                    <kul:htmlAttributeLabel attributeEntry="${dvAttributes.disbExcptAttachedIndicator}"/>
                    <kul:htmlControlAttribute attributeEntry="${dvAttributes.disbExcptAttachedIndicator}" property="document.disbExcptAttachedIndicator" readOnly="true"/><br>          
                  </c:otherwise>
-				</c:choose>                 
+				</c:choose>     
+
+				<c:choose>
+                 <c:when test="${immediateDisbursementEntryMode}">        
+                   <kul:htmlControlAttribute attributeEntry="${dvAttributes.immediatePaymentIndicator}" property="document.immediatePaymentIndicator" readOnly="false"/>
+                   <kul:htmlAttributeLabel attributeEntry="${dvAttributes.immediatePaymentIndicator}" noColon="true" /><br>
+                 </c:when>
+                 <c:otherwise>
+                   <kul:htmlAttributeLabel attributeEntry="${dvAttributes.immediatePaymentIndicator}"/>
+                   <kul:htmlControlAttribute attributeEntry="${dvAttributes.immediatePaymentIndicator}" property="document.immediatePaymentIndicator" readOnly="true"/><br>          
+                 </c:otherwise>
+				</c:choose>
                  </td>
             </tr>
             
Index: work/web-root/WEB-INF/tags/fp/currencyCoinLine.tag
===================================================================
--- work/web-root/WEB-INF/tags/fp/currencyCoinLine.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/fp/currencyCoinLine.tag	(revision 37225)
@@ -17,24 +17,49 @@
 
 <%@ attribute name="currencyProperty" required="true" %>
 <%@ attribute name="coinProperty" required="true" %>
+<%@ attribute name="confirmedCurrencyProperty" required="false" %>
+<%@ attribute name="confirmedCoinProperty" required="false" %>
 <%@ attribute name="readOnly" required="false" %>
 <%@ attribute name="editingMode" required="false" type="java.util.Map" %>
+<%@ attribute name="confirmMode" required="false" %>
+<%@ attribute name="totalChangeAmount" required="false" %>
 
 <c:if test="${!readOnly && !empty editingMode}">
   <c:set var="readOnly" value="${!KualiForm.documentActions[Constants.KUALI_ACTION_CAN_EDIT]}" />
 </c:if>
 
+<c:if test="${!empty totalChangeAmount}">
+	<c:set var="changeMode" value="True" />
+</c:if>
 <c:set var="currencyAttributes" value="${DataDictionary.CurrencyDetail.attributes}" />
 <c:set var="coinAttributes" value="${DataDictionary.CoinDetail.attributes}" />
 
       <table border="0" cellspacing="0" cellpadding="0" class="datatable" width="100%">
+        <c:if test="${confirmMode && !changeMode}">
+          <tr>
+          	<th>&nbsp;</th>
+          	<th colspan="2">Original</th>
+          	<th colspan="2">Cash Manager</th>
+          	<th>&nbsp;</th>
+          	<th colspan="2">Original</th>
+          	<th colspan="2">Cash Manager</th>
+          </tr>
+        </c:if>
         <tr>
           <th>&nbsp;</th>
           <th>Count</th>
           <th>Amount</th>
+          <c:if test="${confirmMode && !changeMode }">
+          	<th>Count</th>
+          	<th>Amount</th>
+          </c:if>
           <th>&nbsp;</th>
           <th>Count</th>
           <th>Amount</th>
+          <c:if test="${confirmMode && !changeMode}">
+          	<th>Count</th>
+          	<th>Amount</th>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -44,13 +69,25 @@
             <kul:htmlControlAttribute property="${currencyProperty}.hundredDollarCount" attributeEntry="${currencyAttributes.hundredDollarCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${currencyProperty}.financialDocumentHundredDollarAmount.span">$<bean:write name="KualiForm" property="${currencyProperty}.financialDocumentHundredDollarAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
           <td>
+            <kul:htmlControlAttribute property="${confirmedCurrencyProperty}.hundredDollarCount" attributeEntry="${currencyAttributes.hundredDollarCount}" />
+          </td>
+          <td><span id="${confirmedCurrencyProperty}.financialDocumentHundredDollarAmount.span">$<bean:write name="KualiForm" property="${confirmedCurrencyProperty}.financialDocumentHundredDollarAmount" /></span></td>
+          </c:if>
+          <td>
             <kul:htmlAttributeLabel labelFor="${coinProperty}.hundredCentCount" attributeEntry="${coinAttributes.hundredCentCount}" />
           </td>
           <td>
             <kul:htmlControlAttribute property="${coinProperty}.hundredCentCount" attributeEntry="${coinAttributes.hundredCentCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${coinProperty}.financialDocumentHundredCentAmount.span">$<bean:write name="KualiForm" property="${coinProperty}.financialDocumentHundredCentAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>
+            <kul:htmlControlAttribute property="${confirmedCoinProperty}.hundredCentCount" attributeEntry="${coinAttributes.hundredCentCount}" />
+          </td>
+          <td><span id="${confirmedCoinProperty}.financialDocumentHundredCentAmount.span">$<bean:write name="KualiForm" property="${confirmedCoinProperty}.financialDocumentHundredCentAmount" /></span></td>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -60,13 +97,25 @@
             <kul:htmlControlAttribute property="${currencyProperty}.fiftyDollarCount" attributeEntry="${currencyAttributes.fiftyDollarCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${currencyProperty}.financialDocumentFiftyDollarAmount.span">$<bean:write name="KualiForm" property="${currencyProperty}.financialDocumentFiftyDollarAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
           <td>
+            <kul:htmlControlAttribute property="${confirmedCurrencyProperty}.fiftyDollarCount" attributeEntry="${currencyAttributes.fiftyDollarCount}" />
+          </td>
+          <td><span id="${confirmedCurrencyProperty}.financialDocumentFiftyDollarAmount.span">$<bean:write name="KualiForm" property="${confirmedCurrencyProperty}.financialDocumentFiftyDollarAmount" /></span></td>
+          </c:if>
+          <td>
             <kul:htmlAttributeLabel labelFor="${coinProperty}.fiftyCentCount" attributeEntry="${coinAttributes.fiftyCentCount}" />
           </td>
           <td>
             <kul:htmlControlAttribute property="${coinProperty}.fiftyCentCount" attributeEntry="${coinAttributes.fiftyCentCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${coinProperty}.financialDocumentFiftyCentAmount.span">$<bean:write name="KualiForm" property="${coinProperty}.financialDocumentFiftyCentAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>
+            <kul:htmlControlAttribute property="${confirmedCoinProperty}.fiftyCentCount" attributeEntry="${coinAttributes.fiftyCentCount}" />
+          </td>
+          <td><span id="${confirmedCoinProperty}.financialDocumentFiftyCentAmount.span">$<bean:write name="KualiForm" property="${confirmedCoinProperty}.financialDocumentFiftyCentAmount" /></span></td>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -76,13 +125,25 @@
             <kul:htmlControlAttribute property="${currencyProperty}.twentyDollarCount" attributeEntry="${currencyAttributes.twentyDollarCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${currencyProperty}.financialDocumentTwentyDollarAmount.span">$<bean:write name="KualiForm" property="${currencyProperty}.financialDocumentTwentyDollarAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
           <td>
+            <kul:htmlControlAttribute property="${confirmedCurrencyProperty}.twentyDollarCount" attributeEntry="${currencyAttributes.twentyDollarCount}" />
+          </td>
+          <td><span id="${confirmedCurrencyProperty}.financialDocumentTwentyDollarAmount.span">$<bean:write name="KualiForm" property="${confirmedCurrencyProperty}.financialDocumentTwentyDollarAmount" /></span></td>
+          </c:if>
+          <td>
             <kul:htmlAttributeLabel labelFor="${coinProperty}.twentyFiveCentCount" attributeEntry="${coinAttributes.twentyFiveCentCount}" />
           </td>
           <td>
             <kul:htmlControlAttribute property="${coinProperty}.twentyFiveCentCount" attributeEntry="${coinAttributes.twentyFiveCentCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${coinProperty}.financialDocumentTwentyFiveCentAmount.span">$<bean:write name="KualiForm" property="${coinProperty}.financialDocumentTwentyFiveCentAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>
+            <kul:htmlControlAttribute property="${confirmedCoinProperty}.twentyFiveCentCount" attributeEntry="${coinAttributes.twentyFiveCentCount}" />
+          </td>
+          <td><span id="${confirmedCoinProperty}.financialDocumentTwentyFiveCentAmount.span">$<bean:write name="KualiForm" property="${confirmedCoinProperty}.financialDocumentTwentyFiveCentAmount" /></span></td>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -92,13 +153,25 @@
             <kul:htmlControlAttribute property="${currencyProperty}.tenDollarCount" attributeEntry="${currencyAttributes.tenDollarCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${currencyProperty}.financialDocumentTenDollarAmount.span">$<bean:write name="KualiForm" property="${currencyProperty}.financialDocumentTenDollarAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
           <td>
+            <kul:htmlControlAttribute property="${confirmedCurrencyProperty}.tenDollarCount" attributeEntry="${currencyAttributes.tenDollarCount}" />
+          </td>
+          <td><span id="${confirmedCurrencyProperty}.financialDocumentTenDollarAmount.span">$<bean:write name="KualiForm" property="${confirmedCurrencyProperty}.financialDocumentTenDollarAmount" /></span></td>
+          </c:if>
+          <td>
             <kul:htmlAttributeLabel labelFor="${coinProperty}.tenCentCount" attributeEntry="${coinAttributes.tenCentCount}" />
           </td>
           <td>
             <kul:htmlControlAttribute property="${coinProperty}.tenCentCount" attributeEntry="${coinAttributes.tenCentCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${coinProperty}.financialDocumentTenCentAmount.span">$<bean:write name="KualiForm" property="${coinProperty}.financialDocumentTenCentAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>
+            <kul:htmlControlAttribute property="${confirmedCoinProperty}.tenCentCount" attributeEntry="${coinAttributes.tenCentCount}" />
+          </td>
+          <td><span id="${confirmedCoinProperty}.financialDocumentTenCentAmount.span">$<bean:write name="KualiForm" property="${confirmedCoinProperty}.financialDocumentTenCentAmount" /></span></td>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -108,13 +181,25 @@
             <kul:htmlControlAttribute property="${currencyProperty}.fiveDollarCount" attributeEntry="${currencyAttributes.fiveDollarCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${currencyProperty}.financialDocumentFiveDollarAmount.span">$<bean:write name="KualiForm" property="${currencyProperty}.financialDocumentFiveDollarAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
           <td>
+            <kul:htmlControlAttribute property="${confirmedCurrencyProperty}.fiveDollarCount" attributeEntry="${currencyAttributes.fiveDollarCount}" />
+          </td>
+          <td><span id="${confirmedCurrencyProperty}.financialDocumentFiveDollarAmount.span">$<bean:write name="KualiForm" property="${confirmedCurrencyProperty}.financialDocumentFiveDollarAmount" /></span></td>
+          </c:if>
+          <td>
             <kul:htmlAttributeLabel labelFor="${coinProperty}.fiveCentCount" attributeEntry="${coinAttributes.fiveCentCount}" />
           </td>
           <td>
             <kul:htmlControlAttribute property="${coinProperty}.fiveCentCount" attributeEntry="${coinAttributes.fiveCentCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${coinProperty}.financialDocumentFiveCentAmount.span">$<bean:write name="KualiForm" property="${coinProperty}.financialDocumentFiveCentAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>
+            <kul:htmlControlAttribute property="${confirmedCoinProperty}.fiveCentCount" attributeEntry="${coinAttributes.fiveCentCount}" />
+          </td>
+          <td><span id="${confirmedCoinProperty}.financialDocumentFiveCentAmount.span">$<bean:write name="KualiForm" property="${confirmedCoinProperty}.financialDocumentFiveCentAmount" /></span></td>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -124,13 +209,25 @@
             <kul:htmlControlAttribute property="${currencyProperty}.twoDollarCount" attributeEntry="${currencyAttributes.twoDollarCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${currencyProperty}.financialDocumentTwoDollarAmount.span">$<bean:write name="KualiForm" property="${currencyProperty}.financialDocumentTwoDollarAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
           <td>
+            <kul:htmlControlAttribute property="${confirmedCurrencyProperty}.twoDollarCount" attributeEntry="${currencyAttributes.twoDollarCount}" />
+          </td>
+          <td><span id="${confirmedCurrencyProperty}.financialDocumentTwoDollarAmount.span">$<bean:write name="KualiForm" property="${confirmedCurrencyProperty}.financialDocumentTwoDollarAmount" /></span></td>
+          </c:if>
+          <td>
             <kul:htmlAttributeLabel labelFor="${coinProperty}.oneCentCount" attributeEntry="${coinAttributes.oneCentCount}" />
           </td>
           <td>
             <kul:htmlControlAttribute property="${coinProperty}.oneCentCount" attributeEntry="${coinAttributes.oneCentCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${coinProperty}.financialDocumentOneCentAmount.span">$<bean:write name="KualiForm" property="${coinProperty}.financialDocumentOneCentAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>
+            <kul:htmlControlAttribute property="${confirmedCoinProperty}.oneCentCount" attributeEntry="${coinAttributes.oneCentCount}" />
+          </td>
+          <td><span id="${confirmedCoinProperty}.financialDocumentOneCentAmount.span">$<bean:write name="KualiForm" property="${confirmedCoinProperty}.financialDocumentOneCentAmount" /></span></td>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -140,13 +237,25 @@
             <kul:htmlControlAttribute property="${currencyProperty}.oneDollarCount" attributeEntry="${currencyAttributes.oneDollarCount}" readOnly="${readOnly}" />
           </td>
           <td><span id="${currencyProperty}.financialDocumentOneDollarAmount.span">$<bean:write name="KualiForm" property="${currencyProperty}.financialDocumentOneDollarAmount" /></span></td>
+          <c:if test="${confirmMode && !changeMode}">
           <td>
+            <kul:htmlControlAttribute property="${confirmedCurrencyProperty}.oneDollarCount" attributeEntry="${currencyAttributes.oneDollarCount}" />
+          </td>
+          <td><span id="${confirmedCurrencyProperty}.financialDocumentOneDollarAmount.span">$<bean:write name="KualiForm" property="${confirmedCurrencyProperty}.financialDocumentOneDollarAmount" /></span></td>
+          </c:if>
+          <td>
             <kul:htmlAttributeLabel labelFor="${coinProperty}.financialDocumentOtherCentAmount" attributeEntry="${coinAttributes.financialDocumentOtherCentAmount}" />
           </td>
           <td>&nbsp;</td>
           <td>
             $<kul:htmlControlAttribute property="${coinProperty}.financialDocumentOtherCentAmount" attributeEntry="${coinAttributes.financialDocumentOtherCentAmount}" readOnly="${readOnly}" />
           </td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>&nbsp;</td>
+          <td>
+            $<kul:htmlControlAttribute property="${confirmedCoinProperty}.financialDocumentOtherCentAmount" attributeEntry="${coinAttributes.financialDocumentOtherCentAmount}" />
+          </td>
+          </c:if>
         </tr>
         <tr>
           <td>
@@ -156,6 +265,18 @@
           <td>
             $<kul:htmlControlAttribute property="${currencyProperty}.financialDocumentOtherDollarAmount" attributeEntry="${currencyAttributes.financialDocumentOtherDollarAmount}" readOnly="${readOnly}" />
           </td>
-          <td colspan="3">&nbsp;</td>
+          <c:if test="${confirmMode && !changeMode}">
+          <td>&nbsp;</td>
+          <td>
+            $<kul:htmlControlAttribute property="${confirmedCurrencyProperty}.financialDocumentOtherDollarAmount" attributeEntry="${currencyAttributes.financialDocumentOtherDollarAmount}" />
+          </td>
+          </c:if>
+          <td colspan="5">&nbsp;</td>
         </tr>
+        <c:if test="${changeMode}">
+        <tr>
+        	<td class="total-line" colspan="5">&nbsp;</td>
+            <td class="total-line"><strong>Total: <c:out value="${totalChangeAmount}" /></strong></td>
+        </tr>
+        </c:if>
       </table>
Index: work/web-root/WEB-INF/tags/fp/crCheckLines.tag
===================================================================
--- work/web-root/WEB-INF/tags/fp/crCheckLines.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/fp/crCheckLines.tag	(revision 37225)
@@ -18,7 +18,9 @@
 <%@ attribute name="checkDetailMode" required="true" %>
 <%@ attribute name="editingMode" required="true" type="java.util.Map" %>
 <%@ attribute name="totalAmount" required="false" %>
+<%@ attribute name="totalConfirmedAmount" required="false" %>
 <%@ attribute name="displayHidden" required="true" %>
+<%@ attribute name="confirmMode" required="false" %>
 
 <c:set var="checkBaseAttributes" value="${DataDictionary.CheckBase.attributes}" />
 
@@ -48,7 +50,7 @@
                 </tr>
     			<c:if test="${!readOnly}">
                 <fp:checkLine readOnly="${readOnly}" rowHeading="add" propertyName="newCheck" actionImage="${ConfigProperties.kr.externalizable.images.url}tinybutton-add1.gif" actionAlt="add" actionMethod="addCheck" cssClass="infoline" displayHidden="${displayHidden}" />
-                </c:if>            
+                </c:if> 
                 <logic:iterate id="check" name="KualiForm" property="document.checks" indexId="ctr">
                     <fp:checkLine readOnly="${readOnly}" rowHeading="${ctr + 1}" propertyName="document.check[${ctr}]" baselinePropertyName="baselineCheck[${ctr}]" actionImage="${ConfigProperties.kr.externalizable.images.url}tinybutton-delete1.gif" actionAlt="delete" actionMethod="deleteCheck.line${ctr}" cssClass="datacell" displayHidden="${displayHidden}" />
                 </logic:iterate>
@@ -64,6 +66,37 @@
                 </c:if>
             </table>
         </div>	
+    
+    <c:if test="${confirmMode}">
+        <div class="tab-container" align="center">
+    	    <html:image align="left" property="methodToCall.copyAllChecks" src="${ConfigProperties.externalizable.images.url}tinybutton-copyall.gif" title="Copy all original checks to confirmed checks" alt="Copy all checks" styleClass="tinybutton"/>
+    	</div>
+    	<div class="tab-container" align=center>
+    		<h3>Cash Manager Confirmed Check Detail</h3>
+    		<table cellpadding=0 class="datatable" summary="confirmed check detail information">
+    			<tr>
+                    <kul:htmlAttributeHeaderCell literalLabel="&nbsp;" />
+                    <kul:htmlAttributeHeaderCell attributeEntry="${checkBaseAttributes.checkNumber}" />
+                    <kul:htmlAttributeHeaderCell attributeEntry="${checkBaseAttributes.checkDate}" />
+                    <kul:htmlAttributeHeaderCell attributeEntry="${checkBaseAttributes.description}" />
+                    <kul:htmlAttributeHeaderCell attributeEntry="${checkBaseAttributes.amount}" />
+                    <kul:htmlAttributeHeaderCell literalLabel="Action" />
+                </tr>
+                <fp:checkLine readOnly="false" rowHeading="add" propertyName="newConfirmedCheck" actionImage="${ConfigProperties.kr.externalizable.images.url}tinybutton-add1.gif" actionAlt="add" actionMethod="addConfirmedCheck" cssClass="infoline" displayHidden="${displayHidden}" />
+                <logic:iterate id="confirmedCheck" name="KualiForm" property="document.confirmedChecks" indexId="ct">
+                    <fp:checkLine readOnly="false" rowHeading="${ct + 1}" propertyName="document.confirmedCheck[${ct}]" actionImage="${ConfigProperties.kr.externalizable.images.url}tinybutton-delete1.gif" actionAlt="delete" actionMethod="deleteConfirmedCheck.line${ct}" cssClass="datacell" displayHidden="${displayHidden}" />
+                </logic:iterate>	
+                	
+                <c:if test="${!empty totalConfirmedAmount}">
+                    <tr>
+                        <td class="total-line" colspan="4">&nbsp;</td>
+                        <td class="total-line"><strong>Total: <c:out value="${totalConfirmedAmount}" /></strong></td>
+                        <td class="total-line">&nbsp;</td>
+                    </tr>
+                </c:if>
+    		</table>
+    	</div>
+    </c:if>
     </kul:tab>
 </c:if>
 
Index: work/web-root/WEB-INF/tags/module/ar/customerInvoiceGeneral.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ar/customerInvoiceGeneral.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ar/customerInvoiceGeneral.tag	(revision 37225)
@@ -27,6 +27,7 @@
 
 <c:set var="arDocHeaderAttributes" value="${DataDictionary.AccountsReceivableDocumentHeader.attributes}" />
 
+
 <kul:tab tabTitle="General" defaultOpen="true" tabErrorKey="${KFSConstants.CUSTOMER_INVOICE_DOCUMENT_GENERAL_ERRORS}">
     <div class="tab-container" align=center>	
         <table cellpadding="0" cellspacing="0" class="datatable" summary="Invoice Section">
@@ -46,8 +47,10 @@
 				        <c:otherwise>
 				            <c:set var="onblurForCustomer" value=""/>
 				        </c:otherwise>
-				    </c:choose>                
-                    <kul:htmlControlAttribute attributeEntry="${arDocHeaderAttributes.customerNumber}" property="document.accountsReceivableDocumentHeader.customerNumber" readOnly="${readOnly}" onblur="${onblurForCustomer}" onchange="${onblurForCustomer}" forceRequired="true"/>
+				    </c:choose>
+				
+				    <a href="arCustomerOpenItemReportLookup.do?methodToCall=search&businessObjectClassName=org.kuali.kfs.module.ar.businessobject.CustomerOpenItemReportDetail&lookupableImplementaionServiceName=arCustomerOpenItemReportLookupable&docFormKey=88888888&returnLocation=&hideReturnLink=true&reportName=${KFSConstants.CustomerOpenItemReport.HISTORY_REPORT_NAME}&customerNumber=${KualiForm.customerInvoiceDocument.accountsReceivableDocumentHeader.customerNumber}&customerName=${KualiForm.customerInvoiceDocument.customerName}"
+						target="new"> <kul:htmlControlAttribute attributeEntry="${arDocHeaderAttributes.customerNumber}" property="document.accountsReceivableDocumentHeader.customerNumber" readOnly="${readOnly}" onblur="${onblurForCustomer}" onchange="${onblurForCustomer}" forceRequired="true"/></a>
                     <c:if test="${not readOnly}">
 	                    &nbsp;
 	                    <kul:lookup boClassName="org.kuali.kfs.module.ar.businessobject.Customer" fieldConversions="customerNumber:document.accountsReceivableDocumentHeader.customerNumber" lookupParameters="document.accountsReceivableDocumentHeader.customerNumber:customerNumber" />
Index: work/web-root/WEB-INF/tags/module/ar/customerInvoiceReceivableAccountingLine.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ar/customerInvoiceReceivableAccountingLine.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ar/customerInvoiceReceivableAccountingLine.tag	(revision 37225)
@@ -16,13 +16,14 @@
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
 <%@ attribute name="documentAttributes" required="true" type="java.util.Map"
-              description="The DataDictionary entry containing attributes for this row's fields." %>
-              
-<%@ attribute name="readOnly" required="true" description="used to decide editability of overview fields" %>
-
+    description="The DataDictionary entry containing attributes for this row's fields." %>              
+<%@ attribute name="readOnly" required="true" 
+	description="used to decide editability of overview fields" %>
 <%@ attribute name="receivableValuesMap" required="false" type="java.util.Map"
-              description="map of the accounting line primitive fields and values, for inquiry keys" %>     
-
+    description="map of the accounting line primitive fields and values, for inquiry keys" %>     
+<%@ attribute name="accountsCanCrossCharts" required="false"
+	description="Whether or not accounts can cross charts"%>
+	
 <script language="JavaScript" type="text/javascript" src="scripts/module/ar/receivableObjectInfo.js"></script>        
                          
 <kul:tab tabTitle="Receivable" defaultOpen="true" tabErrorKey="${KFSConstants.CUSTOMER_INVOICE_DOCUMENT_RECEIVABLE_ACCOUNTING_LINE}">
@@ -42,6 +43,12 @@
             </tr>
             <tr>
                 <td align=left valign=middle class="datacell">
+                  <c:if test="${!accountsCanCrossCharts}">
+					<span id="document.paymentChartOfAccountsCode.div">
+						<bean:write name="KualiForm" property="document.paymentChartOfAccountsCode" />
+					</span>
+				  </c:if> 
+				  <c:if test="${accountsCanCrossCharts}">
                 	<span class="nowrap">
                     <kul:htmlControlAttribute 
                     	attributeEntry="${documentAttributes.paymentChartOfAccountsCode}" 
@@ -50,18 +57,29 @@
                     	onblur="loadChartInfo( this.name, 'document.paymentChartOfAccounts.finChartOfAccountDescription' );" 
                     	readOnly="${readOnly}"/>
                     </span>
+				  </c:if>
                     <br />
-                    <div id="document.paymentChartOfAccounts.finChartOfAccountDescription.div" class="fineprint">${document.paymentAccountNumber}</div>
+                    <div id="document.paymentChartOfAccounts.finChartOfAccountDescription.div" class="fineprint">${document.paymentChartOfAccounts.finChartOfAccountDescription}</div>
                 </td>
 				
                 <td align=left valign=middle class="datacell">
                 	<span class="nowrap">
+                  <c:if test="${!accountsCanCrossCharts}">
                     <kul:htmlControlAttribute 
                     	attributeEntry="${documentAttributes.paymentAccountNumber}" 
                     	property="document.paymentAccountNumber"
                     	styleClass="${dataCellCssClass}" 
+                    	onblur="loadReceivableChartAccountInfo( this.name, 'document.paymentAccount.accountName' );" 
+                    	readOnly="${readOnly}"/>
+				  </c:if>
+				  <c:if test="${accountsCanCrossCharts}">
+                    <kul:htmlControlAttribute 
+                    	attributeEntry="${documentAttributes.paymentAccountNumber}" 
+                    	property="document.paymentAccountNumber"
+                    	styleClass="${dataCellCssClass}" 
                     	onblur="loadReceivableAccountInfo( this.name, 'document.paymentAccount.accountName' );" 
                     	readOnly="${readOnly}"/>
+ 				  </c:if>
 					<c:if test="${not readOnly}">
 	                    &nbsp;
 	                    <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.Account" fieldConversions="accountNumber:document.paymentAccountNumber" lookupParameters="document.paymentAccountNumber:accountNumber,document.paymentChartOfAccountsCode:chartOfAccountsCode"/>
Index: work/web-root/WEB-INF/tags/module/ar/paymentApplicationNonAr.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ar/paymentApplicationNonAr.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ar/paymentApplicationNonAr.tag	(revision 37225)
@@ -13,6 +13,7 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 <%@ attribute name="hasRelatedCashControlDocument" required="true"
     description="If has related cash control document"%>
@@ -22,6 +23,8 @@
     description="Whether or not the customer is set" %>
 <%@ attribute name="customerAttributes" required="true"
     description="Attributes of Customer according to the data dictionary" %>
+<%@ attribute name="accountsCanCrossCharts" required="false"
+    description="Whether or not accounts can cross charts" %>
     
 <c:set var="nonInvoicedAttributes" value="${DataDictionary['NonInvoiced'].attributes}" scope="request" />
 <c:set var="nonInvoicedAddLine" value="${KualiForm.nonInvoicedAddLine}" scope="request" />
@@ -60,66 +63,71 @@
 	                        add
 	                    </td>
 	                    <td>
+			                <c:if test="${!accountsCanCrossCharts}">	
+	    		            	<span id="nonInvoicedAddLine.chartOfAccountsCode.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.chartOfAccountsCode"/></span> 
+	            		    </c:if>
+							<c:if test="${accountsCanCrossCharts}">				
 	                        <kul:htmlControlAttribute
-	                            onblur="loadChartInfo(this.name, 'nonInvoicedAddLine.chart.name')"
+	                            onblur="loadChartInfo(this.name, 'nonInvoicedAddLine.chart.finChartOfAccountDescription')"
 	                            attributeEntry="${nonInvoicedAttributes.chartOfAccountsCode}"
 	                            property="nonInvoicedAddLine.chartOfAccountsCode"/>
-	                        <div id="nonInvoicedAddLine.chart.name.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.chartOfAccounts.name"/></div>
+	            		    </c:if>
+	                        <div id="nonInvoicedAddLine.chart.finChartOfAccountDescription.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.chartOfAccounts.finChartOfAccountDescription"/></div>
 	                    </td>
 	                    <td>
 	                        <kul:htmlControlAttribute
-	                            onblur="loadAccountInfo(this.name, 'nonInvoicedAddLine.account.name')"
+	                            onblur="loadAccountInfo(this.name, 'nonInvoicedAddLine.account.accountName')"
 	                            attributeEntry="${nonInvoicedAttributes.accountNumber}"
 	                            property="nonInvoicedAddLine.accountNumber"/>
 	                        <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.Account" 
 	                            autoSearch="true"
 	                            lookupParameters="nonInvoicedAddLine.chartOfAccountsCode:chartOfAccountsCode,nonInvoicedAddLine.accountNumber:accountNumber"
 	                            fieldConversions="chartOfAccountsCode:nonInvoicedAddLine.chartOfAccountsCode,accountNumber:nonInvoicedAddLine.accountNumber" />
-	                        <div id="nonInvoicedAddLine.account.name.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.account.name"/></div>
+	                        <div id="nonInvoicedAddLine.account.accountName.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.account.accountName"/></div>
 	                    </td>
 	                    <td>
 	                        <kul:htmlControlAttribute
-	                            onblur="loadSubAccountInfo(this.name, 'nonInvoicedAddLine.subAccount.name')"
+	                            onblur="loadSubAccountInfo(this.name, 'nonInvoicedAddLine.subAccount.subAccountName')"
 	                            attributeEntry="${nonInvoicedAttributes.subAccountNumber}"
 	                            property="nonInvoicedAddLine.subAccountNumber"/>
 	                        <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.SubAccount" 
 	                            autoSearch="true"
 	                            lookupParameters="nonInvoicedAddLine.chartOfAccountsCode:chartOfAccountsCode,nonInvoicedAddLine.accountNumber:accountNumber,nonInvoicedAddLine.subAccountNumber:subAccountNumber"
 	                            fieldConversions="chartOfAccountsCode:nonInvoicedAddLine.chartOfAccountsCode,accountNumber:nonInvoicedAddLine.accountNumber,subAccountNumber:nonInvoicedAddLine.subAccountNumber" />
-	                        <div id="nonInvoicedAddLine.subAccount.name.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.subAccount.subAccountName"/></div>
+	                        <div id="nonInvoicedAddLine.subAccount.subAccountName.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.subAccount.subAccountName"/></div>
 	                    </td>
 	                    <td>
 	                        <kul:htmlControlAttribute
-	                            onblur="loadObjectInfo('${KualiForm.document.postingYear}', '', '', this.name, 'nonInvoicedAddLine.objectCode.name')"
+	                            onblur="loadObjectInfo('${KualiForm.document.postingYear}', '', '', this.name, 'nonInvoicedAddLine.objectCode.financialObjectCodeName')"
 	                            attributeEntry="${nonInvoicedAttributes.financialObjectCode}"
 	                            property="nonInvoicedAddLine.financialObjectCode"/>
 	                        <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.ObjectCode" 
 	                            autoSearch="true"
 	                            lookupParameters="nonInvoicedAddLine.financialObjectCode:financialObjectCode,nonInvoicedAddLine.chartOfAccountsCode:chartOfAccountsCode"
 	                            fieldConversions="financialObjectCode:nonInvoicedAddLine.financialObjectCode,chartOfAccountsCode:nonInvoicedAddLine.chartOfAccountsCode" />
-	                        <div id="nonInvoicedAddLine.objectCode.name.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.financialObject.financialObjectCodeName"/></div>
+	                        <div id="nonInvoicedAddLine.objectCode.financialObjectCodeName.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.financialObject.financialObjectCodeName"/></div>
 	                    </td>
 	                    <td>
 	                        <kul:htmlControlAttribute
-	                            onblur="loadSubObjectInfo('${KualiForm.document.postingYear}', this.name, 'nonInvoicedAddLine.subObjectCode.name')"
+	                            onblur="loadSubObjectInfo('${KualiForm.document.postingYear}', this.name, 'nonInvoicedAddLine.subObjectCode.financialSubObjectCodeName')"
 	                            attributeEntry="${nonInvoicedAttributes.financialSubObjectCode}"
 	                            property="nonInvoicedAddLine.financialSubObjectCode"/>
 	                        <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.SubObjectCode" 
 	                            autoSearch="true"
 	                            lookupParameters="nonInvoicedAddLine.financialSubObjectCode:financialSubObjectCode,nonInvoicedAddLine.chartOfAccountsCode:chartOfAccountsCode,nonInvoicedAddLine.financialObjectCode:financialObjectCode,nonInvoicedAddLine.accountNumber:accountNumber"
 	                            fieldConversions="financialSubObjectCode:nonInvoicedAddLine.financialSubObjectCode,chartOfAccountsCode:nonInvoicedAddLine.chartOfAccountsCode,financialObjectCode:nonInvoicedAddLine.financialObjectCode,accountNumber:nonInvoicedAddLine.accountNumber" />
-	                        <div id="nonInvoicedAddLine.subObjectCode.name.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.financialSubObject.financialSubObjectCodeName"/></div>
+	                        <div id="nonInvoicedAddLine.subObjectCode.financialSubObjectCodeName.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.financialSubObject.financialSubObjectCodeName"/></div>
 	                    </td>
 	                    <td>
 	                        <kul:htmlControlAttribute
-	                            onblur="loadProjectInfo(this.name, 'nonInvoicedAddLine.projectCode.name')"
+	                            onblur="loadProjectInfo(this.name, 'nonInvoicedAddLine.project.projectDescription')"
 	                            attributeEntry="${nonInvoicedAttributes.projectCode}"
 	                            property="nonInvoicedAddLine.projectCode"/>
 	                        <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.ProjectCode" 
 	                            autoSearch="true"
 	                            lookupParameters="nonInvoicedAddLine.chartOfAccountsCode:chartOfAccountsCode,nonInvoicedAddLine.projectCode:code"
 	                            fieldConversions="chartOfAccountsCode:nonInvoicedAddLine.chartOfAccountsCode,code:nonInvoicedAddLine.projectCode" />
-	                        <div id="nonInvoicedAddLine.projectCode.name.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.project.projectDescription"/></div>
+	                        <div id="nonInvoicedAddLine.project.projectDescription.div"><bean:write name="KualiForm" property="nonInvoicedAddLine.project.projectDescription"/></div>
 	                    </td>
 	                    <td>
 	                        <kul:htmlControlAttribute
@@ -141,13 +149,18 @@
                             <c:out value="${nonInvoiced.financialDocumentLineNumber}" />
                         </td>
                         <td>
+			                <c:if test="${!accountsCanCrossCharts}">	
+	    		            	<span id="paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccountsCode.div"><bean:write name="KualiForm" property="paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccountsCode"/></span> 
+	            		    </c:if>
+							<c:if test="${accountsCanCrossCharts}">				
                             <kul:htmlControlAttribute
                                 attributeEntry="${nonInvoicedAttributes.chartOfAccountsCode}" 
                                 readOnly="${readOnly}" 
                                 property="paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccountsCode"
-                                onblur="loadChartInfo(this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccounts.name')" 
-                                onchange="loadChartInfo(this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccounts.name')" />
-                            <div id="paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccounts.name.div"><bean:write name="KualiForm" property="paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccounts.name"/></div>
+                                onblur="loadChartInfo(this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].chart.finChartOfAccountDescription')" 
+                                onchange="loadChartInfo(this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].chart.finChartOfAccountDescription')" />
+	            		    </c:if>
+                            <div id="paymentApplicationDocument.nonInvoiced[${ctr}].chart.finChartOfAccountDescription.div"><bean:write name="KualiForm" property="paymentApplicationDocument.nonInvoiced[${ctr}].chartOfAccounts.finChartOfAccountDescription"/></div>
                         </td>
                         <td>
                             <kul:htmlControlAttribute
@@ -170,17 +183,17 @@
                                 attributeEntry="${nonInvoicedAttributes.financialObjectCode}"
                                 readOnly="${readOnly}" 
                                 property="paymentApplicationDocument.nonInvoiced[${ctr}].financialObjectCode"
-                                onblur="loadObjectInfo('${KualiForm.document.postingYear}', '', '', this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].financialObject.name')"
-                                onchange="loadObjectInfo('${paymentApplicationDocument.postingYear}', '', '', this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].financialObject.name')" />
-                            <div id="paymentApplicationDocument.nonInvoiced[${ctr}].financialObject.name.div"><bean:write name="KualiForm" property="paymentApplicationDocument.nonInvoiced[${ctr}].financialObject.name"/></div>
+                                onblur="loadObjectInfo('${KualiForm.document.postingYear}', '', '', this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].objectCode.financialObjectCodeName')"
+                                onchange="loadObjectInfo('${paymentApplicationDocument.postingYear}', '', '', this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].objectCode.financialObjectCodeName')" />
+                            <div id="paymentApplicationDocument.nonInvoiced[${ctr}].objectCode.financialObjectCodeName.div"><bean:write name="KualiForm" property="paymentApplicationDocument.nonInvoiced[${ctr}].financialObject.financialObjectCodeName"/></div>
                         </td>
                         <td>
                             <kul:htmlControlAttribute
                                 attributeEntry="${nonInvoicedAttributes.financialSubObjectCode}"
                                 readOnly="${readOnly}" 
                                 property="paymentApplicationDocument.nonInvoiced[${ctr}].financialSubObjectCode" 
-                                onblur="loadSubObjectInfo('${KualiForm.document.postingYear}', this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].financialSubObject.financialSubObjectCodeName')" />
-                            <div id="paymentApplicationDocument.nonInvoiced[${ctr}].financialSubObject.financialSubObjectCodeName.div"><bean:write name="KualiForm" property="paymentApplicationDocument.nonInvoiced[${ctr}].financialSubObject.financialSubObjectCodeName"/></div>
+                                onblur="loadSubObjectInfo('${KualiForm.document.postingYear}', this.name, 'paymentApplicationDocument.nonInvoiced[${ctr}].subObjectCode.financialSubObjectCodeName')" />
+                            <div id="paymentApplicationDocument.nonInvoiced[${ctr}].subObjectCode.financialSubObjectCodeName.div"><bean:write name="KualiForm" property="paymentApplicationDocument.nonInvoiced[${ctr}].financialSubObject.financialSubObjectCodeName"/></div>
                         </td>
                         <td>
                             <kul:htmlControlAttribute
Index: work/web-root/WEB-INF/tags/module/ar/customerInvoiceOrganization.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ar/customerInvoiceOrganization.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ar/customerInvoiceOrganization.tag	(revision 37225)
@@ -16,6 +16,7 @@
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
 <c:set var="arDocHeaderAttributes" value="${DataDictionary.AccountsReceivableDocumentHeader.attributes}" />
+<c:set var="processingOrgMode" value="${KualiForm.editingMode['processingOrganizationMode']}" scope="request" />
 
 <%@ attribute name="documentAttributes" required="true" type="java.util.Map"
               description="The DataDictionary entry containing attributes for this row's fields." %>
@@ -33,13 +34,13 @@
                     <div align="right"><kul:htmlAttributeLabel attributeEntry="${arDocHeaderAttributes.processingChartOfAccountCode}" /></div>
                 </th>
                 <td align=left valign=middle class="datacell" style="width: 25%;">
-                    <kul:htmlControlAttribute attributeEntry="${arDocHeaderAttributes.processingChartOfAccountCode}" property="document.accountsReceivableDocumentHeader.processingChartOfAccountCode" readOnly="true" />
+                    <kul:htmlControlAttribute attributeEntry="${arDocHeaderAttributes.processingChartOfAccountCode}" property="document.accountsReceivableDocumentHeader.processingChartOfAccountCode" readOnly='${!processingOrgMode}' />
                 </td>
 				<th align=right valign=middle class="bord-l-b" style="width: 25%;">
                     <div align="right"><kul:htmlAttributeLabel attributeEntry="${documentAttributes.billByChartOfAccountCode}" /></div>
                 </th>
                 <td align=left valign=middle class="datacell" style="width: 25%;">
-                    <kul:htmlControlAttribute attributeEntry="${documentAttributes.billByChartOfAccountCode}" property="document.billByChartOfAccountCode" readOnly="${readOnly}"/>
+                    <kul:htmlControlAttribute attributeEntry="${documentAttributes.billByChartOfAccountCode}" property="document.billByChartOfAccountCode" readOnly='${!processingOrgMode || readOnly}'/>
                 </td>                                
             </tr>
             <tr>
@@ -47,13 +48,13 @@
                     <div align="right"><kul:htmlAttributeLabel attributeEntry="${arDocHeaderAttributes.processingOrganizationCode}" /></div>
                 </th>
                 <td align=left valign=middle class="datacell">
-                    <kul:htmlControlAttribute attributeEntry="${arDocHeaderAttributes.processingOrganizationCode}" property="document.accountsReceivableDocumentHeader.processingOrganizationCode" readOnly="true" />
+                    <kul:htmlControlAttribute attributeEntry="${arDocHeaderAttributes.processingOrganizationCode}" property="document.accountsReceivableDocumentHeader.processingOrganizationCode" readOnly='${!processingOrgMode}' />
                 </td>                
 				<th align=right valign=middle class="bord-l-b">
                     <div align="right"><kul:htmlAttributeLabel attributeEntry="${documentAttributes.billedByOrganizationCode}" /></div>
                 </th>
                 <td align=left valign=middle class="datacell">
-                    <kul:htmlControlAttribute attributeEntry="${documentAttributes.billedByOrganizationCode}" property="document.billedByOrganizationCode" readOnly="${readOnly}"/>
+                    <kul:htmlControlAttribute attributeEntry="${documentAttributes.billedByOrganizationCode}" property="document.billedByOrganizationCode" readOnly='${!processingOrgMode || readOnly}'/>
 					<c:if test="${not readOnly}">
 	                    &nbsp;
 	                    <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.Organization" fieldConversions="organizationCode:document.billedByOrganizationCode" lookupParameters="document.billedByOrganizationCode:organizationCode,document.billByChartOfAccountCode:chartOfAccountsCode"/>
Index: work/web-root/WEB-INF/tags/module/ar/paymentApplicationApplyToInvoiceDetail.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ar/paymentApplicationApplyToInvoiceDetail.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ar/paymentApplicationApplyToInvoiceDetail.tag	(revision 37225)
@@ -170,8 +170,8 @@
 												</td>
 												<td>
 													<kul:htmlControlAttribute
-														attributeEntry="${arDocHeaderAttributes.financialDocumentExplanationText}"
-														property="selectedInvoiceApplication.invoice.accountsReceivableDocumentHeader.financialDocumentExplanationText"
+														attributeEntry="${invoiceAttributes.invoiceHeaderText}"
+														property="selectedInvoiceApplication.invoice.invoiceHeaderText"
 														readOnly="true" />
 												</td>
 												<td style="text-align: right;">
Index: work/web-root/WEB-INF/tags/module/ar/customerCreditMemoDetails.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ar/customerCreditMemoDetails.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ar/customerCreditMemoDetails.tag	(revision 37225)
@@ -82,9 +82,11 @@
 					<strong>${KualiForm.document.currencyFormattedCrmTotalItemAmount}</strong>
 				</td>
 				<!-- Customer Credit Memo Total Tax Amount -->
+				<c:if test="${salesTaxEnabled}">
 				<td class="total-line">
 					<strong>${KualiForm.document.currencyFormattedCrmTotalTaxAmount}</strong>
 				</td>
+				</c:if>
 				<!--  Customer Credit Memo Total Amount -->
 				<td class="total-line">
 					<strong>${KualiForm.document.currencyFormattedCrmTotalAmount}</strong>
Index: work/web-root/WEB-INF/tags/module/ar/customerCreditMemoDetail.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ar/customerCreditMemoDetail.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ar/customerCreditMemoDetail.tag	(revision 37225)
@@ -202,12 +202,14 @@
 	</c:if>
 	
 	<!--  CRM Tax Amount -->
+	<c:if test="${salesTaxEnabled}">
 	<td class="${cssClass}" style="text-align:right" >
 		<kul:htmlControlAttribute
 			attributeEntry="${customerCreditMemoDetailAttributes.creditMemoItemTaxAmount}"
 			property="${crmPropertyName}.creditMemoItemTaxAmount"
 			readOnly="true" />
 	</td>
+	</c:if>
 	
 	<!--  CRM Total Amount -->
 	<td class="${cssClass}" style="text-align:right" colspan="1" >
Index: work/web-root/WEB-INF/tags/module/bc/incumbentSalarySetting.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/bc/incumbentSalarySetting.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/bc/incumbentSalarySetting.tag	(revision 37225)
@@ -16,6 +16,7 @@
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
 <%@ attribute name="readOnly" required="false" description="determine whether the contents can be read only or not"%>
+<%@ attribute name="accountsCanCrossCharts" required="false"  description="Whether or not accounts can cross charts"%>
 
 <c:set var="tableWidth" value="100%"/>
 <c:set var="isKeyFieldsLocked" value="${KualiForm.singleAccountMode}"/>
@@ -32,7 +33,7 @@
 <div class="tab-container" align=center>
 	<c:if test="${not readOnly}">
 		<kul:subtab lookedUpCollectionName="fundingLine" width="${tableWidth}" subTabTitle="Add Funding">      
-			<bc:appointmentFundingLineForIncumbent fundingLine="${KualiForm.newBCAFLine}" fundingLineName="newBCAFLine" countOfMajorColumns="11" isKeyFieldsLocked="${isKeyFieldsLocked}" hasBeenAdded="false">
+			<bc:appointmentFundingLineForIncumbent fundingLine="${KualiForm.newBCAFLine}" fundingLineName="newBCAFLine" countOfMajorColumns="11" isKeyFieldsLocked="${isKeyFieldsLocked}" hasBeenAdded="false" accountsCanCrossCharts="${accountsCanCrossCharts}">
 				<html:image property="methodToCall.addAppointmentFundingLine.anchorsalarynewLineLineAnchor" 
 			       	src="${ConfigProperties.kr.externalizable.images.url}tinybutton-add1.gif" 
 			       	title="Add a Salary Setting Line" alt="Add a Salary Setting Line" styleClass="tinybutton"/>
Index: work/web-root/WEB-INF/tags/module/bc/appointmentFundingLineForPosition.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/bc/appointmentFundingLineForPosition.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/bc/appointmentFundingLineForPosition.tag	(revision 37225)
@@ -24,6 +24,7 @@
 <%@ attribute name="countOfMajorColumns" required="true" description="the number of major columns "%>
 <%@ attribute name="readOnly" required="false" description="determine whether the contents can be read only or not"%>
 <%@ attribute name="isKeyFieldsLocked" required="false" description="determine whether the key fields can be locked from editing"%>
+<%@ attribute name="accountsCanCrossCharts" required="false"  description="Whether or not accounts can cross charts"%>
 
 <c:if test="${!accountingLineScriptsLoaded}">
 	<script type='text/javascript' src="dwr/interface/ChartService.js"></script>
@@ -46,6 +47,7 @@
 
 <%-- FIXME: remove when JS lookup use is fixed --%>
 <html:hidden property="${fundingLineName}.universityFiscalYear" />
+<html:hidden property="${fundingLineName}.chartOfAccountsCode" />
 <html:hidden property="${fundingLineName}.positionNumber" />
 
 <%-- FIXME: was removed due to conflicts in JS newline subobject lookup and using disabled setting --%>
@@ -75,29 +77,52 @@
 		    readOnly="false"
 		    rowSpan="1 "dataFieldCssClass="nobord"
 		    anchor="salaryexistingLineLineAnchor${lineIndex}" disabled="true"/>
-		      
-		 <bc:pbglLineDataCell dataCellCssClass="datacell"
-		    accountingLine="${fundingLineName}"
-		    field="chartOfAccountsCode"
-		    detailField="chartOfAccounts.finChartOfAccountDescription" detailFunction="loadChartInfo"
-		    attributes="${pbcafAttributes}" lookup="true" inquiry="true"
-		    boClassSimpleName="Chart"
-		    readOnly="${hasBeenAdded || isKeyFieldsLocked}"
-		    displayHidden="false"
-		    lookupOrInquiryKeys="chartOfAccountsCode"
-		    accountingLineValuesMap="${fundingLine.valuesMap}" />
-		      
-		 <bc:pbglLineDataCell dataCellCssClass="datacell"
-			accountingLine="${fundingLineName}"
-			field="accountNumber" detailFunction="loadAccountInfo"
-			detailField="account.accountName"
-			attributes="${pbcafAttributes}" lookup="true" inquiry="true"
-			boClassSimpleName="Account"
-			readOnly="${hasBeenAdded || isKeyFieldsLocked}"
-			displayHidden="false"
-			lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
-			accountingLineValuesMap="${fundingLine.valuesMap}" />
-	  
+		    
+		 <c:if test="${!accountsCanCrossCharts}">
+			 <bc:pbglLineDataCell dataCellCssClass="datacell"
+			    accountingLine="${fundingLineName}"
+			    field="chartOfAccountsCode"
+			    detailField="chartOfAccounts.finChartOfAccountDescription" detailFunction="loadChartInfo"
+			    attributes="${pbcafAttributes}" lookup="true" inquiry="true"
+			    boClassSimpleName="Chart"
+			    readOnly="true"
+			    displayHidden="false"
+			    divId="newBCAFLine.chartOfAccountsCode.div"
+			    accountingLineValuesMap="${fundingLine.valuesMap}" />
+			 <bc:pbglLineDataCell dataCellCssClass="datacell"
+				accountingLine="${fundingLineName}"
+				field="accountNumber" detailFunction="budgetObjectInfoUpdator.loadChartAccountInfo"
+				detailField="account.accountName"
+				attributes="${pbcafAttributes}" lookup="true" inquiry="true"
+				boClassSimpleName="Account"
+				readOnly="${hasBeenAdded || isKeyFieldsLocked}"
+				displayHidden="false"
+				lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
+				accountingLineValuesMap="${fundingLine.valuesMap}" />
+	  	</c:if>
+		 <c:if test="${accountsCanCrossCharts}">
+			 <bc:pbglLineDataCell dataCellCssClass="datacell"
+			    accountingLine="${fundingLineName}"
+			    field="chartOfAccountsCode"
+			    detailField="chartOfAccounts.finChartOfAccountDescription" detailFunction="loadChartInfo"
+			    attributes="${pbcafAttributes}" lookup="true" inquiry="true"
+			    boClassSimpleName="Chart"
+			    readOnly="${hasBeenAdded || isKeyFieldsLocked}"
+			    displayHidden="false"
+			    lookupOrInquiryKeys="chartOfAccountsCode"
+			    accountingLineValuesMap="${fundingLine.valuesMap}" />
+			      
+			 <bc:pbglLineDataCell dataCellCssClass="datacell"
+				accountingLine="${fundingLineName}"
+				field="accountNumber" detailFunction="loadAccountInfo"
+				detailField="account.accountName"
+				attributes="${pbcafAttributes}" lookup="true" inquiry="true"
+				boClassSimpleName="Account"
+				readOnly="${hasBeenAdded || isKeyFieldsLocked}"
+				displayHidden="false"
+				lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
+				accountingLineValuesMap="${fundingLine.valuesMap}" />
+	  	</c:if>
 		<c:set var="doAccountLookupOrInquiry" value="false"/>
 	  	<c:if test="${fundingLine.subAccountNumber ne BCConstants.DASH_SUB_ACCOUNT_NUMBER}">
 	      	<c:set var="doAccountLookupOrInquiry" value="true"/>
Index: work/web-root/WEB-INF/tags/module/bc/positionSalarySetting.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/bc/positionSalarySetting.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/bc/positionSalarySetting.tag	(revision 37225)
@@ -16,6 +16,7 @@
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
 <%@ attribute name="readOnly" required="false" description="determine whether the contents can be read only or not"%>
+<%@ attribute name="accountsCanCrossCharts" required="false"  description="Whether or not accounts can cross charts"%>
 
 <c:set var="tableWidth" value="100%"/>
 <c:set var="isKeyFieldsLocked" value="${KualiForm.singleAccountMode}"/>
@@ -65,7 +66,7 @@
 			    
 	    <kul:subtab lookedUpCollectionName="fundingLine" width="${tableWidth}" subTabTitle="${fundingLine.appointmentFundingString}" >
 	    	<bc:appointmentFundingLineForPosition fundingLine="${fundingLine}" fundingLineName="${fundingLineName}"	
-	    		countOfMajorColumns="9" lineIndex="${status.index}" hasBeenAdded = "true" readOnly="${readOnly}">    		
+	    		countOfMajorColumns="9" lineIndex="${status.index}" hasBeenAdded = "true" readOnly="${readOnly}" accountsCanCrossCharts="${accountsCanCrossCharts}">    		
 	    		<c:if test="${canRecalculate}">
 					<html:image property="methodToCall.recalculateSalarySettingLine.line${status.index}.anchorsalaryexistingLineLineAnchor${status.index}" 
 						src="${ConfigProperties.externalizable.images.url}tinybutton-calculate.gif" 
Index: work/web-root/WEB-INF/tags/module/bc/pbglLineDataCell.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/bc/pbglLineDataCell.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/bc/pbglLineDataCell.tag	(revision 37225)
@@ -26,7 +26,6 @@
               description="The DataDictionary entry containing attributes for the field in this cell." %>
 <%@ attribute name="readOnly" required="true" %>
 <%@ attribute name="disabled" required="false" %>
-
 <%@ attribute name="fieldAlign" required="false"
               description="div alignment. default is align=left" %>
 
@@ -130,6 +129,7 @@
 <%@ attribute name="displayMask" required="false"
 			  description="when a field is not to be displayed in clear text and encrypted as hidden, the
 			  string to display." %>
+<%@ attribute name="divId" required="false"  %>			  
 
 
 <c:if test="${empty fieldAlign}">
@@ -196,7 +196,8 @@
     	<a href="${ConfigProperties.application.url}/budgetTempListLookup.do?methodToCall=start&businessObjectClassName=org.kuali.kfs.module.bc.businessobject.CalculatedSalaryFoundationTracker&universityFiscalYear=${KualiForm.universityFiscalYear}&chartOfAccountsCode=${KualiForm.chartOfAccountsCode}&accountNumber=${KualiForm.accountNumber}&subAccountNumber=${KualiForm.subAccountNumber}&hideReturnLink=true&suppressActions=true&tempListLookupMode=6&showInitialResults=true&docFormKey=${KualiForm.returnFormKey}&backLocation=${KualiForm.backLocation}"  target="_blank">
     </c:if>
     <c:if test="${!excludedFromTotal}">
-    <kul:htmlControlAttribute
+    <div id="${divId}" >
+    	<kul:htmlControlAttribute
         property="${cellProperty}"
         attributeEntry="${attributes[field]}"
         onblur="${onblur}"
@@ -217,6 +218,7 @@
             inquiryExtraKeyValues="${inquiryExtraKeyValues}"
             formattedNumberValue="${formattedNumberValue}"
             />
+    </div>
     </kul:htmlControlAttribute>
     </c:if>
     <c:if test="${excludedFromTotal}">
Index: work/web-root/WEB-INF/tags/module/bc/appointmentFundingLineForIncumbent.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/bc/appointmentFundingLineForIncumbent.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/bc/appointmentFundingLineForIncumbent.tag	(revision 37225)
@@ -24,6 +24,7 @@
 <%@ attribute name="countOfMajorColumns" required="true" description="the number of major columns "%>
 <%@ attribute name="readOnly" required="false" description="determine whether the contents can be read only or not"%>
 <%@ attribute name="isKeyFieldsLocked" required="false" description="determine whether the key fields can be locked from editing"%>
+<%@ attribute name="accountsCanCrossCharts" required="false"  description="Whether or not accounts can cross charts"%>
 
 <c:if test="${!accountingLineScriptsLoaded}">
 	<script type='text/javascript' src="dwr/interface/ChartService.js"></script>
@@ -47,6 +48,7 @@
 <%-- FIXME: remove when JS lookup use is fixed --%>
 <html:hidden property="${fundingLineName}.universityFiscalYear" />
 <html:hidden property="${fundingLineName}.emplid" />
+<html:hidden property="${fundingLineName}.chartOfAccountsCode" />
 
 <table border="0" cellpadding="0" cellspacing="0" style="width: ${tableWidth}; text-align: left; margin-left: auto; margin-right: auto;">    
 	<tr>
@@ -71,29 +73,52 @@
 		    field="appointmentFundingDeleteIndicator" readOnly="false"
 		    fieldAlign="center" disabled="true"
 		    anchor="salaryexistingLineLineAnchor${lineIndex}" />
-		      
-		 <bc:pbglLineDataCell dataCellCssClass="datacell"
-		    accountingLine="${fundingLineName}" attributes="${pbcafAttributes}"
-		    field="chartOfAccountsCode"
-		    detailField="chartOfAccounts.finChartOfAccountDescription" detailFunction="loadChartInfo"
-		    lookup="true" inquiry="true"
-		    boClassSimpleName="Chart"
-		    readOnly="${hasBeenAdded || isKeyFieldsLocked}"
-		    displayHidden="false"
-		    lookupOrInquiryKeys="chartOfAccountsCode"
-		    accountingLineValuesMap="${fundingLine.valuesMap}" />
-		      
-		 <bc:pbglLineDataCell dataCellCssClass="datacell"
-			accountingLine="${fundingLineName}"
-			field="accountNumber" detailFunction="loadAccountInfo"
-			detailField="account.accountName"
-			attributes="${pbcafAttributes}" lookup="true" inquiry="true"
-			boClassSimpleName="Account"
-			readOnly="${hasBeenAdded || isKeyFieldsLocked}"
-			displayHidden="false"
-			lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
-			accountingLineValuesMap="${fundingLine.valuesMap}" />
-	  
+		 <c:if test="${!accountsCanCrossCharts}">
+		 	<bc:pbglLineDataCell dataCellCssClass="datacell"
+			    accountingLine="${fundingLineName}" attributes="${pbcafAttributes}"
+			    field="chartOfAccountsCode"
+			    detailField="chartOfAccounts.finChartOfAccountDescription" detailFunction="loadChartInfo"
+			    lookup="true" inquiry="true"
+			    boClassSimpleName="Chart"
+			    readOnly="true"
+			    displayHidden="false"
+			    divId="newBCAFLine.chartOfAccountsCode.div"
+			    accountingLineValuesMap="${fundingLine.valuesMap}" />
+			      
+			 <bc:pbglLineDataCell dataCellCssClass="datacell"
+				accountingLine="${fundingLineName}"
+				field="accountNumber" detailFunction="budgetObjectInfoUpdator.loadChartAccountInfo"
+				detailField="account.accountName"
+				attributes="${pbcafAttributes}" lookup="true" inquiry="true"
+				boClassSimpleName="Account"
+				readOnly="${hasBeenAdded || isKeyFieldsLocked}"
+				displayHidden="false"
+				lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
+				accountingLineValuesMap="${fundingLine.valuesMap}" />
+		 </c:if>
+		  <c:if test="${accountsCanCrossCharts}">   
+			 <bc:pbglLineDataCell dataCellCssClass="datacell"
+			    accountingLine="${fundingLineName}" attributes="${pbcafAttributes}"
+			    field="chartOfAccountsCode"
+			    detailField="chartOfAccounts.finChartOfAccountDescription" detailFunction="loadChartInfo"
+			    lookup="true" inquiry="true"
+			    boClassSimpleName="Chart"
+			    readOnly="${hasBeenAdded || isKeyFieldsLocked}"
+			    displayHidden="false"
+			    lookupOrInquiryKeys="chartOfAccountsCode"
+			    accountingLineValuesMap="${fundingLine.valuesMap}" />
+			      
+			 <bc:pbglLineDataCell dataCellCssClass="datacell"
+				accountingLine="${fundingLineName}"
+				field="accountNumber" detailFunction="loadAccountInfo"
+				detailField="account.accountName"
+				attributes="${pbcafAttributes}" lookup="true" inquiry="true"
+				boClassSimpleName="Account"
+				readOnly="${hasBeenAdded || isKeyFieldsLocked}"
+				displayHidden="false"
+				lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
+				accountingLineValuesMap="${fundingLine.valuesMap}" />
+	 	</c:if> 
 		<c:set var="doAccountLookupOrInquiry" value="false"/>
 	  	<c:if test="${fundingLine.subAccountNumber ne BCConstants.DASH_SUB_ACCOUNT_NUMBER}">
 	      	<c:set var="doAccountLookupOrInquiry" value="true"/>
Index: work/web-root/WEB-INF/tags/module/ec/detailTab.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ec/detailTab.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ec/detailTab.tag	(revision 37225)
@@ -13,10 +13,12 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
 <%@ attribute name="isOpen" required="false" description="determine whehter the tab is open"%>
 <%@ attribute name="isEditable" required="false" description="determine whehter the tab is editable"%>
+<%@ attribute name="accountsCanCrossCharts" required="false"  description="Whether or not accounts can cross charts"%>
 
 <c:set var="documentAttributes"	value="${DataDictionary.EffortCertificationDocument.attributes}" />
 <c:set var="detailAttributes" value="${DataDictionary.EffortCertificationDetail.attributes}" />
@@ -25,6 +27,7 @@
 <c:set var="newDetailLine" value="${KualiForm.newDetailLine}"/>
 <c:set var="tabErrorKey" value="${isOpen ? EffortConstants.EFFORT_CERTIFICATION_TAB_ERRORS : '' }" />
 
+
 <kul:tab tabTitle="Effort Detail" defaultOpen="${isOpen}" tabErrorKey="${tabErrorKey}">	
 <c:choose>
 	<c:when test="${isEditable}">
@@ -39,19 +42,35 @@
 				
 				<tr>
 					<kul:htmlAttributeHeaderCell literalLabel="${KFSConstants.ADD_PREFIX}: "/>
-					
-					<ec:detailLine detailLine="${newDetailLine}" detailLineFormName="newDetailLine" attributes="${detailAttributes}"
-						detailFieldNames="${newLineDetailFieldNames}"
-						editableFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
-						onchangeForEditableFieldNames="loadChartInfo,effortAmountUpdator.loadAccountInfo,loadSubAccountInfo"
-						onchangeableInfoFieldNames="chartOfAccounts.finChartOfAccountDescription,account.accountName,subAccount.subAccountName"
-						relationshipMetadata ="${KualiForm.relationshipMetadata}"
-						hasActions="true" actions="add" actionImageFileNames="tinybutton-add1.gif" />
+					<c:choose>
+						<c:when test="${!accountsCanCrossCharts}">
+						<ec:detailLine detailLine="${newDetailLine}" detailLineFormName="newDetailLine" attributes="${detailAttributes}"
+							detailFieldNames="${newLineDetailFieldNames}"
+							editableFieldNames="accountNumber,subAccountNumber,effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
+							detailFieldNamesWithHiddenFormWhenReadonly="chartOfAccountsCode"
+							fieldInfo="${KualiForm.detailLineFieldInfo}"
+							onchangeForEditableFieldNames="effortAmountUpdator.loadChartAccountInfo,loadSubAccountInfo"
+							onchangeableInfoFieldNames="account.accountName,subAccount.subAccountName"
+							relationshipMetadata ="${KualiForm.relationshipMetadata}"
+							hasActions="true" actions="add" actionImageFileNames="tinybutton-add1.gif" />
+						</c:when>
+						<c:otherwise>
+							<ec:detailLine detailLine="${newDetailLine}" detailLineFormName="newDetailLine" attributes="${detailAttributes}"
+							detailFieldNames="${newLineDetailFieldNames}"
+							editableFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
+							onchangeForEditableFieldNames="loadChartInfo,effortAmountUpdator.loadAccountInfo,loadSubAccountInfo"
+							onchangeableInfoFieldNames="chartOfAccounts.finChartOfAccountDescription,account.accountName,subAccount.subAccountName"
+							relationshipMetadata ="${KualiForm.relationshipMetadata}"
+							hasActions="true" actions="add" actionImageFileNames="tinybutton-add1.gif" />
+						</c:otherwise>
+					</c:choose>
 				</tr>
 			</table>
 		</div>
 	
 		<div class="tab-container" style="text-align: center;">
+			<c:choose>
+				<c:when test="${!accountsCanCrossCharts}">
 			<ec:detailLinesWithGrouping id="editableDetailLineTable" detailLines="${detailLines}" 
 				detailLineFormName="document.effortCertificationDetailLines"
 				attributes="${detailAttributes}"
@@ -62,6 +81,27 @@
 				fieldInfo="${KualiForm.fieldInfo}"
 				sortableFieldNames="chartOfAccountsCode,accountNumber,effortCertificationPayrollAmount"
 				editableFieldNames="effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
+				extraEditableFieldNames="accountNumber,subAccountNumber,financialObjectCode,positionNumber"
+				onchangeForExtraEditableFieldNames="effortAmountUpdator.loadAccountInfo,loadSubAccountInfo,loadObjectCodeInfo"
+				onchangeableInfoFieldNames=""	
+				onchangeableExtraInfoFieldNames="account.accountName,subAccount.subAccountName,financialObject.financialObjectCodeName,"			
+				relationshipMetadata="${KualiForm.relationshipMetadata}"
+				ferderalTotalFieldNames="federalTotalOriginalEffortPercent,federalTotalEffortPercent,federalTotalOriginalPayrollAmount,federalTotalPayrollAmount,federalTotalOriginalFringeBenefit,federalTotalFringeBenefit" 
+				nonFerderalTotalFieldNames="otherTotalOriginalEffortPercent,otherTotalEffortPercent,otherTotalOriginalPayrollAmount,otherTotalPayrollAmount,otherTotalOriginalFringeBenefit,otherTotalFringeBenefit"
+				grandTotalFieldNames="totalOriginalEffortPercent,totalEffortPercent,totalOriginalPayrollAmount,totalPayrollAmount,totalOriginalFringeBenefit,totalFringeBenefit"
+				hasActions="true"/>
+				</c:when>
+				<c:otherwise>
+					<ec:detailLinesWithGrouping id="editableDetailLineTable" detailLines="${detailLines}" 
+				detailLineFormName="document.effortCertificationDetailLines"
+				attributes="${detailAttributes}"
+				detailFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,financialObjectCode,positionNumber,sourceChartOfAccountsCode,sourceAccountNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount,originalFringeBenefitAmount,fringeBenefitAmount"
+				detailFieldNamesWithHiddenFormWhenReadonly="chartOfAccountsCode,accountNumber,subAccountNumber,financialObjectCode,sourceChartOfAccountsCode,sourceAccountNumber,positionNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount,originalFringeBenefitAmount,fringeBenefitAmount"				
+				hiddenFieldNames="documentNumber,universityFiscalYear,newLineIndicator,federalOrFederalPassThroughIndicator,persistedPayrollAmount,persistedEffortPercent,versionNumber"
+				inquirableUrl="${KualiForm.detailLineFieldInquiryUrl}"
+				fieldInfo="${KualiForm.fieldInfo}"
+				sortableFieldNames="chartOfAccountsCode,accountNumber,effortCertificationPayrollAmount"
+				editableFieldNames="effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
 				extraEditableFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,financialObjectCode,positionNumber"
 				onchangeForExtraEditableFieldNames="loadChartInfo,effortAmountUpdator.loadAccountInfo,loadSubAccountInfo,loadObjectCodeInfo"
 				onchangeableInfoFieldNames=""	
@@ -70,7 +110,9 @@
 				ferderalTotalFieldNames="federalTotalOriginalEffortPercent,federalTotalEffortPercent,federalTotalOriginalPayrollAmount,federalTotalPayrollAmount,federalTotalOriginalFringeBenefit,federalTotalFringeBenefit" 
 				nonFerderalTotalFieldNames="otherTotalOriginalEffortPercent,otherTotalEffortPercent,otherTotalOriginalPayrollAmount,otherTotalPayrollAmount,otherTotalOriginalFringeBenefit,otherTotalFringeBenefit"
 				grandTotalFieldNames="totalOriginalEffortPercent,totalEffortPercent,totalOriginalPayrollAmount,totalPayrollAmount,totalOriginalFringeBenefit,totalFringeBenefit"
-				hasActions="true"/>			
+				hasActions="true"/>
+				</c:otherwise>
+			</c:choose>			
 		</div>	
 	</c:when>
 	
Index: work/web-root/WEB-INF/tags/module/ec/summaryTab.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/ec/summaryTab.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/ec/summaryTab.tag	(revision 37225)
@@ -13,13 +13,15 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
-
+<%@ attribute name="accountsCanCrossCharts" required="false"  description="Whether or not accounts can cross charts"%>
 <c:set var="documentAttributes"	value="${DataDictionary.EffortCertificationDocument.attributes}" />
 <c:set var="detailAttributes" value="${DataDictionary.EffortCertificationDetail.attributes}" />
 
 <c:set var="summarizedDetailLines" value="${KualiForm.document.summarizedDetailLines}"/>
 <c:set var="newDetailLine" value="${KualiForm.newDetailLine}"/>
+   
     
 <kul:tab tabTitle="Effort Summary" defaultOpen="true" tabErrorKey="${EffortConstants.EFFORT_CERTIFICATION_TAB_ERRORS}">
 	
@@ -35,38 +37,82 @@
 			
 			<tr>
 				<kul:htmlAttributeHeaderCell literalLabel="${KFSConstants.ADD_PREFIX}: "/>
-				
+				<c:choose>
+				<c:when test="${!accountsCanCrossCharts}">
+				 <span id="document.chartOfAccountsCode.div">
 				<ec:detailLine detailLine="${newDetailLine}" detailLineFormName="newDetailLine" attributes="${detailAttributes}"
 					detailFieldNames="${newLineDetailFieldNames}"
-					editableFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
-					onchangeForEditableFieldNames="loadChartInfo,effortAmountUpdator.loadAccountInfo,loadSubAccountInfo"
-					onchangeableInfoFieldNames="chartOfAccounts.finChartOfAccountDescription,account.accountName,subAccount.subAccountName"
+					editableFieldNames="accountNumber,subAccountNumber,effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
+					detailFieldNamesWithHiddenFormWhenReadonly="chartOfAccountsCode"
+					fieldInfo="${KualiForm.detailLineFieldInfo}"
+					onchangeForEditableFieldNames="effortAmountUpdator.loadChartAccountInfo,loadSubAccountInfo"
+					onchangeableInfoFieldNames="account.accountName,subAccount.subAccountName"
 					relationshipMetadata ="${KualiForm.relationshipMetadata}"
 					hasActions="true" actions="addSummarizedDetailLine" actionImageFileNames="tinybutton-add1.gif" />
+				</span>
+				</c:when>
+				<c:otherwise>
+					<ec:detailLine detailLine="${newDetailLine}" detailLineFormName="newDetailLine" attributes="${detailAttributes}"
+						detailFieldNames="${newLineDetailFieldNames}"
+						editableFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
+						onchangeForEditableFieldNames="loadChartInfo,effortAmountUpdator.prototype.loadAccountInfo,loadSubAccountInfo"
+						onchangeableInfoFieldNames="chartOfAccounts.finChartOfAccountDescription,account.accountName,subAccount.subAccountName"
+						relationshipMetadata ="${KualiForm.relationshipMetadata}"
+						hasActions="true" actions="addSummarizedDetailLine" actionImageFileNames="tinybutton-add1.gif" />
+				</c:otherwise>
+				</c:choose>
 			</tr>
 		</table>
 	</div>
 	
 	<div class="tab-container" align=center>
-		<ec:detailLinesWithGrouping id="editableDetailLineTable" 
-			detailLines="${summarizedDetailLines}"
-			detailLineFormName="document.summarizedDetailLines" 
-			attributes="${detailAttributes}"
-			detailFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount"
-			detailFieldNamesWithHiddenFormWhenReadonly="chartOfAccountsCode,accountNumber,subAccountNumber,financialObjectCode,sourceChartOfAccountsCode,sourceAccountNumber,positionNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount"				
-			hiddenFieldNames="documentNumber,universityFiscalYear,financialObjectCode,sourceChartOfAccountsCode,sourceAccountNumber,positionNumber,costShareSourceSubAccountNumber,originalFringeBenefitAmount,fringeBenefitAmount,newLineIndicator,federalOrFederalPassThroughIndicator,persistedPayrollAmount,persistedEffortPercent,groupId,versionNumber"			
-			inquirableUrl="${KualiForm.summarizedDetailLineFieldInquiryUrl}"
-			fieldInfo="${KualiForm.summarizedDetailLineFieldInfo}"
-			sortableFieldNames="chartOfAccountsCode,accountNumber,effortCertificationPayrollAmount"
-			editableFieldNames="effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
-			extraEditableFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber"
-			onchangeForExtraEditableFieldNames="loadChartInfo,effortAmountUpdator.loadAccountInfo,loadSubAccountInfo"
-			onchangeableInfoFieldNames=""	
-			onchangeableExtraInfoFieldNames="chartOfAccounts.finChartOfAccountDescription,account.accountName,subAccount.subAccountName"			
-			relationshipMetadata="${KualiForm.relationshipMetadata}"
-			ferderalTotalFieldNames="federalTotalOriginalEffortPercent,federalTotalEffortPercent,federalTotalOriginalPayrollAmount,federalTotalPayrollAmount" 
-			nonFerderalTotalFieldNames="otherTotalOriginalEffortPercent,otherTotalEffortPercent,otherTotalOriginalPayrollAmount,otherTotalPayrollAmount"
-			grandTotalFieldNames="totalOriginalEffortPercent,totalEffortPercent,totalOriginalPayrollAmount,totalPayrollAmount"
-			hasActions="true" actionSuffix="SummarizedDetailLine"/>			
+		<c:choose>
+			<c:when test="${accountsCanCrossCharts}">
+			<ec:detailLinesWithGrouping id="editableDetailLineTable" 
+				detailLines="${summarizedDetailLines}"
+				detailLineFormName="document.summarizedDetailLines" 
+				attributes="${detailAttributes}"
+				detailFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount"
+				detailFieldNamesWithHiddenFormWhenReadonly="chartOfAccountsCode,accountNumber,subAccountNumber,financialObjectCode,sourceChartOfAccountsCode,sourceAccountNumber,positionNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount"				
+				hiddenFieldNames="documentNumber,universityFiscalYear,financialObjectCode,sourceChartOfAccountsCode,sourceAccountNumber,positionNumber,costShareSourceSubAccountNumber,originalFringeBenefitAmount,fringeBenefitAmount,newLineIndicator,federalOrFederalPassThroughIndicator,persistedPayrollAmount,persistedEffortPercent,groupId,versionNumber"			
+				inquirableUrl="${KualiForm.summarizedDetailLineFieldInquiryUrl}"
+				fieldInfo="${KualiForm.summarizedDetailLineFieldInfo}"
+				sortableFieldNames="chartOfAccountsCode,accountNumber,effortCertificationPayrollAmount"
+				editableFieldNames="effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
+				extraEditableFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber"
+				onchangeForExtraEditableFieldNames="loadChartInfo,effortAmountUpdator.loadAccountInfo,loadSubAccountInfo"
+				onchangeableInfoFieldNames=""	
+				onchangeableExtraInfoFieldNames="chartOfAccounts.finChartOfAccountDescription,account.accountName,subAccount.subAccountName"			
+				relationshipMetadata="${KualiForm.relationshipMetadata}"
+				ferderalTotalFieldNames="federalTotalOriginalEffortPercent,federalTotalEffortPercent,federalTotalOriginalPayrollAmount,federalTotalPayrollAmount" 
+				nonFerderalTotalFieldNames="otherTotalOriginalEffortPercent,otherTotalEffortPercent,otherTotalOriginalPayrollAmount,otherTotalPayrollAmount"
+				grandTotalFieldNames="totalOriginalEffortPercent,totalEffortPercent,totalOriginalPayrollAmount,totalPayrollAmount"
+				hasActions="true" actionSuffix="SummarizedDetailLine"/>
+			</c:when>	
+			<c:otherwise>
+				 <span id="document.summarizedDetailLines.div">
+				 <ec:detailLinesWithGrouping id="editableDetailLineTable" 
+					detailLines="${summarizedDetailLines}"
+					detailLineFormName="document.summarizedDetailLines" 
+					attributes="${detailAttributes}"
+					detailFieldNames="chartOfAccountsCode,accountNumber,subAccountNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount"
+					detailFieldNamesWithHiddenFormWhenReadonly="chartOfAccountsCode,accountNumber,subAccountNumber,financialObjectCode,sourceChartOfAccountsCode,sourceAccountNumber,positionNumber,effortCertificationCalculatedOverallPercent,effortCertificationUpdatedOverallPercent,effortCertificationOriginalPayrollAmount,effortCertificationPayrollAmount"				
+					hiddenFieldNames="documentNumber,universityFiscalYear,financialObjectCode,sourceChartOfAccountsCode,sourceAccountNumber,positionNumber,costShareSourceSubAccountNumber,originalFringeBenefitAmount,fringeBenefitAmount,newLineIndicator,federalOrFederalPassThroughIndicator,persistedPayrollAmount,persistedEffortPercent,groupId,versionNumber"			
+					inquirableUrl="${KualiForm.summarizedDetailLineFieldInquiryUrl}"
+					fieldInfo="${KualiForm.summarizedDetailLineFieldInfo}"
+					sortableFieldNames="chartOfAccountsCode,accountNumber,effortCertificationPayrollAmount"
+					editableFieldNames="effortCertificationUpdatedOverallPercent,effortCertificationPayrollAmount"
+					extraEditableFieldNames="accountNumber,subAccountNumber"
+					onchangeForExtraEditableFieldNames="effortAmountUpdator.loadAccountInfo,loadSubAccountInfo"
+					onchangeableInfoFieldNames=""	
+					onchangeableExtraInfoFieldNames="account.accountName,subAccount.subAccountName"			
+					relationshipMetadata="${KualiForm.relationshipMetadata}"
+					ferderalTotalFieldNames="federalTotalOriginalEffortPercent,federalTotalEffortPercent,federalTotalOriginalPayrollAmount,federalTotalPayrollAmount" 
+					nonFerderalTotalFieldNames="otherTotalOriginalEffortPercent,otherTotalEffortPercent,otherTotalOriginalPayrollAmount,otherTotalPayrollAmount"
+					grandTotalFieldNames="totalOriginalEffortPercent,totalEffortPercent,totalOriginalPayrollAmount,totalPayrollAmount"
+					hasActions="true" actionSuffix="SummarizedDetailLine"/>
+				 </span>
+			</c:otherwise>		
+		</c:choose>
 	</div>
 </kul:tab>
Index: work/web-root/WEB-INF/tags/module/purap/paymentRequestItems.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/purap/paymentRequestItems.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/purap/paymentRequestItems.tag	(revision 37225)
@@ -44,21 +44,21 @@
 <c:if test="${KualiForm.countOfAboveTheLine>=1}">
 	<tr>
 		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemLineNumber}" width="2%"/>
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poOutstandingQuantity}" width="12%"/>
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemUnitOfMeasureCode}" width="12%" />
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.purchaseOrderItemUnitPrice}" width="12%"/>				
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemQuantity}" width="12%"/>				
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemUnitPrice}" width="12%"/>
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.extendedPrice}" width="12%"/>
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poOutstandingQuantity}" width="2%" />
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemUnitOfMeasureCode}" width="5%" />
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.purchaseOrderItemUnitPrice}" width="5%"/>				
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemQuantity}" width="5%" />
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemUnitPrice}" width="5%"/>
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.extendedPrice}" width="5%"/>
 		
 		<c:if test="${purapTaxEnabled}">
-			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemTaxAmount}" width="12%"/>		
-			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.totalAmount}" width="12%"/>
+			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemTaxAmount}" width="5%"/>		
+			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.totalAmount}"  width="5%"/>
 		</c:if>
 
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemCatalogNumber}" width="12%"/>
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemAssignedToTradeInIndicator}" width="25%"/>		
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemDescription}" width="25%" colspan="${colSpanDescription}"/>
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemCatalogNumber}" width="5%" />
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemAssignedToTradeInIndicator}" width="2%" />		
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemDescription}" width="45%"  colspan="${colSpanDescription}"/>
 	</tr>
 </c:if>
 
@@ -195,7 +195,7 @@
 				    property="document.item[${ctr}].itemAssignedToTradeInIndicator"
 				    readOnly="true" />
 			</td>			    
-			<td class="infoline" colspan="${colSpanDescription}">
+			<td  class="infoline" colspan="${colSpanDescription}">
 			    <kul:htmlControlAttribute
 				    attributeEntry="${itemAttributes.itemDescription}"
 				    property="document.item[${ctr}].itemDescription"
Index: work/web-root/WEB-INF/tags/module/purap/receivingLineItems.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/purap/receivingLineItems.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/purap/receivingLineItems.tag	(revision 37225)
@@ -46,6 +46,16 @@
 						<html:image property="methodToCall.loadQty" src="${ConfigProperties.externalizable.images.url}tinybutton-loadqtyreceived.gif" alt="load qty received" title="load qty received" styleClass="tinybutton" />
 						<html:image property="methodToCall.clearQty" src="${ConfigProperties.externalizable.images.url}tinybutton-clearqtyreceived.gif" alt="clear qty received" title="clear qty received" styleClass="tinybutton" />
 					</c:if>
+					<c:if test="${KualiForm.hideAddUnorderedItem}">
+						<html:image property="methodToCall.showAddUnorderedItem"
+							src="${ConfigProperties.externalizable.images.url}tinybutton-addunorditem.gif"
+							alt="add unordered item" title="add unordered item"
+							styleClass="tinybutton" />
+					</c:if>
+					<c:if test="${!KualiForm.hideAddUnorderedItem}">
+						<img src="${ConfigProperties.externalizable.images.url}tinybutton-addunorditem-grey.gif"
+							alt="add unordered item" border="0" styleClass="tinybutton" />
+					</c:if>
 				</div>
 			</td>
 		</tr>
@@ -72,7 +82,7 @@
 		</tr>
 		
 		<!--  New Receiving Line Item -->
-		<c:if test="${fullEntryMode}">
+		<c:if test="${fullEntryMode and !KualiForm.hideAddUnorderedItem}">
 		<tr>
             <td class="infoline">
                 <kul:htmlControlAttribute attributeEntry="${itemAttributes.itemLineNumber}" property="newLineItemReceivingItemLine.itemLineNumber" readOnly="${true}"/>
Index: work/web-root/WEB-INF/tags/module/purap/creditMemoItems.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/purap/creditMemoItems.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/purap/creditMemoItems.tag	(revision 37225)
@@ -47,28 +47,28 @@
 		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemLineNumber}" width="2%"/>
 		
 		<c:if test="${usePO}" >
-	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poInvoicedTotalQuantity}" width="12%"/>
-	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poUnitPrice}" width="12%"/>		
-	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poTotalAmount}" width="12%"/>
+	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poInvoicedTotalQuantity}" width="7%"/>
+	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poUnitPrice}" width="7%"/>		
+	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.poTotalAmount}" width="7%"/>
 	    </c:if>
 	    
 		<c:if test="${!usePO}" >
-	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.preqInvoicedTotalQuantity}" width="12%"/>
-	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.preqUnitPrice}" width="12%"/>		
-	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.preqTotalAmount}" width="12%"/>
+	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.preqInvoicedTotalQuantity}" width="7%"/>
+	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.preqUnitPrice}" width="7%"/>		
+	    	<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.preqTotalAmount}" width="7%"/>
 	    </c:if>
 	    	
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemQuantity}" width="12%"/>		
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemUnitPrice}" width="12%"/>
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.extendedPrice}" width="12%"/>
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemQuantity}" width="7%"/>		
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemUnitPrice}" width="7%"/>
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.extendedPrice}" width="7%"/>
 
 		<c:if test="${purapTaxEnabled}">
-			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemTaxAmount}" width="12%"/>		
-			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.totalAmount}" width="12%"/>
+			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemTaxAmount}" width="7%"/>		
+			<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.totalAmount}" width="7%"/>
 		</c:if>
 
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemCatalogNumber}" width="12%"/>
-		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemDescription}" width="25%" colspan="${colSpanDescription}"/>
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemCatalogNumber}" width="7%"/>
+		<kul:htmlAttributeHeaderCell attributeEntry="${itemAttributes.itemDescription}" width="45%" colspan="${colSpanDescription}"/>
 	</tr>
 </c:if>
 
Index: work/web-root/WEB-INF/tags/module/purap/vendor.tag
===================================================================
--- work/web-root/WEB-INF/tags/module/purap/vendor.tag	(revision 30259)
+++ work/web-root/WEB-INF/tags/module/purap/vendor.tag	(revision 37225)
@@ -211,6 +211,17 @@
                     	readOnly="${(readOnlyForPREQ) or not (fullEntryMode or amendmentEntry) or displayCreditMemoFields or (lockB2BEntry and (displayRequisitionFields or displayPurchaseOrderFields))}" tabindexOverride="${tabindexOverrideBase + 3}"/>
             	</td>
             </tr>
+            <c:if test="${(not empty KualiForm.document.vendorDetail) and KualiForm.document.vendorDetail.vendorHeader.vendorDebarredIndicator}">
+            <tr>
+            	<th align=right valign=middle class="bord-l-b" >
+            		<div align="right"><kul:htmlAttributeLabel attributeEntry="${documentAttributes.justification}" /></div>
+            	</th>
+            	<td align=left valign=middle class="datacell">
+                    <kul:htmlControlAttribute 
+                    	attributeEntry="${documentAttributes.justification}" property="document.justification" tabindexOverride="${tabindexOverrideBase + 0}"/>
+            	</td>
+            </tr>
+            </c:if>
 
             <tr>
                 <td colspan="4" class="subhead">Vendor Info</td>
Index: work/web-root/scripts/pdp/objectInfo.js
===================================================================
--- work/web-root/scripts/pdp/objectInfo.js	(revision 30259)
+++ work/web-root/scripts/pdp/objectInfo.js	(revision 37225)
@@ -14,16 +14,17 @@
  * limitations under the License.
  */
 
+
 function loadAchBankInfo(bankRoutingField) {
     var bankRoutingNumber = dwr.util.getValue( bankRoutingField.name ).trim();
-    var targetFieldName = findElPrefix( primaryKeyField.name ) + ".bankRouting.bankName";
+    var targetFieldName = findElPrefix( bankRoutingField.name ) + ".bankRouting.bankName";
 
-	if (bankRoutingNumber=='') {
+	if (bankRoutingNumber=="") {
 		clearRecipients(targetFieldName, "");
 	} else {
 		var dwrReply = {
 			callback:function(data) {
-			if ( data != null && typeof data == 'object' ) {
+			if ( data != null && typeof data == "object" ) {
 				setRecipientValue( targetFieldName, data.bankName );
 			} else {
 				setRecipientValue( targetFieldName, wrapError( "bank not found" ), true );			
@@ -36,3 +37,19 @@
 		AchBankService.getByPrimaryId( bankRoutingNumber, dwrReply );
 	}
 }
+
+function submit(payeeIdTypeCodeField) {
+	// always force a form submit in case of change on payee type, so the readOnly fields will be re-evaluated 
+	document.forms[0].submit();
+	/*
+	alert("payeeIdTypeCodeFieldName = " + payeeIdTypeCodeField.name);
+	var payeeIdTypeCode = dwr.util.getValue(payeeIdTypeCodeField.name).trim();
+	alert("payeeIdTypeCode = " + payeeIdTypeCode);
+	if (payeeIdTypeCode == "E" || payeeIdTypeCode == "T") {
+		var form = document.forms[0];
+		form.methodToCall="post";
+		alert("submit form...");
+		form.submit();
+	}
+	*/
+}
\ No newline at end of file
Index: work/web-root/scripts/module/ar/receivableObjectInfo.js
===================================================================
--- work/web-root/scripts/module/ar/receivableObjectInfo.js	(revision 30259)
+++ work/web-root/scripts/module/ar/receivableObjectInfo.js	(revision 37225)
@@ -15,6 +15,7 @@
  */
 
 var receivableChartCodeSuffix = ".paymentChartOfAccountsCode";
+var receivableChartNameSuffix = ".paymentChartOfAccounts.finChartOfAccountDescription";
 var receivableAccountNumberSuffix = ".paymentAccountNumber";
 var receivableSubAccountNumberSuffix = ".paymentSubAccountNumber";
 var receivableSubAccountNameSuffix = ".paymentSubAccount.subAccountName";
@@ -22,6 +23,57 @@
 var receivableSubObjectCodeSuffix = ".paymentFinancialSubObjectCode";
 var receivableSubObjectCodeNameSuffix = ".paymentSubObjectCode.financialSubObjectCodeName";
 
+/**
+ * Loads account info and chart info when ACCOUNT_CAN_CROSS_CHART is false.
+ * @param accountCodeFieldName
+ * @param accountNameFieldName
+ * @return
+ */
+function loadReceivableChartAccountInfo( accountCodeFieldName, accountNameFieldName ) {
+    var elPrefix = findElPrefix( accountCodeFieldName );
+	var coaCodeFieldName = elPrefix + receivableChartCodeSuffix;
+	var coaNameFieldName = elPrefix + receivableChartNameSuffix;
+	var accountCode = dwr.util.getValue( accountCodeFieldName );
+    
+    if (valueChanged( accountCodeFieldName )) {
+        setRecipientValue( elPrefix + receivableSubAccountNumberSuffix, "" );
+        setRecipientValue( elPrefix + receivableSubAccountNameSuffix, "" );
+        setRecipientValue( elPrefix + receivableSubObjectCodeSuffix, "" );
+        setRecipientValue( elPrefix + receivableSubObjectCodeNameSuffix, "" );
+    }
+    
+    if (accountCode=='') {
+		clearRecipients(accountNameFieldName);
+		clearRecipients(coaCodeFieldName);    		
+		clearRecipients(coaNameFieldName);    		
+	} else {
+		var dwrReply = {
+			callback:function(data) {
+			if ( data != null && typeof data == 'object' ) {
+				setRecipientValue( accountNameFieldName, data.accountName );
+				setRecipientValue( coaCodeFieldName, data.chartOfAccountsCode );
+				setRecipientValue( coaNameFieldName, data.chartOfAccounts.finChartOfAccountDescription );
+			} else {
+				setRecipientValue( accountNameFieldName, wrapError( "account not found" ), true );			
+				clearRecipients(coaCodeFieldName);    		
+				clearRecipients(coaNameFieldName);
+			} },
+			errorHandler:function( errorMessage ) { 
+				setRecipientValue( accountNameFieldName, wrapError( "account not found" ), true );
+				clearRecipients(coaCodeFieldName);    		
+				clearRecipients(coaNameFieldName);  
+			}
+		};
+		AccountService.getUniqueAccountForAccountNumber( accountCode, dwrReply );	  
+	}	
+}
+
+/**
+ * Loads account info and chart info when ACCOUNT_CAN_CROSS_CHART is true.
+ * @param accountCodeFieldName
+ * @param accountNameFieldName
+ * @return
+ */
 function loadReceivableAccountInfo( accountCodeFieldName, accountNameFieldName ) {
     var elPrefix = findElPrefix( accountCodeFieldName );
     var accountCode = dwr.util.getValue( accountCodeFieldName );
Index: work/web-root/scripts/module/cams/assetTransfer.js
===================================================================
--- work/web-root/scripts/module/cams/assetTransfer.js	(revision 0)
+++ work/web-root/scripts/module/cams/assetTransfer.js	(revision 37225)
@@ -0,0 +1,59 @@
+/*
+ * Copyright 2006 The Kuali Foundation
+ * 
+ * Licensed under the Educational Community License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.opensource.org/licenses/ecl2.php
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+function onblur_accountNumber( accountNumberField, coaCodePropertyName ) {
+	var accountNumberFieldName = accountNumberField.name;
+	var coaCodeFieldName = findElPrefix(accountNumberFieldName) + "." + coaCodePropertyName;
+    var accountNumber = dwr.util.getValue( accountNumberFieldName );	    
+	//alert("coaCodeFieldName = " + coaCodeFieldName + ", accountNumberFieldName = " + accountNumberFieldName);
+
+	var dwrReply = {
+		callback: function (param) {
+			if ( typeof param == "boolean" && param == false) {	
+				loadChartCode(accountNumber, coaCodeFieldName);
+			}
+		},	
+		errorHandler:function( errorMessage ) { 
+			window.status = errorMessage;
+		}
+	};
+	AccountService.accountsCanCrossCharts(dwrReply);	
+}
+
+function loadChartCode( accountNumber, coaCodeFieldName ) {
+	if (accountNumber == "") {
+		clearRecipients(coaCodeFieldName);    		
+	}
+	else {
+		var dwrReply = {
+				callback: function (data) {
+				//alert("chartOfAccountsCode = " + data.chartOfAccountsCode + ", accountNumber = " + accountNumber);
+				if ( data != null && typeof data == "object" ) {   
+					setRecipientValue( coaCodeFieldName, data.chartOfAccountsCode );
+				}
+				else {
+					clearRecipients(coaCodeFieldName); 
+				}
+			},
+			errorHandler:function( errorMessage ) { 
+				clearRecipients(coaCodeFieldName); 
+				window.status = errorMessage;
+			}
+		};
+		AccountService.getUniqueAccountForAccountNumber( accountNumber, dwrReply );	    
+	}
+}
+
Index: work/web-root/scripts/module/cams/assetGlobalMaintenanceDocument.js
===================================================================
--- work/web-root/scripts/module/cams/assetGlobalMaintenanceDocument.js	(revision 30259)
+++ work/web-root/scripts/module/cams/assetGlobalMaintenanceDocument.js	(revision 37225)
@@ -40,7 +40,7 @@
 	lookupOrgCode(chartCode, accountNumber, orgCodeFieldName);
 }
 
-function onblur_accountNumber( accountNumberField ) {
+function onblur_accountNumber_org( accountNumberField ) {
     var chartCodeFieldName = findChartCodeFieldName(accountNumberField.name);
     var orgCodeFieldName = findOrgCodeFieldName(accountNumberField.name);
     var accountNumber = getElementValue(accountNumberField.name);    
@@ -53,7 +53,7 @@
 			    lookupOrgCode(chartCode, accountNumber, orgCodeFieldName);
 			}
 			else {
-				loadChartAccount(accountNumber, chartCodeFieldName, accountNumberField.name, orgCodeFieldName);
+				loadChartOrg(accountNumber, chartCodeFieldName, accountNumberField.name, orgCodeFieldName);
 			}
 		},	
 		errorHandler:function( errorMessage ) { 
@@ -63,7 +63,7 @@
 	AccountService.accountsCanCrossCharts(dwrReply);	
 }
 
-function loadChartAccount( accountNumber, chartCodeFieldName, accountNumberFieldName, orgCodeFieldName ) {
+function loadChartOrg( accountNumber, chartCodeFieldName, accountNumberFieldName, orgCodeFieldName ) {
 	if (accountNumber == "") {
 		clearRecipients(chartCodeFieldName);    
 		clearRecipients(orgCodeFieldName);
@@ -120,6 +120,50 @@
 	return orgCodeFieldName;
 }    
 
+function onblur_accountNumber_pay( accountNumberField ) {
+	var accountNumberFieldName = accountNumberField.name;
+	var coaCodeFieldName = findElPrefix(accountNumberFieldName) + ".chartOfAccountsCode";
+    var accountNumber = getElementValue( accountNumberFieldName );	    
+	//alert("coaCodeFieldName = " + coaCodeFieldName + ", accountNumberFieldName = " + accountNumberFieldName);
+
+	var dwrReply = {
+		callback: function (param) {
+			if ( typeof param == "boolean" && param == false) {	
+				loadChartCode(accountNumber, coaCodeFieldName);
+			}
+		},	
+		errorHandler:function( errorMessage ) { 
+			window.status = errorMessage;
+		}
+	};
+	AccountService.accountsCanCrossCharts(dwrReply);	
+}
+
+function loadChartCode( accountNumber, coaCodeFieldName ) {
+	if (accountNumber == "") {
+		clearRecipients(coaCodeFieldName);    		
+	}
+	else {
+		var dwrReply = {
+				callback: function (data) {
+				//alert("chartOfAccountsCode = " + data.chartOfAccountsCode + ", accountNumber = " + accountNumber);
+				if ( data != null && typeof data == "object" ) {   
+					//var coaValue = data.chartOfAccountsCode + " - " + data.chartOfAccounts.finChartOfAccountDescription;
+					setRecipientValue( coaCodeFieldName, data.chartOfAccountsCode );
+				}
+				else {
+					clearRecipients(coaCodeFieldName); 
+				}
+			},
+			errorHandler:function( errorMessage ) { 
+				clearRecipients(coaCodeFieldName); 
+				window.status = errorMessage;
+			}
+		};
+		AccountService.getUniqueAccountForAccountNumber( accountNumber, dwrReply );	    
+	}
+}
+
 function makeDwrSingleReply( boName, propertyName, targetFieldName ) {
     var friendlyBoName = boName.replace(/([A-Z])/g, ' $1').toLowerCase();
     return {
@@ -135,7 +179,6 @@
         }
     };
 }
-*/
 
 function onblur_postingYearAndPeriodCode(field, callbackFunction) {
 	var postedDate = getElementValue(field.name).trim();
Index: work/web-root/scripts/module/bc/objectInfo.js
===================================================================
--- work/web-root/scripts/module/bc/objectInfo.js	(revision 30259)
+++ work/web-root/scripts/module/bc/objectInfo.js	(revision 37225)
@@ -1,5 +1,6 @@
 /*
  * Copyright 2007-2008 The Kuali Foundation
+
  * 
  * Licensed under the Educational Community License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -14,6 +15,14 @@
  * limitations under the License.
  */
  
+
+var chartCodeSuffix = ".chartOfAccountsCode";
+var chartNameSuffix = ".chartOfAccounts.finChartOfAccountDescription";
+var accountNumberSuffix = ".accountNumber";
+var accountNameSuffix = ".account.accountName";
+var subAccountNumberSuffix = ".subAccountNumber";
+var subAccountNameSuffix = ".subAccount.subAccountName";
+
 /**
  * import the given javascript into the hosting document
  * 
@@ -290,4 +299,51 @@
 	}
 }
 
+/**
+* Loads account info and chart info when ACCOUNT_CAN_CROSS_CHART is false.
+* @param accountCodeFieldName
+* @param accountNameFieldName
+* @return
+*/
+BudgetObjectInfoUpdator.prototype.loadChartAccountInfo = function( accountCodeFieldName, accountNameFieldName ) {
+    var elPrefix = findElPrefix( accountCodeFieldName );
+    var accountCode = dwr.util.getValue( accountCodeFieldName );
+    var coaCodeFieldName =  elPrefix + chartCodeSuffix ;
+    var coaNameFieldName =  elPrefix + chartNameSuffix ;
+
+    if (valueChanged( accountCodeFieldName )) {
+        setRecipientValue( elPrefix + subAccountNumberSuffix, "" );
+        setRecipientValue( elPrefix + subAccountNameSuffix, "" );
+    }
+    
+    if (accountCode=='') {
+		clearRecipients(accountNameFieldName);
+		clearRecipients(coaCodeFieldName);
+		clearRecipients(coaNameFieldName);    
+		
+	} else {
+		var dwrReply = {
+			callback:function(data) {
+			if ( data != null && typeof data == 'object' ) {
+				setRecipientValue( accountNameFieldName, data.accountName  );
+				setRecipientValue( coaCodeFieldName, data.chartOfAccountsCode );
+			    setRecipientValue( coaNameFieldName, data.chartOfAccounts.finChartOfAccountDescription );
+			    
+			} else {
+				setRecipientValue( accountNameFieldName, wrapError( "account not found" ), true );	
+				clearRecipients(coaCodeFieldName);  
+				clearRecipients(coaNameFieldName);
+			} },
+			errorHandler:function( errorMessage ) { 
+				setRecipientValue( accountNameFieldName, wrapError( "account not found" ), true );
+				clearRecipients(coaCodeFieldName);  
+				clearRecipients(coaNameFieldName);
+			}
+		};
+		
+		 AccountService.getUniqueAccountForAccountNumber( accountCode, dwrReply ); 
+	}	
+}
+
 var budgetObjectInfoUpdator = new BudgetObjectInfoUpdator();
+
Index: work/web-root/scripts/module/ec/objectInfo.js
===================================================================
--- work/web-root/scripts/module/ec/objectInfo.js	(revision 30259)
+++ work/web-root/scripts/module/ec/objectInfo.js	(revision 37225)
@@ -23,7 +23,7 @@
 	fiscalYearFieldNameSuffix = ".universityFiscalYear";
 	objectCodeFieldNameSuffix = ".financialObjectCode";
 	chartOfAccountsCodeFieldNameSuffix = ".chartOfAccountsCode";
-	
+	chartOfAccountDescSuffix = ".chartOfAccounts.finChartOfAccountDescription";
 	accountNumberSuffix = ".accountNumber";
 	accountNameSuffix = ".account.accountName";
 	chartCodeSuffix = ".chartOfAccountsCode";
@@ -153,6 +153,12 @@
 	}
 };
 
+/**
+	* Loads account info and chart info when ACCOUNT_CAN_CROSS_CHART is true.
+	* @param accountCodeFieldName
+	* @param accountNameFieldName
+	* @return
+	*/
 EffortAmountUpdator.prototype.loadAccountInfo = function( accountCodeFieldName, accountNameFieldName ) {
     var elPrefix = findElPrefix( accountCodeFieldName );
     var accountCode = dwr.util.getValue( accountCodeFieldName );
@@ -185,6 +191,53 @@
 	}	
 }
 
+/**
+* Loads account info and chart info when ACCOUNT_CAN_CROSS_CHART is false.
+* @param accountCodeFieldName
+* @param accountNameFieldName
+* @return
+*/
+EffortAmountUpdator.prototype.loadChartAccountInfo = function( accountCodeFieldName, accountNameFieldName ) {
+    var elPrefix = findElPrefix( accountCodeFieldName );
+    var accountCode = dwr.util.getValue( accountCodeFieldName );
+    var coaCodeFieldName =  elPrefix + chartCodeSuffix ;
+    var coaNameFieldName =  elPrefix + chartOfAccountDescSuffix ;
+
+    if (valueChanged( accountCodeFieldName )) {
+        setRecipientValue( elPrefix + subAccountNumberSuffix, "" );
+        setRecipientValue( elPrefix + subAccountNameSuffix, "" );
+        setRecipientValue( elPrefix + subObjectCodeSuffix, "" );
+        setRecipientValue( elPrefix + subObjectCodeNameSuffix, "" );
+    }
+    
+    if (accountCode=='') {
+		clearRecipients(accountNameFieldName);
+		clearRecipients(coaCodeFieldName);
+		clearRecipients(coaNameFieldName);    
+		
+	} else {
+		var dwrReply = {
+			callback:function(data) {
+			if ( data != null && typeof data == 'object' ) {
+				setRecipientValue( accountNameFieldName, data.accountName  );
+				setRecipientValue( coaCodeFieldName, data.chartOfAccountsCode );
+			    setRecipientValue( coaNameFieldName, data.chartOfAccounts.finChartOfAccountDescription );
+			} else {
+				setRecipientValue( accountNameFieldName, wrapError( "account not found" ), true );	
+				clearRecipients(coaCodeFieldName);  
+				clearRecipients(coaNameFieldName);
+			} },
+			errorHandler:function( errorMessage ) { 
+				setRecipientValue( accountNameFieldName, wrapError( "account not found" ), true );
+				clearRecipients(coaCodeFieldName);  
+				clearRecipients(coaNameFieldName);
+			}
+		};
+		//EffortCertificationForm.loadAccountInfo( coaCode, accountCode, dwrReply );
+		 AccountService.getUniqueAccountForAccountNumber( accountCode, dwrReply ); 
+	}	
+}
+
 EffortAmountUpdator.prototype.setValueByElementId = function(elementId, value){
 	if(document.getElementById(elementId) != null || document.getElementsByName(elementId).length > 0){
 		dwr.util.setValue( elementId, value);
Index: work/web-root/static/images/tinybutton-addunorditem.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: work/web-root/static/images/tinybutton-addunorditem.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: work/web-root/static/images/tinybutton-addunorditem-grey.gif
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: work/web-root/static/images/tinybutton-addunorditem-grey.gif
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Index: work/web-root/jsp/gl/ModifiedInquiry.jsp
===================================================================
--- work/web-root/jsp/gl/ModifiedInquiry.jsp	(revision 30259)
+++ work/web-root/jsp/gl/ModifiedInquiry.jsp	(revision 37225)
@@ -31,7 +31,7 @@
 	<html-el:hidden name="KualiForm" property="conversionFields" />
 	<html-el:hidden name="KualiForm" property="hideReturnLink" />
 	<kul:errors errorTitle="Errors found in Search Criteria:" />
-	<table width="1200px" cellspacing="0" cellpadding="0">
+	<table width="1000px" cellspacing="0" cellpadding="0">
 		<tr>
 			<td width="1%"><img
 				src="${ConfigProperties.kr.externalizable.images.url}pixel_clear.gif"
Index: work/web-root/jsp/fp/YearEndGeneralErrorCorrection.jsp
===================================================================
--- work/web-root/jsp/fp/YearEndGeneralErrorCorrection.jsp	(revision 30259)
+++ work/web-root/jsp/fp/YearEndGeneralErrorCorrection.jsp	(revision 37225)
@@ -42,6 +42,6 @@
 
 	<kul:panelFooter />
 
-	<sys:documentControls transactionalDocument="${documentEntry.transactionalDocument}" />
+	<sys:documentControls transactionalDocument="${documentEntry.transactionalDocument}" extraButtons="${KualiForm.extraButtons}" />
 
 </kul:documentPage>
Index: work/web-root/jsp/fp/DepositWizard.jsp
===================================================================
--- work/web-root/jsp/fp/DepositWizard.jsp	(revision 30259)
+++ work/web-root/jsp/fp/DepositWizard.jsp	(revision 37225)
@@ -62,10 +62,10 @@
 	<html:hidden property="cashManagementDocId" />
 	<html:hidden property="depositTypeCode" />
 	<html:hidden property="currencyDetail.documentNumber" />
-	<html:hidden property="currencyDetail.cashieringRecordSource" />
+	<html:hidden property="currencyDetail.cashieringStatus" />
 	<html:hidden property="currencyDetail.financialDocumentTypeCode" />
 	<html:hidden property="coinDetail.documentNumber" />
-	<html:hidden property="coinDetail.cashieringRecordSource" />
+	<html:hidden property="coinDetail.cashieringStatus" />
 	<html:hidden property="coinDetail.financialDocumentTypeCode" />
 
 	<c:if test="${!empty KualiForm.depositableCashReceipts || !empty KualiForm.depositableCashieringChecks || !empty KualiForm.checkFreeCashReceipts}">
@@ -182,15 +182,15 @@
 						</td>
 						<td>
 						<div align="center">
-						$&nbsp;<c:out value="${cashReceipt.currencyFormattedTotalCheckAmount}" /> <html:hidden
-							property="depositableCashReceipt[${ctr}].totalCheckAmount" /></div>
+						$&nbsp;<c:out value="${cashReceipt.currencyFormattedTotalConfirmedCheckAmount}" /> <html:hidden
+							property="depositableCashReceipt[${ctr}].totalConfirmedCheckAmount" /></div>
 						</td>
 						
 					</tr>
 
-					<c:if test="${cashReceipt.checkCount > 0}">
+					<c:if test="${cashReceipt.confirmedCheckCount > 0}">
 						<tr>
-							<td class="infoline" rowspan="${cashReceipt.checkCount + 1}"
+							<td class="infoline" rowspan="${cashReceipt.confirmedCheckCount + 1}"
 								colspan="2">&nbsp;</td>
 							<td class="infoline"><kul:htmlAttributeLabel
 								attributeEntry="${checkAttributes.checkNumber}" readOnly="true" />
@@ -206,23 +206,23 @@
 							
 						</tr>
 
-						<logic:iterate name="cashReceipt" property="checks" id="check"
+						<logic:iterate name="cashReceipt" property="confirmedChecks" id="confirmedCheck"
 							indexId="checkIndex">
 							<tr>
 								<td><kul:htmlControlAttribute
-									property="depositableCashReceipt[${ctr}].check[${checkIndex}].checkNumber"
+									property="depositableCashReceipt[${ctr}].confirmedCheck[${checkIndex}].checkNumber"
 									attributeEntry="${checkAttributes.checkNumber}" readOnly="true" />
 								</td>
 								<td><kul:htmlControlAttribute
-									property="depositableCashReceipt[${ctr}].check[${checkIndex}].checkDate"
+									property="depositableCashReceipt[${ctr}].confirmedCheck[${checkIndex}].checkDate"
 									attributeEntry="${checkAttributes.checkDate}" readOnly="true" />
 								</td>
 								<td><kul:htmlControlAttribute
-									property="depositableCashReceipt[${ctr}].check[${checkIndex}].description"
+									property="depositableCashReceipt[${ctr}].confirmedCheck[${checkIndex}].description"
 									attributeEntry="${checkAttributes.description}" readOnly="true" />
 								</td>
 								<td>$<kul:htmlControlAttribute
-									property="depositableCashReceipt[${ctr}].check[${checkIndex}].amount"
+									property="depositableCashReceipt[${ctr}].confirmedCheck[${checkIndex}].amount"
 									attributeEntry="${checkAttributes.amount}" readOnly="true" />
 								</td>
 							</tr>
@@ -274,7 +274,7 @@
 						<td>&nbsp;</td>
 						<td>
 						<div align="center">
-						$&nbsp;<c:out value="${cashReceipt.currencyFormattedSumTotalAmount}" /></div>
+						$&nbsp;<c:out value="${cashReceipt.currencyFormattedFinalSumTotalAmount}" /></div>
 						</td>
 					</tr>
 				</logic:iterate>
Index: work/web-root/jsp/fp/CashReceipt.jsp
===================================================================
--- work/web-root/jsp/fp/CashReceipt.jsp	(revision 30259)
+++ work/web-root/jsp/fp/CashReceipt.jsp	(revision 37225)
@@ -17,6 +17,8 @@
 
 <c:set var="displayHidden" value="false" />
 <c:set var="checkDetailMode" value="${KualiForm.checkEntryDetailMode}" />
+<c:set var="confirmMode" value="${KualiForm.editingMode['cmConfirm']}" />
+<c:set var="changeRequestMode" value="${KualiForm.editingMode['changeRequestOn']}" />
 <c:set var="cashReceiptAttributes"
 	value="${DataDictionary['CashReceiptDocument'].attributes}" />
 <c:set var="readOnly"
@@ -54,6 +56,13 @@
 		<h3>Cash Reconciliation</h3>
 		<table>
 			<tbody>
+				<c:if test="${confirmMode}">
+					<tr>
+						<th>&nbsp;</th>
+						<th>Original</th>
+						<th>Cash Manager</th>
+					</tr>
+				</c:if>
 				<tr>
 					<th width="35%">
 					<div align="right"><kul:htmlAttributeLabel
@@ -77,6 +86,16 @@
 							styleClass="tinybutton" alt="change check entry mode" title="change check entry mode" /></noscript>
 						</td>
 					</c:if>
+					<c:if test="${confirmMode}">
+						<c:if test="${!checkDetailMode}">
+						<td>
+							<kul:htmlControlAttribute property="document.totalConfirmedCheckAmount"
+								attributeEntry="${cashReceiptAttributes.totalCheckAmount}" /></td>
+						</c:if>
+						<c:if test="${checkDetailMode}">
+							<td>${KualiForm.document.currencyFormattedTotalConfirmedCheckAmount}</td>
+						</c:if>
+					</c:if>
 				</tr>
 				<tr>
 					<th>
@@ -85,6 +104,9 @@
 						useShortLabel="false" /></strong></div>
 					</th>
 					<td width="35%" align="left" valign="middle"><c:out value="${KualiForm.document.currencyFormattedTotalCashAmount}" /></td>
+					<c:if test="${confirmMode}">
+						<td width="35%" align="left" valign="middle"><c:out value="${KualiForm.document.currencyFormattedTotalConfirmedCashAmount}" /></td>
+					</c:if>
 				</tr>
 				<tr>
 					<th>
@@ -93,6 +115,9 @@
 						useShortLabel="false" /></strong></div>
 					</th>
 					<td width="35%" align="left" valign="middle"><c:out value="${KualiForm.document.currencyFormattedTotalCoinAmount}" /></td>
+					<c:if test="${confirmMode}">
+						<td width="35%" align="left" valign="middle"><c:out value="${KualiForm.document.currencyFormattedTotalConfirmedCoinAmount}" /></td>
+					</c:if>
 				</tr>
 				<tr>
 					<th>
@@ -104,7 +129,12 @@
 					<c:if test="${!readOnly}">
 						<html:image src="${ConfigProperties.externalizable.images.url}tinybutton-recalculate.gif"
 							styleClass="tinybutton" alt="recalculate total" title="recalculate total" />
-					</c:if> <c:if test="${readOnly}"> &nbsp; </c:if></td>
+					</c:if> <c:if test="${confirmMode}"> &nbsp; 
+						<td width="35%" align="left" valign="middle"><c:out value="${KualiForm.document.currencyFormattedConfirmedSumTotalAmount}" />
+						&nbsp;&nbsp;&nbsp;
+						<html:image src="${ConfigProperties.externalizable.images.url}tinybutton-recalculate.gif"
+							styleClass="tinybutton" alt="recalculate total" title="recalculate total" />
+					</c:if></td>
 				</tr>
 			</tbody>
 		</table>
@@ -112,16 +142,34 @@
 	</kul:tab>
   <kul:tab tabTitle="Currency and Coin Detail" defaultOpen="true" tabErrorKey="${KFSConstants.EDIT_CASH_RECEIPT_CURRENCY_COIN_ERRORS}">
     <div class="tab-container" align="center">
+  	  <c:if test="${confirmMode}">
+  	    <div>
+	  	  <html:image align="left" property="methodToCall.copyAllCurrencyAndCoin" src="${ConfigProperties.externalizable.images.url}tinybutton-copyall.gif" title="Copy all original currency and coin" alt="Copy all currency and coin" styleClass="tinybutton"/>
+	    </div>
+	  </c:if>
+    </div>
+    <div class="tab-container" align="center">
         <h3>Currency and Coin Detail</h3>
-      <fp:currencyCoinLine currencyProperty="document.currencyDetail" coinProperty="document.coinDetail" readOnly="${readOnly}" editingMode="${KualiForm.editingMode}" />
+      <fp:currencyCoinLine currencyProperty="document.currencyDetail" coinProperty="document.coinDetail" confirmedCurrencyProperty="document.confirmedCurrencyDetail" confirmedCoinProperty="document.confirmedCoinDetail" readOnly="${readOnly}" editingMode="${KualiForm.editingMode}" confirmMode="${confirmMode}"/>
     </div>
   </kul:tab>
 	
 	<fp:crCheckLines checkDetailMode="${checkDetailMode}"
 		editingMode="${KualiForm.editingMode}"
 		totalAmount="${KualiForm.cashReceiptDocument.currencyFormattedTotalCheckAmount}"
-		displayHidden="${displayHidden}" />
+		totalConfirmedAmount="${KualiForm.cashReceiptDocument.currencyFormattedTotalConfirmedCheckAmount}"
+		displayHidden="${displayHidden}" 
+		confirmMode="${confirmMode}"/>
 		
+	<c:if test="${changeRequestMode}">	
+	<kul:tab tabTitle="Change Request" defaultOpen="false">
+		<div class="tab-container" align="center">
+			<h3>Requesting</h3>
+      		<fp:currencyCoinLine currencyProperty="document.changeCurrencyDetail" coinProperty="document.changeCoinDetail" readOnly="${readOnly}" editingMode="${KualiForm.editingMode}" confirmMode="${confirmMode}" totalChangeAmount="${KualiForm.document.currencyFormattedChangeTotalAmount}"/>
+      	</div>
+	</kul:tab>	
+	</c:if>
+		
 	<kul:tab tabTitle="Accounting Lines" defaultOpen="true" tabErrorKey="${KFSConstants.ACCOUNTING_LINE_ERRORS}">
 		<sys-java:accountingLines>
 			<sys-java:accountingLineGroup newLinePropertyName="newSourceLine" collectionPropertyName="document.sourceAccountingLines" collectionItemPropertyName="document.sourceAccountingLine" attributeGroupName="source" />
Index: work/web-root/jsp/fp/DisbursementVoucher.jsp
===================================================================
--- work/web-root/jsp/fp/DisbursementVoucher.jsp	(revision 30259)
+++ work/web-root/jsp/fp/DisbursementVoucher.jsp	(revision 37225)
@@ -37,6 +37,7 @@
 	<c:set var="paymentHandlingEntryMode" value="${canEdit && KualiForm.editingMode['paymentHandlingEntry']}" scope="request" />
 	<c:set var="voucherDeadlineEntryMode" value="${canEdit && KualiForm.editingMode['voucherDeadlineEntry']}" scope="request" />
 	<c:set var="specialHandlingChangingEntryMode" value="${canEdit && KualiForm.editingMode['specialHandlingChangingEntry']}" scope="request" />
+	<c:set var="immediateDisbursementEntryMode" value="${canEdit && KualiForm.editingMode['immediateDisbursementEntryMode']}" scope="request"/>
 	
 	<sys:documentOverview editingMode="${KualiForm.editingMode}" includeBankCode="true"
 	  bankProperty="document.disbVchrBankCode" 
Index: work/web-root/jsp/fp/CreditCardReceipt.jsp
===================================================================
--- work/web-root/jsp/fp/CreditCardReceipt.jsp	(revision 30259)
+++ work/web-root/jsp/fp/CreditCardReceipt.jsp	(revision 37225)
@@ -25,7 +25,9 @@
 	documentTypeName="CreditCardReceiptDocument"
 	renderMultipart="true" showTabButtons="true">
 	<sys:hiddenDocumentFields />
-	<sys:documentOverview editingMode="${KualiForm.editingMode}" />
+	<sys:documentOverview editingMode="${KualiForm.editingMode}" includeBankCode="true"
+		bankProperty="document.creditCardReceiptBankCode"
+		bankObjectProperty="document.bank"/>
 	<SCRIPT type="text/javascript">
 	    <!--
 	        function submitForm() {
Index: work/web-root/jsp/fp/YearEndDistributionOfIncomeAndExpense.jsp
===================================================================
--- work/web-root/jsp/fp/YearEndDistributionOfIncomeAndExpense.jsp	(revision 30259)
+++ work/web-root/jsp/fp/YearEndDistributionOfIncomeAndExpense.jsp	(revision 37225)
@@ -48,6 +48,6 @@
 	<kul:panelFooter />
 
 	<sys:documentControls
-		transactionalDocument="${documentEntry.transactionalDocument}" />
+		transactionalDocument="${documentEntry.transactionalDocument}" extraButtons="${KualiForm.extraButtons}" />
 
 </kul:documentPage>
Index: work/web-root/jsp/module/ld/FringeBenefitInquiry.jsp
===================================================================
--- work/web-root/jsp/module/ld/FringeBenefitInquiry.jsp	(revision 0)
+++ work/web-root/jsp/module/ld/FringeBenefitInquiry.jsp	(revision 37225)
@@ -0,0 +1,49 @@
+<%--
+ Copyright 2007 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+--%>
+<%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
+<c:set var="benefitInq"
+	value="${DataDictionary.BenefitInquiry.attributes}" />
+
+<kul:page showDocumentInfo="false" showTabButtons="false"
+	headerTitle="Fringe Benefit Inquiry" docTitle="Fringe Benefit Inquiry"
+	transactionalDocument="false" htmlFormAction="fringeBenefitInquiry">
+	<kul:tabTop tabTitle="Fringe Benefit Detail" defaultOpen="true">
+        <div id="workarea">
+          <table cellpadding="0" cellspacing="0" class="datatable" summary="" width="50%">
+            <tr>
+              <kul:htmlAttributeHeaderCell literalLabel="Object Code" scope="col"/>
+              <kul:htmlAttributeHeaderCell literalLabel="Amount" scope="col" />
+            </tr>
+
+            <logic:iterate name="KualiForm" id="benefitInquiry" property="benefitInquiry" indexId="ctr">
+              <tr>
+                <td>
+                 <kul:htmlControlAttribute property="benefitInquiry[${ctr}].fringeBenefitObjectCode" attributeEntry="${benefitInq.fringeBenefitObjectCode}" readOnly="true" />
+                </td>
+                <td>
+                 <kul:htmlControlAttribute property="benefitInquiry[${ctr}].benefitAmount" attributeEntry="${benefitInq.benefitAmount}" readOnly="true" />
+                </td>
+              </tr>
+            </logic:iterate>
+          </table>
+        </div>
+        <div id="globalbuttons" class="globalbuttons">
+	    <html:image src="${ConfigProperties.kr.externalizable.images.url}buttonsmall_close.gif" styleClass="globalbuttons" 
+	        onclick="window.close();return false;" title="close the window" alt="close the window"/>		
+		</div>
+      </kul:tabTop>
+	    
+</kul:page>
Index: work/web-root/jsp/module/ld/GLLaborEntrySummarizationInquiry.jsp
===================================================================
--- work/web-root/jsp/module/ld/GLLaborEntrySummarizationInquiry.jsp	(revision 0)
+++ work/web-root/jsp/module/ld/GLLaborEntrySummarizationInquiry.jsp	(revision 37225)
@@ -0,0 +1,90 @@
+<%--
+ Copyright 2006 The Kuali Foundation
+ 
+ Licensed under the Educational Community License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl2.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+--%>
+<%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
+
+<c:set var="laborLedgerEntryAttributes" value="${DataDictionary.LedgerEntry.attributes}" />
+
+<kul:page lookup="false" showDocumentInfo="false"
+	htmlFormAction="laborGLLaborEntrySummarizationInquiry"
+	headerTitle="${KualiForm.pageTitle}" docTitle="" transactionalDocument="false">
+	<table width="100%">
+		<tr>
+			<td width="1%"><img src="${ConfigProperties.kr.externalizable.images.url}pixel_clear.gif" alt="" width="20" height="20" /></td>
+			<td>
+				<table width="100%" class="datatable-100">
+					<tr>
+						<th class="grid"><kul:htmlAttributeLabel attributeEntry="${laborLedgerEntryAttributes.universityFiscalYear}" noColon="true" useShortLabel="true"/></th>
+						<th class="grid"><kul:htmlAttributeLabel attributeEntry="${laborLedgerEntryAttributes.universityFiscalPeriodCode}" noColon="true"/></th>
+						<th class="grid"><kul:htmlAttributeLabel attributeEntry="${laborLedgerEntryAttributes.chartOfAccountsCode}" noColon="true"/></th>
+						<th class="grid"><kul:htmlAttributeLabel attributeEntry="${laborLedgerEntryAttributes.accountNumber}" noColon="true"/></th>
+						<th class="grid"><kul:htmlAttributeLabel attributeEntry="${laborLedgerEntryAttributes.subAccountNumber}" noColon="true"/></th>
+						<th class="grid"><kul:htmlAttributeLabel attributeEntry="${laborLedgerEntryAttributes.financialObjectCode}" noColon="true"/></th>
+						<th class="grid"><kul:htmlAttributeLabel attributeEntry="${laborLedgerEntryAttributes.financialSubObjectCode}" noColon="true"/></th>
+					</tr>
+					<tr>
+						<td class="grid"><c:if test="${!empty KualiForm.universityFiscalYearInquiryUrl}"><a href="${KualiForm.universityFiscalYearInquiryUrl}" target="_blank"></c:if><kul:htmlControlAttribute attributeEntry="${laborLedgerEntryAttributes.universityFiscalYear}" property="universityFiscalYear" readOnly="true"/><c:if test="${!empty KualiForm.universityFiscalYearInquiryUrl}"></a></c:if></td>
+						<td class="grid"><c:if test="${!empty KualiForm.universityFiscalPeriodCodeInquiryUrl}"><a href="${KualiForm.universityFiscalPeriodCodeInquiryUrl}" target="_blank"></c:if><kul:htmlControlAttribute attributeEntry="${laborLedgerEntryAttributes.universityFiscalPeriodCode}" property="universityFiscalPeriodCode" readOnly="true"/><c:if test="${!empty KualiForm.universityFiscalPeriodCodeInquiryUrl}"></a></c:if></td>
+						<td class="grid"><c:if test="${!empty KualiForm.chartOfAccountsCodeInquiryUrl}"><a href="${KualiForm.chartOfAccountsCodeInquiryUrl}" target="_blank"></c:if><kul:htmlControlAttribute attributeEntry="${laborLedgerEntryAttributes.chartOfAccountsCode}" property="chartOfAccountsCode" readOnly="true"/><c:if test="${!empty KualiForm.chartOfAccountsCodeInquiryUrl}"></a></c:if></td>
+						<td class="grid"><c:if test="${!empty KualiForm.accountNumberInquiryUrl}"><a href="${KualiForm.accountNumberInquiryUrl}" target="_blank"></c:if><kul:htmlControlAttribute attributeEntry="${laborLedgerEntryAttributes.accountNumber}" property="accountNumber" readOnly="true"/><c:if test="${!empty KualiForm.accountNumberInquiryUrl}"></a></c:if></td>
+						<td class="grid"><c:if test="${!empty KualiForm.subAccountNumberInquiryUrl}"><a href="${KualiForm.subAccountNumberInquiryUrl}" target="_blank"></c:if><kul:htmlControlAttribute attributeEntry="${laborLedgerEntryAttributes.subAccountNumber}" property="subAccountNumber" readOnly="true"/><c:if test="${!empty KualiForm.subAccountNumberInquiryUrl}"></a></c:if></td>
+						<td class="grid"><c:if test="${!empty KualiForm.financialObjectCodeInquiryUrl}"><a href="${KualiForm.financialObjectCodeInquiryUrl}" target="_blank"></c:if><kul:htmlControlAttribute attributeEntry="${laborLedgerEntryAttributes.financialObjectCode}" property="financialObjectCode" readOnly="true"/><c:if test="${!empty KualiForm.financialObjectCodeInquiryUrl}"></a></c:if></td>
+						<td class="grid"><c:if test="${!empty KualiForm.financialSubObjectCodeInquiryUrl}"><a href="${KualiForm.financialSubObjectCodeInquiryUrl}" target="_blank"></c:if><kul:htmlControlAttribute attributeEntry="${laborLedgerEntryAttributes.financialSubObjectCode}" property="financialSubObjectCode" readOnly="true"/><c:if test="${!empty KualiForm.financialSubObjectCodeInquiryUrl}"></a></c:if></td>
+					</tr>
+				</table>
+			</td>
+			<td width="1%"><img src="${ConfigProperties.kr.externalizable.images.url}pixel_clear.gif" alt="" height="20" width="20" /></td>
+		</tr>
+		<tr>
+			<td width="1%"><img src="${ConfigProperties.kr.externalizable.images.url}pixel_clear.gif" alt="" width="20" height="20" /></td>
+			<td> 
+			<c:if test="${!empty KualiForm.entries}">
+	        
+	        <display:table class="datatable-100" cellspacing="0"
+				cellpadding="0" name="${KualiForm.entries}" id="row"
+				export="true" pagesize="100" defaultsort="2"
+				requestURI="laborGLLaborEntrySummarizationInquiry.do?methodToCall=start&universityFiscalYear=${KualiForm.universityFiscalYear}&universityFiscalPeriodCode=${KualiForm.universityFiscalPeriodCode}&chartOfAccountsCode=${KualiForm.chartOfAccountsCode}&accountNumber=${KualiForm.accountNumber}&subAccountNumber=${KualiForm.subAccountNumber}&financialObjectCode=${KualiForm.financialObjectCode}&financialSubObjectCode=${KualiForm.financialSubObjectCode}&financialBalanceTypeCode=${KualiForm.financialBalanceTypeCode}&financialObjectTypeCode=${KualiForm.financialObjectTypeCode}&financialDocumentTypeCode=${KualiForm.financialDocumentTypeCode}&financialSystemOriginationCode=${KualiForm.financialSystemOriginationCode}&documentNumber=${KualiForm.documentNumber}">
+				
+				<c:set var="columnLength" value="${fn:length(row.columns)-15}" />
+				<c:forEach items="${row.columns}" var="column" varStatus="status">
+					<c:if test="${!empty column.columnAnchor.title}">
+						<c:set var="title" value="${column.columnAnchor.title}" />
+					</c:if>
+					<c:if test="${empty column.columnAnchor.title}">
+						<c:set var="title" value="${column.propertyValue}" />
+					</c:if>
+					
+					<display:column class="${column.formatter.implementationClass == 'org.kuali.rice.kns.web.format.CurrencyFormatter' ? 'numbercell' : 'infocell'}" sortable="${column.sortable}" decorator="org.kuali.rice.kns.web.ui.FormatAwareDecorator" title="${column.columnTitle}" comparator="${column.comparator}">
+						<c:choose>
+							<c:when test="${!empty column.propertyURL}">
+								<a href="<c:out value="${column.propertyURL}"/>" title="<c:out value="${column.columnAnchor.title}" />" target="_blank"><c:out value="${column.propertyValue}" /></a>	
+							</c:when>		
+							<c:otherwise>
+								<c:out value="${column.propertyValue}" />
+							</c:otherwise>	
+						</c:choose>
+					</display:column>
+				</c:forEach>
+				
+			</display:table>
+			</td>
+			</c:if>
+			<td width="1%"><img src="${ConfigProperties.kr.externalizable.images.url}pixel_clear.gif" alt="" height="20" width="20" /></td>
+		</tr>
+	</table>
+	
+	<kul:inquiryControls />
+
+</kul:page>
Index: work/web-root/jsp/module/ar/CustomerInvoiceDocument.jsp
===================================================================
--- work/web-root/jsp/module/ar/CustomerInvoiceDocument.jsp	(revision 30259)
+++ work/web-root/jsp/module/ar/CustomerInvoiceDocument.jsp	(revision 37225)
@@ -13,8 +13,25 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+
+<%@ page import="org.kuali.kfs.sys.context.SpringContext" %>
+<%@ page import="org.kuali.kfs.coa.service.AccountService" %>
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
+<c:if test="${!accountingLineScriptsLoaded}">
+       <script type='text/javascript' src="dwr/interface/ChartService.js"></script>
+       <script type='text/javascript' src="dwr/interface/AccountService.js"></script>
+       <script type='text/javascript' src="dwr/interface/SubAccountService.js"></script>
+       <script type='text/javascript' src="dwr/interface/ObjectCodeService.js"></script>
+       <script type='text/javascript' src="dwr/interface/ObjectTypeService.js"></script>
+       <script type='text/javascript' src="dwr/interface/SubObjectCodeService.js"></script>
+       <script type='text/javascript' src="dwr/interface/ProjectCodeService.js"></script>
+       <script type='text/javascript' src="dwr/interface/OriginationCodeService.js"></script>
+       <script language="JavaScript" type="text/javascript" src="scripts/sys/objectInfo.js"></script>
+       <c:set var="accountingLineScriptsLoaded" value="true" scope="request" />
+</c:if>     
+       
+<c:set var="accountsCanCrossCharts" value="<%=SpringContext.getBean(AccountService.class).accountsCanCrossCharts()%>" />       
 <c:set var="readOnly" value="${!KualiForm.documentActions[Constants.KUALI_ACTION_CAN_EDIT]}" />
 
 <kul:documentPage showDocumentInfo="true"
@@ -40,7 +57,8 @@
 	<c:if test="${!empty KualiForm.editingMode['showReceivableFAU']}">
      <ar:customerInvoiceReceivableAccountingLine
       	documentAttributes="${DataDictionary.CustomerInvoiceDocument.attributes}" readOnly="${readOnly}"
-      	receivableValuesMap="${KualiForm.document.valuesMap}"  />
+      	receivableValuesMap="${KualiForm.document.valuesMap}"
+        accountsCanCrossCharts="${accountsCanCrossCharts}"/>
     </c:if>
      
 	<kul:tab tabTitle="Accounting Lines" defaultOpen="true" tabErrorKey="${KFSConstants.ACCOUNTING_LINE_ERRORS}">
Index: work/web-root/jsp/module/ar/PaymentApplicationDocument.jsp
===================================================================
--- work/web-root/jsp/module/ar/PaymentApplicationDocument.jsp	(revision 30259)
+++ work/web-root/jsp/module/ar/PaymentApplicationDocument.jsp	(revision 37225)
@@ -13,6 +13,10 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+
+<%@ page import="org.kuali.kfs.sys.context.SpringContext" %>
+<%@ page import="org.kuali.kfs.coa.service.AccountService" %>
+
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 <script type='text/javascript'>
 function toggle(id) {
@@ -37,6 +41,7 @@
        <c:set var="accountingLineScriptsLoaded" value="true" scope="request" />
 </c:if>
 
+<c:set var="accountsCanCrossCharts" value="<%=SpringContext.getBean(AccountService.class).accountsCanCrossCharts()%>" />
 <c:set var="readOnly" value="${!KualiForm.documentActions[Constants.KUALI_ACTION_CAN_EDIT]}" />
 <c:set var="paymentApplicationDocumentAttributes" value="${DataDictionary['PaymentApplicationDocument'].attributes}" />
 <c:set var="invoiceAttributes" value="${DataDictionary['CustomerInvoiceDocument'].attributes}" />
@@ -81,7 +86,8 @@
     <ar:paymentApplicationNonAr customerAttributes="${customerAttributes}"
         isCustomerSelected="${isCustomerSelected}"
         hasRelatedCashControlDocument="${hasRelatedCashControlDocument}"
-        readOnly="${readOnly}"/>
+        readOnly="${readOnly}"
+        accountsCanCrossCharts="${accountsCanCrossCharts}"/>
     <ar:paymentApplicationUnappliedTab
 		isCustomerSelected="${isCustomerSelected}" readOnly="${readOnly}" 
 		hasRelatedCashControlDocument="${hasRelatedCashControlDocument}" />
Index: work/web-root/jsp/module/cams/AssetTransfer.jsp
===================================================================
--- work/web-root/jsp/module/cams/AssetTransfer.jsp	(revision 30259)
+++ work/web-root/jsp/module/cams/AssetTransfer.jsp	(revision 37225)
@@ -13,13 +13,22 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+<%@ page import="org.kuali.kfs.sys.context.SpringContext" %>
+<%@ page import="org.kuali.kfs.coa.service.AccountService" %>
+
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
+
+<script type='text/javascript' src="dwr/interface/AccountService.js"></script>
+<script language="JavaScript" type="text/javascript" src="scripts/module/cams/assetTransfer.js"></script>   
+
 <kul:documentPage showDocumentInfo="true" htmlFormAction="camsAssetTransfer" documentTypeName="AssetTransferDocument" renderMultipart="true" showTabButtons="true">
 	<c:set var="assetTransferAttributes" value="${DataDictionary.AssetTransferDocument.attributes}" />
 	<c:set var="assetAttributes" value="${DataDictionary.Asset.attributes}" />	
 	<c:set var="assetOrgAttributes" value="${DataDictionary.AssetOrganization.attributes}" />	
 	<c:set var="organizationAttributes" value="${DataDictionary.Organization.attributes}" />	
 	<c:set var="readOnly" value="${!KualiForm.documentActions[Constants.KUALI_ACTION_CAN_EDIT]}" />
+	<c:set var="accountsCanCrossCharts" value="<%=SpringContext.getBean(AccountService.class).accountsCanCrossCharts()%>" />
+	<c:set var="readOnlyChartCode" value="${readOnly or !accountsCanCrossCharts}" />
 	<sys:documentOverview editingMode="${KualiForm.editingMode}" />
     <cams:viewAssetDetails defaultTabHide="false" /> 
 	
@@ -37,9 +46,13 @@
 				<th class="grid" width="25%" align="right"><kul:htmlAttributeLabel attributeEntry="${assetTransferAttributes.oldOrganizationOwnerChartOfAccountsCode}" readOnly="true" /></th>
 				<td class="grid" width="25%"><kul:htmlControlAttribute property="document.oldOrganizationOwnerChartOfAccountsCode" attributeEntry="${assetTransferAttributes.organizationOwnerChartOfAccountsCode}" readOnly="true"/></td>
 				<th class="grid" width="25%" align="right"><kul:htmlAttributeLabel attributeEntry="${assetTransferAttributes.organizationOwnerChartOfAccountsCode}" /></th>
-				<td class="grid" width="25%"><kul:htmlControlAttribute property="document.organizationOwnerChartOfAccountsCode" attributeEntry="${assetTransferAttributes.organizationOwnerChartOfAccountsCode}" readOnly="${readOnly}"/>
-					<c:if test="${not readOnly}">
-						&nbsp;
+				<td class="grid" width="25%">
+	                <c:if test="${readOnlyChartCode}">	
+	                	<span id="document.organizationOwnerChartOfAccountsCode"><bean:write name="KualiForm" property="document.organizationOwnerChartOfAccountsCode"/></span> 
+	                </c:if>
+					<c:if test="${not readOnlyChartCode}">				
+						<kul:htmlControlAttribute property="document.organizationOwnerChartOfAccountsCode" attributeEntry="${assetTransferAttributes.organizationOwnerChartOfAccountsCode}" readOnly="false"/>
+						&nbsp; 
 		                <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.Chart" fieldConversions="chartOfAccountsCode:document.organizationOwnerChartOfAccountsCode" lookupParameters="document.organizationOwnerChartOfAccountsCode:chartOfAccountsCode" />
 	                </c:if>
 				</td>						
@@ -48,7 +61,9 @@
 				<th class="grid" width="25%" align="right"><kul:htmlAttributeLabel attributeEntry="${assetTransferAttributes.oldOrganizationOwnerAccountNumber}" readOnly="true" /></th>
 				<td class="grid" width="25%"><kul:htmlControlAttribute property="document.oldOrganizationOwnerAccountNumber" attributeEntry="${assetTransferAttributes.organizationOwnerAccountNumber}" readOnly="true"/></td>
 				<th class="grid" width="25%" align="right"><kul:htmlAttributeLabel attributeEntry="${assetTransferAttributes.organizationOwnerAccountNumber}" /></th>
-				<td class="grid" width="25%"><kul:htmlControlAttribute property="document.organizationOwnerAccountNumber" attributeEntry="${assetTransferAttributes.organizationOwnerAccountNumber}" readOnly="${readOnly}"/>
+				<td class="grid" width="25%"><kul:htmlControlAttribute property="document.organizationOwnerAccountNumber" attributeEntry="${assetTransferAttributes.organizationOwnerAccountNumber}" 
+                    onblur="onblur_accountNumber(this, 'organizationOwnerChartOfAccountsCode');" 					
+					readOnly="${readOnly}"/>
 					<c:if test="${not readOnly}">
 						&nbsp;
 		                <kul:lookup boClassName="org.kuali.kfs.coa.businessobject.Account" fieldConversions="accountNumber:document.organizationOwnerAccountNumber,chartOfAccountsCode:document.organizationOwnerChartOfAccountsCode" lookupParameters="document.organizationOwnerAccountNumber:accountNumber,document.organizationOwnerChartOfAccountsCode:chartOfAccountsCode" />
Index: work/web-root/jsp/module/bc/BudgetConstruction.jsp
===================================================================
--- work/web-root/jsp/module/bc/BudgetConstruction.jsp	(revision 30259)
+++ work/web-root/jsp/module/bc/BudgetConstruction.jsp	(revision 37225)
@@ -26,7 +26,7 @@
 	>
     <div id="globalbuttons" class="globalbuttons">
 	    <html:image src="${ConfigProperties.kr.externalizable.images.url}buttonsmall_close.gif" styleClass="globalbuttons" 
-	        onclick="window.close();return false;" title="close the window" alt="close the window"/>		
+	        onclick="window.close();return true;" property="methodToCall.performLost" title="close the window" alt="close the window"/>		
     </div>
 </kul:page>
 </c:if>
Index: work/web-root/jsp/module/bc/BudgetConstructionSelection.jsp
===================================================================
--- work/web-root/jsp/module/bc/BudgetConstructionSelection.jsp	(revision 30259)
+++ work/web-root/jsp/module/bc/BudgetConstructionSelection.jsp	(revision 37225)
@@ -14,408 +14,434 @@
  limitations under the License.
 --%>
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
+<%@ page import="org.kuali.kfs.sys.context.SpringContext"%>
+<%@ page import="org.kuali.kfs.coa.service.AccountService"%>
 
+
+
 <c:if test="${!accountingLineScriptsLoaded}">
 	<script type='text/javascript' src="dwr/interface/ChartService.js"></script>
 	<script type='text/javascript' src="dwr/interface/AccountService.js"></script>
 	<script type='text/javascript' src="dwr/interface/SubAccountService.js"></script>
 	<script language="JavaScript" type="text/javascript" src="scripts/sys/objectInfo.js"></script>
+	<script language="JavaScript" type="text/javascript" src="scripts/module/bc/objectInfo.js"></script>
 	<c:set var="accountingLineScriptsLoaded" value="true" scope="request" />
 </c:if>
 
-<c:set var="bcHeaderAttributes" value="${DataDictionary.BudgetConstructionHeader.attributes}" />
-<c:set var="accountAttributes" value="${DataDictionary.Account.attributes}" />
-<c:set var="subFundGroupAttributes" value="${DataDictionary.SubFundGroup.attributes}" />
-<c:set var="orgAttributes" value="${DataDictionary.Organization.attributes}" />
-<c:set var="orgPropString" value="budgetConstructionHeader.account.organization" />
+<c:set var="bcHeaderAttributes"
+	value="${DataDictionary.BudgetConstructionHeader.attributes}" />
+<c:set var="accountAttributes"
+	value="${DataDictionary.Account.attributes}" />
+<c:set var="subFundGroupAttributes"
+	value="${DataDictionary.SubFundGroup.attributes}" />
+<c:set var="orgAttributes"
+	value="${DataDictionary.Organization.attributes}" />
+<c:set var="orgPropString"
+	value="budgetConstructionHeader.account.organization" />
+<c:set var="accountsCanCrossCharts"
+	value="<%=SpringContext.getBean(AccountService.class).accountsCanCrossCharts()%>" />
 
 <c:if test="${KualiForm.accountReportsExist}">
-<c:set var="accountRptsAttributes" value="${DataDictionary.BudgetConstructionAccountReports.attributes}" />
-<c:set var="accountRptsPropString" value="budgetConstructionHeader.budgetConstructionAccountReports" />
-<c:set var="orgRptsAttributes" value="${DataDictionary.BudgetConstructionOrganizationReports.attributes}" />
-<c:set var="orgRptsPropString" value="budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports" />
+	<c:set var="accountRptsAttributes"
+		value="${DataDictionary.BudgetConstructionAccountReports.attributes}" />
+	<c:set var="accountRptsPropString"
+		value="budgetConstructionHeader.budgetConstructionAccountReports" />
+	<c:set var="orgRptsAttributes"
+		value="${DataDictionary.BudgetConstructionOrganizationReports.attributes}" />
+	<c:set var="orgRptsPropString"
+		value="budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports" />
 </c:if>
 
 <%-- hack to get around ojb retrieve problems when account key is bad, don't show the info fields --%>
 <c:catch var="e">
-	<c:set var="showTheDetail" value="${!empty KualiForm.budgetConstructionHeader.account.subFundGroupCode}" scope="page" />
-	
+	<c:set var="showTheDetail"
+		value="${!empty KualiForm.budgetConstructionHeader.account.subFundGroupCode}"
+		scope="page" />
+
 </c:catch>
 <c:if test="${e!=null}">
 	<c:set var="showTheDetail" value="false" scope="page" />
 </c:if>
 
 <kul:page showDocumentInfo="false"
-	htmlFormAction="budgetBudgetConstructionSelection" renderMultipart="true"
-	docTitle=""
-    transactionalDocument="false">
-  
-   <strong><h2>
-   Budget Construction Selection
-	<a href="${ConfigProperties.externalizable.help.url}default.htm?turl=WordDocuments%2Fbudgetconstructionselection.htm" tabindex="${KualiForm.nextArbitrarilyHighIndex}" target="helpWindow"  title="[Help]Upload">
-	                                        <img src="${ConfigProperties.kr.externalizable.images.url}my_cp_inf.gif" title="[Help] Upload" alt="[Help] Upload" hspace=5 border=0  align="middle"></a>
-  </h2></strong>
+	htmlFormAction="budgetBudgetConstructionSelection"
+	renderMultipart="true" docTitle="" transactionalDocument="false">
+
+	<strong>
+	<h2>Budget Construction Selection <a
+		href="${ConfigProperties.externalizable.help.url}default.htm?turl=WordDocuments%2Fbudgetconstructionselection.htm"
+		tabindex="${KualiForm.nextArbitrarilyHighIndex}" target="helpWindow"
+		title="[Help]Upload"> <img
+		src="${ConfigProperties.kr.externalizable.images.url}my_cp_inf.gif"
+		title="[Help] Upload" alt="[Help] Upload" hspace=5 border=0
+		align="middle"></a></h2>
+	</strong>
 	</br>
-<%--	<sys:hiddenDocumentFields /> --%>
+	<%--	<sys:hiddenDocumentFields /> --%>
 
-	<kul:errors keyMatch="${BCConstants.BUDGET_CONSTRUCTION_SELECTION_ERRORS}" errorTitle="Errors found in Search Criteria:" />
+	<kul:errors
+		keyMatch="${BCConstants.BUDGET_CONSTRUCTION_SELECTION_ERRORS}"
+		errorTitle="Errors found in Search Criteria:" />
 	<c:forEach items="${KualiForm.messages}" var="message">
 	   ${message}
 	</c:forEach>
 
-    <c:if test="${!empty KualiForm.universityFiscalYear && !KualiForm.sessionInProgressDetected}">
-    <table align="center" cellpadding="0" cellspacing="0" class="datatable-100">
-	    <tr>
-            <th class="grid" align="right" width="10%" colspan="1">
-			    <span class="nowrap">BC Fiscal Year:</span>
-                <html:hidden property="universityFiscalYear"/>
-            </th>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-            <span class="nowrap">
-                ${KualiForm.universityFiscalYear}&nbsp;
-            </span>
-            </td>
-            <th class="grid" colspan="5">
-			    &nbsp;
-            </th>
-	    </tr>
-    	<tr>
-            <th class="grid" colspan="7" align="left">
-                <br>
-                Budget Construction Document Open
-                <br><br>
-		    </th>
-		</tr>
-    	<tr>
-            <td class="grid" colspan="4">
-            <div align="center">
-              <html:image property="methodToCall.performMyAccounts.anchoraccountControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-myaccounts.gif" title="Find My Budgeted Accounts" alt="Find My Budgeted Accounts" styleClass="tinybutton"/>&nbsp;&nbsp;&nbsp;
-              <html:image property="methodToCall.performMyOrganization.anchoraccountControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-myorg.gif" title="Find My Organization Budgeted Accounts" alt="Find My Organization Budgeted Accounts" styleClass="tinybutton"/>
-            </div>
-		    </td>
-            <td class="grid" colspan="3">
-			    &nbsp;
-		    </td>
-		</tr>
-	    <tr>
-            <th class="grid" colspan="2" rowspan="2">&nbsp;</th>
-		    <th class="grid" align="center" colspan="1">
-                <html:hidden property="budgetConstructionHeader.universityFiscalYear"/>
-                <html:hidden property="budgetConstructionHeader.documentNumber"/>
-			    <kul:htmlAttributeLabel
-			        attributeEntry="${bcHeaderAttributes.chartOfAccountsCode}"
-			        labelFor="budgetConstructionHeader.chartOfAccountsCode"
-			        useShortLabel="true" noColon="true" />
-		    </th>
-		    <th class="grid" align="center" colspan="1">
-			    <kul:htmlAttributeLabel
-			        attributeEntry="${bcHeaderAttributes.accountNumber}"
-			        useShortLabel="true" noColon="true" />
-		    </th>
-		    <th class="grid" align="center" colspan="1">
-			    <kul:htmlAttributeLabel
-			        attributeEntry="${bcHeaderAttributes.subAccountNumber}"
-			        useShortLabel="true" noColon="true" />
-		    </th>
-		    <th class="grid" align="center" colspan="2">
-			    Action
-		    </th>
-	    </tr>
-	    <tr>
-            <%--first cell in row above spans two rows --%>
-            <bc:pbglLineDataCell dataCellCssClass="grid"
-                accountingLine="budgetConstructionHeader"
-                field="chartOfAccountsCode" detailFunction="loadChartInfo"
-                detailField="chartOfAccounts.finChartOfAccountDescription"
-                attributes="${bcHeaderAttributes}" inquiry="true"
-                boClassSimpleName="Chart"
-                readOnly="false"
-                displayHidden="false"
-                colSpan="1"
-                accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
-                anchor="budgetConstructionHeaderAnchor" />
-            <bc:pbglLineDataCell dataCellCssClass="grid"
-                accountingLine="budgetConstructionHeader"
-                field="accountNumber" detailFunction="loadAccountInfo"
-                detailField="account.accountName"
-                attributes="${bcHeaderAttributes}" lookup="true" inquiry="true"
-                boClassSimpleName="Account"
-                readOnly="false"
-                displayHidden="false"
-                colSpan="1"
-                lookupOrInquiryKeys="chartOfAccountsCode"
-                accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
-                anchor="budgetConstructionHeaderAccountAnchor" />
-            <bc:pbglLineDataCell dataCellCssClass="grid"
-                accountingLine="budgetConstructionHeader"
-                field="subAccountNumber" detailFunction="loadSubAccountInfo"
-                detailField="subAccount.subAccountName"
-                attributes="${bcHeaderAttributes}" lookup="true" inquiry="true"
-                boClassSimpleName="SubAccount"
-                readOnly="false"
-                displayHidden="false"
-                colSpan="1"
-                lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
-                accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
-                anchor="budgetConstructionHeaderSubAccountAnchor" />
-            <td class="grid" nowrap colspan="2">
-            <div align="center">
-                <html:image property="methodToCall.refresh.anchorbudgetConstructionHeaderAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-refresh.gif" title="Refresh" alt="Refresh" styleClass="tinybutton" />
-                <html:image property="methodToCall.performBCDocumentOpen.anchorbudgetConstructionHeaderAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-loaddoc.gif" title="Load Budget Construction Document" alt="Load Budget Construction Document" styleClass="tinybutton" />
-            </div>
-            </td>
-	    </tr>
-	    <tr>
-		    <th class="grid" align="right" colspan="2">
-		        Sub-Fund Group:
-		    </th>
-            <td class="grid" valign="center" rowspan="1" colspan="2">
-                <c:if test="${showTheDetail}" >
-                <kul:htmlControlAttribute
-                    property="budgetConstructionHeader.account.subFundGroupCode"
-                    attributeEntry="${accountAttributes.subFundGroupCode}"
-                    readOnly="true"
-                    readOnlyBody="true">
-                    <kul:inquiry
-                        boClassName="org.kuali.kfs.coa.businessobject.SubFundGroup"
-                        keyValues="subFundGroupCode=${KualiForm.budgetConstructionHeader.account.subFundGroupCode}"
-                        render="${!empty KualiForm.budgetConstructionHeader.accountNumber}">
-                        <html:hidden write="true" property="budgetConstructionHeader.account.subFundGroupCode" />
-                    </kul:inquiry>&nbsp;
+	<c:if
+		test="${!empty KualiForm.universityFiscalYear && !KualiForm.sessionInProgressDetected}">
+		<table align="center" cellpadding="0" cellspacing="0"
+			class="datatable-100">
+			<tr>
+				<th class="grid" align="right" width="10%" colspan="1"><span
+					class="nowrap">BC Fiscal Year:</span> <html:hidden
+					property="universityFiscalYear" /></th>
+				<td class="grid" valign="center" rowspan="1" colspan="1"><span
+					class="nowrap"> ${KualiForm.universityFiscalYear}&nbsp; </span></td>
+				<th class="grid" colspan="5">&nbsp;</th>
+			</tr>
+			<tr>
+				<th class="grid" colspan="7" align="left"><br>
+				Budget Construction Document Open <br>
+				<br>
+				</th>
+			</tr>
+			<tr>
+				<td class="grid" colspan="4">
+				<div align="center"><html:image
+					property="methodToCall.performMyAccounts.anchoraccountControlsAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-myaccounts.gif"
+					title="Find My Budgeted Accounts" alt="Find My Budgeted Accounts"
+					styleClass="tinybutton" />&nbsp;&nbsp;&nbsp; <html:image
+					property="methodToCall.performMyOrganization.anchoraccountControlsAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-myorg.gif"
+					title="Find My Organization Budgeted Accounts"
+					alt="Find My Organization Budgeted Accounts"
+					styleClass="tinybutton" /></div>
+				</td>
+				<td class="grid" colspan="3">&nbsp;</td>
+			</tr>
+			<tr>
+				<th class="grid" colspan="2" rowspan="2">&nbsp;</th>
+				<th class="grid" align="center" colspan="1">
+				<html:hidden property="budgetConstructionHeader.universityFiscalYear" /> 
+				<html:hidden property="budgetConstructionHeader.documentNumber" />
+				<html:hidden property="budgetConstructionHeader.chartOfAccountsCode" /> 
+				<kul:htmlAttributeLabel	attributeEntry="${bcHeaderAttributes.chartOfAccountsCode}"
+					labelFor="budgetConstructionHeader.chartOfAccountsCode"
+					useShortLabel="true" noColon="true" /></th>
+				<th class="grid" align="center" colspan="1"><kul:htmlAttributeLabel
+					attributeEntry="${bcHeaderAttributes.accountNumber}"
+					useShortLabel="true" noColon="true" /></th>
+				<th class="grid" align="center" colspan="1"><kul:htmlAttributeLabel
+					attributeEntry="${bcHeaderAttributes.subAccountNumber}"
+					useShortLabel="true" noColon="true" /></th>
+				<th class="grid" align="center" colspan="2">Action</th>
+			</tr>
+			<tr>
+				<%--first cell in row above spans two rows --%>
+				<c:if test="${!accountsCanCrossCharts}">
+					<bc:pbglLineDataCell dataCellCssClass="grid"
+						accountingLine="budgetConstructionHeader"
+						field="chartOfAccountsCode"
+						detailField="chartOfAccounts.finChartOfAccountDescription"
+						attributes="${bcHeaderAttributes}" inquiry="true"
+						boClassSimpleName="Chart" readOnly="true" displayHidden="false"
+						colSpan="1"
+						accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
+						anchor="budgetConstructionHeaderAnchor" 
+						divId="budgetConstructionHeader.chartOfAccountsCode.div"/>
+					<bc:pbglLineDataCell dataCellCssClass="grid"
+						accountingLine="budgetConstructionHeader" field="accountNumber"
+						detailFunction="budgetObjectInfoUpdator.loadChartAccountInfo" detailField="account.accountName"
+						attributes="${bcHeaderAttributes}" lookup="true" inquiry="true"
+						boClassSimpleName="Account" readOnly="false" displayHidden="false"
+						colSpan="1" lookupOrInquiryKeys="chartOfAccountsCode"
+						accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
+						anchor="budgetConstructionHeaderAccountAnchor" />
+				</c:if>
+				<c:if test="${accountsCanCrossCharts}">
+					<bc:pbglLineDataCell dataCellCssClass="grid"
+						accountingLine="budgetConstructionHeader"
+						field="chartOfAccountsCode" detailFunction="loadChartInfo"
+						detailField="chartOfAccounts.finChartOfAccountDescription"
+						attributes="${bcHeaderAttributes}" inquiry="true"
+						boClassSimpleName="Chart" readOnly="false" displayHidden="false"
+						colSpan="1"
+						accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
+						anchor="budgetConstructionHeaderAnchor" />
+					<bc:pbglLineDataCell dataCellCssClass="grid"
+						accountingLine="budgetConstructionHeader" field="accountNumber"
+						detailFunction="loadAccountInfo" detailField="account.accountName"
+						attributes="${bcHeaderAttributes}" lookup="true" inquiry="true"
+						boClassSimpleName="Account" readOnly="false" displayHidden="false"
+						colSpan="1" lookupOrInquiryKeys="chartOfAccountsCode"
+						accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
+						anchor="budgetConstructionHeaderAccountAnchor" />
+				</c:if>
+				<bc:pbglLineDataCell dataCellCssClass="grid"
+					accountingLine="budgetConstructionHeader" field="subAccountNumber"
+					detailFunction="loadSubAccountInfo"
+					detailField="subAccount.subAccountName"
+					attributes="${bcHeaderAttributes}" lookup="true" inquiry="true"
+					boClassSimpleName="SubAccount" readOnly="false"
+					displayHidden="false" colSpan="1"
+					lookupOrInquiryKeys="chartOfAccountsCode,accountNumber"
+					accountingLineValuesMap="${KualiForm.budgetConstructionHeader.valuesMap}"
+					anchor="budgetConstructionHeaderSubAccountAnchor" />
+				<td class="grid" nowrap colspan="2">
+				<div align="center"><html:image
+					property="methodToCall.refresh.anchorbudgetConstructionHeaderAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-refresh.gif"
+					title="Refresh" alt="Refresh" styleClass="tinybutton" /> <html:image
+					property="methodToCall.performBCDocumentOpen.anchorbudgetConstructionHeaderAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-loaddoc.gif"
+					title="Load Budget Construction Document"
+					alt="Load Budget Construction Document" styleClass="tinybutton" />
+				</div>
+				</td>
+			</tr>
+			<tr>
+				<th class="grid" align="right" colspan="2">Sub-Fund Group:</th>
+				<td class="grid" valign="center" rowspan="1" colspan="2"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="budgetConstructionHeader.account.subFundGroupCode"
+						attributeEntry="${accountAttributes.subFundGroupCode}"
+						readOnly="true" readOnlyBody="true">
+						<kul:inquiry
+							boClassName="org.kuali.kfs.coa.businessobject.SubFundGroup"
+							keyValues="subFundGroupCode=${KualiForm.budgetConstructionHeader.account.subFundGroupCode}"
+							render="${!empty KualiForm.budgetConstructionHeader.accountNumber}">
+							<html:hidden write="true"
+								property="budgetConstructionHeader.account.subFundGroupCode" />
+						</kul:inquiry>&nbsp;
                 </kul:htmlControlAttribute>
-                </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="3">
-                <c:if test="${showTheDetail}" >
-                <kul:htmlControlAttribute
-                    property="budgetConstructionHeader.account.subFundGroup.subFundGroupDescription"
-                    attributeEntry="${subFundGroupAttributes.subfundGroupDescription}"
-                    readOnly="true"/>
-                </c:if>&nbsp;
-            </td>
-	    </tr>
-	    <tr>
-		    <th class="grid" align="right" colspan="2">
-		        Current Year Org:
-		    </th>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-			    &nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="budgetConstructionHeader.account.organizationCode"
-                attributeEntry="${accountAttributes.organizationCode}"
-                readOnly="true"
-                readOnlyBody="true">
-                <kul:inquiry
-                    boClassName="org.kuali.kfs.coa.businessobject.Organization"
-                    keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.account.chartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.account.organizationCode}"
-                    render="${!empty KualiForm.budgetConstructionHeader.account.organizationCode}">
-                	<html:hidden write="true" property="budgetConstructionHeader.account.organizationCode" />
-                </kul:inquiry>&nbsp;
+				</c:if>&nbsp;</td>
+				<td class="grid" valign="center" rowspan="1" colspan="3"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="budgetConstructionHeader.account.subFundGroup.subFundGroupDescription"
+						attributeEntry="${subFundGroupAttributes.subfundGroupDescription}"
+						readOnly="true" />
+				</c:if>&nbsp;</td>
+			</tr>
+			<tr>
+				<th class="grid" align="right" colspan="2">Current Year Org:</th>
+				<td class="grid" valign="center" rowspan="1" colspan="1">
+				&nbsp;</td>
+				<td class="grid" valign="center" rowspan="1" colspan="1"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="budgetConstructionHeader.account.organizationCode"
+						attributeEntry="${accountAttributes.organizationCode}"
+						readOnly="true" readOnlyBody="true">
+						<kul:inquiry
+							boClassName="org.kuali.kfs.coa.businessobject.Organization"
+							keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.account.chartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.account.organizationCode}"
+							render="${!empty KualiForm.budgetConstructionHeader.account.organizationCode}">
+							<html:hidden write="true"
+								property="budgetConstructionHeader.account.organizationCode" />
+						</kul:inquiry>&nbsp;
 	      	</kul:htmlControlAttribute>
-            </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="3">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="${orgPropString}.organizationName"
-                attributeEntry="${orgAttributes.organizationName}"
-                readOnly="true"/>
-            </c:if>&nbsp;
-            </td>
-	    </tr>
-	    <tr>
-		    <th class="grid" align="right" colspan="2">
-		        Rpts To:
-		    </th>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-                <c:if test="${showTheDetail}" >
-                <kul:htmlControlAttribute
-                    property="${orgPropString}.reportsToChartOfAccountsCode"
-                    attributeEntry="${orgAttributes.reportsToChartOfAccountsCode}"
-                    readOnly="true"
-                    readOnlyBody="true">
-                    <kul:inquiry
-                        boClassName="org.kuali.kfs.coa.businessobject.Chart"
-                        keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.account.organization.reportsToChartOfAccountsCode}"
-                        render="${!empty KualiForm.budgetConstructionHeader.account.organization.reportsToChartOfAccountsCode}">
-                    <html:hidden write="true" property="${orgPropString}.reportsToChartOfAccountsCode" />
-                </kul:inquiry>&nbsp;
+				</c:if>&nbsp;</td>
+				<td class="grid" valign="center" rowspan="1" colspan="3"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="${orgPropString}.organizationName"
+						attributeEntry="${orgAttributes.organizationName}" readOnly="true" />
+				</c:if>&nbsp;</td>
+			</tr>
+			<tr>
+				<th class="grid" align="right" colspan="2">Rpts To:</th>
+				<td class="grid" valign="center" rowspan="1" colspan="1"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="${orgPropString}.reportsToChartOfAccountsCode"
+						attributeEntry="${orgAttributes.reportsToChartOfAccountsCode}"
+						readOnly="true" readOnlyBody="true">
+						<kul:inquiry boClassName="org.kuali.kfs.coa.businessobject.Chart"
+							keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.account.organization.reportsToChartOfAccountsCode}"
+							render="${!empty KualiForm.budgetConstructionHeader.account.organization.reportsToChartOfAccountsCode}">
+							<html:hidden write="true"
+								property="${orgPropString}.reportsToChartOfAccountsCode" />
+						</kul:inquiry>&nbsp;
 	      	</kul:htmlControlAttribute>
-            </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-            <c:if test="${showTheDetail}" >
-	      	<kul:htmlControlAttribute
-	      		property="${orgPropString}.reportsToOrganizationCode"
-	      		attributeEntry="${orgAttributes.reportsToOrganizationCode}"
-	      		readOnly="true"
-	      		readOnlyBody="true">
-	      		<kul:inquiry
-				    boClassName="org.kuali.kfs.coa.businessobject.Organization"
-				    keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.account.organization.reportsToChartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.account.organization.reportsToOrganizationCode}"
-				    render="${!empty KualiForm.budgetConstructionHeader.account.organization.reportsToOrganizationCode}">
-			    	<html:hidden write="true" property="${orgPropString}.reportsToOrganizationCode" />
-				</kul:inquiry>&nbsp;
+				</c:if>&nbsp;</td>
+				<td class="grid" valign="center" rowspan="1" colspan="1"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="${orgPropString}.reportsToOrganizationCode"
+						attributeEntry="${orgAttributes.reportsToOrganizationCode}"
+						readOnly="true" readOnlyBody="true">
+						<kul:inquiry
+							boClassName="org.kuali.kfs.coa.businessobject.Organization"
+							keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.account.organization.reportsToChartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.account.organization.reportsToOrganizationCode}"
+							render="${!empty KualiForm.budgetConstructionHeader.account.organization.reportsToOrganizationCode}">
+							<html:hidden write="true"
+								property="${orgPropString}.reportsToOrganizationCode" />
+						</kul:inquiry>&nbsp;
 	      	</kul:htmlControlAttribute>
-            </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="3">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="${orgPropString}.reportsToOrganization.organizationName"
-                attributeEntry="${organizationAttributes.organizationName}"
-                readOnly="true"/>
-            </c:if>&nbsp;
-            </td>
-	    </tr>
+				</c:if>&nbsp;</td>
+				<td class="grid" valign="center" rowspan="1" colspan="3"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="${orgPropString}.reportsToOrganization.organizationName"
+						attributeEntry="${organizationAttributes.organizationName}"
+						readOnly="true" />
+				</c:if>&nbsp;</td>
+			</tr>
 
-        <c:if test="${!KualiForm.accountReportsExist}">
-	    <tr>
-		    <th class="grid" align="right" colspan="2">
-		        Next Year Org:
-		    </th>
-            <td class="grid" valign="center" rowspan="1" colspan="5">
-              <c:if test="${!empty KualiForm.budgetConstructionHeader.chartOfAccountsCode && !empty KualiForm.budgetConstructionHeader.accountNumber}">
+			<c:if test="${!KualiForm.accountReportsExist}">
+				<tr>
+					<th class="grid" align="right" colspan="2">Next Year Org:</th>
+					<td class="grid" valign="center" rowspan="1" colspan="5"><c:if
+						test="${!empty KualiForm.budgetConstructionHeader.chartOfAccountsCode && !empty KualiForm.budgetConstructionHeader.accountNumber}">
                     No Account Reports To mapping found!
-              </c:if>&nbsp;
-            </td>
-	    </tr>
-        </c:if>
-        <c:if test="${KualiForm.accountReportsExist}">
-	    <tr>
-		    <th class="grid" align="right" colspan="2">
-		        Next Year Org:
-		    </th>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="${accountRptsPropString}.reportsToChartOfAccountsCode"
-                attributeEntry="${accountRptsAttributes.reportsToChartOfAccountsCode}"
-                readOnly="true"
-                readOnlyBody="true">
-                <kul:inquiry
-                    boClassName="org.kuali.kfs.coa.businessobject.Chart"
-                    keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToChartOfAccountsCode}"
-                    render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToChartOfAccountsCode}">
-                	<html:hidden write="true" property="${accountRptsPropString}.reportsToChartOfAccountsCode" />
-                </kul:inquiry>&nbsp;
+              </c:if>&nbsp;</td>
+				</tr>
+			</c:if>
+			<c:if test="${KualiForm.accountReportsExist}">
+				<tr>
+					<th class="grid" align="right" colspan="2">Next Year Org:</th>
+					<td class="grid" valign="center" rowspan="1" colspan="1"><c:if
+						test="${showTheDetail}">
+						<kul:htmlControlAttribute
+							property="${accountRptsPropString}.reportsToChartOfAccountsCode"
+							attributeEntry="${accountRptsAttributes.reportsToChartOfAccountsCode}"
+							readOnly="true" readOnlyBody="true">
+							<kul:inquiry boClassName="org.kuali.kfs.coa.businessobject.Chart"
+								keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToChartOfAccountsCode}"
+								render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToChartOfAccountsCode}">
+								<html:hidden write="true"
+									property="${accountRptsPropString}.reportsToChartOfAccountsCode" />
+							</kul:inquiry>&nbsp;
             </kul:htmlControlAttribute>
-            </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="${accountRptsPropString}.reportsToOrganizationCode"
-                attributeEntry="${accountRptsAttributes.reportsToOrganizationCode}"
-                readOnly="true"
-                readOnlyBody="true">
-                <kul:inquiry
-                    boClassName="org.kuali.kfs.module.bc.businessobject.BudgetConstructionOrganizationReports"
-                    keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToChartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToOrganizationCode}"
-                    render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToOrganizationCode}">
-                	<html:hidden write="true" property="${accountRptsPropString}.reportsToOrganizationCode" />
-                </kul:inquiry>&nbsp;
+					</c:if>&nbsp;</td>
+					<td class="grid" valign="center" rowspan="1" colspan="1"><c:if
+						test="${showTheDetail}">
+						<kul:htmlControlAttribute
+							property="${accountRptsPropString}.reportsToOrganizationCode"
+							attributeEntry="${accountRptsAttributes.reportsToOrganizationCode}"
+							readOnly="true" readOnlyBody="true">
+							<kul:inquiry
+								boClassName="org.kuali.kfs.module.bc.businessobject.BudgetConstructionOrganizationReports"
+								keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToChartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToOrganizationCode}"
+								render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.reportsToOrganizationCode}">
+								<html:hidden write="true"
+									property="${accountRptsPropString}.reportsToOrganizationCode" />
+							</kul:inquiry>&nbsp;
             </kul:htmlControlAttribute>
-            </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="3">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="${accountRptsPropString}.budgetConstructionOrganizationReports.organization.organizationName"
-                attributeEntry="${orgAttributes.organizationName}"
-                readOnly="true"/>
-            </td>
-            </c:if>&nbsp;
-	    </tr>
-	    <tr>
-		    <th class="grid" align="right" colspan="2">
-		        Rpts To:
-		    </th>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="${orgRptsPropString}.reportsToChartOfAccountsCode"
-                attributeEntry="${orgRptsAttributes.reportsToChartOfAccountsCode}"
-                readOnly="true"
-                readOnlyBody="true">
-                <kul:inquiry
-                    boClassName="org.kuali.kfs.coa.businessobject.Chart"
-                    keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToChartOfAccountsCode}"
-                    render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToChartOfAccountsCode}">
-                    <html:hidden write="true" property="${orgRptsPropString}.reportsToChartOfAccountsCode" />
-                </kul:inquiry>&nbsp;
-            </kul:htmlControlAttribute>
-            </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="1">
-            <c:if test="${showTheDetail}" >
-	      	<kul:htmlControlAttribute
-	      		property="${orgRptsPropString}.reportsToOrganizationCode"
-	      		attributeEntry="${orgRptsAttributes.reportsToOrganizationCode}"
-	      		readOnly="true"
-	      		readOnlyBody="true">
-	      		<kul:inquiry
-				    boClassName="org.kuali.kfs.coa.businessobject.Organization"
-				    keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToChartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToOrganizationCode}"
-				    render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToOrganizationCode}">
-			    	<html:hidden write="true" property="${orgRptsPropString}.reportsToOrganizationCode" />
-				</kul:inquiry>&nbsp;
+					</c:if>&nbsp;</td>
+					<td class="grid" valign="center" rowspan="1" colspan="3"><c:if
+						test="${showTheDetail}">
+						<kul:htmlControlAttribute
+							property="${accountRptsPropString}.budgetConstructionOrganizationReports.organization.organizationName"
+							attributeEntry="${orgAttributes.organizationName}"
+							readOnly="true" /></td>
+			</c:if>
+			&nbsp;
+			</tr>
+			<tr>
+				<th class="grid" align="right" colspan="2">Rpts To:</th>
+				<td class="grid" valign="center" rowspan="1" colspan="1"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="${orgRptsPropString}.reportsToChartOfAccountsCode"
+						attributeEntry="${orgRptsAttributes.reportsToChartOfAccountsCode}"
+						readOnly="true" readOnlyBody="true">
+						<kul:inquiry boClassName="org.kuali.kfs.coa.businessobject.Chart"
+							keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToChartOfAccountsCode}"
+							render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToChartOfAccountsCode}">
+							<html:hidden write="true"
+								property="${orgRptsPropString}.reportsToChartOfAccountsCode" />
+						</kul:inquiry>&nbsp;
+            		</kul:htmlControlAttribute>
+				</c:if>&nbsp;</td>
+				<td class="grid" valign="center" rowspan="1" colspan="1"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="${orgRptsPropString}.reportsToOrganizationCode"
+						attributeEntry="${orgRptsAttributes.reportsToOrganizationCode}"
+						readOnly="true" readOnlyBody="true">
+						<kul:inquiry
+							boClassName="org.kuali.kfs.coa.businessobject.Organization"
+							keyValues="chartOfAccountsCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToChartOfAccountsCode}&amp;organizationCode=${KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToOrganizationCode}"
+							render="${!empty KualiForm.budgetConstructionHeader.budgetConstructionAccountReports.budgetConstructionOrganizationReports.reportsToOrganizationCode}">
+							<html:hidden write="true"
+								property="${orgRptsPropString}.reportsToOrganizationCode" />
+						</kul:inquiry>&nbsp;
 	      	</kul:htmlControlAttribute>
-            </c:if>&nbsp;
-            </td>
-            <td class="grid" valign="center" rowspan="1" colspan="3">
-            <c:if test="${showTheDetail}" >
-            <kul:htmlControlAttribute
-                property="${orgRptsPropString}.reportsToOrganization.organizationName"
-                attributeEntry="${organizationAttributes.organizationName}"
-                readOnly="${true}"/>
-            </td>
-            </c:if>&nbsp;
-		</tr>
-        </c:if>
+				</c:if>&nbsp;</td>
+				<td class="grid" valign="center" rowspan="1" colspan="3"><c:if
+					test="${showTheDetail}">
+					<kul:htmlControlAttribute
+						property="${orgRptsPropString}.reportsToOrganization.organizationName"
+						attributeEntry="${organizationAttributes.organizationName}"
+						readOnly="${true}" /></td>
+				</c:if>
+				&nbsp;
+			</tr>
+			</c:if>
 
-    	<tr>
-            <th class="grid" colspan="7" align="left">
-                <br>
-                Budget Construction Organization Salary Setting/Report/Control
-                <br><br>
-		    </th>
-		</tr>
-    	<tr>
-            <td class="grid" colspan="4">
-            <div align="center">
-              <c:if test="${!KualiForm.salarySettingDisabled}">
-              <html:image property="methodToCall.performOrgSalarySetting.anchororgControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-orgsalsettings.gif" title="Organization Salary Setting" alt="Organization Salary Setting" styleClass="tinybutton"/>&nbsp;&nbsp;&nbsp;
-              </c:if>
-              <html:image property="methodToCall.performReportDump.anchororgControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-orgrepdump.gif" title="Organization Report Export" alt="Organization Report/Dump" styleClass="tinybutton"/>&nbsp;&nbsp;&nbsp;
-              <html:image property="methodToCall.performRequestImport.anchororgControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-requestimport.gif" title="Organization Request Import" alt="Organization Request Import" styleClass="tinybutton" />&nbsp;&nbsp;&nbsp;
-              <html:image property="methodToCall.performLockMonitor.anchororgControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-lockmonitor.gif" title="Lock Monitor" alt="Lock Monitor" styleClass="tinybutton" />&nbsp;&nbsp;&nbsp;
-              <c:if test="${KualiForm.canPerformPayrateImportExport}">
-                <c:if test="${!KualiForm.salarySettingDisabled}">
-                  <html:image property="methodToCall.performPayrateImportExport.anchororgControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-payrateimpexp.gif" title="Payrate Import/Export" alt="Payrate Import/Export" styleClass="tinybutton" />
-                </c:if>
-              </c:if>
-            </div>
-		    </td>
-            <td class="grid" colspan="3">
-            <div align="center">
-              <html:image property="methodToCall.performOrgPullup.anchororgControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-orgpullup.gif" title="Organization Pull Up" alt="Organization Pull Up" styleClass="tinybutton"/>&nbsp;&nbsp;&nbsp;
-              <html:image property="methodToCall.performOrgPushdown.anchororgControlsAnchor" src="${ConfigProperties.externalizable.images.url}tinybutton-orgpushdown.gif" title="Organization Push Down" alt="Organization Push Down" styleClass="tinybutton" />
-            </div>
-		    </td>
-		</tr>
-	</table>
-    </c:if>
+			<tr>
+				<th class="grid" colspan="7" align="left"><br>
+				Budget Construction Organization Salary Setting/Report/Control <br>
+				<br>
+				</th>
+			</tr>
+			<tr>
+				<td class="grid" colspan="4">
+				<div align="center"><c:if
+					test="${!KualiForm.salarySettingDisabled}">
+					<html:image
+						property="methodToCall.performOrgSalarySetting.anchororgControlsAnchor"
+						src="${ConfigProperties.externalizable.images.url}tinybutton-orgsalsettings.gif"
+						title="Organization Salary Setting"
+						alt="Organization Salary Setting" styleClass="tinybutton" />&nbsp;&nbsp;&nbsp;
+              </c:if> <html:image
+					property="methodToCall.performReportDump.anchororgControlsAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-orgrepdump.gif"
+					title="Organization Report Export" alt="Organization Report/Dump"
+					styleClass="tinybutton" />&nbsp;&nbsp;&nbsp; <html:image
+					property="methodToCall.performRequestImport.anchororgControlsAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-requestimport.gif"
+					title="Organization Request Import"
+					alt="Organization Request Import" styleClass="tinybutton" />&nbsp;&nbsp;&nbsp;
+				<html:image
+					property="methodToCall.performLockMonitor.anchororgControlsAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-lockmonitor.gif"
+					title="Lock Monitor" alt="Lock Monitor" styleClass="tinybutton" />&nbsp;&nbsp;&nbsp;
+				<c:if test="${KualiForm.canPerformPayrateImportExport}">
+					<c:if test="${!KualiForm.salarySettingDisabled}">
+						<html:image
+							property="methodToCall.performPayrateImportExport.anchororgControlsAnchor"
+							src="${ConfigProperties.externalizable.images.url}tinybutton-payrateimpexp.gif"
+							title="Payrate Import/Export" alt="Payrate Import/Export"
+							styleClass="tinybutton" />
+					</c:if>
+				</c:if></div>
+				</td>
+				<td class="grid" colspan="3">
+				<div align="center"><html:image
+					property="methodToCall.performOrgPullup.anchororgControlsAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-orgpullup.gif"
+					title="Organization Pull Up" alt="Organization Pull Up"
+					styleClass="tinybutton" />&nbsp;&nbsp;&nbsp; <html:image
+					property="methodToCall.performOrgPushdown.anchororgControlsAnchor"
+					src="${ConfigProperties.externalizable.images.url}tinybutton-orgpushdown.gif"
+					title="Organization Push Down" alt="Organization Push Down"
+					styleClass="tinybutton" /></div>
+				</td>
+			</tr>
+		</table>
+	</c:if>
 
-    <div id="globalbuttons" class="globalbuttons">
-        <html:image src="${ConfigProperties.kr.externalizable.images.url}buttonsmall_close.gif" styleClass="globalbuttons" property="methodToCall.returnToCaller" title="close" alt="close"/>
-    </div>
+	<div id="globalbuttons" class="globalbuttons"><html:image
+		src="${ConfigProperties.kr.externalizable.images.url}buttonsmall_close.gif"
+		styleClass="globalbuttons" property="methodToCall.returnToCaller"
+		title="close" alt="close" /></div>
 
-<%-- Need these here to override and initialize vars used by objectinfo.js to BC specific --%>
-<SCRIPT type="text/javascript">
+	<%-- Need these here to override and initialize vars used by objectinfo.js to BC specific --%>
+	<SCRIPT type="text/javascript">
   var kualiForm = document.forms['KualiForm'];
   var kualiElements = kualiForm.elements;
 </SCRIPT>
Index: work/web-root/jsp/module/bc/OrganizationSalarySettingReturning.jsp
===================================================================
--- work/web-root/jsp/module/bc/OrganizationSalarySettingReturning.jsp	(revision 30259)
+++ work/web-root/jsp/module/bc/OrganizationSalarySettingReturning.jsp	(revision 37225)
@@ -21,6 +21,6 @@
     <kul:errors keyMatch="${BCConstants.ErrorKey.RETURNED_DETAIL_SALARY_SETTING_TAB_ERRORS}" errorTitle=" " />
     <div id="globalbuttons" class="globalbuttons">
 	    <html:image src="${ConfigProperties.kr.externalizable.images.url}buttonsmall_close.gif" styleClass="globalbuttons" 
-	        onclick="window.close();return false;" title="close the window" alt="close the window"/>		
+	        onclick="window.close();return true;" property="methodToCall.performLost" title="close the window" alt="close the window"/>		
     </div>
 </kul:page>
Index: work/web-root/jsp/module/bc/IncumbentSalarySetting.jsp
===================================================================
--- work/web-root/jsp/module/bc/IncumbentSalarySetting.jsp	(revision 30259)
+++ work/web-root/jsp/module/bc/IncumbentSalarySetting.jsp	(revision 37225)
@@ -13,16 +13,21 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+<%@ page import="org.kuali.kfs.sys.context.SpringContext"%>
+<%@ page import="org.kuali.kfs.coa.service.AccountService"%>
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
 <c:set var="readOnly" value="${KualiForm.viewOnlyEntry || KualiForm.salarySettingClosed}" />
+<c:set var="accountsCanCrossCharts"
+	value="<%=SpringContext.getBean(AccountService.class).accountsCanCrossCharts()%>" />
 
+
 <kul:page showDocumentInfo="false" htmlFormAction="budgetIncumbentSalarySetting" renderMultipart="true"
 	showTabButtons="true" docTitle="${KualiForm.documentTitle}" transactionalDocument="false">
 
     <html:hidden property="mainWindow" />
 
-    <bc:incumbentSalarySetting readOnly="${readOnly}"/>	
+    <bc:incumbentSalarySetting readOnly="${readOnly}" accountsCanCrossCharts="${accountsCanCrossCharts}"/>	
     
 	<kul:panelFooter />
 
Index: work/web-root/jsp/module/bc/PositionSalarySetting.jsp
===================================================================
--- work/web-root/jsp/module/bc/PositionSalarySetting.jsp	(revision 30259)
+++ work/web-root/jsp/module/bc/PositionSalarySetting.jsp	(revision 37225)
@@ -13,16 +13,21 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
+<%@ page import="org.kuali.kfs.sys.context.SpringContext"%>
+<%@ page import="org.kuali.kfs.coa.service.AccountService"%>
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
 <c:set var="readOnly" value="${KualiForm.viewOnlyEntry || KualiForm.salarySettingClosed}" />
+<c:set var="accountsCanCrossCharts"
+	value="<%=SpringContext.getBean(AccountService.class).accountsCanCrossCharts()%>" />
 
+
 <kul:page showDocumentInfo="false" htmlFormAction="budgetPositionSalarySetting" renderMultipart="true"
 	showTabButtons="true" docTitle="${KualiForm.documentTitle}" transactionalDocument="false">
 	
     <html:hidden property="mainWindow" />
 
-    <bc:positionSalarySetting readOnly="${readOnly}" />
+    <bc:positionSalarySetting readOnly="${readOnly}" accountsCanCrossCharts="${accountsCanCrossCharts}"/>
 	<kul:panelFooter />
 
     <div id="globalbuttons" class="globalbuttons">
Index: work/web-root/jsp/module/bc/LostSessionReturning.jsp
===================================================================
--- work/web-root/jsp/module/bc/LostSessionReturning.jsp	(revision 30259)
+++ work/web-root/jsp/module/bc/LostSessionReturning.jsp	(revision 37225)
@@ -20,6 +20,6 @@
 
     <div id="globalbuttons" class="globalbuttons">
 	    <html:image src="${ConfigProperties.kr.externalizable.images.url}buttonsmall_close.gif" styleClass="globalbuttons" 
-	        onclick="window.close();return false;" title="close the window" alt="close the window"/>		
+	        onclick="window.close();return true;" property="methodToCall.performLost" title="close the window" alt="close the window"/>		
     </div>
 </kul:page>
Index: work/web-root/jsp/module/ec/CertificationReport.jsp
===================================================================
--- work/web-root/jsp/module/ec/CertificationReport.jsp	(revision 30259)
+++ work/web-root/jsp/module/ec/CertificationReport.jsp	(revision 37225)
@@ -14,6 +14,8 @@
  limitations under the License.
 --%>
 <%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
+<%@ page import="org.kuali.kfs.sys.context.SpringContext" %>
+<%@ page import="org.kuali.kfs.coa.service.AccountService" %>
 
 <html:xhtml/>
 
@@ -25,6 +27,7 @@
 
 <c:set var="documentTypeName" value="EffortCertificationDocument"/>
 <c:set var="htmlFormAction" value="effortCertificationRecreate"/>
+<c:set var="accountsCanCrossCharts" value="<%=SpringContext.getBean(AccountService.class).accountsCanCrossCharts()%>" />    
 
 <kul:documentPage showDocumentInfo="true"
 	htmlFormAction="effortCertificationReport"
@@ -43,12 +46,12 @@
 	<c:set var="canEdit" value="${KualiForm.documentActions[Constants.KUALI_ACTION_CAN_EDIT]}"/>
 	<c:set var="isSummaryTabEntry" value="${KualiForm.editingMode[EffortConstants.EffortCertificationEditMode.SUMMARY_TAB_ENTRY]}"/>
 	
- 	<c:if test="${canEdit && isSummaryTabEntry}">
-		<ec:summaryTab/>	
-	</c:if>
+ 	< c:if test="${canEdit && isSummaryTabEntry}" >
+		<ec:summaryTab accountsCanCrossCharts="${accountsCanCrossCharts}"/>	
+	</c:if >
 	
 	<c:set var="isDetailTabEntry" value="${KualiForm.editingMode[EffortConstants.EffortCertificationEditMode.DETAIL_TAB_ENTRY]}" />
-	<ec:detailTab isOpen="${!isSummaryTabEntry}" isEditable="${canEdit && isDetailTabEntry && !isSummaryTabEntry}"/>
+	<ec:detailTab isOpen="${!isSummaryTabEntry}" isEditable="${canEdit && isDetailTabEntry && !isSummaryTabEntry}" accountsCanCrossCharts="${accountsCanCrossCharts}"/>
 	
 	<kul:notes />
 	
Index: work/web-root/jsp/module/purap/ElectronicInvoiceTest.jsp
===================================================================
--- work/web-root/jsp/module/purap/ElectronicInvoiceTest.jsp	(revision 30259)
+++ work/web-root/jsp/module/purap/ElectronicInvoiceTest.jsp	(revision 37225)
@@ -1,5 +1,5 @@
 <%--
- Copyright 2007-2009 The Kuali Foundation
+ Copyright 2007 The Kuali Foundation
  
  Licensed under the Educational Community License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
@@ -13,30 +13,44 @@
  See the License for the specific language governing permissions and
  limitations under the License.
 --%>
-<%-- @ include file="tldHeader.jsp" --%>
-<html>
-<head>
+<%@ include file="/jsp/sys/kfsTldHeader.jsp"%>
 
-</head>
-<body>
-
-<br /><br />
-
-<form method="post" action="purapElectronicInvoiceTest.do" enctype="multipart/form-data">
-	<input type="hidden" name="action" value="postXML" />
-	<INPUT TYPE="file" NAME="xmlFile" /><br />
-	<INPUT TYPE="submit" VALUE="Upload XML eInvoice File" />
-</form>
-
-<br /><br />
-
-<form method="post" action="purapElectronicInvoiceTest.do">
-	<input type="hidden" name="action" value="returnXML" />
-	PO Document Number: <INPUT TYPE="text" NAME="poDocNumber" size="10" /><br />
-	<INPUT TYPE="submit" VALUE="Get XML eInvoice File for Specfied PO">
-</form>
-
-<br /><br />
-
-</body>
-</html>
+<kul:page showDocumentInfo="false"
+	headerTitle="Electronic Invoice Test File Generation" docTitle="" renderMultipart="true"
+	transactionalDocument="false" htmlFormAction="purapElectronicInvoiceTestFileGeneration" errorKey="foo">
+	
+	<strong><h2>	
+	  Electronic Invoice Test File Generation
+	</h2></strong>
+	</br>
+	
+	<table width="100%" border="0"><tr><td>	
+	  <kul:errors keyMatch="*" errorTitle="Errors Found In File:"/>
+	</td></tr></table>  
+	</br>
+		
+	<kul:tabTop tabTitle="Manage Batch Files" defaultOpen="true" tabErrorKey="">
+      <div class="tab-container" align="center">
+          <h3>Generate Test File</h3>
+          <table width="100%" summary="" cellpadding="0" cellspacing="0">
+            <tr>
+              <th width="300">&nbsp;</th>
+              <th> <div align="left"><label for="poDocNumber">Purchase Order Document Number</label></div></th>
+              <th width="150"> <div align="center">Actions</div></th>
+            </tr>
+            
+            <tr>
+              <th scope="row"><div align="center">Generate eInvoice test file for PO:</div></th>
+              <td class="infoline"><input type="text" name="poDocNumber" size="10" />
+				<span class="fineprint"></span> 
+			  </td>
+              <td class="infoline"><div align="center">
+				<html:image src="${ConfigProperties.externalizable.images.url}tinybutton-generate.gif" styleClass="globalbuttons" property="methodToCall.generate" title="Generate Test File" alt="Generate Test File" />
+              </td>
+            </tr>
+         </table>
+      </div>
+	</kul:tabTop>
+	
+	<kul:panelFooter />		
+</kul:page>
Index: .settings/org.eclipse.jdt.core.prefs
===================================================================
--- .settings/org.eclipse.jdt.core.prefs	(revision 30259)
+++ .settings/org.eclipse.jdt.core.prefs	(revision 37225)
@@ -1,366 +1,366 @@
-#Wed Oct 06 12:55:44 PDT 2010
-eclipse.preferences.version=1
-instance/org.eclipse.core.net/org.eclipse.core.net.hasMigrated=true
-org.eclipse.jdt.core.builder.cleanOutputFolder=clean
-org.eclipse.jdt.core.builder.duplicateResourceTask=warning
-org.eclipse.jdt.core.builder.invalidClasspath=abort
-org.eclipse.jdt.core.builder.resourceCopyExclusionFilter=*.launch
-org.eclipse.jdt.core.circularClasspath=error
-org.eclipse.jdt.core.classpath.exclusionPatterns=enabled
-org.eclipse.jdt.core.classpath.multipleOutputLocations=enabled
-org.eclipse.jdt.core.codeComplete.argumentPrefixes=
-org.eclipse.jdt.core.codeComplete.argumentSuffixes=
-org.eclipse.jdt.core.codeComplete.fieldPrefixes=
-org.eclipse.jdt.core.codeComplete.fieldSuffixes=
-org.eclipse.jdt.core.codeComplete.localPrefixes=
-org.eclipse.jdt.core.codeComplete.localSuffixes=
-org.eclipse.jdt.core.codeComplete.staticFieldPrefixes=
-org.eclipse.jdt.core.codeComplete.staticFieldSuffixes=
-org.eclipse.jdt.core.codeComplete.staticFinalFieldPrefixes=
-org.eclipse.jdt.core.codeComplete.staticFinalFieldSuffixes=
-org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.5
-org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
-org.eclipse.jdt.core.compiler.compliance=1.6
-org.eclipse.jdt.core.compiler.debug.lineNumber=generate
-org.eclipse.jdt.core.compiler.debug.localVariable=generate
-org.eclipse.jdt.core.compiler.debug.sourceFile=generate
-org.eclipse.jdt.core.compiler.doc.comment.support=disabled
-org.eclipse.jdt.core.compiler.maxProblemPerUnit=100
-org.eclipse.jdt.core.compiler.problem.annotationSuperInterface=warning
-org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
-org.eclipse.jdt.core.compiler.problem.autoboxing=ignore
-org.eclipse.jdt.core.compiler.problem.comparingIdentical=warning
-org.eclipse.jdt.core.compiler.problem.deadCode=warning
-org.eclipse.jdt.core.compiler.problem.deprecation=warning
-org.eclipse.jdt.core.compiler.problem.deprecationInDeprecatedCode=disabled
-org.eclipse.jdt.core.compiler.problem.deprecationWhenOverridingDeprecatedMethod=disabled
-org.eclipse.jdt.core.compiler.problem.discouragedReference=warning
-org.eclipse.jdt.core.compiler.problem.emptyStatement=ignore
-org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
-org.eclipse.jdt.core.compiler.problem.fallthroughCase=ignore
-org.eclipse.jdt.core.compiler.problem.fatalOptionalError=enabled
-org.eclipse.jdt.core.compiler.problem.fieldHiding=ignore
-org.eclipse.jdt.core.compiler.problem.finalParameterBound=warning
-org.eclipse.jdt.core.compiler.problem.finallyBlockNotCompletingNormally=warning
-org.eclipse.jdt.core.compiler.problem.forbiddenReference=error
-org.eclipse.jdt.core.compiler.problem.hiddenCatchBlock=warning
-org.eclipse.jdt.core.compiler.problem.incompatibleNonInheritedInterfaceMethod=warning
-org.eclipse.jdt.core.compiler.problem.incompleteEnumSwitch=ignore
-org.eclipse.jdt.core.compiler.problem.indirectStaticAccess=ignore
-org.eclipse.jdt.core.compiler.problem.invalidJavadoc=warning
-org.eclipse.jdt.core.compiler.problem.invalidJavadocTags=enabled
-org.eclipse.jdt.core.compiler.problem.invalidJavadocTagsDeprecatedRef=enabled
-org.eclipse.jdt.core.compiler.problem.invalidJavadocTagsNotVisibleRef=enabled
-org.eclipse.jdt.core.compiler.problem.invalidJavadocTagsVisibility=private
-org.eclipse.jdt.core.compiler.problem.localVariableHiding=ignore
-org.eclipse.jdt.core.compiler.problem.methodWithConstructorName=warning
-org.eclipse.jdt.core.compiler.problem.missingDeprecatedAnnotation=ignore
-org.eclipse.jdt.core.compiler.problem.missingHashCodeMethod=ignore
-org.eclipse.jdt.core.compiler.problem.missingJavadocComments=warning
-org.eclipse.jdt.core.compiler.problem.missingJavadocCommentsOverriding=enabled
-org.eclipse.jdt.core.compiler.problem.missingJavadocCommentsVisibility=public
-org.eclipse.jdt.core.compiler.problem.missingJavadocTags=warning
-org.eclipse.jdt.core.compiler.problem.missingJavadocTagsOverriding=enabled
-org.eclipse.jdt.core.compiler.problem.missingJavadocTagsVisibility=private
-org.eclipse.jdt.core.compiler.problem.missingOverrideAnnotation=ignore
-org.eclipse.jdt.core.compiler.problem.missingOverrideAnnotationForInterfaceMethodImplementation=disabled
-org.eclipse.jdt.core.compiler.problem.missingSerialVersion=ignore
-org.eclipse.jdt.core.compiler.problem.missingSynchronizedOnInheritedMethod=ignore
-org.eclipse.jdt.core.compiler.problem.noEffectAssignment=warning
-org.eclipse.jdt.core.compiler.problem.noImplicitStringConversion=warning
-org.eclipse.jdt.core.compiler.problem.nonExternalizedStringLiteral=ignore
-org.eclipse.jdt.core.compiler.problem.nullReference=warning
-org.eclipse.jdt.core.compiler.problem.overridingPackageDefaultMethod=warning
-org.eclipse.jdt.core.compiler.problem.parameterAssignment=ignore
-org.eclipse.jdt.core.compiler.problem.possibleAccidentalBooleanAssignment=ignore
-org.eclipse.jdt.core.compiler.problem.potentialNullReference=warning
-org.eclipse.jdt.core.compiler.problem.rawTypeReference=warning
-org.eclipse.jdt.core.compiler.problem.redundantNullCheck=ignore
-org.eclipse.jdt.core.compiler.problem.redundantSuperinterface=ignore
-org.eclipse.jdt.core.compiler.problem.specialParameterHidingField=disabled
-org.eclipse.jdt.core.compiler.problem.staticAccessReceiver=warning
-org.eclipse.jdt.core.compiler.problem.suppressOptionalErrors=disabled
-org.eclipse.jdt.core.compiler.problem.suppressWarnings=enabled
-org.eclipse.jdt.core.compiler.problem.syntheticAccessEmulation=ignore
-org.eclipse.jdt.core.compiler.problem.typeParameterHiding=warning
-org.eclipse.jdt.core.compiler.problem.uncheckedTypeOperation=ignore
-org.eclipse.jdt.core.compiler.problem.undocumentedEmptyBlock=ignore
-org.eclipse.jdt.core.compiler.problem.unhandledWarningToken=warning
-org.eclipse.jdt.core.compiler.problem.unnecessaryElse=ignore
-org.eclipse.jdt.core.compiler.problem.unnecessaryTypeCheck=ignore
-org.eclipse.jdt.core.compiler.problem.unqualifiedFieldAccess=ignore
-org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownException=ignore
-org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionExemptExceptionAndThrowable=enabled
-org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionIncludeDocCommentReference=enabled
-org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionWhenOverriding=disabled
-org.eclipse.jdt.core.compiler.problem.unusedImport=ignore
-org.eclipse.jdt.core.compiler.problem.unusedLabel=warning
-org.eclipse.jdt.core.compiler.problem.unusedLocal=ignore
-org.eclipse.jdt.core.compiler.problem.unusedObjectAllocation=ignore
-org.eclipse.jdt.core.compiler.problem.unusedParameter=ignore
-org.eclipse.jdt.core.compiler.problem.unusedParameterIncludeDocCommentReference=enabled
-org.eclipse.jdt.core.compiler.problem.unusedParameterWhenImplementingAbstract=disabled
-org.eclipse.jdt.core.compiler.problem.unusedParameterWhenOverridingConcrete=disabled
-org.eclipse.jdt.core.compiler.problem.unusedPrivateMember=ignore
-org.eclipse.jdt.core.compiler.problem.unusedWarningToken=warning
-org.eclipse.jdt.core.compiler.problem.varargsArgumentNeedCast=warning
-org.eclipse.jdt.core.compiler.source=1.5
-org.eclipse.jdt.core.compiler.taskCaseSensitive=enabled
-org.eclipse.jdt.core.compiler.taskPriorities=NORMAL,HIGH,NORMAL
-org.eclipse.jdt.core.compiler.taskTags=TODO,FIXME,XXX
-org.eclipse.jdt.core.formatter.align_type_members_on_columns=false
-org.eclipse.jdt.core.formatter.alignment_for_arguments_in_allocation_expression=20
-org.eclipse.jdt.core.formatter.alignment_for_arguments_in_enum_constant=16
-org.eclipse.jdt.core.formatter.alignment_for_arguments_in_explicit_constructor_call=20
-org.eclipse.jdt.core.formatter.alignment_for_arguments_in_method_invocation=16
-org.eclipse.jdt.core.formatter.alignment_for_arguments_in_qualified_allocation_expression=16
-org.eclipse.jdt.core.formatter.alignment_for_assignment=0
-org.eclipse.jdt.core.formatter.alignment_for_binary_expression=16
-org.eclipse.jdt.core.formatter.alignment_for_compact_if=16
-org.eclipse.jdt.core.formatter.alignment_for_conditional_expression=80
-org.eclipse.jdt.core.formatter.alignment_for_enum_constants=0
-org.eclipse.jdt.core.formatter.alignment_for_expressions_in_array_initializer=16
-org.eclipse.jdt.core.formatter.alignment_for_multiple_fields=16
-org.eclipse.jdt.core.formatter.alignment_for_parameters_in_constructor_declaration=16
-org.eclipse.jdt.core.formatter.alignment_for_parameters_in_method_declaration=16
-org.eclipse.jdt.core.formatter.alignment_for_selector_in_method_invocation=16
-org.eclipse.jdt.core.formatter.alignment_for_superclass_in_type_declaration=16
-org.eclipse.jdt.core.formatter.alignment_for_superinterfaces_in_enum_declaration=16
-org.eclipse.jdt.core.formatter.alignment_for_superinterfaces_in_type_declaration=16
-org.eclipse.jdt.core.formatter.alignment_for_throws_clause_in_constructor_declaration=18
-org.eclipse.jdt.core.formatter.alignment_for_throws_clause_in_method_declaration=16
-org.eclipse.jdt.core.formatter.blank_lines_after_imports=1
-org.eclipse.jdt.core.formatter.blank_lines_after_package=1
-org.eclipse.jdt.core.formatter.blank_lines_before_field=0
-org.eclipse.jdt.core.formatter.blank_lines_before_first_class_body_declaration=0
-org.eclipse.jdt.core.formatter.blank_lines_before_imports=1
-org.eclipse.jdt.core.formatter.blank_lines_before_member_type=1
-org.eclipse.jdt.core.formatter.blank_lines_before_method=1
-org.eclipse.jdt.core.formatter.blank_lines_before_new_chunk=1
-org.eclipse.jdt.core.formatter.blank_lines_before_package=0
-org.eclipse.jdt.core.formatter.blank_lines_between_import_groups=1
-org.eclipse.jdt.core.formatter.blank_lines_between_type_declarations=1
-org.eclipse.jdt.core.formatter.brace_position_for_annotation_type_declaration=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_anonymous_type_declaration=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_array_initializer=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_block=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_block_in_case=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_constructor_declaration=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_enum_constant=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_enum_declaration=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_method_declaration=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_switch=end_of_line
-org.eclipse.jdt.core.formatter.brace_position_for_type_declaration=end_of_line
-org.eclipse.jdt.core.formatter.comment.clear_blank_lines_in_block_comment=true
-org.eclipse.jdt.core.formatter.comment.clear_blank_lines_in_javadoc_comment=true
-org.eclipse.jdt.core.formatter.comment.format_block_comments=true
-org.eclipse.jdt.core.formatter.comment.format_header=false
-org.eclipse.jdt.core.formatter.comment.format_html=true
-org.eclipse.jdt.core.formatter.comment.format_javadoc_comments=true
-org.eclipse.jdt.core.formatter.comment.format_line_comments=true
-org.eclipse.jdt.core.formatter.comment.format_source_code=true
-org.eclipse.jdt.core.formatter.comment.indent_parameter_description=false
-org.eclipse.jdt.core.formatter.comment.indent_root_tags=true
-org.eclipse.jdt.core.formatter.comment.insert_new_line_before_root_tags=insert
-org.eclipse.jdt.core.formatter.comment.insert_new_line_for_parameter=do not insert
-org.eclipse.jdt.core.formatter.comment.line_length=132
-org.eclipse.jdt.core.formatter.compact_else_if=true
-org.eclipse.jdt.core.formatter.continuation_indentation=2
-org.eclipse.jdt.core.formatter.continuation_indentation_for_array_initializer=2
-org.eclipse.jdt.core.formatter.format_guardian_clause_on_one_line=false
-org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_annotation_declaration_header=true
-org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_enum_constant_header=true
-org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_enum_declaration_header=true
-org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_type_header=true
-org.eclipse.jdt.core.formatter.indent_breaks_compare_to_cases=true
-org.eclipse.jdt.core.formatter.indent_empty_lines=false
-org.eclipse.jdt.core.formatter.indent_statements_compare_to_block=true
-org.eclipse.jdt.core.formatter.indent_statements_compare_to_body=true
-org.eclipse.jdt.core.formatter.indent_switchstatements_compare_to_cases=true
-org.eclipse.jdt.core.formatter.indent_switchstatements_compare_to_switch=true
-org.eclipse.jdt.core.formatter.indentation.size=4
-org.eclipse.jdt.core.formatter.insert_new_line_after_opening_brace_in_array_initializer=do not insert
-org.eclipse.jdt.core.formatter.insert_new_line_at_end_of_file_if_missing=do not insert
-org.eclipse.jdt.core.formatter.insert_new_line_before_catch_in_try_statement=insert
-org.eclipse.jdt.core.formatter.insert_new_line_before_closing_brace_in_array_initializer=do not insert
-org.eclipse.jdt.core.formatter.insert_new_line_before_else_in_if_statement=insert
-org.eclipse.jdt.core.formatter.insert_new_line_before_finally_in_try_statement=insert
-org.eclipse.jdt.core.formatter.insert_new_line_before_while_in_do_statement=do not insert
-org.eclipse.jdt.core.formatter.insert_new_line_in_empty_annotation_declaration=insert
-org.eclipse.jdt.core.formatter.insert_new_line_in_empty_anonymous_type_declaration=insert
-org.eclipse.jdt.core.formatter.insert_new_line_in_empty_block=insert
-org.eclipse.jdt.core.formatter.insert_new_line_in_empty_enum_constant=insert
-org.eclipse.jdt.core.formatter.insert_new_line_in_empty_enum_declaration=insert
-org.eclipse.jdt.core.formatter.insert_new_line_in_empty_method_body=insert
-org.eclipse.jdt.core.formatter.insert_new_line_in_empty_type_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_after_and_in_type_parameter=insert
-org.eclipse.jdt.core.formatter.insert_space_after_assignment_operator=insert
-org.eclipse.jdt.core.formatter.insert_space_after_at_in_annotation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_at_in_annotation_type_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_binary_operator=insert
-org.eclipse.jdt.core.formatter.insert_space_after_closing_angle_bracket_in_type_arguments=insert
-org.eclipse.jdt.core.formatter.insert_space_after_closing_angle_bracket_in_type_parameters=insert
-org.eclipse.jdt.core.formatter.insert_space_after_closing_brace_in_block=insert
-org.eclipse.jdt.core.formatter.insert_space_after_closing_paren_in_cast=insert
-org.eclipse.jdt.core.formatter.insert_space_after_colon_in_assert=insert
-org.eclipse.jdt.core.formatter.insert_space_after_colon_in_case=insert
-org.eclipse.jdt.core.formatter.insert_space_after_colon_in_conditional=insert
-org.eclipse.jdt.core.formatter.insert_space_after_colon_in_for=insert
-org.eclipse.jdt.core.formatter.insert_space_after_colon_in_labeled_statement=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_allocation_expression=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_annotation=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_array_initializer=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_constructor_declaration_parameters=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_constructor_declaration_throws=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_enum_constant_arguments=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_enum_declarations=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_explicitconstructorcall_arguments=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_for_increments=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_for_inits=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_method_declaration_parameters=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_method_declaration_throws=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_method_invocation_arguments=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_multiple_field_declarations=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_multiple_local_declarations=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_parameterized_type_reference=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_superinterfaces=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_type_arguments=insert
-org.eclipse.jdt.core.formatter.insert_space_after_comma_in_type_parameters=insert
-org.eclipse.jdt.core.formatter.insert_space_after_ellipsis=insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_angle_bracket_in_parameterized_type_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_angle_bracket_in_type_arguments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_angle_bracket_in_type_parameters=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_brace_in_array_initializer=insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_bracket_in_array_allocation_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_bracket_in_array_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_annotation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_cast=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_catch=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_constructor_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_enum_constant=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_for=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_if=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_method_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_method_invocation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_parenthesized_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_switch=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_synchronized=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_while=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_postfix_operator=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_prefix_operator=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_question_in_conditional=insert
-org.eclipse.jdt.core.formatter.insert_space_after_question_in_wildcard=do not insert
-org.eclipse.jdt.core.formatter.insert_space_after_semicolon_in_for=insert
-org.eclipse.jdt.core.formatter.insert_space_after_unary_operator=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_and_in_type_parameter=insert
-org.eclipse.jdt.core.formatter.insert_space_before_assignment_operator=insert
-org.eclipse.jdt.core.formatter.insert_space_before_at_in_annotation_type_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_before_binary_operator=insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_angle_bracket_in_parameterized_type_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_angle_bracket_in_type_arguments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_angle_bracket_in_type_parameters=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_brace_in_array_initializer=insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_bracket_in_array_allocation_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_bracket_in_array_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_annotation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_cast=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_catch=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_constructor_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_enum_constant=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_for=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_if=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_method_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_method_invocation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_parenthesized_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_switch=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_synchronized=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_while=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_colon_in_assert=insert
-org.eclipse.jdt.core.formatter.insert_space_before_colon_in_case=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_colon_in_conditional=insert
-org.eclipse.jdt.core.formatter.insert_space_before_colon_in_default=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_colon_in_for=insert
-org.eclipse.jdt.core.formatter.insert_space_before_colon_in_labeled_statement=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_allocation_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_annotation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_array_initializer=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_constructor_declaration_parameters=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_constructor_declaration_throws=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_enum_constant_arguments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_enum_declarations=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_explicitconstructorcall_arguments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_for_increments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_for_inits=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_method_declaration_parameters=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_method_declaration_throws=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_method_invocation_arguments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_multiple_field_declarations=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_multiple_local_declarations=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_parameterized_type_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_superinterfaces=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_type_arguments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_comma_in_type_parameters=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_ellipsis=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_angle_bracket_in_parameterized_type_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_angle_bracket_in_type_arguments=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_angle_bracket_in_type_parameters=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_annotation_type_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_anonymous_type_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_array_initializer=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_block=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_constructor_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_enum_constant=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_enum_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_method_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_switch=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_type_declaration=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_bracket_in_array_allocation_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_bracket_in_array_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_bracket_in_array_type_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_annotation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_annotation_type_member_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_catch=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_constructor_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_enum_constant=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_for=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_if=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_method_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_method_invocation=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_parenthesized_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_switch=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_synchronized=insert
-org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_while=insert
-org.eclipse.jdt.core.formatter.insert_space_before_parenthesized_expression_in_return=insert
-org.eclipse.jdt.core.formatter.insert_space_before_parenthesized_expression_in_throw=insert
-org.eclipse.jdt.core.formatter.insert_space_before_postfix_operator=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_prefix_operator=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_question_in_conditional=insert
-org.eclipse.jdt.core.formatter.insert_space_before_question_in_wildcard=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_semicolon=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_semicolon_in_for=do not insert
-org.eclipse.jdt.core.formatter.insert_space_before_unary_operator=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_brackets_in_array_type_reference=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_empty_braces_in_array_initializer=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_empty_brackets_in_array_allocation_expression=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_annotation_type_member_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_constructor_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_enum_constant=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_method_declaration=do not insert
-org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_method_invocation=do not insert
-org.eclipse.jdt.core.formatter.keep_else_statement_on_same_line=false
-org.eclipse.jdt.core.formatter.keep_empty_array_initializer_on_one_line=false
-org.eclipse.jdt.core.formatter.keep_imple_if_on_one_line=false
-org.eclipse.jdt.core.formatter.keep_then_statement_on_same_line=false
-org.eclipse.jdt.core.formatter.lineSplit=1000
-org.eclipse.jdt.core.formatter.never_indent_block_comments_on_first_column=false
-org.eclipse.jdt.core.formatter.never_indent_line_comments_on_first_column=false
-org.eclipse.jdt.core.formatter.number_of_blank_lines_at_beginning_of_method_body=0
-org.eclipse.jdt.core.formatter.number_of_empty_lines_to_preserve=2
-org.eclipse.jdt.core.formatter.put_empty_statement_on_new_line=true
-org.eclipse.jdt.core.formatter.tabulation.char=space
-org.eclipse.jdt.core.formatter.tabulation.size=4
-org.eclipse.jdt.core.formatter.use_tabs_only_for_leading_indentations=false
-org.eclipse.jdt.core.formatter.wrap_before_binary_operator=true
-org.eclipse.jdt.core.incompatibleJDKLevel=ignore
-org.eclipse.jdt.core.incompleteClasspath=error
+#Mon May 23 08:39:45 EDT 2011
+eclipse.preferences.version=1
+instance/org.eclipse.core.net/org.eclipse.core.net.hasMigrated=true
+org.eclipse.jdt.core.builder.cleanOutputFolder=clean
+org.eclipse.jdt.core.builder.duplicateResourceTask=warning
+org.eclipse.jdt.core.builder.invalidClasspath=abort
+org.eclipse.jdt.core.builder.resourceCopyExclusionFilter=*.launch
+org.eclipse.jdt.core.circularClasspath=error
+org.eclipse.jdt.core.classpath.exclusionPatterns=enabled
+org.eclipse.jdt.core.classpath.multipleOutputLocations=enabled
+org.eclipse.jdt.core.codeComplete.argumentPrefixes=
+org.eclipse.jdt.core.codeComplete.argumentSuffixes=
+org.eclipse.jdt.core.codeComplete.fieldPrefixes=
+org.eclipse.jdt.core.codeComplete.fieldSuffixes=
+org.eclipse.jdt.core.codeComplete.localPrefixes=
+org.eclipse.jdt.core.codeComplete.localSuffixes=
+org.eclipse.jdt.core.codeComplete.staticFieldPrefixes=
+org.eclipse.jdt.core.codeComplete.staticFieldSuffixes=
+org.eclipse.jdt.core.codeComplete.staticFinalFieldPrefixes=
+org.eclipse.jdt.core.codeComplete.staticFinalFieldSuffixes=
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
+org.eclipse.jdt.core.compiler.doc.comment.support=disabled
+org.eclipse.jdt.core.compiler.maxProblemPerUnit=100
+org.eclipse.jdt.core.compiler.problem.annotationSuperInterface=warning
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.autoboxing=ignore
+org.eclipse.jdt.core.compiler.problem.comparingIdentical=warning
+org.eclipse.jdt.core.compiler.problem.deadCode=warning
+org.eclipse.jdt.core.compiler.problem.deprecation=warning
+org.eclipse.jdt.core.compiler.problem.deprecationInDeprecatedCode=disabled
+org.eclipse.jdt.core.compiler.problem.deprecationWhenOverridingDeprecatedMethod=disabled
+org.eclipse.jdt.core.compiler.problem.discouragedReference=warning
+org.eclipse.jdt.core.compiler.problem.emptyStatement=ignore
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.fallthroughCase=ignore
+org.eclipse.jdt.core.compiler.problem.fatalOptionalError=enabled
+org.eclipse.jdt.core.compiler.problem.fieldHiding=ignore
+org.eclipse.jdt.core.compiler.problem.finalParameterBound=warning
+org.eclipse.jdt.core.compiler.problem.finallyBlockNotCompletingNormally=warning
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=error
+org.eclipse.jdt.core.compiler.problem.hiddenCatchBlock=warning
+org.eclipse.jdt.core.compiler.problem.incompatibleNonInheritedInterfaceMethod=warning
+org.eclipse.jdt.core.compiler.problem.incompleteEnumSwitch=ignore
+org.eclipse.jdt.core.compiler.problem.indirectStaticAccess=ignore
+org.eclipse.jdt.core.compiler.problem.invalidJavadoc=warning
+org.eclipse.jdt.core.compiler.problem.invalidJavadocTags=enabled
+org.eclipse.jdt.core.compiler.problem.invalidJavadocTagsDeprecatedRef=enabled
+org.eclipse.jdt.core.compiler.problem.invalidJavadocTagsNotVisibleRef=enabled
+org.eclipse.jdt.core.compiler.problem.invalidJavadocTagsVisibility=private
+org.eclipse.jdt.core.compiler.problem.localVariableHiding=ignore
+org.eclipse.jdt.core.compiler.problem.methodWithConstructorName=warning
+org.eclipse.jdt.core.compiler.problem.missingDeprecatedAnnotation=ignore
+org.eclipse.jdt.core.compiler.problem.missingHashCodeMethod=ignore
+org.eclipse.jdt.core.compiler.problem.missingJavadocComments=warning
+org.eclipse.jdt.core.compiler.problem.missingJavadocCommentsOverriding=enabled
+org.eclipse.jdt.core.compiler.problem.missingJavadocCommentsVisibility=public
+org.eclipse.jdt.core.compiler.problem.missingJavadocTags=warning
+org.eclipse.jdt.core.compiler.problem.missingJavadocTagsOverriding=enabled
+org.eclipse.jdt.core.compiler.problem.missingJavadocTagsVisibility=private
+org.eclipse.jdt.core.compiler.problem.missingOverrideAnnotation=ignore
+org.eclipse.jdt.core.compiler.problem.missingOverrideAnnotationForInterfaceMethodImplementation=disabled
+org.eclipse.jdt.core.compiler.problem.missingSerialVersion=ignore
+org.eclipse.jdt.core.compiler.problem.missingSynchronizedOnInheritedMethod=ignore
+org.eclipse.jdt.core.compiler.problem.noEffectAssignment=warning
+org.eclipse.jdt.core.compiler.problem.noImplicitStringConversion=warning
+org.eclipse.jdt.core.compiler.problem.nonExternalizedStringLiteral=ignore
+org.eclipse.jdt.core.compiler.problem.nullReference=warning
+org.eclipse.jdt.core.compiler.problem.overridingPackageDefaultMethod=warning
+org.eclipse.jdt.core.compiler.problem.parameterAssignment=ignore
+org.eclipse.jdt.core.compiler.problem.possibleAccidentalBooleanAssignment=ignore
+org.eclipse.jdt.core.compiler.problem.potentialNullReference=warning
+org.eclipse.jdt.core.compiler.problem.rawTypeReference=warning
+org.eclipse.jdt.core.compiler.problem.redundantNullCheck=ignore
+org.eclipse.jdt.core.compiler.problem.redundantSuperinterface=ignore
+org.eclipse.jdt.core.compiler.problem.specialParameterHidingField=disabled
+org.eclipse.jdt.core.compiler.problem.staticAccessReceiver=warning
+org.eclipse.jdt.core.compiler.problem.suppressOptionalErrors=disabled
+org.eclipse.jdt.core.compiler.problem.suppressWarnings=enabled
+org.eclipse.jdt.core.compiler.problem.syntheticAccessEmulation=ignore
+org.eclipse.jdt.core.compiler.problem.typeParameterHiding=warning
+org.eclipse.jdt.core.compiler.problem.uncheckedTypeOperation=ignore
+org.eclipse.jdt.core.compiler.problem.undocumentedEmptyBlock=ignore
+org.eclipse.jdt.core.compiler.problem.unhandledWarningToken=warning
+org.eclipse.jdt.core.compiler.problem.unnecessaryElse=ignore
+org.eclipse.jdt.core.compiler.problem.unnecessaryTypeCheck=ignore
+org.eclipse.jdt.core.compiler.problem.unqualifiedFieldAccess=ignore
+org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownException=ignore
+org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionExemptExceptionAndThrowable=enabled
+org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionIncludeDocCommentReference=enabled
+org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionWhenOverriding=disabled
+org.eclipse.jdt.core.compiler.problem.unusedImport=ignore
+org.eclipse.jdt.core.compiler.problem.unusedLabel=warning
+org.eclipse.jdt.core.compiler.problem.unusedLocal=ignore
+org.eclipse.jdt.core.compiler.problem.unusedObjectAllocation=ignore
+org.eclipse.jdt.core.compiler.problem.unusedParameter=ignore
+org.eclipse.jdt.core.compiler.problem.unusedParameterIncludeDocCommentReference=enabled
+org.eclipse.jdt.core.compiler.problem.unusedParameterWhenImplementingAbstract=disabled
+org.eclipse.jdt.core.compiler.problem.unusedParameterWhenOverridingConcrete=disabled
+org.eclipse.jdt.core.compiler.problem.unusedPrivateMember=ignore
+org.eclipse.jdt.core.compiler.problem.unusedWarningToken=warning
+org.eclipse.jdt.core.compiler.problem.varargsArgumentNeedCast=warning
+org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.taskCaseSensitive=enabled
+org.eclipse.jdt.core.compiler.taskPriorities=NORMAL,HIGH,NORMAL
+org.eclipse.jdt.core.compiler.taskTags=TODO,FIXME,XXX
+org.eclipse.jdt.core.formatter.align_type_members_on_columns=false
+org.eclipse.jdt.core.formatter.alignment_for_arguments_in_allocation_expression=20
+org.eclipse.jdt.core.formatter.alignment_for_arguments_in_enum_constant=16
+org.eclipse.jdt.core.formatter.alignment_for_arguments_in_explicit_constructor_call=20
+org.eclipse.jdt.core.formatter.alignment_for_arguments_in_method_invocation=16
+org.eclipse.jdt.core.formatter.alignment_for_arguments_in_qualified_allocation_expression=16
+org.eclipse.jdt.core.formatter.alignment_for_assignment=0
+org.eclipse.jdt.core.formatter.alignment_for_binary_expression=16
+org.eclipse.jdt.core.formatter.alignment_for_compact_if=16
+org.eclipse.jdt.core.formatter.alignment_for_conditional_expression=80
+org.eclipse.jdt.core.formatter.alignment_for_enum_constants=0
+org.eclipse.jdt.core.formatter.alignment_for_expressions_in_array_initializer=16
+org.eclipse.jdt.core.formatter.alignment_for_multiple_fields=16
+org.eclipse.jdt.core.formatter.alignment_for_parameters_in_constructor_declaration=16
+org.eclipse.jdt.core.formatter.alignment_for_parameters_in_method_declaration=16
+org.eclipse.jdt.core.formatter.alignment_for_selector_in_method_invocation=16
+org.eclipse.jdt.core.formatter.alignment_for_superclass_in_type_declaration=16
+org.eclipse.jdt.core.formatter.alignment_for_superinterfaces_in_enum_declaration=16
+org.eclipse.jdt.core.formatter.alignment_for_superinterfaces_in_type_declaration=16
+org.eclipse.jdt.core.formatter.alignment_for_throws_clause_in_constructor_declaration=18
+org.eclipse.jdt.core.formatter.alignment_for_throws_clause_in_method_declaration=16
+org.eclipse.jdt.core.formatter.blank_lines_after_imports=1
+org.eclipse.jdt.core.formatter.blank_lines_after_package=1
+org.eclipse.jdt.core.formatter.blank_lines_before_field=0
+org.eclipse.jdt.core.formatter.blank_lines_before_first_class_body_declaration=0
+org.eclipse.jdt.core.formatter.blank_lines_before_imports=1
+org.eclipse.jdt.core.formatter.blank_lines_before_member_type=1
+org.eclipse.jdt.core.formatter.blank_lines_before_method=1
+org.eclipse.jdt.core.formatter.blank_lines_before_new_chunk=1
+org.eclipse.jdt.core.formatter.blank_lines_before_package=0
+org.eclipse.jdt.core.formatter.blank_lines_between_import_groups=1
+org.eclipse.jdt.core.formatter.blank_lines_between_type_declarations=1
+org.eclipse.jdt.core.formatter.brace_position_for_annotation_type_declaration=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_anonymous_type_declaration=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_array_initializer=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_block=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_block_in_case=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_constructor_declaration=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_enum_constant=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_enum_declaration=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_method_declaration=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_switch=end_of_line
+org.eclipse.jdt.core.formatter.brace_position_for_type_declaration=end_of_line
+org.eclipse.jdt.core.formatter.comment.clear_blank_lines_in_block_comment=true
+org.eclipse.jdt.core.formatter.comment.clear_blank_lines_in_javadoc_comment=true
+org.eclipse.jdt.core.formatter.comment.format_block_comments=true
+org.eclipse.jdt.core.formatter.comment.format_header=false
+org.eclipse.jdt.core.formatter.comment.format_html=true
+org.eclipse.jdt.core.formatter.comment.format_javadoc_comments=true
+org.eclipse.jdt.core.formatter.comment.format_line_comments=true
+org.eclipse.jdt.core.formatter.comment.format_source_code=true
+org.eclipse.jdt.core.formatter.comment.indent_parameter_description=false
+org.eclipse.jdt.core.formatter.comment.indent_root_tags=true
+org.eclipse.jdt.core.formatter.comment.insert_new_line_before_root_tags=insert
+org.eclipse.jdt.core.formatter.comment.insert_new_line_for_parameter=do not insert
+org.eclipse.jdt.core.formatter.comment.line_length=132
+org.eclipse.jdt.core.formatter.compact_else_if=true
+org.eclipse.jdt.core.formatter.continuation_indentation=2
+org.eclipse.jdt.core.formatter.continuation_indentation_for_array_initializer=2
+org.eclipse.jdt.core.formatter.format_guardian_clause_on_one_line=false
+org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_annotation_declaration_header=true
+org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_enum_constant_header=true
+org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_enum_declaration_header=true
+org.eclipse.jdt.core.formatter.indent_body_declarations_compare_to_type_header=true
+org.eclipse.jdt.core.formatter.indent_breaks_compare_to_cases=true
+org.eclipse.jdt.core.formatter.indent_empty_lines=false
+org.eclipse.jdt.core.formatter.indent_statements_compare_to_block=true
+org.eclipse.jdt.core.formatter.indent_statements_compare_to_body=true
+org.eclipse.jdt.core.formatter.indent_switchstatements_compare_to_cases=true
+org.eclipse.jdt.core.formatter.indent_switchstatements_compare_to_switch=true
+org.eclipse.jdt.core.formatter.indentation.size=4
+org.eclipse.jdt.core.formatter.insert_new_line_after_opening_brace_in_array_initializer=do not insert
+org.eclipse.jdt.core.formatter.insert_new_line_at_end_of_file_if_missing=do not insert
+org.eclipse.jdt.core.formatter.insert_new_line_before_catch_in_try_statement=insert
+org.eclipse.jdt.core.formatter.insert_new_line_before_closing_brace_in_array_initializer=do not insert
+org.eclipse.jdt.core.formatter.insert_new_line_before_else_in_if_statement=insert
+org.eclipse.jdt.core.formatter.insert_new_line_before_finally_in_try_statement=insert
+org.eclipse.jdt.core.formatter.insert_new_line_before_while_in_do_statement=do not insert
+org.eclipse.jdt.core.formatter.insert_new_line_in_empty_annotation_declaration=insert
+org.eclipse.jdt.core.formatter.insert_new_line_in_empty_anonymous_type_declaration=insert
+org.eclipse.jdt.core.formatter.insert_new_line_in_empty_block=insert
+org.eclipse.jdt.core.formatter.insert_new_line_in_empty_enum_constant=insert
+org.eclipse.jdt.core.formatter.insert_new_line_in_empty_enum_declaration=insert
+org.eclipse.jdt.core.formatter.insert_new_line_in_empty_method_body=insert
+org.eclipse.jdt.core.formatter.insert_new_line_in_empty_type_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_after_and_in_type_parameter=insert
+org.eclipse.jdt.core.formatter.insert_space_after_assignment_operator=insert
+org.eclipse.jdt.core.formatter.insert_space_after_at_in_annotation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_at_in_annotation_type_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_binary_operator=insert
+org.eclipse.jdt.core.formatter.insert_space_after_closing_angle_bracket_in_type_arguments=insert
+org.eclipse.jdt.core.formatter.insert_space_after_closing_angle_bracket_in_type_parameters=insert
+org.eclipse.jdt.core.formatter.insert_space_after_closing_brace_in_block=insert
+org.eclipse.jdt.core.formatter.insert_space_after_closing_paren_in_cast=insert
+org.eclipse.jdt.core.formatter.insert_space_after_colon_in_assert=insert
+org.eclipse.jdt.core.formatter.insert_space_after_colon_in_case=insert
+org.eclipse.jdt.core.formatter.insert_space_after_colon_in_conditional=insert
+org.eclipse.jdt.core.formatter.insert_space_after_colon_in_for=insert
+org.eclipse.jdt.core.formatter.insert_space_after_colon_in_labeled_statement=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_allocation_expression=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_annotation=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_array_initializer=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_constructor_declaration_parameters=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_constructor_declaration_throws=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_enum_constant_arguments=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_enum_declarations=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_explicitconstructorcall_arguments=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_for_increments=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_for_inits=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_method_declaration_parameters=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_method_declaration_throws=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_method_invocation_arguments=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_multiple_field_declarations=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_multiple_local_declarations=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_parameterized_type_reference=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_superinterfaces=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_type_arguments=insert
+org.eclipse.jdt.core.formatter.insert_space_after_comma_in_type_parameters=insert
+org.eclipse.jdt.core.formatter.insert_space_after_ellipsis=insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_angle_bracket_in_parameterized_type_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_angle_bracket_in_type_arguments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_angle_bracket_in_type_parameters=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_brace_in_array_initializer=insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_bracket_in_array_allocation_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_bracket_in_array_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_annotation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_cast=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_catch=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_constructor_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_enum_constant=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_for=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_if=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_method_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_method_invocation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_parenthesized_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_switch=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_synchronized=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_opening_paren_in_while=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_postfix_operator=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_prefix_operator=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_question_in_conditional=insert
+org.eclipse.jdt.core.formatter.insert_space_after_question_in_wildcard=do not insert
+org.eclipse.jdt.core.formatter.insert_space_after_semicolon_in_for=insert
+org.eclipse.jdt.core.formatter.insert_space_after_unary_operator=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_and_in_type_parameter=insert
+org.eclipse.jdt.core.formatter.insert_space_before_assignment_operator=insert
+org.eclipse.jdt.core.formatter.insert_space_before_at_in_annotation_type_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_before_binary_operator=insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_angle_bracket_in_parameterized_type_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_angle_bracket_in_type_arguments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_angle_bracket_in_type_parameters=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_brace_in_array_initializer=insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_bracket_in_array_allocation_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_bracket_in_array_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_annotation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_cast=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_catch=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_constructor_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_enum_constant=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_for=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_if=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_method_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_method_invocation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_parenthesized_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_switch=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_synchronized=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_closing_paren_in_while=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_colon_in_assert=insert
+org.eclipse.jdt.core.formatter.insert_space_before_colon_in_case=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_colon_in_conditional=insert
+org.eclipse.jdt.core.formatter.insert_space_before_colon_in_default=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_colon_in_for=insert
+org.eclipse.jdt.core.formatter.insert_space_before_colon_in_labeled_statement=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_allocation_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_annotation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_array_initializer=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_constructor_declaration_parameters=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_constructor_declaration_throws=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_enum_constant_arguments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_enum_declarations=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_explicitconstructorcall_arguments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_for_increments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_for_inits=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_method_declaration_parameters=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_method_declaration_throws=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_method_invocation_arguments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_multiple_field_declarations=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_multiple_local_declarations=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_parameterized_type_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_superinterfaces=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_type_arguments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_comma_in_type_parameters=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_ellipsis=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_angle_bracket_in_parameterized_type_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_angle_bracket_in_type_arguments=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_angle_bracket_in_type_parameters=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_annotation_type_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_anonymous_type_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_array_initializer=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_block=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_constructor_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_enum_constant=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_enum_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_method_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_switch=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_brace_in_type_declaration=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_bracket_in_array_allocation_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_bracket_in_array_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_bracket_in_array_type_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_annotation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_annotation_type_member_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_catch=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_constructor_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_enum_constant=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_for=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_if=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_method_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_method_invocation=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_parenthesized_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_switch=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_synchronized=insert
+org.eclipse.jdt.core.formatter.insert_space_before_opening_paren_in_while=insert
+org.eclipse.jdt.core.formatter.insert_space_before_parenthesized_expression_in_return=insert
+org.eclipse.jdt.core.formatter.insert_space_before_parenthesized_expression_in_throw=insert
+org.eclipse.jdt.core.formatter.insert_space_before_postfix_operator=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_prefix_operator=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_question_in_conditional=insert
+org.eclipse.jdt.core.formatter.insert_space_before_question_in_wildcard=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_semicolon=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_semicolon_in_for=do not insert
+org.eclipse.jdt.core.formatter.insert_space_before_unary_operator=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_brackets_in_array_type_reference=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_empty_braces_in_array_initializer=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_empty_brackets_in_array_allocation_expression=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_annotation_type_member_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_constructor_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_enum_constant=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_method_declaration=do not insert
+org.eclipse.jdt.core.formatter.insert_space_between_empty_parens_in_method_invocation=do not insert
+org.eclipse.jdt.core.formatter.keep_else_statement_on_same_line=false
+org.eclipse.jdt.core.formatter.keep_empty_array_initializer_on_one_line=false
+org.eclipse.jdt.core.formatter.keep_imple_if_on_one_line=false
+org.eclipse.jdt.core.formatter.keep_then_statement_on_same_line=false
+org.eclipse.jdt.core.formatter.lineSplit=1000
+org.eclipse.jdt.core.formatter.never_indent_block_comments_on_first_column=false
+org.eclipse.jdt.core.formatter.never_indent_line_comments_on_first_column=false
+org.eclipse.jdt.core.formatter.number_of_blank_lines_at_beginning_of_method_body=0
+org.eclipse.jdt.core.formatter.number_of_empty_lines_to_preserve=2
+org.eclipse.jdt.core.formatter.put_empty_statement_on_new_line=true
+org.eclipse.jdt.core.formatter.tabulation.char=space
+org.eclipse.jdt.core.formatter.tabulation.size=4
+org.eclipse.jdt.core.formatter.use_tabs_only_for_leading_indentations=false
+org.eclipse.jdt.core.formatter.wrap_before_binary_operator=true
+org.eclipse.jdt.core.incompatibleJDKLevel=ignore
+org.eclipse.jdt.core.incompleteClasspath=error
Index: build.xml
===================================================================
--- build.xml	(revision 30259)
+++ build.xml	(revision 37225)
@@ -129,16 +129,8 @@
 	</target>
 	
 	
-	<target name="dist-local" if="is.local.build" depends="clean,filter-project,filter-local,dist-local-cas,dist-local-rice,overlay-additional-web-content,filter-project-schema" description="Prepare local configuration files and tokenized resources and deploy tomcat context file on development workstation">
+	<target name="dist-local" if="is.local.build" depends="clean,filter-project,filter-local,dist-local-cas,dist-local-rice,overlay-additional-web-content,overlay-additional-schema,filter-project-schema" description="Prepare local configuration files and tokenized resources and deploy tomcat context file on development workstation">
 		<copy file="${metainf.directory}/${context.file}" tofile="${appserver.localhost.dir}/${ant.project.name}-${build.environment}.xml" overwrite="true" />
-		<if>
-			<isset property="institution.lib.directory" />
-			<then>
-				<copy todir="${lib.directory}" overwrite="true">
-					<fileset dir="${institution.lib.directory}" includes="*.jar" />
-				</copy>
-			</then>
-		</if>
 	</target>
 	
 	<target name="dist-local-cas" if="is.local.build" depends="filter-project">
@@ -163,6 +155,27 @@
 	</target>
 
 	<target name="test-local" depends="dist-local,make-tests,test" description="Run all unit tests and format results"/>
+	
+	<target name="filter-libraries" depends="init-properties" description="Copies over institutional lib libraries to the application's library directory">
+		<mkdir dir="${lib.directory}" />
+				
+		<copy todir="${lib.directory}" verbose="true">
+			<fileset dir="${build.rice.lib.directory}">
+			    <include name="*.jar"/>
+			</fileset>
+			<fileset dir="${build.kfs.lib.directory}">
+			    <include name="*.jar"/>
+			</fileset>
+		</copy>
+		<if>
+			<isset property="institution.lib.directory" />
+			<then>
+				<copy todir="${lib.directory}" overwrite="true">
+					<fileset dir="${institution.lib.directory}" includes="*.jar" />
+				</copy>
+			</then>
+		</if>
+	</target>
 
 	<target name="echo-properties" depends="init-properties" description="Print all build properties that have been set">
 		<echoproperties />
@@ -374,28 +387,38 @@
             </then>
         </if>
 		
+		<if>
+			<and>
+				<isset property="institution.log4j.properties.file" />
+					<not>	        	
+						<equals arg1="" arg2="${institution.log4j.properties.file}" trim="true" />
+					</not>
+			</and>
+			<then>
+				<loadfile property="institutional.log4j" srcfile="${institution.log4j.properties.file}"><filterchain><expandproperties/></filterchain></loadfile>
+			</then>
+		</if>
+		
 		<loadfile property="cas.context" srcfile="${build.appserver.directory}/${cas.context.file}"><filterchain><expandproperties/></filterchain></loadfile>
 		<loadfile property="rice.config" srcfile="${build.appserver.directory}/standalone-rice-config.xml"><filterchain><expandproperties/></filterchain></loadfile>
 		
 		<!-- update the lib paths for the app server based on the tomcat version -->
 	    <if>
-	        <equals arg1="6" arg2="${tomcat.version}" trim="true" />
+	        <equals arg1="5" arg2="${tomcat.version}" trim="true" />
 	        <then>
-	            <property name="appserver.lib.dir" value="${appserver.home}/lib" />
-	            <property name="appserver.classes.dir" value="${appserver.home}/lib" />
-	        </then>
-            <else> <!-- default back to Tomcat 5 locations -->
 	            <property name="appserver.lib.dir" value="${appserver.home}/common/lib" />
 	            <property name="appserver.classes.dir" value="${appserver.home}/common/classes" />
-            </else>
+	        </then>
         </if>
+		<!-- default to this version unless 5 selected --> 
+        <property name="appserver.lib.dir" value="${appserver.home}/lib" />
+        <property name="appserver.classes.dir" value="${appserver.home}/lib" />
 		
 	</target>
 
-	<target name="init-make-references" depends="init-properties">
+	<target name="init-make-references" depends="init-properties,filter-libraries">
 		<path id="compile.source.classpath">
-			<fileset dir="${build.kfs.lib.directory}" includes="*.jar" />
-			<fileset dir="${build.rice.lib.directory}" includes="*.jar" />
+			<fileset dir="${lib.directory}" includes="*.jar"/>
 			<fileset dir="${build.server.lib.directory}" includes="*-api.jar" />
 			<fileset dir="${build.appserver.directory}" includes="*.jar" /> <!-- should not be needed but commons logging is here -->	
 			<pathelement location="${build.directory}/${log4j.library.file}" />
@@ -514,13 +537,7 @@
 	</target>
 
 	<target name="filter-project-log4j" unless="use.p6spy.local" depends="init-properties">
-	    <if> <!-- we can only copy this file to the app server IF we are running a local build.  Otherwise, we need to assume that it is
-	    already there. -->
-	        <isset property="is.local.build" />
-	        <then>
-        		<copy file="${build.directory}/${log4j.library.file}" todir="${appserver.lib.dir}"/>
-            </then>
-        </if>
+		<copy file="${build.directory}/${log4j.library.file}" todir="${lib.directory}" />
 	</target>
 
 	<target name="filter-project-p6spy" if="use.p6spy.local" depends="filter-project-log4j">
@@ -538,7 +555,7 @@
 	</target>
 
 	<target name="filter-project-rice" unless="dont.filter.project.rice" depends="init-properties,clean-rice">
-		<echo message="Copying Rice Web Content from ${build.appserver.directory}/${rice.server.war.file.name}" />
+		<echo message="Copying Rice Web Content from ${rice.server.war.directory}/${rice.server.war.file.name}" />
 		<!--
 		<if>
 			<isset property="rice.standalone.flag" />
@@ -547,7 +564,7 @@
 			</then>
 		</if>
 		-->
-		<unzip dest="${webroot.directory}" src="${build.appserver.directory}/${rice.server.war.file.name}">
+		<unzip dest="${webroot.directory}" src="${rice.server.war.directory}/${rice.server.war.file.name}">
 			<patternset>
 				<exclude name="META-INF/**"/>
 				<exclude name="WEB-INF/*"/>
@@ -597,17 +614,8 @@
 		<replace file="${spring.ide.support.file}" token="${file.separator}" value="/" />
   	</target>
 	
-	<target name="filter-project" depends="filter-project-p6spy,filter-project-help,filter-project-rice,filter-project-spring-ide">
-		<mkdir dir="${lib.directory}" />
+	<target name="filter-project" depends="filter-project-p6spy,filter-project-help,filter-project-rice,filter-project-spring-ide,filter-libraries">
 		
-		<copy todir="${lib.directory}" verbose="true">
-			<fileset dir="${build.rice.lib.directory}">
-			    <include name="*.jar"/>
-			</fileset>
-			<fileset dir="${build.kfs.lib.directory}">
-			    <include name="*.jar"/>
-			</fileset>
-		</copy>
 		
 		<echo file="${source.directory}/${configuration.file}" message="${configuration}" />
 	    <if>
@@ -675,6 +683,12 @@
 		<mkdir dir="${settings.directory}" />
 		<echo file="${log4j.settings.file}" message="${log4j}" />
 		<if>
+			<isset property="institutional.log4j"/>
+			<then>
+				<echo append="true" file="${log4j.settings.file}" message="${line.separator}${institutional.log4j}"/>
+			</then>
+		</if>
+		<if>
 			<isset property="institution.settings.directory" />
 			<then>
 				<copy todir="${settings.directory}" overwrite="true">
@@ -724,7 +738,9 @@
 	    <echo message="Compiling Source from ${source.directory} into ${war.classes.directory}" />
 		<javac destdir="${war.classes.directory}" srcdir="${source.directory}" includeantruntime="false"
 			   debug="true" fork="true" memoryinitialsize="${compile.min.memory}" memorymaximumsize="${compile.max.memory}">
-			<classpath refid="compile.source.classpath" />
+			<classpath>
+				<path refid="compile.source.classpath" />
+			</classpath>
 		</javac>
 		<copy todir="${war.classes.directory}">
 			<fileset dir="${source.directory}" includes="${non.java.resources}" />
@@ -740,9 +756,6 @@
             <classpath>
                 <pathelement location="${war.classes.directory}"/>
                 <path refid="compile.source.classpath" />
-                <fileset dir="${institution.lib.directory}">
-                    <include name="*.jar"/>
-                </fileset>
             </classpath>
         </javac>
         <copy todir="${war.classes.directory}" overwrite="true" verbose="true">
@@ -849,6 +862,10 @@
 				<fileset dir="${test.unit.source.directory}" includes="${tests.includes}" excludes="${tests.excludes}" />
 				<fileset dir="${test.integration.source.directory}" includes="${tests.includes}" excludes="${tests.excludes}" />
 			</batchtest>
+			<!-- run institution tests if possible -->
+			<batchtest todir="${test.xml.results.directory}" if="institution.test.source.directory">
+				<fileset dir="${institution.test.source.directory}" includes="${tests.includes}" excludes="${tests.excludes}" />
+			</batchtest>
 			<test name="org.kuali.kfs.sys.context.${tests.shutdown.class}" todir="${test.xml.results.directory}" />
 		</junit>
 		<mkdir dir="${test.html.results.directory}" />
@@ -876,6 +893,12 @@
 		<mkdir dir="temp"/>
 		<echo file="temp/${log4j.file}" message="${log4j}" />
 		<if>
+			<isset property="institutional.log4j"/>
+			<then>
+				<echo append="true" file="temp/${log4j.file}" message="${line.separator}${institutional.log4j}"/>
+			</then>
+		</if>
+		<if>
 			<isset property="institution.settings.directory" />
 			<then>
 				<copy todir="temp" overwrite="true">
@@ -908,18 +931,10 @@
 		<zip destfile="${deploy.working.directory}/skel.zip" basedir="${build.work.directory}" />
 	</target>
 	
-	<target name="dist" depends="make-source,overlay-additional-web-content,filter-project-schema">
+	<target name="dist" depends="make-source,overlay-additional-web-content,overlay-additional-schema,filter-project-schema">
 		<copy todir="${war.directory}">
 			<fileset dir="${webroot.directory}" excludes="WEB-INF/classes/**/**" />
 		</copy>
-		<if>
-			<isset property="institution.lib.directory" />
-			<then>
-				<copy todir="${war.directory}/WEB-INF/lib" overwrite="true">
-					<fileset dir="${institution.lib.directory}" includes="*.jar" />
-				</copy>
-			</then>
-		</if>
 		<jar jarfile="${ant.project.name}-${build.environment}.war" basedir="${war.directory}" compress="false" />
 	</target>
 
@@ -931,6 +946,14 @@
         </copy>
     </target>
 	
+	<target name="overlay-additional-schema" depends="init-properties" if="institution.schema.directory">
+	        <copy todir="${build.project.directory}/xsd" preservelastmodified="true" overwrite="true">
+	            <fileset dir="${institution.schema.directory}">
+	                <include name="**/*" />
+	            </fileset>
+	        </copy>
+	 </target>
+	
 	<target name="continuous-integration" depends="clean,make-tests,test">
 		<fail if="tests.failed" message="Tests failed" />
 	</target>
